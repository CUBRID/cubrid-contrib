-- File Open : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\presv\format\PresvFormatMonitor.xml


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\presv\format\PresvFormatMonitor.xml
-- Query    : select
-- Query Id : findPresvFormatMonitorWait

		SELECT A.wflb_server_ip AS server_ip_address			, (SELECT Z.com_cd_nm FROM TB_ZZCOMCD Z WHERE Z.com_type_cd='NE03' AND Z.com_cd=A.status) AS server_status			, (SELECT COUNT(1) FROM TB_STREQTRANS B WHERE B.wflb_server_ip=A.wflb_server_ip AND B.request_status IN ('A')) AS wait_cnt			, TO_CHAR(A.update_date, 'YYYYMMDDHH24MISS') AS last_response_dtime			, NVL(((CAST(TO_CHAR(sys_datetime,'YYYYMMDDHH24MISS') AS TIMESTAMP)-CAST(TO_CHAR(A.update_date,'YYYYMMDDHH24MISS') AS TIMESTAMP))),0) AS wait_time		FROM  TB_STWFLBMONITOR A;


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\presv\format\PresvFormatMonitor.xml
-- Query    : select
-- Query Id : findPresvFormatMonitorServerList

		SELECT C.doc_det_gubun			, NVL(B.job_record_cnt,0) AS job_record_cnt			, NVL(B.job_file_cnt,0) AS job_file_cnt			, (CASE WHEN NVL(B.job_file_cnt,0) = 0 THEN '-'					WHEN NVL(B.gap_sec,0) = 0 THEN '알수없음'					WHEN 60>(B.job_file_cnt * B.gap_sec)   THEN (B.job_file_cnt * B.gap_sec)||'초'					WHEN 3600>(B.job_file_cnt * B.gap_sec) THEN RTRIM(LTRIM(TO_CHAR((B.job_file_cnt * B.gap_sec / 60),'999990'),' '),0)||'분'										ELSE RTRIM(LTRIM(TO_CHAR((B.job_file_cnt * B.gap_sec / 3600),'999990'),' '),0)||'시간'				END) AS estimate_nm            , (SELECT COUNT(1) FROM TB_STREQTRANS Z WHERE Z.NEO_GUBUN = C.doc_det_gubun AND REQUEST_STATUS IN ('C','D') AND (TRUNC(Z.REQUEST_START_TIME) = TRUNC(SYSDATE) OR TRUNC(Z.REQUEST_END_TIME) = TRUNC(SYSDATE))) AS today_job_record_cnt            , (SELECT COUNT(1) FROM TB_STREQRESULT Y, TB_STREQTRANS Z WHERE Y.RECORD_CENTER_ID = Z.RECORD_CENTER_ID AND Y.JOB_ID = Z.JOB_ID AND Z.NEO_GUBUN = C.doc_det_gubun AND Y.REQUEST_STATUS IN ('C','D') AND (TRUNC(Z.REQUEST_START_TIME) = TRUNC(SYSDATE) OR TRUNC(Z.REQUEST_END_TIME) = TRUNC(SYSDATE))) today_job_file_cnt		FROM (               SELECT NEO_GUBUN AS doc_det_gubun,                       COUNT(1) AS job_record_cnt,                       SUM(CNT) AS job_file_cnt,                      NVL((SELECT RTRIM(LTRIM(TO_CHAR((((Z.REQUEST_END_TIME - Z.REQUEST_START_TIME)) / CNT/1000),'999990'),' '),0) 			FROM (SELECT COUNT(1) CNT,  NEO_GUBUN , REQUEST_END_TIME, REQUEST_START_TIME, A.JOB_ID FROM TB_STREQTRANS A INNER JOIN (SELECT MAX(JOB_ID) AS MAX_JOB_ID FROM TB_STREQTRANS GROUP BY NEO_GUBUN, NEOCHASU, RECORD_ID, FOLDER_ID, RECORD_CENTER_ID) M ON M.MAX_JOB_ID = A.JOB_ID LEFT OUTER JOIN TB_STREQFILE B ON B.JOB_ID = A.JOB_ID GROUP BY A.JOB_ID, NEO_GUBUN , REQUEST_END_TIME, REQUEST_START_TIME ) Z WHERE Z.NEO_GUBUN = C.NEO_GUBUN AND Z.job_id = (SELECT MAX(Y.job_id) FROM TB_STREQTRANS Y WHERE Y.NEO_GUBUN=C.NEO_GUBUN AND Y.REQUEST_START_TIME IS NOT NULL AND Y.REQUEST_END_TIME IS NOT NULL)),0) AS gap_sec                     FROM ( SELECT COUNT(1) CNT,  NEO_GUBUN, A.JOB_ID FROM TB_STREQTRANS A INNER JOIN (SELECT MAX(JOB_ID) AS MAX_JOB_ID FROM TB_STREQTRANS GROUP BY NEO_GUBUN, NEOCHASU, RECORD_ID, FOLDER_ID, RECORD_CENTER_ID) M ON M.MAX_JOB_ID = A.JOB_ID LEFT OUTER JOIN TB_STREQFILE B ON B.JOB_ID = A.JOB_ID WHERE REQUEST_STATUS IN ('-','A','B') GROUP BY A.JOB_ID, NEO_GUBUN ) C                GROUP BY  NEO_GUBUN		) B		, (SELECT Z.com_cd AS doc_det_gubun FROM TB_ZZCOMCD Z WHERE Z.com_type_cd='ST22') C		WHERE C.doc_det_gubun=B.doc_det_gubun(+)		ORDER BY C.doc_det_gubun;


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\presv\format\PresvFormatMonitor.xml
-- Query    : select
-- Query Id : findPresvFormatMonitorRecordCenterList

		SELECT C.record_center_id			, C.record_center_nm			, C.doc_det_gubun			, NVL(B.job_record_cnt,0) AS job_record_cnt			, NVL(B.job_file_cnt,0) AS job_file_cnt			, (CASE WHEN NVL(B.job_file_cnt,0) = 0 THEN '-'					WHEN NVL(B.gap_sec,0) = 0 THEN '알수없음'					WHEN 60>(B.job_file_cnt * B.gap_sec) THEN (B.job_file_cnt * B.gap_sec)||'초'					WHEN 3600>(B.job_file_cnt * B.gap_sec) THEN RTRIM(LTRIM(TO_CHAR((B.job_file_cnt * B.gap_sec / 60),'999990'),' '),0)||'분'					ELSE RTRIM(LTRIM(TO_CHAR((B.job_file_cnt * B.gap_sec / 3600),'999990'),' '),0)||'시간'				END) AS estimate_nm            , (SELECT COUNT(1) FROM TB_STREQTRANS Z WHERE Z.record_center_id = C.record_center_id AND Z.NEO_GUBUN = C.doc_det_gubun AND REQUEST_STATUS IN ('C','D') AND (TRUNC(Z.REQUEST_START_TIME) = TRUNC(SYSDATE) OR TRUNC(Z.REQUEST_END_TIME) = TRUNC(SYSDATE))) AS today_job_record_cnt            , (SELECT COUNT(1) FROM TB_STREQRESULT Y, TB_STREQTRANS Z WHERE Y.record_center_id = C.record_center_id AND Y.RECORD_CENTER_ID = Z.RECORD_CENTER_ID AND Y.JOB_ID = Z.JOB_ID AND Z.NEO_GUBUN = C.doc_det_gubun AND Y.REQUEST_STATUS IN ('C','D') AND (TRUNC(Z.REQUEST_START_TIME) = TRUNC(SYSDATE) OR TRUNC(Z.REQUEST_END_TIME) = TRUNC(SYSDATE))) today_job_file_cnt		FROM (				SELECT record_center_id					, neo_gubun AS doc_det_gubun				    , COUNT(1) AS job_record_cnt				    , SUM(cnt) AS job_file_cnt				    , NVL((SELECT RTRIM(LTRIM(TO_CHAR((((Z.REQUEST_END_TIME - Z.REQUEST_START_TIME)) / CNT/1000),'999990'),' '),0) FROM (SELECT COUNT(1) CNT,  NEO_GUBUN , REQUEST_END_TIME, REQUEST_START_TIME, (select A.JOB_ID FROM TB_STREQTRANS WHERE REQUEST_START_TIME = (SELECT MAX(REQUEST_START_TIME) FROM TB_STREQTRANS)) AS JOB_ID FROM TB_STREQTRANS A, TB_STREQFILE B  WHERE B.JOB_ID = A.JOB_ID GROUP BY A.JOB_ID, NEO_GUBUN , REQUEST_END_TIME, REQUEST_START_TIME ) Z WHERE Z.NEO_GUBUN = C.NEO_GUBUN AND Z.job_id=(SELECT MAX(Y.job_id) FROM TB_STREQTRANS Y WHERE Y.NEO_GUBUN=C.NEO_GUBUN AND Y.REQUEST_START_TIME IS NOT NULL AND Y.REQUEST_END_TIME IS NOT NULL)),0) AS gap_sec      				FROM ( SELECT COUNT(1) CNT,  NEO_GUBUN, A.JOB_ID, A.record_center_id FROM TB_STREQTRANS A INNER JOIN (SELECT MAX(JOB_ID) AS MAX_JOB_ID FROM TB_STREQTRANS GROUP BY NEO_GUBUN, NEOCHASU, RECORD_ID, FOLDER_ID, RECORD_CENTER_ID) M ON M.MAX_JOB_ID = A.JOB_ID LEFT OUTER JOIN TB_STREQFILE B ON B.JOB_ID = A.JOB_ID WHERE REQUEST_STATUS IN ('-','A','B') GROUP BY A.JOB_ID, NEO_GUBUN, A.record_center_id ) C 				GROUP BY record_center_id, neo_gubun		) B		, (SELECT R.record_center_id, R.record_center_nm, Z.com_cd AS doc_det_gubun FROM TB_STRECORDCENTER R, TB_ZZCOMCD Z WHERE Z.com_type_cd='ST22') C		WHERE C.record_center_id=B.record_center_id(+)		AND   C.doc_det_gubun=B.doc_det_gubun(+)		ORDER BY C.record_center_id, C.doc_det_gubun	;


-- File Close : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\presv\format\PresvFormatMonitor.xml
