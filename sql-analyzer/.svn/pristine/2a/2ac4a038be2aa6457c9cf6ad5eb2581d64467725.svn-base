<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="presv.format">

	<!--
		장기보존포맷변환(재변환)_생산부서별변환
		: 생산부서별변환 목록 조회 (재변환)
	-->
	<resultMap id="findPresvFormatNeoReconvOrgPagedList-resultMap" class="rms.presv.format.domain.PresvFormatNeoResult">
		<result property="orgCd"			column="org_cd" />
		<result property="orgNm"			column="org_nm" />
		<result property="orgAbbrNm"		column="org_abbr_nm" />
		<result property="folderTotCnt"		column="folder_tot_cnt" />
		<result property="folderDefCnt"		column="folder_def_cnt" />
		<result property="folderIngCnt"		column="folder_ing_cnt" />
		<result property="folderFailCnt"	column="folder_fail_cnt" />
		<result property="folderEndCnt"		column="folder_end_cnt" />
		<result property="recordTotCnt"		column="record_tot_cnt" />
		<result property="recordDefCnt"		column="record_def_cnt" />
		<result property="recordIngCnt"		column="record_ing_cnt" />
		<result property="recordFailCnt"	column="record_fail_cnt" />
		<result property="recordEndCnt"		column="record_end_cnt" />
	</resultMap>
	<select id="countPresvFormatNeoReconvOrgPagedList" parameterClass="rms.presv.format.domain.PresvFormatNeo" resultClass="java.lang.Long">
		SELECT COUNT(1) 
		FROM (
			SELECT A.record_center_id, A.org_cd
			FROM   TB_RDFOLDER A
			JOIN (SELECT *
				FROM TB_DFRECVTRANSFLIST
				WHERE record_center_id = #recordCenterId:VARCHAR#
				AND confm_transf_div_cd IN ('1', '2', '3')
				AND (exam_rslt_cd IS NULL OR exam_rslt_cd != '1')
				AND transf_grp_sno IN (SELECT MAX(transf_grp_sno) FROM TB_DFTRANSFWORK WHERE record_center_id = #recordCenterId:VARCHAR# AND TO_NUMBER(transf_handl_state) > 1)) DF
			ON DF.record_center_id = A.record_center_id
			AND DF.folder_id = A.folder_id
			AND A.folder_keep_state_cd IN ('01', '04')
			<isNotEmpty prepend="AND" property="orgCd">
				A.org_cd = #orgCd:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
				</isNotEmpty>
				<isEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
				</isEmpty>
			</isNotEmpty>
			<isEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
				</isNotEmpty>
			</isEmpty>
			<isNotEmpty property="presvTermCd">
				<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR# 
				</isEqual>
				<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd = #presvTermCd:VARCHAR# 
				</isNotEqual>
			</isNotEmpty>
			GROUP BY A.record_center_id, A.org_cd                                     
		)
	</select>
	<select id="findPresvFormatNeoReconvOrgPagedList" parameterClass="rms.presv.format.domain.PresvFormatNeo" resultMap="findPresvFormatNeoReconvOrgPagedList-resultMap">
		SELECT E.record_center_id
			, E.org_cd
			, (SELECT Z.org_nm FROM TB_STORG Z WHERE Z.record_center_id=E.record_center_id AND Z.org_cd=E.org_cd) org_nm
			, (SELECT Z.org_abbr_nm FROM TB_STORG Z WHERE Z.record_center_id=E.record_center_id AND Z.org_cd=E.org_cd) org_abbr_nm
		    , SUM(E.folder_tot_cnt) folder_tot_cnt
		    , SUM(E.folder_def_cnt) folder_def_cnt
		    , SUM(E.folder_ing_cnt) folder_ing_cnt
		    , SUM(E.folder_fail_cnt) folder_fail_cnt
		    , SUM(E.folder_end_cnt) folder_end_cnt
		    , SUM(E.record_tot_cnt) record_tot_cnt
		    , SUM(E.record_def_cnt) record_def_cnt
		    , SUM(E.record_ing_cnt) record_ing_cnt
		    , SUM(E.record_fail_cnt) record_fail_cnt
		    , SUM(E.record_end_cnt) record_end_cnt
		FROM (
			SELECT D.record_center_id
				, D.org_cd
				, 1 folder_tot_cnt
				, (CASE WHEN (D.neo_trans_state_2 IS NULL OR D.neo_trans_state_2='0') THEN 1 ELSE 0 END) folder_def_cnt
				, (CASE WHEN D.neo_trans_state_2 IN ('1','2','3') THEN 1 ELSE 0 END) folder_ing_cnt
				, (CASE WHEN D.neo_trans_state_2='5' THEN 1 ELSE 0 END) folder_fail_cnt
				, (CASE WHEN D.neo_trans_state_2='4' THEN 1 ELSE 0 END) folder_end_cnt
				, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id) record_tot_cnt
				, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id AND (R.neo_trans_state_2 IS NULL OR R.neo_trans_state_2='0')) record_def_cnt
				, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id AND R.neo_trans_state_2 IN ('1','2','3')) record_ing_cnt
				, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id AND R.neo_trans_state_2='5') record_fail_cnt
				, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id AND R.neo_trans_state_2='4') record_end_cnt
			FROM TB_RDFOLDER D
			<!--cubrid WHERE (D.record_center_id, D.folder_id)
			IN (
				SELECT C.record_center_id, C.folder_id-->
			WHERE
			EXISTS (
				SELECT 1
				FROM (
					SELECT ROWNUM AS rnum, B.*
					FROM (
						SELECT A.record_center_id, A.folder_id
						FROM TB_RDFOLDER A
						JOIN (SELECT *
                                FROM TB_DFRECVTRANSFLIST
                               WHERE record_center_id = #recordCenterId:VARCHAR#
                                 AND confm_transf_div_cd IN ('1', '2', '3')
                                 AND (exam_rslt_cd IS NULL OR exam_rslt_cd != '1')
                                 AND transf_grp_sno IN (SELECT MAX(transf_grp_sno) FROM TB_DFTRANSFWORK WHERE record_center_id = #recordCenterId:VARCHAR# AND TO_NUMBER(transf_handl_state) > 1)) DF
                          ON DF.record_center_id = A.record_center_id
                             AND DF.folder_id = A.folder_id
                             AND A.folder_keep_state_cd IN ('01', '04')
							<isNotEmpty prepend="AND" property="orgCd">
								A.org_cd = #orgCd:VARCHAR#
							</isNotEmpty>
							<isNotEmpty prepend="AND" property="creatYyyyFrom">
								<isNotEmpty property="creatYyyyTo">
									(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
								</isNotEmpty>
								<isEmpty property="creatYyyyTo">
									A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
								</isEmpty>
							</isNotEmpty>
							<isEmpty prepend="AND" property="creatYyyyFrom">
								<isNotEmpty property="creatYyyyTo">
									A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
								</isNotEmpty>
							</isEmpty>
							<isNotEmpty property="presvTermCd">
								<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
									A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR# 
								</isEqual>
								<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
									A.presv_term_cd = #presvTermCd:VARCHAR# 
								</isNotEqual>
							</isNotEmpty>
		    				AND   A.folder_keep_state_cd IN ('01','04')
                         ORDER BY A.record_center_id, A.folder_id
                      ) B
		            WHERE ROWNUM <![CDATA[<=]]> #pagedEnd:NUMBER#
		        ) C
		        WHERE C.rnum <![CDATA[>=]]> #pagedStart:NUMBER#
			<!--cubrid-->
			AND C.record_center_id = D.record_center_id
			AND C.folder_id = D.folder_id 	
		    )
		) E
		GROUP BY E.record_center_id, E.org_cd
	</select>

	<!--
		장기보존포맷변환(재변환)_생산부서별변환(기록물철)
		: 생산부서별변환(기록물철) 목록 조회 (재변환)
	-->
	<resultMap id="findPresvFormatNeoReconvOrgFolderPagedList-resultMap" class="rms.presv.format.domain.PresvFormatNeoResult">
		<result property="folderId"				column="folder_id" />
		<result property="folderTitle"			column="folder_title" />
		<result property="folderNeoState"		column="folder_neo_state" />
		<result property="folderNeoStateNm"		column="folder_neo_state_nm" />
		<result property="recordTotCnt"			column="record_tot_cnt" />
		<result property="recordDefCnt"			column="record_def_cnt" />
		<result property="recordIngCnt"			column="record_ing_cnt" />
		<result property="recordFailCnt"		column="record_fail_cnt" />
		<result property="recordEndCnt"			column="record_end_cnt" />
	</resultMap>
	<select id="countPresvFormatNeoReconvOrgFolderPagedList" parameterClass="rms.presv.format.domain.PresvFormatNeo" resultClass="java.lang.Long">
		SELECT COUNT(1)
		FROM (
			SELECT A.record_center_id, A.folder_id
			FROM TB_RDFOLDER A
			JOIN (
				SELECT *
				FROM TB_DFRECVTRANSFLIST
				WHERE record_center_id = #recordCenterId:VARCHAR#
				AND   confm_transf_div_cd IN ('1', '2', '3')
				AND   (exam_rslt_cd IS NULL OR exam_rslt_cd != '1')
				AND   transf_grp_sno IN (SELECT MAX(transf_grp_sno) FROM TB_DFTRANSFWORK WHERE record_center_id = #recordCenterId:VARCHAR# AND TO_NUMBER(transf_handl_state) > 1)
			) DF
			ON    DF.record_center_id = A.record_center_id
			AND   DF.folder_id = A.folder_id
			AND   A.record_center_id = #recordCenterId:VARCHAR#
			AND   A.org_cd = #orgCd:VARCHAR#
			<isNotEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
				</isNotEmpty>
				<isEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
				</isEmpty>
			</isNotEmpty>
			<isEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
				</isNotEmpty>
			</isEmpty>
			<isNotEmpty property="presvTermCd">
				<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR# 
				</isEqual>
				<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd = #presvTermCd:VARCHAR# 
				</isNotEqual>
			</isNotEmpty>
			AND   A.folder_keep_state_cd IN ('01','04')
		)
	</select>
	<select id="findPresvFormatNeoReconvOrgFolderPagedList" parameterClass="rms.presv.format.domain.PresvFormatNeo" resultMap="findPresvFormatNeoReconvOrgFolderPagedList-resultMap">
		SELECT D.record_center_id
			, D.folder_id
			, D.title folder_title
			, NVL(D.neo_trans_state_2, '0') folder_neo_state
			, (SELECT Z.com_cd_nm FROM TB_ZZCOMCD Z WHERE Z.com_type_cd='ST03' AND Z.com_cd=NVL(D.neo_trans_state_2, '0')) folder_neo_state_nm
			, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id) record_tot_cnt
			, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id AND (R.neo_trans_state_2 IS NULL OR R.neo_trans_state_2='0')) record_def_cnt
			, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id AND R.neo_trans_state_2 IN ('1','2','3')) record_ing_cnt
			, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id AND R.neo_trans_state_2='5') record_fail_cnt
			, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id AND R.neo_trans_state_2 IN ('4','6')) record_end_cnt
		FROM TB_RDFOLDER D
		<!--cubrid WHERE (D.record_center_id, D.folder_id)
		IN (
			SELECT C.record_center_id, C.folder_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM (
				SELECT ROWNUM AS rnum, B.*
				FROM (
					SELECT A.record_center_id, A.folder_id
					FROM TB_RDFOLDER A
					JOIN (
						SELECT *
						FROM TB_DFRECVTRANSFLIST
						WHERE record_center_id = #recordCenterId:VARCHAR#
						AND   confm_transf_div_cd IN ('1', '2', '3')
						AND   (exam_rslt_cd IS NULL OR exam_rslt_cd != '1')
						AND   transf_grp_sno IN (SELECT MAX(transf_grp_sno) FROM TB_DFTRANSFWORK WHERE record_center_id = #recordCenterId:VARCHAR# AND TO_NUMBER(transf_handl_state) > 1)
					) DF
					ON    DF.record_center_id = A.record_center_id
					AND   DF.folder_id = A.folder_id
					AND   A.record_center_id = #recordCenterId:VARCHAR#
					AND   A.org_cd = #orgCd:VARCHAR#
					<isNotEmpty prepend="AND" property="creatYyyyFrom">
						<isNotEmpty property="creatYyyyTo">
							(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
						</isNotEmpty>
						<isEmpty property="creatYyyyTo">
							A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
						</isEmpty>
					</isNotEmpty>
					<isEmpty prepend="AND" property="creatYyyyFrom">
						<isNotEmpty property="creatYyyyTo">
							A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
						</isNotEmpty>
					</isEmpty>
					<isNotEmpty property="presvTermCd">
						<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
							A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR# 
						</isEqual>
						<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
							A.presv_term_cd = #presvTermCd:VARCHAR# 
						</isNotEqual>
					</isNotEmpty>
					AND   A.folder_keep_state_cd IN ('01','04')
	                ORDER BY A.record_center_id, A.title
	            ) B
	            WHERE ROWNUM <![CDATA[<=]]> #pagedEnd:NUMBER#
	        ) C
	        WHERE C.rnum <![CDATA[>=]]> #pagedStart:NUMBER#
		<!--cubrid-->
		AND C.record_center_id = D.record_center_id
		AND C.folder_id = D.folder_id
	    )
	    ORDER BY D.record_center_id, D.title
	</select>


	<!--
		장기보존포맷변환(재변환)_기록물철별변환
		: 기록물철별변환 목록 조회 (재변환)
	 -->
	<resultMap id="findPresvFormatNeoReconvFolderPagedList-resultMap" class="rms.presv.format.domain.PresvFormatNeoResult">
		<result property="folderId"				column="folder_id" />
		<result property="folderTitle"			column="folder_title" />
		<result property="folderNeoState"		column="folder_neo_state" />
		<result property="folderNeoStateNm"		column="folder_neo_state_nm" />
		<result property="recordTotCnt"			column="record_tot_cnt" />
		<result property="recordDefCnt"			column="record_def_cnt" />
		<result property="recordIngCnt"			column="record_ing_cnt" />
		<result property="recordFailCnt"		column="record_fail_cnt" />
		<result property="recordEndCnt"			column="record_end_cnt" />
	</resultMap>
	<select id="countPresvFormatNeoReconvFolderPagedList" parameterClass="rms.presv.format.domain.PresvFormatNeo" resultClass="java.lang.Long">
		SELECT COUNT(1)
		FROM (
			SELECT A.record_center_id, A.folder_id
			FROM TB_RDFOLDER A JOIN (
				SELECT *
				FROM TB_DFRECVTRANSFLIST
				WHERE RECORD_CENTER_ID = #recordCenterId:VARCHAR#
				<isNotEmpty prepend="AND" property="creatYyyyFrom">
					<isNotEmpty property="creatYyyyTo">
						(transf_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
					</isNotEmpty>
					<isEmpty property="creatYyyyTo">
						transf_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
					</isEmpty>
				</isNotEmpty>
				<isEmpty prepend="AND" property="creatYyyyFrom">
					<isNotEmpty property="creatYyyyTo">
						transf_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
					</isNotEmpty>
				</isEmpty>
				AND confm_transf_div_cd IN ('1', '2', '3')
				AND (exam_rslt_cd IS NULL OR exam_rslt_cd != '1')
				AND transf_grp_sno IN
				(
					SELECT MAX(transf_grp_sno)
					FROM  TB_DFTRANSFWORK
					WHERE RECORD_CENTER_ID = #recordCenterId:VARCHAR#
					<isNotEmpty prepend="AND" property="creatYyyyFrom">
						<isNotEmpty property="creatYyyyTo">
							(transf_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
						</isNotEmpty>
						<isEmpty property="creatYyyyTo">
							transf_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
						</isEmpty>
					</isNotEmpty>
					<isEmpty prepend="AND" property="creatYyyyFrom">
						<isNotEmpty property="creatYyyyTo">
							transf_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
						</isNotEmpty>
					</isEmpty>
					AND TO_NUMBER (TRANSF_HANDL_STATE) > 1
				)
			) DF ON DF.record_center_id=A.record_center_id
			AND DF.folder_id = A.folder_id
			<isNotEmpty prepend="AND" property="creatSysCd">
				A.creat_sys_cd = #creatSysCd:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="orgCd">
				A.org_cd = #orgCd:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="clssId">
				A.clss_id = #clssId:VARCHAR#
			</isNotEmpty>
			<isNotEmpty property="presvTermCd">
				<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR#
				</isEqual>
				<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd = #presvTermCd:VARCHAR#
				</isNotEqual>
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="folderTypeDivCd">
				A.folder_type_div_cd = #folderTypeDivCd:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="neoTransState">
				A.neo_trans_state_2 = #neoTransState:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="folderTitle">
				A.title LIKE #folderTitle:VARCHAR#
			</isNotEmpty>
			AND A.folder_keep_state_cd IN ('01','04')
		)
	</select>
	<select id="findPresvFormatNeoReconvFolderPagedList" parameterClass="rms.presv.format.domain.PresvFormatNeo" resultMap="findPresvFormatNeoReconvFolderPagedList-resultMap">
		SELECT D.record_center_id
			, D.folder_id
			, D.title folder_title
			, NVL(D.neo_trans_state_2, '0') folder_neo_state
			, (SELECT Z.com_cd_nm FROM TB_ZZCOMCD Z WHERE Z.com_type_cd='ST03' AND Z.com_cd=NVL(D.neo_trans_state_2, '0')) folder_neo_state_nm
			, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id) record_tot_cnt
			, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id AND (R.neo_trans_state_2 IS NULL OR R.neo_trans_state_2='0')) record_def_cnt
			, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id AND R.neo_trans_state_2 IN ('1','2','3')) record_ing_cnt
			, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id AND R.neo_trans_state_2='5') record_fail_cnt
			, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id AND R.neo_trans_state_2 IN ('4','6')) record_end_cnt
		FROM TB_RDFOLDER D
		<!--cubrid WHERE (D.record_center_id, D.folder_id)
		IN (
			SELECT C.record_center_id, C.folder_id-->
		WHERE 
		EXISTS (
			SELECT 1
			FROM (
				SELECT ROWNUM AS rnum, B.*
				FROM (
					SELECT A.record_center_id, A.folder_id
					FROM TB_RDFOLDER A JOIN (
						SELECT *
						FROM TB_DFRECVTRANSFLIST
						WHERE record_center_id = #recordCenterId:VARCHAR#
						<isNotEmpty prepend="AND" property="creatYyyyFrom">
							<isNotEmpty property="creatYyyyTo">
								(transf_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
							</isNotEmpty>
							<isEmpty property="creatYyyyTo">
								transf_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
							</isEmpty>
						</isNotEmpty>
						<isEmpty prepend="AND" property="creatYyyyFrom">
							<isNotEmpty property="creatYyyyTo">
								transf_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
							</isNotEmpty>
						</isEmpty>
						AND confm_transf_div_cd IN ('1', '2', '3')
						AND (exam_rslt_cd IS NULL OR exam_rslt_cd != '1')
						AND transf_grp_sno IN (
							SELECT MAX(transf_grp_sno)
							FROM TB_DFTRANSFWORK
							WHERE record_center_id = #recordCenterId:VARCHAR#
							<isNotEmpty prepend="AND" property="creatYyyyFrom">
								<isNotEmpty property="creatYyyyTo">
									(transf_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
								</isNotEmpty>
								<isEmpty property="creatYyyyTo">
									transf_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
								</isEmpty>
							</isNotEmpty>
							<isEmpty prepend="AND" property="creatYyyyFrom">
								<isNotEmpty property="creatYyyyTo">
									transf_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
								</isNotEmpty>
							</isEmpty>
							AND TO_NUMBER (transf_handl_state) > 1
						)
					) DF ON DF.record_center_id=A.record_center_id
					AND DF.folder_id = A.folder_id
					<isNotEmpty prepend="AND" property="creatSysCd">
						A.creat_sys_cd = #creatSysCd:VARCHAR#
					</isNotEmpty>
					<isNotEmpty prepend="AND" property="orgCd">
						A.org_cd = #orgCd:VARCHAR#
					</isNotEmpty>
					<isNotEmpty prepend="AND" property="clssId">
						A.clss_id = #clssId:VARCHAR#
					</isNotEmpty>
					<isNotEmpty property="presvTermCd">
						<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
							A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR#
						</isEqual>
						<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
							A.presv_term_cd = #presvTermCd:VARCHAR#
						</isNotEqual>
					</isNotEmpty>
					<isNotEmpty prepend="AND" property="folderTypeDivCd">
						A.folder_type_div_cd = #folderTypeDivCd:VARCHAR#
					</isNotEmpty>
					<isNotEmpty prepend="AND" property="neoTransState">
						A.neo_trans_state_2 = #neoTransState:VARCHAR#
					</isNotEmpty>
					<isNotEmpty prepend="AND" property="folderTitle">
						A.title LIKE #folderTitle:VARCHAR#
					</isNotEmpty>
					AND A.folder_keep_state_cd IN ('01','04')
					ORDER BY A.record_center_id, A.title
				) B
	            WHERE ROWNUM <![CDATA[<=]]> #pagedEnd:NUMBER#
	        ) C
	        WHERE C.rnum <![CDATA[>=]]> #pagedStart:NUMBER#
		<!--cubrid-->
		AND C.record_center_id = D.record_center_id
		AND C.folder_id = D.folder_id
		)
		ORDER BY D.record_center_id, D.title
	</select>
	




	<!-- 
		장기보존포맷변환 : 변환실패 목록 조회
	 -->
	<resultMap id="findPresvFormatNeoReconvFailedMsgPagedList-resultMap" class="rms.presv.format.domain.PresvFormatNeoFailedMsg">
		<result property="rnum"				column="rnum" />
		<result property="recordCenterId"	column="record_center_id" />
		<result property="workHistId"		column="work_hist_id" />
		<result property="folderId"			column="folder_id" />
		<result property="folderTitle"		column="folder_title" />
		<result property="recordId"			column="record_id" />
		<result property="recordTitle"		column="record_title" />
		<result property="orignFileId"		column="orign_file_id" />
		<result property="orignFileNm"		column="orign_file_nm" />
		<result property="workStartDtime"	column="work_start_dtime" />
		<result property="workCloseDtime"	column="work_close_dtime" />
		<result property="errorCd"			column="error_cd" />
		<result property="errorCont"		column="error_cont" />
		<result property="followupDivCd"	column="followup_div_cd" />
		<result property="followupDivNm"	column="followup_div_nm" />
		<result property="followupCause"	column="followup_cause" />
		<result property="neoChasu"			column="neo_chasu" />
		<result property="formatDivCd"		column="format_div_cd" />
	</resultMap>
	<select id="countPresvFormatNeoReconvFailedMsgPagedList" parameterClass="rms.presv.format.domain.PresvFormatNeo" resultClass="java.lang.Long">
		SELECT COUNT(1)
		FROM  TB_STWORKHIST B
		<!--cubrid WHERE (B.record_center_id, B.folder_id)
           IN (
               SELECT A.record_center_id, A.folder_id-->
		WHERE 
           EXISTS (
               SELECT 1
               FROM TB_RDFOLDER A
               WHERE A.record_center_id = #recordCenterId:VARCHAR#
			<isNotEmpty prepend="AND" property="folderId">
				A.folder_id = #folderId:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="orgCd">
				A.org_cd = #orgCd:VARCHAR#
			</isNotEmpty>
			<isNotEmpty property="creatYyyyFrom">
				<isNotEmpty prepend="AND" property="creatYyyyTo">
					A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#
				</isNotEmpty>
				<isEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
				</isEmpty>
			</isNotEmpty>
			<isEmpty property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
				</isNotEmpty>
			</isEmpty>
			<isNotEmpty property="presvTermCd">
				<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR# 
				</isEqual>
				<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd = #presvTermCd:VARCHAR# 
				</isNotEqual>
			</isNotEmpty>
			AND   A.folder_keep_state_cd IN ('01','04')
			<!--cubrid-->
			AND   A.record_center_id = B.record_center_id
			AND   A.folder_id = B.folder_id	
		)
		<isNotEmpty prepend="AND" property="recordId">
			B.record_id = #recordId:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="formatDivCd">
			B.format_div_cd = #formatDivCd:VARCHAR#
		</isNotEmpty>
		<isEmpty prepend="AND" property="formatDivCd">
			B.format_div_cd IN ('1','2')
		</isEmpty>
		AND (B.followup_fin_flag IS NULL OR B.followup_fin_flag='0')
		AND  (EXISTS (SELECT 1 FROM TB_RDFOLDER F WHERE F.record_center_id=B.record_center_id AND F.folder_id=B.folder_id AND F.neo_trans_state_2 = '5')
				OR EXISTS (SELECT 1 FROM TB_RDRECORD R WHERE R.record_center_id=B.record_center_id AND R.folder_id=B.folder_id AND R.neo_trans_state_2 = '5' ))
	</select>
	<select id="findPresvFormatNeoReconvFailedMsgPagedList" parameterClass="rms.presv.format.domain.PresvFormatNeo" resultMap="findPresvFormatNeoReconvFailedMsgPagedList-resultMap">
		SELECT E.rnum
			, E.record_center_id
			, E.work_hist_id
			, E.folder_id
			, NVL((SELECT Z.title FROM TB_RDFOLDER Z WHERE Z.record_center_id=E.record_center_id AND Z.folder_id=E.folder_id),'') AS folder_title
			, E.record_id
			, NVL((SELECT Z.title FROM TB_RDRECORD Z WHERE Z.record_center_id=E.record_center_id AND Z.record_id=E.record_id),'') AS record_title
			, E.orign_file_id
			, (SELECT Z.file_nm FROM TB_STORIGNFILE Z WHERE Z.orign_file_id=E.orign_file_id) AS orign_file_nm
			, E.work_start_dtime
			, E.work_close_dtime
			, E.error_cd
			, E.error_cont
			, E.followup_div_cd
			, (CASE WHEN E.followup_div_cd='1' THEN '재변환' WHEN E.followup_div_cd='2' THEN '변환불가' ELSE '미조치' END) AS followup_div_nm
			, E.followup_cause
			, (CASE WHEN E.format_div_cd = '1' THEN (SELECT NVL(MAX(Z.neochasu),0) FROM TB_STREQTRANS Z WHERE Z.record_center_id=E.record_center_id AND Z.folder_id=E.folder_id)
					WHEN E.format_div_cd = '2' THEN (SELECT NVL(MAX(Z.neochasu),0) FROM TB_STREQTRANS Z WHERE Z.record_center_id=E.record_center_id AND Z.folder_id=E.folder_id AND Z.record_id=E.record_id)
					ELSE 0 END) AS neo_chasu
			, E.format_div_cd
		FROM (
			SELECT D.*
			FROM (
				SELECT ROWNUM AS rnum, C.*
				FROM (
					SELECT B.record_center_id, B.work_hist_id, B.folder_id, B.record_id, B.orign_file_id
						, B.work_start_dtime, B.work_close_dtime, B.error_cd, B.error_cont
						, B.followup_div_cd, B.followup_cause, B.format_div_cd
					FROM  TB_STWORKHIST B
					<!--cubrid WHERE (B.record_center_id, B.folder_id)
					IN (
		                SELECT A.record_center_id, A.folder_id-->
					WHERE 
					EXISTS (
		                SELECT  1
		                FROM TB_RDFOLDER A
		                WHERE A.record_center_id = #recordCenterId:VARCHAR#
						<isNotEmpty prepend="AND" property="folderId">
							A.folder_id = #folderId:VARCHAR#
						</isNotEmpty>
						<isNotEmpty prepend="AND" property="orgCd">
							A.org_cd = #orgCd:VARCHAR#
						</isNotEmpty>
						<isNotEmpty property="creatYyyyFrom">
							<isNotEmpty prepend="AND" property="creatYyyyTo">
								A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#
							</isNotEmpty>
							<isEmpty property="creatYyyyTo">
								A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
							</isEmpty>
						</isNotEmpty>
						<isEmpty property="creatYyyyFrom">
							<isNotEmpty property="creatYyyyTo">
								A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
							</isNotEmpty>
						</isEmpty>
						<isNotEmpty property="presvTermCd">
							<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
								A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR# 
							</isEqual>
							<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
								A.presv_term_cd = #presvTermCd:VARCHAR# 
							</isNotEqual>
						</isNotEmpty>
						AND   A.folder_keep_state_cd IN ('01','04')
						<!--cubrid-->
						AND   A.record_center_id = B.record_center_id
						AND   A.folder_id = B.folder_id
					)
					<isNotEmpty prepend="AND" property="recordId">
						B.record_id = #recordId:VARCHAR#
					</isNotEmpty>
					<isNotEmpty prepend="AND" property="formatDivCd">
						B.format_div_cd = #formatDivCd:VARCHAR#
					</isNotEmpty>
					<isEmpty prepend="AND" property="formatDivCd">
						B.format_div_cd IN ('1','2')
					</isEmpty>
					AND (B.followup_fin_flag IS NULL OR B.followup_fin_flag='0')
					AND  (EXISTS (SELECT 1 FROM TB_RDFOLDER F WHERE F.record_center_id=B.record_center_id AND F.folder_id=B.folder_id AND F.neo_trans_state_2 = '5')
							OR EXISTS (SELECT 1 FROM TB_RDRECORD R WHERE R.record_center_id=B.record_center_id AND R.folder_id=B.folder_id AND R.neo_trans_state_2 = '5' ))
					ORDER BY record_center_id, work_hist_id DESC
				) C
				WHERE ROWNUM <![CDATA[<=]]> #pagedEnd:NUMBER#
			) D
			WHERE D.rnum <![CDATA[>=]]> #pagedStart:NUMBER#
		) E
	</select>
	<!-- 
		장기보존포맷변환 : 변환실패 기록물철NEO 수량
	 -->
	<select id="countPresvFormatNeoReconvFailedMsgFolder" parameterClass="rms.presv.format.domain.PresvFormatNeo" resultClass="java.lang.Long">
		SELECT COUNT(1)
		FROM (
			SELECT B.record_center_id, B.folder_id
			FROM  TB_STWORKHIST B
			<!--cubrid WHERE (B.record_center_id, B.folder_id)
	           IN (
	               SELECT A.record_center_id, A.folder_id-->
			WHERE 
	           EXISTS (
	               SELECT 1
	               FROM TB_RDFOLDER A
	               WHERE A.record_center_id = #recordCenterId:VARCHAR#
				<isNotEmpty prepend="AND" property="folderId">
					A.folder_id = #folderId:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="orgCd">
					A.org_cd = #orgCd:VARCHAR#
				</isNotEmpty>
				<isNotEmpty property="creatYyyyFrom">
					<isNotEmpty prepend="AND" property="creatYyyyTo">
						A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#
					</isNotEmpty>
					<isEmpty property="creatYyyyTo">
						A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
					</isEmpty>
				</isNotEmpty>
				<isEmpty property="creatYyyyFrom">
					<isNotEmpty property="creatYyyyTo">
						A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
					</isNotEmpty>
				</isEmpty>
				<isNotEmpty property="presvTermCd">
					<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
						A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR# 
					</isEqual>
					<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
						A.presv_term_cd = #presvTermCd:VARCHAR# 
					</isNotEqual>
				</isNotEmpty>
				AND   A.folder_keep_state_cd IN ('01','04')
				<!--cubrid-->
				AND   A.record_center_id = B.record_center_id
				AND   A.folder_id = B.folder_id
	           )
			AND  B.format_div_cd = '2'
			AND (B.followup_fin_flag IS NULL OR B.followup_fin_flag='0')
			AND  (EXISTS (SELECT 1 FROM TB_RDFOLDER F WHERE F.record_center_id=B.record_center_id AND F.folder_id=B.folder_id AND F.neo_trans_state_2 = '5')
					OR EXISTS (SELECT 1 FROM TB_RDRECORD R WHERE R.record_center_id=B.record_center_id AND R.folder_id=B.folder_id AND R.neo_trans_state_2 = '5' ))
			GROUP BY B.record_center_id, B.folder_id
		) C
	</select>
	<!-- 
		장기보존포맷변환 : 변환실패 기록물건NEO 수량
	 -->
	<select id="countPresvFormatNeoReconvFailedMsgRecord" parameterClass="rms.presv.format.domain.PresvFormatNeo" resultClass="java.lang.Long">
		SELECT COUNT(1)
		FROM (
			SELECT B.record_center_id, B.record_id
			FROM  TB_STWORKHIST B
			<!--cubrid WHERE (B.record_center_id, B.folder_id)
	           IN (
	               SELECT A.record_center_id, A.folder_id-->
			WHERE 
	           EXISTS (
	               SELECT 1
	               FROM TB_RDFOLDER A
	               WHERE A.record_center_id = #recordCenterId:VARCHAR#
				<isNotEmpty prepend="AND" property="folderId">
					A.folder_id = #folderId:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="orgCd">
					A.org_cd = #orgCd:VARCHAR#
				</isNotEmpty>
				<isNotEmpty property="creatYyyyFrom">
					<isNotEmpty prepend="AND" property="creatYyyyTo">
						A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#
					</isNotEmpty>
					<isEmpty property="creatYyyyTo">
						A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
					</isEmpty>
				</isNotEmpty>
				<isEmpty property="creatYyyyFrom">
					<isNotEmpty property="creatYyyyTo">
						A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
					</isNotEmpty>
				</isEmpty>
				<isNotEmpty property="presvTermCd">
					<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
						A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR# 
					</isEqual>
					<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
						A.presv_term_cd = #presvTermCd:VARCHAR# 
					</isNotEqual>
				</isNotEmpty>
				AND   A.folder_keep_state_cd IN ('01','04')
				<!--cubrid-->
				AND   A.record_center_id = B.record_center_id
				AND   A.folder_id = B.folder_id
	           )
			<isNotEmpty prepend="AND" property="recordId">
				B.record_id = #recordId:VARCHAR#
			</isNotEmpty>
			AND  B.format_div_cd = '1'
			AND (B.followup_fin_flag IS NULL OR B.followup_fin_flag='0')
			AND  (EXISTS (SELECT 1 FROM TB_RDFOLDER F WHERE F.record_center_id=B.record_center_id AND F.folder_id=B.folder_id AND F.neo_trans_state_2 = '5')
					OR EXISTS (SELECT 1 FROM TB_RDRECORD R WHERE R.record_center_id=B.record_center_id AND R.folder_id=B.folder_id AND R.neo_trans_state_2 = '5' ))
			GROUP BY B.record_center_id, B.record_id
		) C
	</select>
	
	
	
	
	
	
	
	
	
	<!-- 
		장기보존포맷변환(재변환)
		: 생산부서에 대한 포맷변환 요청 - A.1.기록물건 포맷변환요청정보 생성(-:신청) 
	 -->
	<insert id="createPresvFormatNeoReconvOrgReqTransRecordList" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		INSERT INTO TB_STREQTRANS (
			record_center_id, job_id, neo_gubun, neochasu, folder_id, record_id, dest_storage_type, dest_storage_vendor, request_status, erecord_flag
			, request_corp_cd, request_corp_nm, request_org_cd, request_org_nm, request_user_id, request_user_nm, request_user_pos_rank_nm
		)
		(
			SELECT B.record_center_id
				, TO_CHAR(SYSDATE,'YYYY')||LPAD(TB_STFORMAT_SQ01.NEXTVAL,13,'0') AS job_id
				, '2' AS neo_gubun
				, 2 AS neochasu
				, B.folder_id
				, B.record_id
				, #destStorageType:VARCHAR# AS dest_storage_type
				, #destStorageVendor:VARCHAR# AS dest_storage_vendor
				, '-' AS request_status
				, B.erecord_flag
				, (SELECT Z.hupper_org_cd FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) AS request_corp_cd
				, (SELECT Y.org_nm FROM TB_STORG Y, (SELECT Z.record_center_id, Z.hupper_org_cd FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) X WHERE Y.record_center_id=X.record_center_id AND Y.org_cd=X.hupper_org_cd) AS request_corp_nm
				, #requestOrgCd:VARCHAR#
				, (SELECT Z.full_org_nm FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) AS request_org_nm
				, #requestUserId:VARCHAR#
				, #requestUserNm:VARCHAR#
				, (SELECT (CASE WHEN pos IS NULL AND rank IS NULL THEN ''
								WHEN pos IS NULL AND rank IS NOT NULL THEN rank
								WHEN pos IS NOT NULL AND rank IS NULL THEN pos
								ELSE pos||'/'||rank
							END)
					FROM  TB_STUSER
					WHERE user_id = #requestUserId:VARCHAR#) AS user_pos_rank
	          FROM  TB_RDRECORD B
	          <!--cubrid WHERE (B.record_center_id, B.folder_id)
	          IN (  SELECT record_center_id, folder_id   -->
	          WHERE
	          EXISTS (  SELECT 1
	                FROM  TB_RDFOLDER A
	                WHERE A.record_center_id = #recordCenterId:VARCHAR#
	                AND   A.org_cd = #orgCd:VARCHAR#
	                AND   A.folder_keep_state_cd IN ('01','04')
					<isNotEmpty prepend="AND" property="creatYyyyFrom">
						<isNotEmpty property="creatYyyyTo">
							(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
						</isNotEmpty>
						<isEmpty property="creatYyyyTo">
							A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
						</isEmpty>
					</isNotEmpty>
					<isEmpty prepend="AND" property="creatYyyyFrom">
						<isNotEmpty property="creatYyyyTo">
							A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
						</isNotEmpty>
					</isEmpty>
					<isNotEmpty property="presvTermCd">
						<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
							A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR#
						</isEqual>
						<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
							A.presv_term_cd = #presvTermCd:VARCHAR#
						</isNotEqual>
					</isNotEmpty>
			<!--cubrid-->
			AND  A.record_center_id = B.record_center_id
			AND  A.folder_id = B.folder_id
	              )
	          AND   (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2='0')
         )
	</insert>
	<!-- 
		장기보존포맷변환(재변환)
		: 생산부서에 대한 포맷변환 요청 - A.2.기록물철 포맷변환요청정보 생성(-:신청) 
	 -->
	<insert id="createPresvFormatNeoReconvOrgReqTransFolderList" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		INSERT INTO TB_STREQTRANS (
			record_center_id, job_id, neo_gubun, neochasu, folder_id, record_id, dest_storage_type, dest_storage_vendor, request_status, erecord_flag
			, request_corp_cd, request_corp_nm, request_org_cd, request_org_nm, request_user_id, request_user_nm, request_user_pos_rank_nm
		)
		(
			SELECT A.record_center_id
				, TO_CHAR(SYSDATE,'YYYY')||LPAD(TB_STFORMAT_SQ01.NEXTVAL,13,'0') AS job_id
				, '1' AS neo_gubun
				, 2 AS neochasu
				, A.folder_id
				, '' AS record_id
				, #destStorageType:VARCHAR# AS dest_storage_type
				, #destStorageVendor:VARCHAR# AS dest_storage_vendor
				, '-' AS request_status
				, A.erecord_flag
				, (SELECT Z.hupper_org_cd FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) AS request_corp_cd
				, (SELECT Y.org_nm FROM TB_STORG Y, (SELECT Z.record_center_id, Z.hupper_org_cd FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) X WHERE Y.record_center_id=X.record_center_id AND Y.org_cd=X.hupper_org_cd) AS request_corp_nm
				, #requestOrgCd:VARCHAR#
				, (SELECT Z.full_org_nm FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) AS request_org_nm
				, #requestUserId:VARCHAR#
				, #requestUserNm:VARCHAR#
				, (SELECT (CASE WHEN pos IS NULL AND rank IS NULL THEN ''
								WHEN pos IS NULL AND rank IS NOT NULL THEN rank
								WHEN pos IS NOT NULL AND rank IS NULL THEN pos
								ELSE pos||'/'||rank
							END)
					FROM  TB_STUSER
					WHERE user_id = #requestUserId:VARCHAR#) AS user_pos_rank
			FROM  TB_RDFOLDER A
			WHERE A.record_center_id = #recordCenterId:VARCHAR#
			AND   A.org_cd = #orgCd:VARCHAR#
			AND   A.folder_keep_state_cd IN ('01','04')
			<isNotEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
				</isNotEmpty>
				<isEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
				</isEmpty>
			</isNotEmpty>
			<isEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
				</isNotEmpty>
			</isEmpty>
			<isNotEmpty property="presvTermCd">
				<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR#
				</isEqual>
				<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd = #presvTermCd:VARCHAR#
				</isNotEqual>
			</isNotEmpty>
			AND   (A.neo_trans_state_2 IS NULL OR A.neo_trans_state_2='0')
		)
	</insert>

	<!-- 
		장기보존포맷변환(재변환)
		: 생산부서에 대한 포맷변환 요청 - B.1.기록물건 변환상태 갱신 (1:변환대기)
	 -->
	<insert id="updatePresvFormatNeoReconvOrgWaitToRecord" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDRECORD B
		SET   B.neo_trans_state_2 = '1'
		<!--cubrid WHERE (B.record_center_id, B.folder_id)
		IN (SELECT A.record_center_id, A.folder_id-->
		WHERE
		EXISTS (SELECT 1
			FROM  TB_RDFOLDER A
			WHERE A.record_center_id = #recordCenterId:VARCHAR#
			AND   A.org_cd = #orgCd:VARCHAR#
			AND   A.folder_keep_state_cd IN ('01','04')
			<isNotEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
				</isNotEmpty>
				<isEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
				</isEmpty>
			</isNotEmpty>
			<isEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
				</isNotEmpty>
			</isEmpty>
			<isNotEmpty property="presvTermCd">
				<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR#
				</isEqual>
				<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd = #presvTermCd:VARCHAR#
				</isNotEqual>
			</isNotEmpty>
			<!--cubrid-->
			AND  A.record_center_id = B.record_center_id
			AND  A.folder_id = B.folder_id
		)
		AND   (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2='0')
	</insert>
	<!-- 
		장기보존포맷변환(재변환)
		: 생산부서에 대한 포맷변환 요청 - B.2.접수이관목록 변환상태 갱신 (1:변환대기)
	 -->
	<update id="updatePresvFormatNeoReconvOrgWaitToTransf" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_DFRECVTRANSFLIST A
		SET   A.neo_trans_state = '1'
			, A.record_neo_trans_state = ( CASE WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3','5'))) THEN '4'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3'))) THEN '5'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.neo_trans_state_2 IN ('1','2','3')) THEN '0'
												ELSE '1' END )
		WHERE A.record_center_id = #recordCenterId:VARCHAR#
		AND   A.org_cd = #orgCd:VARCHAR#
		<isNotEmpty prepend="AND" property="creatYyyyFrom">
			<isNotEmpty property="creatYyyyTo">
				(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
			</isNotEmpty>
			<isEmpty property="creatYyyyTo">
				A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
			</isEmpty>
		</isNotEmpty>
		<isEmpty prepend="AND" property="creatYyyyFrom">
			<isNotEmpty property="creatYyyyTo">
				A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
			</isNotEmpty>
		</isEmpty>
		<isNotEmpty property="presvTermCd">
			<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
				A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR#
			</isEqual>
			<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
				A.presv_term_cd = #presvTermCd:VARCHAR#
			</isNotEqual>
		</isNotEmpty>
		AND   (A.neo_trans_state IS NULL OR A.neo_trans_state='0')
	</update>
	<!-- 
		장기보존포맷변환(재변환)
		: 생산부서에 대한 포맷변환 요청 - B.3.기록물철 변환상태 갱신 (1:변환대기)
	 -->
	<update id="updatePresvFormatNeoReconvOrgWaitToFolder" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDFOLDER A
		SET   A.neo_trans_state_2 = '1'
			, A.record_neo_trans_state_2 = ( CASE WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3','5'))) THEN '4'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3'))) THEN '5'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.neo_trans_state_2 IN ('1','2','3')) THEN '0'
												ELSE '1' END )
		WHERE A.record_center_id = #recordCenterId:VARCHAR#
		AND   A.org_cd = #orgCd:VARCHAR#
		AND   A.folder_keep_state_cd IN ('01','04')
		<isNotEmpty prepend="AND" property="creatYyyyFrom">
			<isNotEmpty property="creatYyyyTo">
				(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
			</isNotEmpty>
			<isEmpty property="creatYyyyTo">
				A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
			</isEmpty>
		</isNotEmpty>
		<isEmpty prepend="AND" property="creatYyyyFrom">
			<isNotEmpty property="creatYyyyTo">
				A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
			</isNotEmpty>
		</isEmpty>
		<isNotEmpty property="presvTermCd">
			<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
				A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR#
			</isEqual>
			<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
				A.presv_term_cd = #presvTermCd:VARCHAR#
			</isNotEqual>
		</isNotEmpty>
		AND   (A.neo_trans_state_2 IS NULL OR A.neo_trans_state_2='0')
	</update>

	<!-- 
		장기보존포맷변환(재변환)
		: 생산부서에 대한 포맷변환 취소요청 - C.1.기록물철/기록물건 포맷변환요청정보 갱신 (E:취소) 
	 -->
	<update id="updatePresvFormatNeoReconvOrgClearReqTransList" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_STREQTRANS Z
		SET   request_status = 'E'
			, request_start_time = SYSDATE
		<!--cubrid WHERE (record_center_id, folder_id)
		IN (
			SELECT A.record_center_id, A.folder_id-->
		WHERE 
		EXISTS (
			SELECT 1
			FROM  TB_RDFOLDER A
			WHERE A.record_center_id = #recordCenterId:VARCHAR#
			AND   A.org_cd = #orgCd:VARCHAR#
			AND   A.folder_keep_state_cd IN ('01','04')
			<isNotEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
				</isNotEmpty>
				<isEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
				</isEmpty>
			</isNotEmpty>
			<isEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
				</isNotEmpty>
			</isEmpty>
			<isNotEmpty property="presvTermCd">
				<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR#
				</isEqual>
				<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd = #presvTermCd:VARCHAR#
				</isNotEqual>
			</isNotEmpty>
			<isEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					A.neo_trans_state_2 IN ('1', '2', '3', '5')
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					A.neo_trans_state_2 IN ('1', '2', '3')
				</isNotEqual>
			</isEqual>
			<isNotEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					A.neo_trans_state_2 = '5'
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					0 = 1
				</isNotEqual>
			</isNotEqual>
			<!--cubrid -->
			AND  A.record_center_id = Z.record_center_id
			AND  A.folder_id = Z.folder_id
		)
		AND   Z.neo_gubun IN ('1','2')
		AND   Z.request_status IN ('-','A','B')
	</update>
	
	<!-- 
		장기보존포맷변환(재변환)
		: 생산부서에 대한 포맷변환 취소요청 - D.1.포맷변환작업이력 테이블의 기록물건 변환상태 삭제 (E:취소) 
	 -->
	<delete id="deletePresvFormatNeoReconvOrgClearRecordToWorkHist" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		DELETE FROM TB_STWORKHIST Z
		<!--cubridWHERE (record_center_id, folder_id, record_id)
		IN (
			SELECT B.record_center_id, B.folder_id, B.record_id-->
		WHERE 
		EXISTS (
			SELECT 1
			FROM  TB_RDRECORD B
			<!--cubrid WHERE (B.record_center_id, B.folder_id)
			IN (
				SELECT A.record_center_id, A.folder_id-->
			WHERE 
			EXISTS (
				SELECT 1
				FROM  TB_RDFOLDER A
				WHERE A.record_center_id = #recordCenterId:VARCHAR#
				AND   A.org_cd = #orgCd:VARCHAR#
				AND   A.folder_keep_state_cd IN ('01','04')
				<!--cubrid-->
				AND A.record_center_id = B.record_center_id
				AND A.folder_id = B.folder_id
				<isNotEmpty prepend="AND" property="creatYyyyFrom">
					<isNotEmpty property="creatYyyyTo">
						(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
					</isNotEmpty>
					<isEmpty property="creatYyyyTo">
						A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
					</isEmpty>
				</isNotEmpty>
				<isEmpty prepend="AND" property="creatYyyyFrom">
					<isNotEmpty property="creatYyyyTo">
						A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
					</isNotEmpty>
				</isEmpty>
				<isNotEmpty property="presvTermCd">
					<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
						A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR#
					</isEqual>
					<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
						A.presv_term_cd = #presvTermCd:VARCHAR#
					</isNotEqual>
				</isNotEmpty>
			)
			<isEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.neo_trans_state_2 IN ('1', '2', '3', '5')
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.neo_trans_state_2 IN ('1', '2', '3')
				</isNotEqual>
			</isEqual>
			<isNotEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.neo_trans_state_2 = '5'
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					0 = 1
				</isNotEqual>
			</isNotEqual>
			<!--cubrid-->
			AND B.record_center_id =Z.record_center_id
			AND B.folder_id = Z.folder_id
			AND B.record_id =Z.record_id
		)
		AND   format_div_cd = '1'
		AND   (followup_div_cd IS NULL OR followup_div_cd IN ('0','1')
		)
		
	</delete>
	<!-- 
		장기보존포맷변환(재변환)
		: 생산부서에 대한 포맷변환 취소요청 - D.2.접수이관목록 테이블의 기록물건 변환상태 갱신 (0:미변환) 
	 -->
	<update id="updatePresvFormatNeoReconvOrgClearRecordToTransf" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_DFRECVTRANSFLIST Z
		SET   record_neo_trans_state = '0'
		<!--cubrid WHERE (record_center_id, folder_id)
		IN (
			SELECT B.record_center_id, B.folder_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM  TB_RDRECORD B
			<!--cubrid WHERE (B.record_center_id, B.folder_id)
			IN (
				SELECT A.record_center_id, A.folder_id-->
			WHERE 
			EXISTS (
				SELECT 1
				FROM  TB_RDFOLDER A
				WHERE A.record_center_id = #recordCenterId:VARCHAR#
				AND   A.org_cd = #orgCd:VARCHAR#
				AND   A.folder_keep_state_cd IN ('01','04')
				<!--cubrid-->
				AND   A.record_center_id = B.record_center_id
				AND   A.folder_id = B.folder_id
				<isNotEmpty prepend="AND" property="creatYyyyFrom">
					<isNotEmpty property="creatYyyyTo">
						(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
					</isNotEmpty>
					<isEmpty property="creatYyyyTo">
						A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
					</isEmpty>
				</isNotEmpty>
				<isEmpty prepend="AND" property="creatYyyyFrom">
					<isNotEmpty property="creatYyyyTo">
						A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
					</isNotEmpty>
				</isEmpty>
				<isNotEmpty property="presvTermCd">
					<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
						A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR#
					</isEqual>
					<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
						A.presv_term_cd = #presvTermCd:VARCHAR#
					</isNotEqual>
				</isNotEmpty>
			)
			<isEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.neo_trans_state_2 IN ('1', '2', '3', '5')
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.neo_trans_state_2 IN ('1', '2', '3')
				</isNotEqual>
			</isEqual>
			<isNotEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.neo_trans_state_2 = '5'
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					0 = 1
				</isNotEqual>
			</isNotEqual>
			<!--cubrid-->
			AND  B.record_center_id = Z.record_center_id
			AND  B.folder_id = Z.folder_id
		)
	</update>
	<!-- 
		장기보존포맷변환(재변환)
		: 생산부서에 대한 포맷변환 취소요청 - D.3.기록물철 테이블의 기록물건 변환상태 갱신 (0:미변환) 
	 -->
	<update id="updatePresvFormatNeoReconvOrgClearRecordToFolder" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDFOLDER Z
		SET   record_neo_trans_state_2 = '0'
		<!--cubrid WHERE (record_center_id, folder_id)
		IN (
			SELECT B.record_center_id, B.folder_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM  TB_RDRECORD B
			<!--cubrid WHERE (B.record_center_id, B.folder_id)
			IN (
				SELECT A.record_center_id, A.folder_id-->
			WHERE
			EXISTS (
				SELECT 1
				FROM  TB_RDFOLDER A
				WHERE A.record_center_id = #recordCenterId:VARCHAR#
				AND   A.org_cd = #orgCd:VARCHAR#
				AND   A.folder_keep_state_cd IN ('01','04')
				<!--cubrid-->
				AND A.record_center_id = B.record_center_id
				AND A.folder_id = B.folder_id
				<isNotEmpty prepend="AND" property="creatYyyyFrom">
					<isNotEmpty property="creatYyyyTo">
						(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
					</isNotEmpty>
					<isEmpty property="creatYyyyTo">
						A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
					</isEmpty>
				</isNotEmpty>
				<isEmpty prepend="AND" property="creatYyyyFrom">
					<isNotEmpty property="creatYyyyTo">
						A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
					</isNotEmpty>
				</isEmpty>
				<isNotEmpty property="presvTermCd">
					<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
						A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR#
					</isEqual>
					<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
						A.presv_term_cd = #presvTermCd:VARCHAR#
					</isNotEqual>
				</isNotEmpty>
			)
			<isEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.neo_trans_state_2 IN ('1', '2', '3', '5')
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.neo_trans_state_2 IN ('1', '2', '3')
				</isNotEqual>
			</isEqual>
			<isNotEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.neo_trans_state_2 = '5'
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					0 = 1
				</isNotEqual>
			</isNotEqual>
			AND B.record_center_id = Z.record_center_id
			AND B.folder_id = Z.folder_id
		)
	</update>
	<!-- 
		장기보존포맷변환(재변환)
		: 생산부서에 대한 포맷변환 취소요청 - D.4.기록물건 테이블의 기록물건 변환상태 갱신 (0:미변환) 
	 -->
	<update id="updatePresvFormatNeoReconvOrgClearRecordToRecord" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDRECORD B
		SET   B.neo_trans_state_2 = '0'
		<!--cubrid WHERE (B.record_center_id, B.folder_id)
		IN (
			SELECT A.record_center_id, A.folder_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM  TB_RDFOLDER A
			WHERE A.record_center_id = #recordCenterId:VARCHAR#
			AND   A.org_cd = #orgCd:VARCHAR#
			AND   A.folder_keep_state_cd IN ('01','04')
			<!--cubrid-->
			AND   A.record_center_id = B.record_center_id
			AND   A.folder_id = B.folder_id
			<isNotEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
				</isNotEmpty>
				<isEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
				</isEmpty>
			</isNotEmpty>
			<isEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
				</isNotEmpty>
			</isEmpty>
			<isNotEmpty property="presvTermCd">
				<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR#
				</isEqual>
				<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd = #presvTermCd:VARCHAR#
				</isNotEqual>
			</isNotEmpty>
		)
		<isEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				B.neo_trans_state_2 IN ('1', '2', '3', '5')
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				B.neo_trans_state_2 IN ('1', '2', '3')
			</isNotEqual>
		</isEqual>
		<isNotEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				B.neo_trans_state_2 = '5'
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				0 = 1
			</isNotEqual>
		</isNotEqual>
	</update>
	<!-- 
		장기보존포맷변환(재변환)
		: 생산부서에 대한 포맷변환 취소요청 - D.5.포맷변환작업이력 테이블의 기록물철 변환상태 삭제 
	 -->
	<delete id="updatePresvFormatNeoReconvOrgClearFolderToWorkHist" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		DELETE FROM TB_STWORKHIST Z
		<!--cubrid WHERE (record_center_id, folder_id)
		IN (
			SELECT A.record_center_id, A.folder_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM  TB_RDFOLDER A
			WHERE A.record_center_id = #recordCenterId:VARCHAR#
			AND   A.org_cd = #orgCd:VARCHAR#
			AND   A.folder_keep_state_cd IN ('01','04')
			<!--cubrid-->
			AND   A.record_center_id = Z.record_center_id
			AND   A.folder_id = Z.folder_id
			<isNotEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
				</isNotEmpty>
				<isEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
				</isEmpty>
			</isNotEmpty>
			<isEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
				</isNotEmpty>
			</isEmpty>
			<isNotEmpty property="presvTermCd">
				<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR#
				</isEqual>
				<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd = #presvTermCd:VARCHAR#
				</isNotEqual>
			</isNotEmpty>
			<isEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					A.neo_trans_state_2 IN ('1', '2', '3', '5')
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					A.neo_trans_state_2 IN ('1', '2', '3')
				</isNotEqual>
			</isEqual>
			<isNotEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					A.neo_trans_state_2 = '5'
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					0 = 1
				</isNotEqual>
			</isNotEqual>
		)
		AND   Z.format_div_cd = '2'
		AND   (Z.followup_div_cd IS NULL OR Z.followup_div_cd IN ('0','1'))
	</delete>
	<!-- 
		장기보존포맷변환(재변환)
		: 생산부서에 대한 포맷변환 취소요청 - D.6.접수이관목록 테이블의 기록물철 변환상태 갱신 (0:미변환) 
	 -->
	<update id="updatePresvFormatNeoReconvOrgClearFolderToTransf" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_DFRECVTRANSFLIST Z
		<!--cubrid WHERE (record_center_id, folder_id)
		IN (
			SELECT A.record_center_id, A.folder_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM  TB_RDFOLDER A
			WHERE A.record_center_id = #recordCenterId:VARCHAR#
			AND   A.org_cd = #orgCd:VARCHAR#
			AND   A.folder_keep_state_cd IN ('01','04')
			<!--cubrid-->
			AND   A.record_center_id = Z.record_center_id
			AND   A.folder_id = Z.folder_id
			<isNotEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
				</isNotEmpty>
				<isEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
				</isEmpty>
			</isNotEmpty>
			<isEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
				</isNotEmpty>
			</isEmpty>
			<isNotEmpty property="presvTermCd">
				<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR#
				</isEqual>
				<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd = #presvTermCd:VARCHAR#
				</isNotEqual>
			</isNotEmpty>
			<isEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					A.neo_trans_state_2 IN ('1', '2', '3', '5')
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					A.neo_trans_state_2 IN ('1', '2', '3')
				</isNotEqual>
			</isEqual>
			<isNotEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					A.neo_trans_state_2 = '5'
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					0 = 1
				</isNotEqual>
			</isNotEqual>
		)
	</update>
	<!-- 
		장기보존포맷변환(재변환)
		: 생산부서에 대한 포맷변환 취소요청 - D.7.기록물철 테이블의 기록물철 변환상태 갱신 (0:미변환) 
	 -->
	<update id="updatePresvFormatNeoReconvOrgClearFolderToFolder" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDFOLDER A
		SET   A.neo_trans_state_2 = '0'
		WHERE A.record_center_id = #recordCenterId:VARCHAR#
		AND   A.org_cd = #orgCd:VARCHAR#
		AND   A.folder_keep_state_cd IN ('01','04')
		<isNotEmpty prepend="AND" property="creatYyyyFrom">
			<isNotEmpty property="creatYyyyTo">
				(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
			</isNotEmpty>
			<isEmpty property="creatYyyyTo">
				A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
			</isEmpty>
		</isNotEmpty>
		<isEmpty prepend="AND" property="creatYyyyFrom">
			<isNotEmpty property="creatYyyyTo">
				A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
			</isNotEmpty>
		</isEmpty>
		<isNotEmpty property="presvTermCd">
			<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
				A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR#
			</isEqual>
			<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
				A.presv_term_cd = #presvTermCd:VARCHAR#
			</isNotEqual>
		</isNotEmpty>
		<isEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				A.neo_trans_state_2 IN ('1', '2', '3', '5')
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				A.neo_trans_state_2 IN ('1', '2', '3')
			</isNotEqual>
		</isEqual>
		<isNotEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				A.neo_trans_state_2 = '5'
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				0 = 1
			</isNotEqual>
		</isNotEqual>
	</update>
	




	<!-- 
		장기보존포맷변환(재변환)
		: 기록물철에 대한 포맷변환 요청 - A.1.기록물건 포맷변환요청정보 생성(-:신청) 
	 -->
	<insert id="createPresvFormatNeoReconvFolderReqTransRecordList" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		INSERT INTO TB_STREQTRANS (
			record_center_id, job_id, neo_gubun, neochasu, folder_id, record_id, dest_storage_type, dest_storage_vendor, request_status, erecord_flag
			, request_corp_cd, request_corp_nm, request_org_cd, request_org_nm, request_user_id, request_user_nm, request_user_pos_rank_nm
		)
		(
			SELECT B.record_center_id
				, TO_CHAR(SYSDATE,'YYYY')||LPAD(TB_STFORMAT_SQ01.NEXTVAL,13,'0') AS job_id
				, '2' AS neo_gubun
				, 2 AS neochasu
				, B.folder_id
				, B.record_id
				, #destStorageType:VARCHAR# AS dest_storage_type
				, #destStorageVendor:VARCHAR# AS dest_storage_vendor
				, '-' AS request_status
				, B.erecord_flag
				, (SELECT Z.hupper_org_cd FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) AS request_corp_cd
				, (SELECT Y.org_nm FROM TB_STORG Y, (SELECT Z.record_center_id, Z.hupper_org_cd FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) X WHERE Y.record_center_id=X.record_center_id AND Y.org_cd=X.hupper_org_cd) AS request_corp_nm
				, #requestOrgCd:VARCHAR#
				, (SELECT Z.full_org_nm FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) AS request_org_nm
				, #requestUserId:VARCHAR#
				, #requestUserNm:VARCHAR#
				, (SELECT (CASE WHEN pos IS NULL AND rank IS NULL THEN ''
								WHEN pos IS NULL AND rank IS NOT NULL THEN rank
								WHEN pos IS NOT NULL AND rank IS NULL THEN pos
								ELSE pos||'/'||rank
							END)
					FROM  TB_STUSER
					WHERE user_id = #requestUserId:VARCHAR#) AS user_pos_rank
			FROM  TB_RDRECORD B
			<!--cubrid WHERE (B.record_center_id, B.folder_id)
			IN (
				SELECT record_center_id, folder_id   -->
			WHERE 
			EXISTS (
				SELECT 1
				FROM  TB_RDFOLDER A
				WHERE A.record_center_id = #recordCenterId:VARCHAR#
				AND   A.folder_id = #folderId:VARCHAR#
				<!--cubrid-->
				AND   record_center_id = B.record_center_id
				AND   folder_id = B.folder_id
			)
			AND   (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2='0')
         )
	</insert>
	<!-- 
		장기보존포맷변환(재변환)
		: 기록물철에 대한 포맷변환 요청 - A.2.기록물철 포맷변환요청정보 생성(-:신청) 
	 -->
	<insert id="createPresvFormatNeoReconvFolderReqTransFolderList" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		INSERT INTO TB_STREQTRANS (
			record_center_id, job_id, neo_gubun, neochasu, folder_id, record_id, dest_storage_type, dest_storage_vendor, request_status, erecord_flag
			, request_corp_cd, request_corp_nm, request_org_cd, request_org_nm, request_user_id, request_user_nm, request_user_pos_rank_nm
		)
		(
			SELECT A.record_center_id
				, TO_CHAR(SYSDATE,'YYYY')||LPAD(TB_STFORMAT_SQ01.NEXTVAL,13,'0') AS job_id
				, '1' AS neo_gubun
				, 2 AS neochasu
				, A.folder_id
				, '' AS record_id
				, #destStorageType:VARCHAR# AS dest_storage_type
				, #destStorageVendor:VARCHAR# AS dest_storage_vendor
				, '-' AS request_status
				, A.erecord_flag
				, (SELECT Z.hupper_org_cd FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) AS request_corp_cd
				, (SELECT Y.org_nm FROM TB_STORG Y, (SELECT Z.record_center_id, Z.hupper_org_cd FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) X WHERE Y.record_center_id=X.record_center_id AND Y.org_cd=X.hupper_org_cd) AS request_corp_nm
				, #requestOrgCd:VARCHAR#
				, (SELECT Z.full_org_nm FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) AS request_org_nm
				, #requestUserId:VARCHAR#
				, #requestUserNm:VARCHAR#
				, (SELECT (CASE WHEN pos IS NULL AND rank IS NULL THEN ''
								WHEN pos IS NULL AND rank IS NOT NULL THEN rank
								WHEN pos IS NOT NULL AND rank IS NULL THEN pos
								ELSE pos||'/'||rank
							END)
					FROM  TB_STUSER
					WHERE user_id = #requestUserId:VARCHAR#) AS user_pos_rank
			FROM  TB_RDFOLDER A
			WHERE A.record_center_id = #recordCenterId:VARCHAR#
			AND   A.folder_id = #folderId:VARCHAR#
			AND   (A.neo_trans_state_2 IS NULL OR A.neo_trans_state_2='0')
		)
	</insert>

	<!-- 
		장기보존포맷변환(재변환)
		: 기록물철에 대한 포맷변환 요청 - B.1.기록물건 변환상태 갱신 (1:변환대기)
	 -->
	<insert id="updatePresvFormatNeoReconvFolderWaitToRecord" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDRECORD B
		SET   B.neo_trans_state_2 = '1'
		<!--cubrid WHERE (B.record_center_id, B.folder_id)
		IN (
			SELECT A.record_center_id, A.folder_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM  TB_RDFOLDER A
			WHERE A.record_center_id = #recordCenterId:VARCHAR#
			AND   A.folder_id = #folderId:VARCHAR#
			<!--cubrid-->
			AND   A.record_center_id = B.record_center_id
			AND   A.folder_id = B.folder_id
		)
		AND   (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2='0')
	</insert>
	<!-- 
		장기보존포맷변환(재변환)
		: 기록물철에 대한 포맷변환 요청 - B.2.접수이관목록 기록물철 변환상태 갱신 (1:변환대기)
	 -->
	<update id="updatePresvFormatNeoReconvFolderWaitToTransf" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_DFRECVTRANSFLIST A
		SET   A.neo_trans_state = '1'
			, A.record_neo_trans_state = ( CASE WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3','5'))) THEN '4'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3'))) THEN '5'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.neo_trans_state_2 IN ('1','2','3')) THEN '0'
												ELSE '1' END )
		WHERE A.record_center_id = #recordCenterId:VARCHAR#
		AND   A.folder_id = #folderId:VARCHAR#
		AND   (A.neo_trans_state IS NULL OR A.neo_trans_state='0')
	</update>
	<!-- 
		장기보존포맷변환(재변환)
		: 기록물철에 대한 포맷변환 요청 - B.3.기록물철 변환상태 갱신 (1:변환대기)
	 -->
	<update id="updatePresvFormatNeoReconvFolderWaitToFolder" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDFOLDER A
		SET   A.neo_trans_state_2 = '1'
			, A.record_neo_trans_state_2 = ( CASE WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3','5'))) THEN '4'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3'))) THEN '5'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.neo_trans_state_2 IN ('1','2','3')) THEN '0'
												ELSE '1' END )
		WHERE A.record_center_id = #recordCenterId:VARCHAR#
		AND   A.folder_id = #folderId:VARCHAR#
		AND   (A.neo_trans_state_2 IS NULL OR A.neo_trans_state_2='0')
	</update>

	<!-- 
		장기보존포맷변환(재변환)
		: 기록물철에 대한 포맷변환 취소요청 - C.1.기록물철/기록물건 포맷변환요청정보 갱신 (E:취소) 
	 -->
	<update id="updatePresvFormatNeoReconvFolderClearReqTransList" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_STREQTRANS B
		SET   request_status = 'E'
			, request_start_time = SYSDATE
		<!--cubrid WHERE (record_center_id, folder_id)
		IN (
			SELECT A.record_center_id, A.folder_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM  TB_RDFOLDER A
			WHERE A.record_center_id = #recordCenterId:VARCHAR#
			AND   A.folder_id = #folderId:VARCHAR#
			<!--cubrid-->
			AND   A.record_center_id = B.record_center_id
			AND   A.folder_id = B.folder_id
			<isEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					A.neo_trans_state_2 IN ('1', '2', '3', '5')
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					A.neo_trans_state_2 IN ('1', '2', '3')
				</isNotEqual>
			</isEqual>
			<isNotEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					A.neo_trans_state_2 = '5'
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					0 = 1
				</isNotEqual>
			</isNotEqual>
		)
		AND   B.neo_gubun IN ('1','2')
		AND   B.request_status IN ('-','A','B')
	</update>
	
	<!-- 
		장기보존포맷변환(재변환)
		: 기록물철에 대한 포맷변환 취소요청 - D.1.포맷변환작업이력 테이블의 기록물건 변환상태 삭제 (E:취소) 
	 -->
	<delete id="deletePresvFormatNeoReconvFolderClearRecordToWorkHist" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		DELETE FROM TB_STWORKHIST Z
		<!--cubrid WHERE (record_center_id, folder_id, record_id)
		IN (
			SELECT B.record_center_id, B.folder_id, B.record_id-->
		WHERE 
		EXISTS (
			SELECT 1
			FROM  TB_RDRECORD B
			<!--cubrid WHERE (B.record_center_id, B.folder_id)
			IN (
				SELECT A.record_center_id, A.folder_id-->
			WHERE 
			EXISTS (
				SELECT 1
				FROM  TB_RDFOLDER A
				WHERE A.record_center_id = #recordCenterId:VARCHAR#
				AND   A.folder_id = #folderId:VARCHAR#
				<!--cubrid-->
				AND   A.record_center_id = B.record_center_id
				AND   A.folder_id = B.folder_id
			)
			<isEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.neo_trans_state_2 IN ('1', '2', '3', '5')
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.neo_trans_state_2 IN ('1', '2', '3')
				</isNotEqual>
			</isEqual>
			<isNotEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.neo_trans_state_2 = '5'
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					0 = 1
				</isNotEqual>
			</isNotEqual>
			<!--cubrid-->
			AND B.record_center_id = Z.record_center_id
			AND B.folder_id = Z.folder_id
		)
		AND   format_div_cd = '1'
		AND   (followup_div_cd IS NULL OR followup_div_cd IN ('0','1'))
	</delete>
	<!-- 
		장기보존포맷변환(재변환)
		: 기록물철에 대한 포맷변환 취소요청 - D.2.기록물건 테이블의 기록물건 변환상태 갱신 (0:미변환) 
	 -->
	<update id="updatePresvFormatNeoReconvFolderClearRecordToRecord" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDRECORD B
		SET   B.neo_trans_state_2 = '0'
		<!--cubrid WHERE (B.record_center_id, B.folder_id)
		IN (
			SELECT A.record_center_id, A.folder_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM  TB_RDFOLDER A
			WHERE A.record_center_id = #recordCenterId:VARCHAR#
			AND   A.folder_id = #folderId:VARCHAR#
			<!--cubrid-->
			AND   A.record_center_id = B.record_center_id
			AND   A.folder_id = B.folder_id
		)
		<isEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				B.neo_trans_state_2 IN ('1', '2', '3', '5')
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				B.neo_trans_state_2 IN ('1', '2', '3')
			</isNotEqual>
		</isEqual>
		<isNotEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				B.neo_trans_state_2 = '5'
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				0 = 1
			</isNotEqual>
		</isNotEqual>
	</update>
	<!-- 
		장기보존포맷변환(재변환)
		: 기록물철에 대한 포맷변환 취소요청 - D.3.접수이관목록 테이블의 기록물건 변환상태 갱신 (건상태에 따른 취합) 
	 -->
	<update id="updatePresvFormatNeoReconvFolderClearRecordToTransf" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_DFRECVTRANSFLIST A
		SET   A.record_neo_trans_state = ( CASE WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3','5'))) THEN '4'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3'))) THEN '5'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.neo_trans_state_2 IN ('1','2','3')) THEN '0'
												ELSE '1' END )
		WHERE A.record_center_id = #recordCenterId:VARCHAR#
		AND   A.folder_id = #folderId:VARCHAR#
	</update>
	<!-- 
		장기보존포맷변환(재변환)
		: 기록물철에 대한 포맷변환 취소요청 - D.4.기록물철 테이블의 기록물건 변환상태 갱신 (건상태에 따른 취합) 
	 -->
	<update id="updatePresvFormatNeoReconvFolderClearRecordToFolder" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDFOLDER A
		SET   A.record_neo_trans_state_2 = ( CASE WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3','5'))) THEN '4'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3'))) THEN '5'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.neo_trans_state_2 IN ('1','2','3')) THEN '0'
												ELSE '1' END )
		WHERE A.record_center_id = #recordCenterId:VARCHAR#
		AND   A.folder_id = #folderId:VARCHAR#
	</update>
	<!-- 
		장기보존포맷변환(재변환)
		: 기록물철에 대한 포맷변환 취소요청 - D.5.포맷변환작업이력 테이블의 기록물철 변환상태 삭제 
	 -->
	<delete id="updatePresvFormatNeoReconvFolderClearFolderToWorkHist" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		DELETE FROM TB_STWORKHIST Z
		<!--cubrid WHERE (record_center_id, folder_id)
		IN (
			SELECT A.record_center_id, A.folder_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM  TB_RDFOLDER A
			WHERE A.record_center_id = #recordCenterId:VARCHAR#
			AND   A.folder_id = #folderId:VARCHAR#
			<!--cubrid-->
			AND   A.record_center_id = Z.record_center_id
			AND   A.folder_id = Z.folder_id
			<isEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					A.neo_trans_state_2 IN ('1', '2', '3', '5')
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					A.neo_trans_state_2 IN ('1', '2', '3')
				</isNotEqual>
			</isEqual>
			<isNotEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					A.neo_trans_state_2 = '5'
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					0 = 1
				</isNotEqual>
			</isNotEqual>
		)
		AND   Z.format_div_cd = '2'
		AND   (Z.followup_div_cd IS NULL OR Z.followup_div_cd IN ('0','1'))
	</delete>
	<!-- 
		장기보존포맷변환(재변환)
		: 기록물철에 대한 포맷변환 취소요청 - D.6.접수이관목록 테이블의 기록물철 변환상태 갱신 (0:미변환) 
	 -->
	<update id="updatePresvFormatNeoReconvFolderClearFolderToTransf" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_DFRECVTRANSFLIST A
		SET   A.neo_trans_state = '0'
		WHERE A.record_center_id = #recordCenterId:VARCHAR#
		AND   A.folder_id = #folderId:VARCHAR#
		<isEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				A.neo_trans_state IN ('1', '2', '3', '5')
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				A.neo_trans_state IN ('1', '2', '3')
			</isNotEqual>
		</isEqual>
		<isNotEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				A.neo_trans_state = '5'
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				0 = 1
			</isNotEqual>
		</isNotEqual>
	</update>
	<!-- 
		장기보존포맷변환(재변환)
		: 기록물철에 대한 포맷변환 취소요청 - D.7.기록물철 테이블의 기록물철 변환상태 갱신 (0:미변환) 
	 -->
	<update id="updatePresvFormatNeoReconvFolderClearFolderToFolder" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDFOLDER A
		SET   A.neo_trans_state_2 = '0'
		WHERE A.record_center_id = #recordCenterId:VARCHAR#
		AND   A.folder_id = #folderId:VARCHAR#
		<isEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				A.neo_trans_state_2 IN ('1', '2', '3', '5')
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				A.neo_trans_state_2 IN ('1', '2', '3')
			</isNotEqual>
		</isEqual>
		<isNotEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				A.neo_trans_state_2 = '5'
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				0 = 1
			</isNotEqual>
		</isNotEqual>
	</update>






	<!-- 
		장기보존포맷변환(재변환)
		: 기록물건에 대한 포맷변환 요청 - A.1.기록물건 포맷변환요청정보 생성(-:신청) 
	 -->
	<insert id="createPresvFormatNeoReconvRecordReqTransRecordList" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		INSERT INTO TB_STREQTRANS (
			record_center_id, job_id, neo_gubun, neochasu, folder_id, record_id, dest_storage_type, dest_storage_vendor, request_status, erecord_flag
			, request_corp_cd, request_corp_nm, request_org_cd, request_org_nm, request_user_id, request_user_nm, request_user_pos_rank_nm
		)
		(
			SELECT A.record_center_id
				, TO_CHAR(SYSDATE,'YYYY')||LPAD(TB_STFORMAT_SQ01.NEXTVAL,13,'0') AS job_id
				, '2' AS neo_gubun
				, 2 AS neochasu
				, A.folder_id
				, A.record_id
				, #destStorageType:VARCHAR# AS dest_storage_type
				, #destStorageVendor:VARCHAR# AS dest_storage_vendor
				, '-' AS request_status
				, A.erecord_flag
				, (SELECT Z.hupper_org_cd FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) AS request_corp_cd
				, (SELECT Y.org_nm FROM TB_STORG Y, (SELECT Z.record_center_id, Z.hupper_org_cd FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) X WHERE Y.record_center_id=X.record_center_id AND Y.org_cd=X.hupper_org_cd) AS request_corp_nm
				, #requestOrgCd:VARCHAR#
				, (SELECT Z.full_org_nm FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) AS request_org_nm
				, #requestUserId:VARCHAR#
				, #requestUserNm:VARCHAR#
				, (SELECT (CASE WHEN pos IS NULL AND rank IS NULL THEN ''
								WHEN pos IS NULL AND rank IS NOT NULL THEN rank
								WHEN pos IS NOT NULL AND rank IS NULL THEN pos
								ELSE pos||'/'||rank
							END)
					FROM  TB_STUSER
					WHERE user_id = #requestUserId:VARCHAR#) AS user_pos_rank
	          FROM  TB_RDRECORD A
	          WHERE A.record_center_id = #recordCenterId:VARCHAR#
	          AND   A.record_id = #recordId:VARCHAR#
	          AND   (A.neo_trans_state_2 IS NULL OR A.neo_trans_state_2='0')
         )
	</insert>

	<!-- 
		장기보존포맷변환(재변환)
		: 기록물건에 대한 포맷변환 요청 - B.1.기록물건 변환상태 갱신 (1:변환대기)
	 -->
	<insert id="updatePresvFormatNeoReconvRecordWaitToRecord" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDRECORD A
		SET   A.neo_trans_state_2 = '1'
		WHERE A.record_center_id = #recordCenterId:VARCHAR#
		AND   A.record_id = #recordId:VARCHAR#
		AND   (A.neo_trans_state_2 IS NULL OR A.neo_trans_state_2='0')
	</insert>
	<!-- 
		장기보존포맷변환(재변환)
		: 기록물건에 대한 포맷변환 요청 - B.2.접수이관목록 기록물철 변환상태 갱신 (1:변환대기)
	 -->
	<update id="updatePresvFormatNeoReconvRecordWaitToTransf" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_DFRECVTRANSFLIST A
		SET   A.record_neo_trans_state = ( CASE WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3','5'))) THEN '4'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3'))) THEN '5'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.neo_trans_state_2 IN ('1','2','3')) THEN '0'
												ELSE '1' END )
		<!--cubrid WHERE (A.record_center_id, A.folder_id)
		IN (
			SELECT B.record_center_id, B.folder_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM  TB_RDRECORD B
			WHERE B.record_center_id = #recordCenterId:VARCHAR#
			AND   B.record_id = #recordId:VARCHAR#
			<!--cubrid-->
			AND   B.record_center_id = A.record_center_id
			AND   B.folder_id = A.folder_id
		)
	</update>
	<!-- 
		장기보존포맷변환(재변환)
		: 기록물건에 대한 포맷변환 요청 - B.3.기록물철 변환상태 갱신 (1:변환대기)
	 -->
	<update id="updatePresvFormatNeoReconvRecordWaitToFolder" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDFOLDER A
		SET   A.record_neo_trans_state_2 = ( CASE WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3','5'))) THEN '4'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3'))) THEN '5'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.neo_trans_state_2 IN ('1','2','3')) THEN '0'
												ELSE '1' END )
		WHERE 
		<!--CUBRID
		(A.record_center_id, A.folder_id)
		IN (
			SELECT B.record_center_id, B.folder_id
	  -->
	  EXISTS (SELECT 1
			FROM  TB_RDRECORD B
			WHERE B.record_center_id = #recordCenterId:VARCHAR#
			AND   B.record_id = #recordId:VARCHAR#
			AND A.record_center_id = B.record_center_id
			AND A.folder_id = B.folder_id
		)
	</update>
	

	<!-- 
		장기보존포맷변환(재변환)
		: 기록물건에 대한 포맷변환 취소요청 - C.1.기록물건 포맷변환요청정보 갱신 (E:취소) 
	 -->
	<update id="updatePresvFormatNeoReconvRecordClearReqTransList" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_STREQTRANS Z
		SET   request_status = 'E'
			, request_start_time = SYSDATE
		<!--cubrid WHERE (record_center_id, folder_id, record_id)
		IN (
			SELECT B.record_center_id, B.folder_id, B.record_id-->
		WHERE
		EXISTS (
			SELECT  1
			FROM  TB_RDRECORD B
			WHERE B.record_center_id = #recordCenterId:VARCHAR#
			AND   B.record_id = #recordId:VARCHAR#
			<!--cubrid-->
			AND   B.record_center_id = Z.record_center_id
			AND   B.folder_id = Z.folder_id
			AND   B.record_id = Z.record_id
			<isEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.neo_trans_state_2 IN ('1', '2', '3', '5')
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.neo_trans_state_2 IN ('1', '2', '3')
				</isNotEqual>
			</isEqual>
			<isNotEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.neo_trans_state_2 = '5'
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					0 = 1
				</isNotEqual>
			</isNotEqual>
		)
		AND   Z.neo_gubun IN ('1','2')
		AND   Z.request_status IN ('-','A','B')
	</update>
	
	<!-- 
		장기보존포맷변환(재변환)
		: 기록물건에 대한 포맷변환 취소요청 - D.1.포맷변환작업이력 테이블의 기록물건 변환상태 삭제 (E:취소) 
	 -->
	<delete id="deletePresvFormatNeoReconvRecordClearRecordToWorkHist" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		DELETE FROM TB_STWORKHIST Z
		<!--cubrid WHERE (record_center_id, folder_id, record_id)
		IN (
			SELECT B.record_center_id, B.folder_id, B.record_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM  TB_RDRECORD B
			WHERE B.record_center_id = #recordCenterId:VARCHAR#
			AND   B.record_id = #recordId:VARCHAR#
			<!--cubrid-->
			AND    B.record_center_id = Z.record_center_id
			AND    B.folder_id = Z.folder_id
			AND    B.record_id = Z.record_id
			<isEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.neo_trans_state_2 IN ('1', '2', '3', '5')
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.neo_trans_state_2 IN ('1', '2', '3')
				</isNotEqual>
			</isEqual>
			<isNotEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.neo_trans_state_2 = '5'
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					0 = 1
				</isNotEqual>
			</isNotEqual>
		)
		AND   Z.format_div_cd = '1'
		AND   (Z.followup_div_cd IS NULL OR Z.followup_div_cd IN ('0','1'))
	</delete>
	<!-- 
		장기보존포맷변환(재변환)
		: 기록물건에 대한 포맷변환 취소요청 - D.2.기록물건 테이블의 기록물건 변환상태 갱신 (0:미변환) 
	 -->
	<update id="updatePresvFormatNeoReconvRecordClearRecordToRecord" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDRECORD B
		SET   B.neo_trans_state_2 = '0'
		WHERE B.record_center_id = #recordCenterId:VARCHAR#
		AND   B.record_id = #recordId:VARCHAR#
		<isEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				B.neo_trans_state_2 IN ('1', '2', '3', '5')
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				B.neo_trans_state_2 IN ('1', '2', '3')
			</isNotEqual>
		</isEqual>
		<isNotEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				B.neo_trans_state_2 = '5'
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				0 = 1
			</isNotEqual>
		</isNotEqual>
	</update>
	<!-- 
		장기보존포맷변환(재변환)
		: 기록물건에 대한 포맷변환 취소요청 - D.3.접수이관목록 테이블의 기록물건 변환상태 갱신 (건상태에 따른 취합) 
	 -->
	<update id="updatePresvFormatNeoReconvRecordClearRecordToTransf" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_DFRECVTRANSFLIST A
		SET   A.record_neo_trans_state = ( CASE WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3','5'))) THEN '4'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3'))) THEN '5'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.neo_trans_state_2 IN ('1','2','3')) THEN '0'
												ELSE '1' END )
		<!--cubrid WHERE (A.record_center_id, A.folder_id)
		IN (
			SELECT B.record_center_id, B.folder_id-->
		WHERE 
		EXISTS (
			SELECT 1
			FROM  TB_RDRECORD B
			WHERE B.record_center_id = #recordCenterId:VARCHAR#
			AND   B.record_id = #recordId:VARCHAR#
			<!--cubrid-->
			AND B.record_center_id = A.record_center_id
			AND B.folder_id = A.folder_id
		)
	</update>
	<!-- 
		장기보존포맷변환(재변환)
		: 기록물건에 대한 포맷변환 취소요청 - D.4.기록물철 테이블의 기록물건 변환상태 갱신 (건상태에 따른 취합) 
	 -->
	<update id="updatePresvFormatNeoReconvRecordClearRecordToFolder" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDFOLDER A
		SET   A.record_neo_trans_state_2 = ( CASE WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3','5'))) THEN '4'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3'))) THEN '5'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.neo_trans_state_2 IN ('1','2','3')) THEN '0'
												ELSE '1' END )
		<!--cubrid WHERE (A.record_center_id, A.folder_id)
		IN (
			SELECT B.record_center_id, B.folder_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM  TB_RDRECORD B
			WHERE B.record_center_id = #recordCenterId:VARCHAR#
			AND   B.record_id = #recordId:VARCHAR#
			<!--cubrid-->
			AND   B.record_center_id = A.record_center_id
			AND   B.folder_id = A.folder_id
		)
	</update>
	
	<!-- 
		장기보존포맷변환(재변환) : 변환실패 파일 후속조치 (후속조치이력 입력)
	 -->
	<update id="updatePresvFormatNeoReconvFollowup" parameterClass="rms.presv.format.domain.PresvFormatNeoFailedMsg">
		UPDATE TB_STWORKHIST
		SET   followup_div_cd = #followupDivCd:VARCHAR#
			, followup_cause = #followupCause:VARCHAR#
			, followup_fin_flag = '1'
		WHERE record_center_id = #recordCenterId:VARCHAR#
		AND   work_hist_id = #workHistId:VARCHAR#
	</update>
	<!-- 
		장기보존포맷변환(재변환)
		: 기록물철에 대한 포맷변환 요청 - F.1.기록물철 포맷변환요청정보 생성(-:신청) 
	 -->
	<insert id="createPresvFormatNeoReconvFolderReqTransFollowup" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		INSERT INTO TB_STREQTRANS (
			record_center_id, job_id, neo_gubun, neochasu, folder_id, record_id, dest_storage_type, dest_storage_vendor, request_status, erecord_flag
			, request_corp_cd, request_corp_nm, request_org_cd, request_org_nm, request_user_id, request_user_nm, request_user_pos_rank_nm
		)
		(
			SELECT A.record_center_id
				, TO_CHAR(SYSDATE,'YYYY')||LPAD(TB_STFORMAT_SQ01.NEXTVAL,13,'0') AS job_id
				, '1' AS neo_gubun
				, 2 AS neochasu
				, A.folder_id
				, '' AS record_id
				, #destStorageType:VARCHAR# AS dest_storage_type
				, #destStorageVendor:VARCHAR# AS dest_storage_vendor
				, '-' AS request_status
				, A.erecord_flag
				, (SELECT Z.hupper_org_cd FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) AS request_corp_cd
				, (SELECT Y.org_nm FROM TB_STORG Y, (SELECT Z.record_center_id, Z.hupper_org_cd FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) X WHERE Y.record_center_id=X.record_center_id AND Y.org_cd=X.hupper_org_cd) AS request_corp_nm
				, #requestOrgCd:VARCHAR#
				, (SELECT Z.full_org_nm FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) AS request_org_nm
				, #requestUserId:VARCHAR#
				, #requestUserNm:VARCHAR#
				, (SELECT (CASE WHEN pos IS NULL AND rank IS NULL THEN ''
								WHEN pos IS NULL AND rank IS NOT NULL THEN rank
								WHEN pos IS NOT NULL AND rank IS NULL THEN pos
								ELSE pos||'/'||rank
							END)
					FROM  TB_STUSER
					WHERE user_id = #requestUserId:VARCHAR#) AS user_pos_rank
			FROM  TB_RDFOLDER A
			WHERE A.record_center_id = #recordCenterId:VARCHAR#
			AND   A.folder_id = #folderId:VARCHAR#
			AND   A.neo_trans_state_2 = '5'
		)
	</insert>
	<!-- 
		장기보존포맷변환(재변환)
		: 기록물철에 대한 포맷변환 요청 - F.2.기록물철 변환상태 갱신 (1:변환대기)
	 -->
	<insert id="updatePresvFormatNeoReconvFolderFollowup" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDFOLDER A
		SET   A.neo_trans_state_2 = '1'
			, A.record_neo_trans_state_2 = ( CASE WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3','5'))) THEN '4'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3'))) THEN '5'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.neo_trans_state_2 IN ('1','2','3')) THEN '0'
												ELSE '1' END )
		WHERE A.record_center_id = #recordCenterId:VARCHAR#
		AND   A.folder_id = #folderId:VARCHAR#
		AND   A.neo_trans_state_2 = '5'
	</insert>
	<!-- 
		장기보존포맷변환(재변환)
		: 기록물건에 대한 포맷변환 요청 - R.1.기록물건 포맷변환요청정보 생성(-:신청) 
	 -->
	<insert id="createPresvFormatNeoReconvRecordReqTransFollowup" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		INSERT INTO TB_STREQTRANS (
			record_center_id, job_id, neo_gubun, neochasu, folder_id, record_id, dest_storage_type, dest_storage_vendor, request_status, erecord_flag
			, request_corp_cd, request_corp_nm, request_org_cd, request_org_nm, request_user_id, request_user_nm, request_user_pos_rank_nm
		)
		(
			SELECT A.record_center_id
				, TO_CHAR(SYSDATE,'YYYY')||LPAD(TB_STFORMAT_SQ01.NEXTVAL,13,'0') AS job_id
				, '2' AS neo_gubun
				, 2 AS neochasu
				, A.folder_id
				, A.record_id
				, #destStorageType:VARCHAR# AS dest_storage_type
				, #destStorageVendor:VARCHAR# AS dest_storage_vendor
				, '-' AS request_status
				, A.erecord_flag
				, (SELECT Z.hupper_org_cd FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) AS request_corp_cd
				, (SELECT Y.org_nm FROM TB_STORG Y, (SELECT Z.record_center_id, Z.hupper_org_cd FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) X WHERE Y.record_center_id=X.record_center_id AND Y.org_cd=X.hupper_org_cd) AS request_corp_nm
				, #requestOrgCd:VARCHAR#
				, (SELECT Z.full_org_nm FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) AS request_org_nm
				, #requestUserId:VARCHAR#
				, #requestUserNm:VARCHAR#
				, (SELECT (CASE WHEN pos IS NULL AND rank IS NULL THEN ''
								WHEN pos IS NULL AND rank IS NOT NULL THEN rank
								WHEN pos IS NOT NULL AND rank IS NULL THEN pos
								ELSE pos||'/'||rank
							END)
					FROM  TB_STUSER
					WHERE user_id = #requestUserId:VARCHAR#) AS user_pos_rank
	          FROM  TB_RDRECORD A
	          WHERE A.record_center_id = #recordCenterId:VARCHAR#
	          AND   A.record_id = #recordId:VARCHAR#
	          AND   A.neo_trans_state_2 = '5'
         )
	</insert>
	<!-- 
		장기보존포맷변환(재변환)
		: 기록물건에 대한 포맷변환 취소요청 - R.3.기록물건 테이블의 기록물건 변환상태 갱신 (1:변환대기)
	 -->
	<update id="updatePresvFormatNeoReconvRecordFollowupRecordToRecord" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDRECORD B
		SET   B.neo_trans_state_2 = '1'
		WHERE B.record_center_id = #recordCenterId:VARCHAR#
		AND   B.record_id = #recordId:VARCHAR#
	</update>
	<!-- 
		장기보존포맷변환(재변환)
		: 기록물건에 대한 포맷변환 취소요청 - R.4.기록물철 테이블의 기록물건 변환상태 갱신 (건상태에 따른 취합) 
	 -->
	<update id="updatePresvFormatNeoReconvRecordFollowupRecordToFolder" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDFOLDER A
		SET   A.record_neo_trans_state_2 = ( CASE WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3','5'))) THEN '4'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3'))) THEN '5'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.neo_trans_state_2 IN ('1','2','3')) THEN '0'
												ELSE '1' END )
		<!--cubrid WHERE (A.record_center_id, A.folder_id)
		IN (
			SELECT B.record_center_id, B.folder_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM  TB_RDRECORD B
			WHERE B.record_center_id = #recordCenterId:VARCHAR#
			AND   B.record_id = #recordId:VARCHAR#
			<!--cubrid-->
			AND   B.record_center_id = A.record_center_id
			AND   B.folder_id = A.folder_id
		)
	</update>
	
	<select id="findNeochasu" parameterClass="rms.presv.format.domain.PresvFormatNeoFailedMsg" resultClass="int">
		SELECT MAX(neochasu) neochasu FROM TB_STREQTRANS
		WHERE record_center_id = #recordCenterId:VARCHAR#
		<isNotEmpty prepend="AND" property="folderId">
			folder_id = #folderId:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="recordId">
			record_id = #recordId:VARCHAR#
		</isNotEmpty>
	</select>
	
	<!-- 
		장기보존포맷변환 : 기록물건에 대한 기록물건NEO 변환취소 요청 - 2.기록물건 상태 변경 (0:미변환)
	 -->
	<update id="updatePresvFormatRecordNeoRecordClearRecord" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDRECORD A
		SET   A.neo_trans_state = '0'
		WHERE A.record_center_id = #recordCenterId:VARCHAR#
		AND   A.record_id = #recordId:VARCHAR#
		<isEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				A.neo_trans_state IN ('1', '2', '3', '5')
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				A.neo_trans_state IN ('1', '2', '3')
			</isNotEqual>
		</isEqual>
		<isNotEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				A.neo_trans_state = '5'
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				0 = 1
			</isNotEqual>
		</isNotEqual>
	</update>
	
		<!-- 
		장기보존포맷변환 : 기록물건에 대한 기록물건NEO 변환취소 요청 - 3.기록물철 상태 변경 (0:미변환 or OTHER)
	 -->
	<update id="updatePresvFormatRecordNeoRecordClearFolder" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDFOLDER Z
		SET   Z.record_neo_trans_state = ( CASE 
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=Z.record_center_id AND B.folder_id=Z.folder_id AND (B.neo_trans_state IS NULL OR B.neo_trans_state IN ('0','1','2','3','5'))) THEN '4'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=Z.record_center_id AND B.folder_id=Z.folder_id AND (B.neo_trans_state IS NULL OR B.neo_trans_state IN ('0','1','2','3'))) THEN '5'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=Z.record_center_id AND B.folder_id=Z.folder_id AND B.neo_trans_state IN ('1','2','3')) THEN '0'
												ELSE '1' END )
		<!--cubrid WHERE (record_center_id, folder_id)
		IN (
			SELECT A.record_center_id, A.folder_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM  TB_RDRECORD A
			WHERE A.record_center_id = #recordCenterId:VARCHAR#
			AND   A.record_id = #recordId:VARCHAR#
			<!--cubrid-->
			AND   A.record_center_id = Z.record_center_id
			AND   A.folder_id = Z.folder_id
			<isEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					A.neo_trans_state IN ('1', '2', '3','5')
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					A.neo_trans_state IN ('1', '2', '3')
				</isNotEqual>
			</isEqual>
			<isNotEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					A.neo_trans_state = '5'
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					0 = 1
				</isNotEqual>
			</isNotEqual>
		)
	</update>
	
	<!-- 
		장기보존포맷변환 : 기록물건에 대한 기록물건NEO 변환취소 2cha 요청 - 2.기록물건 상태 변경 (0:미변환)
	 -->
	<update id="updatePresvFormatRecordNeoRecordClearRecord2cha" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDRECORD A
		SET   A.neo_trans_state_2 = '0'
		WHERE A.record_center_id = #recordCenterId:VARCHAR#
		AND   A.record_id = #recordId:VARCHAR#
		<isEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				A.neo_trans_state_2 IN ('1', '2', '3', '5')
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				A.neo_trans_state_2 IN ('1', '2', '3')
			</isNotEqual>
		</isEqual>
		<isNotEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				A.neo_trans_state_2 = '5'
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				0 = 1
			</isNotEqual>
		</isNotEqual>
	</update>
	
	<!-- 
		장기보존포맷변환 : 기록물건에 대한 기록물건NEO 변환취소 요청(2ck) - 3.기록물철 상태 변경 (0:미변환 or OTHER)
	 -->
	<update id="updatePresvFormatRecordNeoRecordClearFolder2cha" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDFOLDER Z
		SET   Z.record_neo_trans_state_2 = ( CASE 
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=Z.record_center_id AND B.folder_id=Z.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3','5'))) THEN '4'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=Z.record_center_id AND B.folder_id=Z.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3'))) THEN '5'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=Z.record_center_id AND B.folder_id=Z.folder_id AND B.neo_trans_state_2 IN ('1','2','3')) THEN '0'
												ELSE '1' END )
		<!--cubrid WHERE (record_center_id, folder_id)
		IN (
			SELECT A.record_center_id, A.folder_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM  TB_RDRECORD A
			WHERE A.record_center_id = #recordCenterId:VARCHAR#
			AND   A.record_id = #recordId:VARCHAR#
			<!--cubrid-->
			AND   A.record_center_id = Z.record_center_id
			AND   A.folder_id = Z.folder_id
			<isEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					A.neo_trans_state_2 IN ('1', '2', '3','5')
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					A.neo_trans_state_2 IN ('1', '2', '3')
				</isNotEqual>
			</isEqual>
			<isNotEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					A.neo_trans_state_2 = '5'
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					0 = 1
				</isNotEqual>
			</isNotEqual>
		)
	</update>
	
		<!--
		장기보존포맷변환 : 기록물건에 대한 기록물건NEO 포맷변환 1차요청 - 작업 큐 생성 (1:변환대기)
	 -->
	<insert id="insertPresvFormatRecordNeoRecord" parameterClass="rms.presv.format.domain.PresvFormatNeo">
			INSERT INTO TB_STREQTRANS		                  	        
			(   RECORD_CENTER_ID    ,
			    JOB_ID              ,
			    NEO_GUBUN           ,
			    FOLDER_ID           ,
			    RECORD_ID           ,
				DEST_STORAGE_TYPE   ,  
				DEST_STORAGE_VENDOR ,
			    REQUEST_STATUS      ,
			    NEOCHASU            ,
			    PARAMETER_XML       ,
			    ERECORD_FLAG        )
			(
			    SELECT
			          C.record_center_id,      
			          #jobGroupId:VARCHAR#, 
			          '2',
			          C.folder_id, 
			          C.record_id, 
                      D.MEDIUM_CD AS   DEST_STORAGE_TYPE   ,
                      D.MEDIUM_DETAIL_CD AS DEST_storage_vendor, 
			          '-',
			          #neochasu:INT#,
			          #parameterXml:CLOB#,
			          C.ERECORD_FLAG
			    FROM  TB_RDRECORD C
			    , ( SELECT MEDIUM_CD, MEDIUM_DETAIL_CD
					FROM (
					    SELECT MEDIUM_CD, MEDIUM_DETAIL_CD
					    FROM  TB_STMEDIUM A
					    WHERE A.record_center_id = #recordCenterId:VARCHAR#
					    AND   A.VOLM_ID IN (SELECT VOLM_ID FROM TB_STVOLM WHERE DEL_FLAG='0' AND VOLM_DIV_CD='3')
					    AND   A.DEL_FLAG = '0'
					    AND   (A.TOT_SIZE - A.USE_SIZE) > 0
					    ORDER BY A.RECORD_CENTER_ID, A.MEDIUM_ID
					)
					WHERE ROWNUM = 1) D
			    WHERE C.record_center_id = #recordCenterId:VARCHAR#
		        AND   C.record_id = #recordId:VARCHAR#
			<isEqual property="neochasu" compareValue="1">
                AND   (C.neo_trans_state IS NULL OR C.neo_trans_state='0')
			</isEqual>
			<isEqual property="neochasu" compareValue="2">
                AND   (C.neo_trans_state_2 IS NULL OR C.neo_trans_state_2='0')
			</isEqual>
			)
    </insert>
    
    	<!-- 장기보존포맷변환 : 기록물철에 대한 기록물건NEO 변환취소 요청 - 1.건원문 변환실패 내역 삭제 -->
	<delete id="deletePresvFormatRecordNeoFolderClearWorkhist"
		parameterClass="rms.presv.format.domain.PresvFormatNeo">
		DELETE FROM TB_STWORKHIST Z
		<!--cubrid WHERE (record_center_id, folder_id,record_id)
		IN (
		SELECT B.record_center_id, B.folder_id, B.record_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM TB_RDRECORD B
			<!--cubrid WHERE (B.record_center_id, B.folder_id)-->
			WHERE 
				EXISTS (
				<!--cubrdi SELECT A.record_center_id, A.folder_id-->
				SELECT  1
				FROM TB_RDFOLDER A
				WHERE A.record_center_id = #recordCenterId:VARCHAR#
				AND A.folder_id = #folderId:VARCHAR#
				AND A.folder_keep_state_cd IN ('01','04')
				<!--cubrid-->
				AND A.record_center_id = B.record_center_id
				AND A.folder_id = B.folder_id
		)
		<isEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				B.neo_trans_state IN ('1', '2', '3','5')
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag"
				compareValue="1">
				B.neo_trans_state IN ('1', '2', '3')
			</isNotEqual>
		</isEqual>
		<isNotEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				B.neo_trans_state = '5'
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag"
				compareValue="1">
				0 = 1
			</isNotEqual>
		</isNotEqual>
			<!--cubrid-->
			AND B.record_center_id = Z.record_center_id
			AND B.folder_id = Z.folder_id
			AND B.record_id = Z.record_id
		)
		AND Z.format_div_cd = '1'
		AND Z.followup_div_cd IS NULL OR Z.followup_div_cd
		IN ('0','1')
	</delete>
	
	
	<!-- 장기보존포맷변환 : 기록물철에 대한 기록물건NEO 변환취소 요청 - 2.건원문 상태 변경 (0:미변환) -->
	<update id="updatePresvFormatRecordNeoFolderClearRecordOrign"
		parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_STRECORDORIGN Z
		SET neo_trans_state = '0'
		<!--cubrid WHERE(record_center_id, record_id)
		IN (
			SELECT B.record_center_id, B.record_id-->
		WHERE
		EXISTS (
			SELECT B.record_center_id, B.record_id
			FROM TB_RDRECORD B
			<!--cubrid WHERE (B.record_center_id, B.folder_id)
				IN (
				SELECT A.record_center_id, A.folder_id-->
			WHERE
				EXISTS (
				SELECT 1
				FROM TB_RDFOLDER A
				WHERE A.record_center_id = #recordCenterId:VARCHAR#
				AND A.folder_id = #folderId:VARCHAR#
				AND A.folder_keep_state_cd IN ('01','04')
				<!--cubrid-->
				AND A.record_center_id = B.record_center_id
				AND A.folder_id = B.folder_id
		)
		<isEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				B.neo_trans_state IN ('1', '2', '3','5')
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag"
				compareValue="1">
				B.neo_trans_state IN ('1', '2', '3')
			</isNotEqual>
		</isEqual>
		<isNotEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				B.neo_trans_state = '5'
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag"
				compareValue="1">
				0 = 1
			</isNotEqual>
		</isNotEqual>
			<!--curid-->
			AND B.record_center_id = Z.record_center_id
			AND B.record_id = Z.record_id
		)
	</update>
	
		<!-- 장기보존포맷변환 : 기록물철에 대한 기록물건NEO 변환취소 요청 - 3.기록물건 상태 변경 (0:미변환) -->
	<update id="updatePresvFormatRecordNeoFolderClearRecord"
		parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDRECORD Z
		SET neo_trans_state = '0'
		<!--cubrid WHERE (record_center_id,folder_id)
			IN (
			SELECT A.record_center_id, A.folder_id-->
		WHERE
			EXISTS (
			SELECT  1
			FROM TB_RDFOLDER A
			WHERE A.record_center_id = #recordCenterId:VARCHAR#
			AND A.folder_id = #folderId:VARCHAR#
			AND A.folder_keep_state_cd IN ('01','04')
			<!--cubrid-->
			AND A.record_center_id = Z.record_center_id
			AND A.folder_id = Z.folder_id
		)
		<isEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				neo_trans_state IN ('1', '2', '3', '5')
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag"
				compareValue="1">
				neo_trans_state IN ('1', '2', '3')
			</isNotEqual>
		</isEqual>
		<isNotEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				neo_trans_state = '5'
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag"
				compareValue="1">
				0 = 1
			</isNotEqual>
		</isNotEqual>
	</update>
	
		<!-- 장기보존포맷변환 : 기록물철에 대한 기록물건NEO 변환취소 요청 - 4.기록물철 상태 변경 (0:미변환 or OTHER) -->
	<update id="updatePresvFormatRecordNeoFolderClearFolder"
		parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDFOLDER A
		SET A.record_neo_trans_state = (
		CASE
		WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE
		B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND
		(B.neo_trans_state IS NULL OR B.neo_trans_state IN
		('0','1','2','3','5'))) THEN '4'
		WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE
		B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND
		(B.neo_trans_state IS NULL OR B.neo_trans_state IN ('0','1','2','3')))
		THEN '5'
		WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE
		B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND
		B.neo_trans_state IN ('1','2','3')) THEN '0'
		ELSE '1' END )
		WHERE A.record_center_id = #recordCenterId:VARCHAR#
		AND
		A.folder_id = #folderId:VARCHAR#
		AND A.folder_keep_state_cd IN
		('01','04')
	</update>
	
	<!-- 장기보존포맷변환 : 기록물철에 대한 기록물철NEO 변환취소 요청 - 1.기록물철 변환실패 내역 삭제 -->
	<delete id="deletePresvFormatFolderNeoFolderClearWorkhist" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		DELETE FROM TB_STWORKHIST Z
		<!--cubrid WHERE (record_center_id, folder_id)
		IN (
			SELECT record_center_id, folder_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM TB_RDFOLDER
			WHERE record_center_id = #recordCenterId:VARCHAR#
			AND folder_id = #folderId:VARCHAR#
			AND folder_keep_state_cd IN ('01','04')
			<!--cubrid-->
			AND record_center_id = Z.record_center_id
			AND folder_id = Z.folder_id
		<isEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				neo_trans_state IN ('1', '2', '3', '5')
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag"
				compareValue="1">
				neo_trans_state IN ('1', '2', '3')
			</isNotEqual>
		</isEqual>
		<isNotEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				neo_trans_state = '5'
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag"
				compareValue="1">
				0 = 1
			</isNotEqual>
		</isNotEqual>
		)
		AND Z.format_div_cd = '2'
		AND Z.followup_div_cd IS NULL OR Z.followup_div_cd
		IN ('0','1')
	</delete>
	
		<!-- 장기보존포맷변환 : 기록물철에 대한 기록물철NEO 변환취소 요청 - 2.기록물철 상태 변경 (0:미변환) -->
	<update id="updatePresvFormatFolderNeoFolderClearFolder"
		parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDFOLDER
		SET neo_trans_state = '0'
		WHERE record_center_id =
		#recordCenterId:VARCHAR#
		AND folder_id = #folderId:VARCHAR#
		AND
		folder_keep_state_cd IN ('01','04')
		<isEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				neo_trans_state IN ('1', '2', '3', '5')
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag"
				compareValue="1">
				neo_trans_state IN ('1', '2', '3')
			</isNotEqual>
		</isEqual>
		<isNotEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				neo_trans_state = '5'
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag"
				compareValue="1">
				0 = 1
			</isNotEqual>
		</isNotEqual>
	</update>
	
		<!-- 
		장기보존포맷변환 요청 - 기록물철변환에 대한 이관기록물철 상태 변경 (1:변환대기)
	 -->
	<update id="updateFolderNeoTransfListClear" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_DFRECVTRANSFLIST A
		SET   A.neo_trans_state = '0',
		      A.record_neo_trans_state = '0'		
        WHERE A.record_center_id = #recordCenterId:VARCHAR#
        AND   A.folder_id = #folderId:VARCHAR#
	</update>	
	
		<!-- 장기보존포맷변환 : 기록물철에 대한 기록물건NEO 변환취소 요청 - 3.기록물건 상태 변경 (0:미변환) -->
		<!-- 20150703 김경수 NEO 2차 취소시 건전체 자동 취소 처리 (완료건 포함) -->
	<update id="updatePresvFormatRecordNeoFolderClearRecord2cha"
		parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDRECORD Z
		SET neo_trans_state_2 = '0'
		<!--cubrid WHERE (record_center_id,folder_id)
		IN (
			SELECT A.record_center_id, A.folder_id-->
		WHERE 
		EXISTS(
			SELECT 1
			FROM TB_RDFOLDER A
			WHERE A.record_center_id = #recordCenterId:VARCHAR#
			AND A.folder_id = #folderId:VARCHAR#
			AND A.folder_keep_state_cd IN ('01','04')
			<!--cubrid-->
			AND record_center_id = Z.record_center_id
			AND folder_id = Z.folder_id
		)
		<isEqual property="clearIngFlag" compareValue="1">
			<isEqual property="clearFailFlag" compareValue="1">
<!-- 				<isEqual property="neochasu" compareValue="2">
					<isEqual prepend="AND" property="errorFlag" compareValue="2">
						neo_trans_state_2 IN ('1', '2', '3', '4', '5')
					</isEqual>
					<isNotEqual prepend="AND" property="errorFlag" compareValue="2">
						neo_trans_state_2 IN ('1', '2', '3', '5')
					</isNotEqual>
				</isEqual> -->
				<isNotEqual prepend="AND" property="neochasu" compareValue="2">
					neo_trans_state_2 IN ('1', '2', '3', '5')
				</isNotEqual>
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				neo_trans_state_2 IN ('1', '2', '3')
			</isNotEqual>
		</isEqual>
		<isNotEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				neo_trans_state_2 = '5'
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag"
				compareValue="1">
				0 = 1
			</isNotEqual>
		</isNotEqual>
	</update>
	
		<!-- 장기보존포맷변환 : 기록물철에 대한 기록물건NEO 변환취소 요청 - 4.기록물철 상태 변경 (0:미변환 or OTHER) -->
	<update id="updatePresvFormatRecordNeoFolderClearFolder2cha"
		parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDFOLDER A
		SET A.record_neo_trans_state_2 = (
		CASE
		WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE
		B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND
		(B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN
		('0','1','2','3','5'))) THEN '4'
		WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE
		B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND
		(B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN
		('0','1','2','3'))) THEN '5'
		WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE
		B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND
		B.neo_trans_state_2 IN ('1','2','3')) THEN '0'
		ELSE '1' END )
		WHERE A.record_center_id = #recordCenterId:VARCHAR#
		AND
		A.folder_id = #folderId:VARCHAR#
		AND A.folder_keep_state_cd IN
		('01','04')
	</update>
	
	<!-- 장기보존포맷변환 : 기록물철에 대한 기록물철NEO 변환취소 요청 - 2.기록물철 상태 변경 (0:미변환)
		 20150703 김경수 NEO 2차 변환 변환 취소시 모든 파일 초기화
	 -->		
	<update id="updatePresvFormatFolderNeoFolderClearFolder2cha"
		parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDFOLDER
		SET neo_trans_state_2 = '0'
		WHERE record_center_id =
		#recordCenterId:VARCHAR#
		AND folder_id = #folderId:VARCHAR#
		AND folder_keep_state_cd IN ('01','04')
		<isEqual property="clearIngFlag" compareValue="1">
			<isEqual property="clearFailFlag" compareValue="1">				
<!-- 				<isEqual property="neochasu" compareValue="2">
					<isEqual prepend="AND" property="errorFlag" compareValue="2">
						neo_trans_state_2 IN ('1', '2', '3', '4', '5')
					</isEqual>
					<isNotEqual prepend="AND" property="errorFlag" compareValue="2">
						neo_trans_state_2 IN ('1', '2', '3', '5')
					</isNotEqual>
				</isEqual> -->
				<isNotEqual prepend="AND" property="neochasu" compareValue="2">
					neo_trans_state_2 IN ('1', '2', '3', '5')
				</isNotEqual>
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag"
				compareValue="1">
				neo_trans_state_2 IN ('1', '2', '3')
			</isNotEqual>
		</isEqual>
		<isNotEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				neo_trans_state_2 = '5'
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag"
				compareValue="1">
				0 = 1
			</isNotEqual>
		</isNotEqual>
	</update>
	
		<!-- 장기보존포맷변환 : 기록물철에 대한 기록물철NEO 포맷변환 요청 - 작업 큐 생성 (1:변환대기) -->
	<insert id="insertPresvFormatFolderNeoFolderQueue"
		parameterClass="rms.presv.format.domain.PresvFormatNeo">
		INSERT INTO TB_STREQTRANS
		( RECORD_CENTER_ID,
		JOB_ID,
		NEO_GUBUN,
		PARAMETER_XML,
		FOLDER_ID,
		DEST_STORAGE_TYPE,
		DEST_STORAGE_VENDOR,
		REQUEST_STATUS,
		NEOCHASU,
		ERECORD_FLAG )
		SELECT
		C.record_center_id,
		#jobGroupId:VARCHAR#,
		'1',
		#parameterXml:CLOB#,
		C.folder_id,
		D.MEDIUM_CD AS DEST_STORAGE_TYPE,
		D.MEDIUM_DETAIL_CD AS DEST_storage_vendor,
		'-',
		#neochasu:INT#,
		C.ERECORD_FLAG
		FROM TB_RDFOLDER C
		, ( SELECT MEDIUM_CD, MEDIUM_DETAIL_CD
		FROM (
		SELECT MEDIUM_CD, MEDIUM_DETAIL_CD
		FROM TB_STMEDIUM A
		WHERE A.record_center_id = #recordCenterId:VARCHAR#
		AND A.VOLM_ID IN (SELECT VOLM_ID FROM TB_STVOLM WHERE DEL_FLAG='0' AND
		VOLM_DIV_CD='3')
		AND A.DEL_FLAG = '0'
		AND (A.TOT_SIZE - A.USE_SIZE) > 0
		ORDER BY A.RECORD_CENTER_ID, A.MEDIUM_ID
		)
		WHERE ROWNUM = 1) D
		WHERE C.record_center_id = #recordCenterId:VARCHAR#
		AND C.folder_id = #folderId:VARCHAR#
		<isEqual property="neochasu" compareValue="1">
			AND (C.neo_trans_state IS NULL OR C.neo_trans_state='0')
		</isEqual>
		<isEqual property="neochasu" compareValue="2">
			AND (C.neo_trans_state_2 IS NULL OR C.neo_trans_state_2='0')
		</isEqual>
	</insert>
	
		<!-- 장기보존포맷변환 : 작업그룹ID에 해당하는 기록물철NEO 변환상태 변경 - 1.기록물철 (1:변환대기) -->
	<update id="updatePresvFormatFolderNeoWaitFolder"
		parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDFOLDER A
		SET A.neo_trans_state = '1'
		WHERE record_center_id = #recordCenterId:VARCHAR#
		AND folder_id = #folderId:VARCHAR#
		AND A.folder_keep_state_cd IN ('01','04')
	</update>
	
		<!-- 장기보존포맷변환 : 작업그룹ID에 해당하는 기록물철NEO 2차 변환상태 변경 - 1.기록물철 (1:변환대기) -->
	<update id="updatePresvFormatFolderNeoWaitFolder2cha"
		parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDFOLDER A
		SET A.neo_trans_state_2 = '1',
		A.record_neo_trans_state_2 = ( CASE
		WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE
		B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND
		B.erecord_flag='1' AND (B.neo_trans_state_2 IS NULL OR
		B.neo_trans_state_2 IN ('0','1','2','3','5'))) THEN '4'
		WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE
		B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND
		B.erecord_flag='1' AND (B.neo_trans_state_2 IS NULL OR
		B.neo_trans_state_2 IN ('0','1','2','3'))) THEN '5'
		WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE
		B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND
		B.erecord_flag='1' AND B.neo_trans_state_2 IN ('1','2','3')) THEN '0'
		WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE
		B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND
		B.erecord_flag='1' AND B.neo_trans_state_2 IN ('1','2')) THEN '3'
		ELSE '1'
		END )
		WHERE record_center_id = #recordCenterId:VARCHAR#
		AND folder_id = #folderId:VARCHAR#
		AND A.folder_keep_state_cd IN ('01','04')
	</update>
	
	<!-- 
		장기보존포맷변환 요청 - 기록물철변환에 대한 이관기록물철 상태 변경 (1:변환대기)
	 -->
	<update id="updateFolderNeoTransfListWait" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_DFRECVTRANSFLIST A
		SET   A.neo_trans_state = '1',
		      A.record_neo_trans_state = '1'
        WHERE A.record_center_id = #recordCenterId:VARCHAR#
        AND   A.folder_id = #folderId:VARCHAR#
	</update>
	
	<!-- 
		장기보존포맷변환 : 기록물건NEO 변환시 원문ID 미부여 기록물건 조회
	 -->
	<resultMap id="findPresvFormatRecordNeoEmptyOrignList-resultMap" class="rms.presv.format.domain.PresvFormatNeo" >
		<result property="recordCenterId" 				column="record_center_id"/>
		<result property="recordId" 					column="record_id"/>
	</resultMap>
	<select id="findPresvFormatRecordNeoEmptyOrignList" parameterClass="rms.presv.format.domain.PresvFormatNeo" resultMap="findPresvFormatRecordNeoEmptyOrignList-resultMap">
		SELECT record_center_id, record_id
		FROM  TB_RDRECORD Z
		<!--cubrid WHERE (record_center_id, record_id)
		IN (
		    SELECT record_center_id, record_id-->
		WHERE 
		EXISTS (
		    SELECT 1
		    FROM  TB_STFORMAT_QUEUE
		    WHERE job_group_id = #jobGroupId:VARCHAR#
		    AND   doc_det_gubun = '1'
		    <!--cubrid-->
	 	    AND   record_center_id = Z.record_center_id
		    AND   folder_id = Z.folder_id
		)
		AND   (Z.orign_id IS NULL OR Z.orign_id = '')
	</select>	

	<!-- 
		장기보존포맷변환 : 기록물건NEO 변환시 원문ID 미부여 기록물건에 대하여 원문ID 부여
	 -->
	<update id="updatePresvFormatRecordNeoOrignId" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDRECORD
		SET   orign_id = #orignId:VARCHAR#
		WHERE record_center_id = #recordCenterId:VARCHAR#
		AND   record_id = #recordId:VARCHAR#
	</update>
	
	<!-- 
		장기보존포맷변환 : 기록물건NEO 변환시 원문ID 미부여 기록물건에 대하여 건원문 정보 생성
	  -->
	<insert id="insertPresvFormatRecordNeoRecordOrign" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		INSERT INTO TB_STRECORDORIGN (
			record_center_id, orign_id, record_id, erecord_flag, pdf_a1_trans_state
			, neo_trans_state, neo_trans_req_dtime, neo_trans_fin_dtime, del_flag, reg_dtime
		)
		(
			SELECT record_center_id, orign_id, record_id, erecord_flag, pdf_a1_trans_state
				, neo_trans_state, '', '', '0'
				<!--cubrid , TO_CHAR(SYSDATE,'YYYYMMDDhh24MISS')-->
				, TO_CHAR(sys_datetime,'YYYYMMDDhh24MISS')
			FROM  TB_RDRECORD
			WHERE RECORD_CENTER_ID = #recordCenterId:VARCHAR#
			AND   RECORD_ID = #recordId:VARCHAR#
		)
  	</insert>
  	
	<!-- 
		장기보존포맷변환 : 작업그룹ID에 해당하는 기록물건NEO 변환상태 변경 - 1.건원문 (1:변환대기)
	 -->
	<update id="updatePresvFormatRecordNeoWaitRecordOrign" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_STRECORDORIGN Z
		SET   neo_trans_state = '1'
		<!--cubrid WHERE (record_center_id, record_id)
		IN (
            		SELECT record_center_id, record_id-->
		WHERE 
		EXISTS (
            		SELECT 1
            		FROM  TB_STREQTRANS
            		WHERE job_id = #jobGroupId:VARCHAR#
			<!--cubrid-->
			AND record_center_id = Z.record_center_id
			AND record_id = Z.record_id
		)
	</update>
	
	<!-- 
		장기보존포맷변환 : 작업그룹ID에 해당하는 기록물건NEO 1차 변환상태 변경 - 2.기록물건 (1:변환대기)
	 -->
	<update id="updatePresvFormatRecordNeoWaitRecord" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDRECORD A
		SET   A.neo_trans_state = '1'
			, A.neo_job_id = #jobGroupId:VARCHAR#
		<dynamic>
			<isEqual property="transfTrgtFlag" compareValue="1">
			, A.transf_neo_trans_state = '1'
			</isEqual>
		</dynamic>
		<!--cubrid WHERE (A.record_center_id, A.record_id)
		IN (
            		SELECT record_center_id, record_id-->
		WHERE
		EXISTS (
            		SELECT 1
            		FROM  TB_STREQTRANS
            		WHERE job_id = #jobGroupId:VARCHAR#
			<!--cubrid-->
			AND   record_center_id = A.record_center_id
			AND   folder_id = A.folder_id
		)
		AND (A.neo_trans_state IS NULL OR A.neo_trans_state='0')
	</update>
  	
	<!-- 
		장기보존포맷변환 : 작업그룹ID에 해당하는 기록물건NEO 변환상태 변경 - 3.기록물철 (1:변환대기)
	 -->
	<update id="updatePresvFormatRecordNeoWaitFolder" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDFOLDER Z
		SET   record_neo_trans_state = '1'
		<!--cubrid WHERE (record_center_id, folder_id)
		IN (
            		SELECT record_center_id, FOLDER_id-->
		WHERE
		EXISTS (
            		SELECT 1
            		FROM  TB_STREQTRANS
            		WHERE job_id = #jobGroupId:VARCHAR#
			<!--cubrid-->
			AND record_center_id = Z.record_center_id
			AND folder_id = Z.folder_id
		)
	</update>
	
	<!-- 
		장기보존포맷변환 : 작업그룹ID에 해당하는 기록물건NEO 2차 변환상태 변경 - 2.기록물건 (1:변환대기)
	 -->
	<update id="updatePresvFormatRecordNeoWaitRecord2cha" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDRECORD A
		SET   A.neo_trans_state_2 = '1'
			, A.neo_job_id = #jobGroupId:VARCHAR#
		<dynamic>
			<isEqual property="transfTrgtFlag" compareValue="1">
			, A.neo_trans_state_2 = '1'
			</isEqual>
		</dynamic>
		<!--cubrid WHERE (A.record_center_id, A.record_id)
		IN (
            		SELECT record_center_id, record_id-->
		WHERE 
		EXISTS (
            		SELECT 1
            		FROM  TB_STREQTRANS
            		WHERE job_id = #jobGroupId:VARCHAR#
			<!--cubrid-->
			AND record_center_id = A.record_center_id
			AND record_id = A.record_id
		
		)
		AND (A.neo_trans_state_2 IS NULL OR A.neo_trans_state_2='0')
	</update>
	
	<!-- 
		장기보존포맷변환 : 작업그룹ID에 해당하는 기록물건NEO 2ck 변환상태 변경 - 3.기록물철 (1:변환대기)
	 -->
	<update id="updatePresvFormatRecordNeoWaitFolder2cha" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDFOLDER Z
		SET   Z.record_neo_trans_state_2 = '1'
		<!--cubrid WHERE (record_center_id, folder_id)
		IN (
            		SELECT record_center_id, FOLDER_id-->
		WHERE
		EXISTS (
            		SELECT 1
            		FROM  TB_STREQTRANS
            		WHERE job_id = #jobGroupId:VARCHAR#
			<!--cubrid-->
			AND record_center_id = Z.record_center_id
			AND folder_id = Z.folder_id
		)
	</update>
	
	<!-- 
		장기보존포맷변환 요청 - 기록물건변환에 대한 이관기록물철 상태 변경 (1:변환대기)
	 -->
	<update id="updateRecordNeoTransfListWait" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		<!-- 
		UPDATE TB_DFRECVTRANSFLIST
		SET   record_neo_trans_state = '1'
		WHERE (record_center_id, folder_id)
		IN (
            SELECT record_center_id, folder_id
            FROM  TB_STREQTRANS
            WHERE job_id = #jobGroupId:VARCHAR#
		)
		 -->
		 UPDATE TB_DFRECVTRANSFLIST
		   SET RECORD_NEO_TRANS_STATE = '1'
		 WHERE RECORD_CENTER_ID = #recordCenterId:VARCHAR#
		   AND FOLDER_ID = #folderId:VARCHAR#
	</update>
	
	
	
	<!-- 
		장기보존포맷변환(재변환)
		: 기록물철에 대한 포맷변환 취소요청 - XF.1.접수이관목록 기록물철 재변환완료 삭제
	 -->
	<delete id="deletePresvFormatNeoReconvFolderNeoFile" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		DELETE FROM TB_STFOLDERNEOFILE
		WHERE record_center_id = #recordCenterId:VARCHAR#
		AND   folder_id = #folderId:VARCHAR#
		AND   chng_sno = 2
		and 0=1
	</delete>

	<!-- 
		장기보존포맷변환(재변환)
		: 기록물철에 대한 포맷변환 취소요청 - XF.2.접수이관목록 테이블의 기록물철 변환상태 갱신 (0:미변환) 
	 -->
	<update id="updatePresvFormatNeoReconvFolderDeleteToTransf" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_DFRECVTRANSFLIST A
		SET   A.neo_trans_state = '0'
		WHERE A.record_center_id = #recordCenterId:VARCHAR#
		AND   A.folder_id = #folderId:VARCHAR#
		AND   A.neo_trans_state = '4'
	</update>
	<!-- 
		장기보존포맷변환(재변환)
		: 기록물철에 대한 포맷변환 취소요청 - XF.3.기록물철 테이블의 기록물철 변환상태 갱신 (0:미변환) 
	 -->
	<update id="updatePresvFormatNeoReconvFolderDeleteToFolder" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDFOLDER A
		SET   A.neo_trans_state_2 = '0'
		WHERE A.record_center_id = #recordCenterId:VARCHAR#
		AND   A.folder_id = #folderId:VARCHAR#
		AND   A.neo_trans_state_2 = '4'
	</update>
	
	<!-- 
		장기보존포맷변환(재변환)
		: 기록물건에 대한 포맷변환 취소요청 - XR.1.접수이관목록 기록물건 재변환완료 삭제
	 -->
	<delete id="deletePresvFormatNeoReconvRecordNeoFile" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		DELETE FROM TB_STFOLDERNEOFILE
		WHERE record_center_id = #recordCenterId:VARCHAR#
		AND   folder_id = #folderId:VARCHAR#
		AND   chng_sno = 2
		and 0=1
	</delete>
	
	<!-- 
		장기보존포맷변환(재변환)
		: 기록물건에 대한 포맷변환 취소요청 - XR.2.기록물철 테이블의 기록물건 변환상태 갱신 (0:미변환) 
	 -->
	<update id="updatePresvFormatNeoReconvRecordDeleteToRecord" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDRECORD A
		SET   A.neo_trans_state_2 = '0'
		WHERE A.record_center_id = #recordCenterId:VARCHAR#
		AND   A.record_id = #recordId:VARCHAR#
		AND   A.neo_trans_state_2 = '4'
	</update>

	<!-- 
		장기보존포맷변환(재변환)
		: 기록물건에 대한 포맷변환 취소요청 - XR.3.접수이관목록 테이블의 기록물건 변환상태 갱신 (0:미변환) 
	 -->
	<update id="updatePresvFormatNeoReconvRecordDeleteToTransf" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_DFRECVTRANSFLIST A
		SET   A.record_neo_trans_state = ( CASE WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3','5'))) THEN '4'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND (B.neo_trans_state_2 IS NULL OR B.neo_trans_state_2 IN ('0','1','2','3'))) THEN '5'
												WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.neo_trans_state_2 IN ('1','2','3')) THEN '0'
												ELSE '1' END )
		<!--cubrid WHERE (A.record_center_id, A.folder_id)
		IN (
			SELECT B.record_center_id, B.folder_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM  TB_RDRECORD B
			WHERE B.record_center_id = #recordCenterId:VARCHAR#
			AND   B.record_id = #recordId:VARCHAR#
			<!--cubrid-->
			AND   B.record_center_id = A.record_center_id
			AND   B.folder_id = A.folder_id
		)
	</update>

	<!-- 장기보존포맷변환 : 기록물철에 대한 기록물철NEO 변환취소 요청 - 2차변환파일 삭제 -->
	<delete id="deletePresvFormatFolderNeoFolderClearFolderNeoFile2cha" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		DELETE TB_STFOLDERNEOFILE
		 WHERE RECORD_CENTER_ID = #recordCenterId:VARCHAR#
		   AND FOLDER_ID = #folderId:VARCHAR#
		   AND CHNG_SNO = 2
	</delete>
	
	<!-- 장기보존포맷변환 : 기록물철에 대한 기록물철NEO 변환취소 요청 - 1차변환파일로 기록물 철 UPDATE -->
	<update id="updatePresvFormatRecordNeoFolderClearFolderNeoFile2cha" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		UPDATE TB_RDFOLDER A
		   SET A.NEO_JOB_ID_2 = '', 
		       A.FOLDER_NEO_FILE_ID = (SELECT B.FOLDER_NEO_FILE_ID 
		                                 FROM TB_STFOLDERNEOFILE B 
		                                WHERE B.RECORD_CENTER_ID = A.RECORD_CENTER_ID 
		                                  AND B.FOLDER_ID = A.FOLDER_ID 
		                                  AND B.CHNG_SNO = 1) 
		 WHERE A.RECORD_CENTER_ID = #recordCenterId:VARCHAR#
		   AND A.FOLDER_ID = #folderId:VARCHAR#
	</update>
	
	<!-- 장기보존포맷변환 : 기록물철에 대한 기록물건NEO 변환취소 요청 - 2차변환파일 삭제 -->
	<delete id="deletePresvFormatRecordNeoFolderClearRecordNeoFile2cha" parameterClass="rms.presv.format.domain.PresvFormatNeo">
		DELETE TB_STORIGNNEOFILE A
		 WHERE 
		 <!--cubrid
		 (A.RECORD_CENTER_ID, A.ORIGN_ID) IN
		       (SELECT B.RECORD_CENTER_ID, B.ORIGN_ID
		       -->
		       EXISTS (SELECT 1
		          FROM TB_RDRECORD B
		         WHERE B.RECORD_CENTER_ID = #recordCenterId:VARCHAR#
		           AND B.FOLDER_ID = #folderId:VARCHAR#
		           AND A.RECORD_CENTER_ID = B.RECORD_CENTER_ID
		           AND A.ORIGN_ID = B.ORIGN_ID
		       )
		   AND A.CHNG_SNO = 2
	</delete>
	
</sqlMap>
