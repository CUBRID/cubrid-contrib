<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="presv.format">

	<!-- 
		문서보존포맷변환
		: 포맷변환 작업그룹ID 획득
	 -->
	<select id="findPresvFormatPdfJobGroupId" resultClass="string">
		SELECT TO_CHAR(SYSDATE,'YYYY')||LPAD(TB_STFORMAT_GROUP_SQ01.NEXTVAL,13,'0') FROM DUAL
	</select>

	<!-- 
		문서보존포맷변환
		: 저장소정보 획득
	 -->
	<resultMap id="findPresvFormatPdfMediumInfo-resultMap" class="rms.presv.format.domain.PresvFormatPdf">
		<result property="destStorageType"			column="medium_cd" />
		<result property="destStorageVendor"		column="medium_detail_cd" />
	</resultMap>
	<select id="findPresvFormatPdfMediumInfo" parameterClass="string" resultMap="findPresvFormatPdfMediumInfo-resultMap">
		SELECT medium_cd
			, medium_detail_cd
		FROM (
		    SELECT medium_cd, medium_detail_cd
		    FROM  TB_STMEDIUM
		    WHERE record_center_id = #value#
		    AND   volm_id IN (SELECT volm_id FROM TB_STVOLM WHERE del_flag='0' AND volm_div_cd='2')
		    AND   del_flag = '0'
		    AND   (tot_size - use_size) > 0
		    ORDER BY record_center_id, medium_id
		)
		WHERE ROWNUM = 1
	</select>

	<!--
		문서보존포맷변환_생산부서별변환
		: 생산부서별변환 목록 조회
	-->
	<resultMap id="findPresvFormatPdfOrgPagedList-resultMap" class="rms.presv.format.domain.PresvFormatPdfResult">
		<result property="orgCd"			column="org_cd" />
		<result property="orgNm"			column="org_nm" />
		<result property="orgAbbrNm"		column="org_abbr_nm" />
		<result property="folderTotCnt"		column="folder_tot_cnt" />
		<result property="folderDefCnt"		column="folder_def_cnt" />
		<result property="folderIngCnt"		column="folder_ing_cnt" />
		<result property="folderFailCnt"	column="folder_fail_cnt" />
		<result property="folderEndCnt"		column="folder_end_cnt" />
		<result property="recordTotCnt"		column="record_tot_cnt" />
		<result property="recordDefCnt"		column="record_def_cnt" />
		<result property="recordIngCnt"		column="record_ing_cnt" />
		<result property="recordFailCnt"	column="record_fail_cnt" />
		<result property="recordEndCnt"		column="record_end_cnt" />
	</resultMap>
	<select id="countPresvFormatPdfOrgPagedList" parameterClass="rms.presv.format.domain.PresvFormatPdf" resultClass="java.lang.Long">
		SELECT COUNT(1)
		FROM (
			SELECT DISTINCT A.record_center_id, A.org_cd
			FROM TB_RDFOLDER A
			WHERE A.record_center_id = #recordCenterId:VARCHAR#
			<isNotEmpty prepend="AND" property="orgCd">
				A.org_cd = #orgCd:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
				</isNotEmpty>
				<isEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
				</isEmpty>
			</isNotEmpty>
			<isEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
				</isNotEmpty>
			</isEmpty>
			<isNotEmpty property="presvTermCd">
				<isEqual property="presvTermCheck" compareValue="1">
					<isEqual prepend="AND" property="presvTermCd" compareValue="25">
						A.presv_term_cd <![CDATA[>=]]> '20'
					</isEqual>
					<isNotEqual prepend="AND" property="presvTermCd" compareValue="25">
					A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR# 
					</isNotEqual> 					 
				</isEqual>
				<isNotEqual property="presvTermCheck" compareValue="1">
					<isEqual prepend="AND" property="presvTermCd" compareValue="25">
						A.presv_term_cd IN ('20','25') 
					</isEqual>
					<isNotEqual prepend="AND" property="presvTermCd" compareValue="25">
					A.presv_term_cd = #presvTermCd:VARCHAR# 
				</isNotEqual>
				</isNotEqual>
			</isNotEmpty>
			AND   A.folder_keep_state_cd IN ('01','04')
		)
	</select>
	<select id="findPresvFormatPdfOrgPagedList" parameterClass="rms.presv.format.domain.PresvFormatPdf" resultMap="findPresvFormatPdfOrgPagedList-resultMap">
		SELECT E.record_center_id
			, E.org_cd
			, (SELECT Z.org_nm FROM TB_STORG Z WHERE Z.record_center_id=E.record_center_id AND Z.org_cd=E.org_cd) org_nm
			, (SELECT Z.org_abbr_nm FROM TB_STORG Z WHERE Z.record_center_id=E.record_center_id AND Z.org_cd=E.org_cd) org_abbr_nm
		    , SUM(E.folder_tot_cnt) folder_tot_cnt
		    , SUM(E.folder_def_cnt) folder_def_cnt
		    , SUM(E.folder_ing_cnt) folder_ing_cnt
		    , SUM(E.folder_fail_cnt) folder_fail_cnt
		    , SUM(E.folder_end_cnt) folder_end_cnt
		    , SUM(E.record_tot_cnt) record_tot_cnt
		    , SUM(E.record_def_cnt) record_def_cnt
		    , SUM(E.record_ing_cnt) record_ing_cnt
		    , SUM(E.record_fail_cnt) record_fail_cnt
		    , SUM(E.record_end_cnt) record_end_cnt
		FROM (
			SELECT D.record_center_id
				, D.org_cd
				, 1 folder_tot_cnt
				, (CASE WHEN (D.pdf_a1_trans_state IS NULL OR D.pdf_a1_trans_state='0') THEN 1 ELSE 0 END) folder_def_cnt
				, (CASE WHEN D.pdf_a1_trans_state IN ('1','2','3') THEN 1 ELSE 0 END) folder_ing_cnt
				, (CASE WHEN D.pdf_a1_trans_state='5' THEN 1 ELSE 0 END) folder_fail_cnt
				, (CASE WHEN D.pdf_a1_trans_state IN ('4','6') THEN 1 ELSE 0 END) folder_end_cnt
				, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id) record_tot_cnt
				, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id AND (R.pdf_a1_trans_state IS NULL OR R.pdf_a1_trans_state='0')) record_def_cnt
				, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id AND R.pdf_a1_trans_state IN ('1','2','3')) record_ing_cnt
				, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id AND R.pdf_a1_trans_state='5') record_fail_cnt
				, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id AND R.pdf_a1_trans_state IN ('4','6')) record_end_cnt
			FROM TB_RDFOLDER D
			<!--cubrid WHERE (D.record_center_id, D.org_cd)-->
			where
			EXISTS (
				<!--SELECT C.record_center_id, C.org_cd-->
				SELECT 1
				FROM (
					SELECT ROWNUM AS rnum, B.*
					FROM (
						SELECT DISTINCT A.record_center_id, A.org_cd
						FROM TB_RDFOLDER A
						WHERE A.record_center_id = #recordCenterId:VARCHAR#
						<isNotEmpty prepend="AND" property="orgCd">
							A.org_cd = #orgCd:VARCHAR#
						</isNotEmpty>
						<isNotEmpty prepend="AND" property="creatYyyyFrom">
							<isNotEmpty property="creatYyyyTo">
								(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
							</isNotEmpty>
							<isEmpty property="creatYyyyTo">
								A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
							</isEmpty>
						</isNotEmpty>
						<isEmpty prepend="AND" property="creatYyyyFrom">
							<isNotEmpty property="creatYyyyTo">
								A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
							</isNotEmpty>
						</isEmpty>
						<isNotEmpty property="presvTermCd">
							<isEqual property="presvTermCheck" compareValue="1">
								<isEqual prepend="AND" property="presvTermCd" compareValue="25">
									A.presv_term_cd <![CDATA[>=]]> '20'
								</isEqual>
								<isNotEqual prepend="AND" property="presvTermCd" compareValue="25">
								A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR# 
								</isNotEqual> 					 
							</isEqual>
							<isNotEqual property="presvTermCheck" compareValue="1">
								<isEqual prepend="AND" property="presvTermCd" compareValue="25">
									A.presv_term_cd IN ('20','25') 
								</isEqual>
								<isNotEqual prepend="AND" property="presvTermCd" compareValue="25">
								A.presv_term_cd = #presvTermCd:VARCHAR# 
							</isNotEqual>
							</isNotEqual>
						</isNotEmpty>
						AND   A.folder_keep_state_cd IN ('01','04')
		                ORDER BY A.record_center_id, A.org_cd
		            ) B
		            WHERE ROWNUM <![CDATA[<=]]> #pagedEnd:NUMBER#
			    AND B.record_center_id = D.record_center_id
			    AND B.org_cd = D.org_cd
		        ) C
		        WHERE C.rnum <![CDATA[>=]]> #pagedStart:NUMBER#
		    )
			<isNotEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					(D.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
				</isNotEmpty>
				<isEmpty property="creatYyyyTo">
					D.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
				</isEmpty>
			</isNotEmpty>
			<isEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					D.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
				</isNotEmpty>
			</isEmpty>
			<isNotEmpty property="presvTermCd">
				<isEqual property="presvTermCheck" compareValue="1">
					<isEqual prepend="AND" property="presvTermCd" compareValue="25">
						D.presv_term_cd <![CDATA[>=]]> '20'
					</isEqual>
					<isNotEqual prepend="AND" property="presvTermCd" compareValue="25">
					D.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR# 
					</isNotEqual> 					 
				</isEqual>
				<isNotEqual property="presvTermCheck" compareValue="1">
					<isEqual prepend="AND" property="presvTermCd" compareValue="25">
						D.presv_term_cd IN ('20','25') 
					</isEqual>
					<isNotEqual prepend="AND" property="presvTermCd" compareValue="25">
					D.presv_term_cd = #presvTermCd:VARCHAR# 
				</isNotEqual>
				</isNotEqual>
			</isNotEmpty>
		    AND   D.folder_keep_state_cd IN ('01','04')
		) E
		GROUP BY E.record_center_id, E.org_cd
	</select>
	
	<!--
		문서보존포맷변환_생산부서별변환(기록물철)
		: 생산부서별변환(기록물철) 목록 조회
	-->
	<resultMap id="findPresvFormatPdfOrgFolderPagedList-resultMap" class="rms.presv.format.domain.PresvFormatPdfResult">
		<result property="folderId"				column="folder_id" />
		<result property="folderTitle"			column="folder_title" />
		<result property="folderState"			column="folder_state" />
		<result property="folderStateNm"		column="folder_state_nm" />
		<result property="recordTotCnt"			column="record_tot_cnt" />
		<result property="recordDefCnt"			column="record_def_cnt" />
		<result property="recordIngCnt"			column="record_ing_cnt" />
		<result property="recordFailCnt"		column="record_fail_cnt" />
		<result property="recordEndCnt"			column="record_end_cnt" />
	</resultMap>
	<select id="countPresvFormatPdfOrgFolderPagedList" parameterClass="rms.presv.format.domain.PresvFormatPdf" resultClass="java.lang.Long">
		SELECT COUNT(1)
		FROM (
			SELECT A.record_center_id, A.folder_id
			FROM TB_RDFOLDER A
			WHERE A.record_center_id = #recordCenterId:VARCHAR#
			AND   A.org_cd = #orgCd:VARCHAR#
			<isNotEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
				</isNotEmpty>
				<isEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
				</isEmpty>
			</isNotEmpty>
			<isEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
				</isNotEmpty>
			</isEmpty>
			<isNotEmpty property="presvTermCd">
				<isEqual property="presvTermCheck" compareValue="1">
					<isEqual prepend="AND" property="presvTermCd" compareValue="25">
						A.presv_term_cd <![CDATA[>=]]> '20'
					</isEqual>
					<isNotEqual prepend="AND" property="presvTermCd" compareValue="25">
					A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR# 
					</isNotEqual> 					 
				</isEqual>
				<isNotEqual property="presvTermCheck" compareValue="1">
					<isEqual prepend="AND" property="presvTermCd" compareValue="25">
						A.presv_term_cd IN ('20','25') 
					</isEqual>
					<isNotEqual prepend="AND" property="presvTermCd" compareValue="25">
					A.presv_term_cd = #presvTermCd:VARCHAR# 
				</isNotEqual>
				</isNotEqual>
			</isNotEmpty>
			AND   A.folder_keep_state_cd IN ('01','04')
		)
	</select>
	<select id="findPresvFormatPdfOrgFolderPagedList" parameterClass="rms.presv.format.domain.PresvFormatPdf" resultMap="findPresvFormatPdfOrgFolderPagedList-resultMap">
		SELECT D.record_center_id
			, D.folder_id
			, D.title folder_title
			, D.pdf_a1_trans_state folder_state
			, (SELECT Z.com_cd_nm FROM TB_ZZCOMCD Z WHERE Z.com_type_cd='ST02' AND Z.com_cd=D.pdf_a1_trans_state) folder_state_nm
			, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id) record_tot_cnt
			, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id AND R.pdf_a1_trans_state IN ('0')) record_def_cnt
			, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id AND R.pdf_a1_trans_state IN ('1','2','3')) record_ing_cnt
			, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id AND R.pdf_a1_trans_state IN ('5')) record_fail_cnt
			, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id AND R.pdf_a1_trans_state IN ('4','6')) record_end_cnt
		FROM TB_RDFOLDER D
		<!--cubrid WHERE (D.record_center_id, D.folder_id)-->
		WHERE
		EXISTS (
			<!--cubrid SELECT C.record_center_id, C.folder_id-->
			SELECT 1
			FROM (
				SELECT ROWNUM AS rnum, B.*
				FROM (
					SELECT A.record_center_id, A.folder_id
					FROM TB_RDFOLDER A
					WHERE A.record_center_id = #recordCenterId:VARCHAR#
					AND   A.org_cd = #orgCd:VARCHAR#
					<isNotEmpty prepend="AND" property="creatYyyyFrom">
						<isNotEmpty property="creatYyyyTo">
							(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
						</isNotEmpty>
						<isEmpty property="creatYyyyTo">
							A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
						</isEmpty>
					</isNotEmpty>
					<isEmpty prepend="AND" property="creatYyyyFrom">
						<isNotEmpty property="creatYyyyTo">
							A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
						</isNotEmpty>
					</isEmpty>
					<isNotEmpty property="presvTermCd">
						<isEqual property="presvTermCheck" compareValue="1">
							<isEqual prepend="AND" property="presvTermCd" compareValue="25">
								A.presv_term_cd <![CDATA[>=]]> '20'
							</isEqual>
							<isNotEqual prepend="AND" property="presvTermCd" compareValue="25">
							A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR# 
							</isNotEqual> 					 
						</isEqual>
						<isNotEqual property="presvTermCheck" compareValue="1">
							<isEqual prepend="AND" property="presvTermCd" compareValue="25">
								A.presv_term_cd IN ('20','25') 
							</isEqual>
							<isNotEqual prepend="AND" property="presvTermCd" compareValue="25">
							A.presv_term_cd = #presvTermCd:VARCHAR# 
						</isNotEqual>
						</isNotEqual>
					</isNotEmpty>
					AND   A.folder_keep_state_cd IN ('01','04')
	                ORDER BY A.record_center_id, A.title
	            ) B
	            WHERE ROWNUM <![CDATA[<=]]> #pagedEnd:NUMBER#
	        ) C
	        WHERE C.rnum <![CDATA[>=]]> #pagedStart:NUMBER#
		AND C.record_center_id = D.record_center_id
		AND C.folder_id = D.folder_id
	    )
	    ORDER BY D.record_center_id, D.title
	</select>

	<!--
		문서보존포맷변환_생산부서별변환(기록물건)
		: 생산부서별변환(기록물건) 목록 조회
	-->
	<resultMap id="findPresvFormatPdfOrgRecordPagedList-resultMap" class="rms.presv.format.domain.PresvFormatPdfResult">
		<result property="recordId" column="record_id" />
		<result property="recordTitle" column="record_title" />
		<result property="recordState" column="record_state" />
		<result property="recordStateNm" column="record_state_nm" />
		<result property="fileTotCnt" column="file_tot_cnt" />
		<result property="fileDefCnt" column="file_def_cnt" />
		<result property="fileIngCnt" column="file_ing_cnt" />
		<result property="fileFailCnt" column="file_fail_cnt" />
		<result property="fileEndCnt" column="file_end_cnt" />
		<result property="fileNotCnt" column="file_not_cnt" />
	</resultMap>
	<select id="countPresvFormatPdfOrgRecordPagedList" parameterClass="rms.presv.format.domain.PresvFormatPdf" resultClass="java.lang.Long">
		SELECT COUNT(1)
		FROM (
			SELECT A.record_center_id, A.folder_id
			FROM TB_RDRECORD A
			WHERE A.record_center_id = #recordCenterId:VARCHAR#
			AND   A.folder_id = #folderId:VARCHAR#
		)
	</select>
	<select id="findPresvFormatPdfOrgRecordPagedList" parameterClass="rms.presv.format.domain.PresvFormatPdf" resultMap="findPresvFormatPdfOrgRecordPagedList-resultMap">
		SELECT D.record_center_id
			, D.record_id
			, D.title record_title
			, D.pdf_a1_trans_state record_state
			,CASE WHEN  d.pdf_a1_trans_state IN (1,2,3)
	         THEN (SELECT z.com_cd_nm FROM tb_zzcomcd z WHERE z.com_type_cd = 'NE02' AND z.com_cd = ( SELECT REQUEST_STATUS FROM TB_STREQTRANS WHERE RECORD_ID = d.record_id AND  JOB_ID = (SELECT MAX(JOB_ID) FROM TB_STREQTRANS WHERE RECORD_ID = d.record_id AND NEO_GUBUN = '0')))
	         ELSE (SELECT Z.com_cd_nm FROM TB_ZZCOMCD Z WHERE Z.com_type_cd='ST02' AND Z.com_cd=D.pdf_a1_trans_state)
	         END    record_state_nm
			, (SELECT COUNT(1) FROM TB_STORIGNFILE F WHERE F.record_center_id=D.record_center_id AND F.orign_id=D.orign_id AND F.doc_type_cd NOT IN ('10','S1')) file_tot_cnt
			, (SELECT COUNT(1) FROM TB_STORIGNFILE F WHERE F.record_center_id=D.record_center_id AND F.orign_id=D.orign_id AND F.doc_type_cd NOT IN ('10','S1') AND F.pdf_a1_trans_state IN ('0')) file_def_cnt
			, (SELECT COUNT(1) FROM TB_STORIGNFILE F WHERE F.record_center_id=D.record_center_id AND F.orign_id=D.orign_id AND F.doc_type_cd NOT IN ('10','S1') AND F.pdf_a1_trans_state IN ('1','2','3')) file_ing_cnt
			, (SELECT COUNT(1) FROM TB_STORIGNFILE F WHERE F.record_center_id=D.record_center_id AND F.orign_id=D.orign_id AND F.doc_type_cd NOT IN ('10','S1') AND F.pdf_a1_trans_state IN ('5')) file_fail_cnt
			, (SELECT COUNT(1) FROM TB_STORIGNFILE F WHERE F.record_center_id=D.record_center_id AND F.orign_id=D.orign_id AND F.doc_type_cd NOT IN ('10','S1') AND F.pdf_a1_trans_state IN ('4')) file_end_cnt
			, (SELECT COUNT(1) FROM TB_STORIGNFILE F WHERE F.record_center_id=D.record_center_id AND F.orign_id=D.orign_id AND F.doc_type_cd NOT IN ('10','S1') AND F.pdf_a1_trans_state IN ('6')) file_not_cnt
		FROM TB_RDRECORD D
		<!--cubrid WHERE (D.record_center_id, D.record_id)
		IN (
			SELECT C.record_center_id, C.record_id-->
		WHERE 
		EXISTS (
			SELECT 1
			FROM (
				SELECT ROWNUM AS rnum, B.*
				FROM (
					SELECT A.record_center_id, A.record_id
					FROM TB_RDRECORD A
					WHERE A.record_center_id = #recordCenterId:VARCHAR#
					AND   A.folder_id = #folderId:VARCHAR#
	                ORDER BY A.record_center_id, A.creat_reg_dtime, A.creat_reg_no
	            ) B
	            WHERE ROWNUM <![CDATA[<=]]> #pagedEnd:NUMBER#

	        ) C
	        WHERE C.rnum <![CDATA[>=]]> #pagedStart:NUMBER#
	        		<!--cubrid-->
		    AND C.record_center_id = D.record_center_id
		    AND C.record_id = D.record_id
	    )
	    ORDER BY D.record_center_id, D.creat_reg_dtime, D.creat_reg_no
	</select>
	
	<!--
		문서보존포맷변환 기록물철별변환 : 기록물철 목록 조회 
	 -->
	<resultMap id="findPresvFormatPdfFolderPagedList-resultMap" class="rms.presv.format.domain.PresvFormatPdfResult">
		<result property="folderId"			column="folder_id" />
		<result property="folderTitle"		column="folder_title" />
		<result property="folderState"		column="folder_state" />
		<result property="folderStateNm"	column="folder_state_nm" />
		<result property="recordTotCnt"		column="record_tot_cnt" />
		<result property="recordDefCnt"		column="record_def_cnt" />
		<result property="recordIngCnt"		column="record_ing_cnt" />
		<result property="recordFailCnt"	column="record_fail_cnt" />
		<result property="recordEndCnt"		column="record_end_cnt" />
	</resultMap>
	<select id="countPresvFormatPdfFolderPagedList" parameterClass="rms.presv.format.domain.PresvFormatPdf" resultClass="java.lang.Long">
		SELECT COUNT(1)
		FROM (
			SELECT A.record_center_id, A.folder_id
			FROM TB_RDFOLDER A
			WHERE A.record_center_id = #recordCenterId:VARCHAR#
			<isNotEmpty prepend="AND" property="creatSysCd">
				A.creat_sys_cd = #creatSysCd:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="orgCd">
				A.org_cd = #orgCd:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="clssId">
			    A.clss_id = #clssId:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
				</isNotEmpty>
				<isEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
				</isEmpty>
			</isNotEmpty>
			<isEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
				</isNotEmpty>
			</isEmpty>
			<isNotEmpty property="presvTermCd">
				<isEqual property="presvTermCheck" compareValue="1">
					<isEqual prepend="AND" property="presvTermCd" compareValue="25">
						A.presv_term_cd <![CDATA[>=]]> '20'
					</isEqual>
					<isNotEqual prepend="AND" property="presvTermCd" compareValue="25">
					A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR# 
					</isNotEqual> 					 
				</isEqual>
				<isNotEqual property="presvTermCheck" compareValue="1">
					<isEqual prepend="AND" property="presvTermCd" compareValue="25">
						A.presv_term_cd IN ('20','25') 
					</isEqual>
					<isNotEqual prepend="AND" property="presvTermCd" compareValue="25">
					A.presv_term_cd = #presvTermCd:VARCHAR# 
				</isNotEqual>
				</isNotEqual>
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="folderTypeDivCd">
				A.folder_type_div_cd = #folderTypeDivCd:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="pdfA1TransState">
				A.pdf_A1_trans_state = #pdfA1TransState:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="folderTitle">
				A.title LIKE #folderTitle:VARCHAR#
			</isNotEmpty>
			AND   A.folder_keep_state_cd IN ('01','04')
		)
	</select>
	<select id="findPresvFormatPdfFolderPagedList" parameterClass="rms.presv.format.domain.PresvFormatPdf" resultMap="findPresvFormatPdfFolderPagedList-resultMap">
		SELECT D.record_center_id
			, D.folder_id
			, D.title folder_title
			, D.pdf_a1_trans_state folder_state
			, (SELECT Z.com_cd_nm FROM TB_ZZCOMCD Z WHERE Z.com_type_cd='ST02' AND Z.com_cd=D.pdf_a1_trans_state) folder_state_nm
			, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id) record_tot_cnt
			, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id AND R.pdf_a1_trans_state IN ('0')) record_def_cnt
			, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id AND R.pdf_a1_trans_state IN ('1','2','3')) record_ing_cnt
			, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id AND R.pdf_a1_trans_state IN ('5')) record_fail_cnt
			, (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=D.record_center_id AND R.folder_id=D.folder_id AND R.pdf_a1_trans_state IN ('4','6')) record_end_cnt
		FROM TB_RDFOLDER D
		<!--cubrid WHERE (D.record_center_id, D.folder_id)-->
		WHERE
		EXISTS (
			<!--cubrid SELECT C.record_center_id, C.folder_id-->
			SELECT 1
			FROM (
				SELECT ROWNUM AS rnum, B.*
				FROM (
					SELECT A.record_center_id, A.folder_id
					FROM TB_RDFOLDER A
					WHERE A.record_center_id = #recordCenterId:VARCHAR#
					<isNotEmpty prepend="AND" property="creatSysCd">
						A.creat_sys_cd = #creatSysCd:VARCHAR#
					</isNotEmpty>
					<isNotEmpty prepend="AND" property="orgCd">
						A.org_cd = #orgCd:VARCHAR#
					</isNotEmpty>
					<isNotEmpty prepend="AND" property="clssId">
					    A.clss_id = #clssId:VARCHAR#
					</isNotEmpty>
					<isNotEmpty prepend="AND" property="creatYyyyFrom">
						<isNotEmpty property="creatYyyyTo">
							(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
						</isNotEmpty>
						<isEmpty property="creatYyyyTo">
							A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
						</isEmpty>
					</isNotEmpty>
					<isEmpty prepend="AND" property="creatYyyyFrom">
						<isNotEmpty property="creatYyyyTo">
							A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
						</isNotEmpty>
					</isEmpty>
					<isNotEmpty property="presvTermCd">
						<isEqual property="presvTermCheck" compareValue="1">
							<isEqual prepend="AND" property="presvTermCd" compareValue="25">
								A.presv_term_cd <![CDATA[>=]]> '20'
							</isEqual>
							<isNotEqual prepend="AND" property="presvTermCd" compareValue="25">
							A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR# 
							</isNotEqual> 					 
						</isEqual>
						<isNotEqual property="presvTermCheck" compareValue="1">
							<isEqual prepend="AND" property="presvTermCd" compareValue="25">
								A.presv_term_cd IN ('20','25') 
							</isEqual>
							<isNotEqual prepend="AND" property="presvTermCd" compareValue="25">
							A.presv_term_cd = #presvTermCd:VARCHAR# 
						</isNotEqual>
						</isNotEqual>
					</isNotEmpty>
					<isNotEmpty prepend="AND" property="folderTypeDivCd">
						A.folder_type_div_cd = #folderTypeDivCd:VARCHAR#
					</isNotEmpty>
					<isNotEmpty prepend="AND" property="pdfA1TransState">
						A.pdf_A1_trans_state = #pdfA1TransState:VARCHAR#
					</isNotEmpty>
					<isNotEmpty prepend="AND" property="folderTitle">
						A.title LIKE #folderTitle:VARCHAR#
					</isNotEmpty>
					AND   A.folder_keep_state_cd IN ('01','04')
	                ORDER BY A.record_center_id, A.title, A.folder_id
	            ) B
	            WHERE ROWNUM <![CDATA[<=]]> #pagedEnd:NUMBER#
	        ) C
	        WHERE C.rnum <![CDATA[>=]]> #pagedStart:NUMBER#
		AND C.record_center_id = D.record_center_id
		AND C.folder_id = D.folder_id
	    )
	    ORDER BY D.record_center_id, D.title
	</select>
	<!--
		문서보존포맷변환 기록물철별변환(기록물건) : 기록물건 목록 조회 
	 -->
	<resultMap id="findPresvFormatPdfFolderRecordPagedList-resultMap" class="rms.presv.format.domain.PresvFormatPdfResult">
		<result property="recordId"			column="record_id" />
		<result property="recordTitle"		column="record_title" />
		<result property="recordState"		column="record_state" />
		<result property="recordStateNm"	column="record_state_nm" />
		<result property="fileTotCnt"		column="file_tot_cnt" />
		<result property="fileDefCnt"		column="file_def_cnt" />
		<result property="fileIngCnt"		column="file_ing_cnt" />
		<result property="fileFailCnt"		column="file_fail_cnt" />
		<result property="fileEndCnt"		column="file_end_cnt" />
		<result property="fileNotCnt"		column="file_not_cnt" />
	</resultMap>
	<select id="countPresvFormatPdfFolderRecordPagedList" parameterClass="rms.presv.format.domain.PresvFormatPdf" resultClass="java.lang.Long">
		SELECT COUNT(1)
		FROM (
			SELECT A.record_center_id, A.folder_id
			FROM TB_RDRECORD A
			WHERE A.record_center_id = #recordCenterId:VARCHAR#
			AND   A.folder_id = #folderId:VARCHAR#
		)
	</select>
	<select id="findPresvFormatPdfFolderRecordPagedList" parameterClass="rms.presv.format.domain.PresvFormatPdf" resultMap="findPresvFormatPdfFolderRecordPagedList-resultMap">
	 	SELECT D.record_center_id
			, D.record_id
			, D.title record_title
			, D.pdf_a1_trans_state record_state
	        , (CASE WHEN D.pdf_a1_trans_state IN (1,2,3) THEN (SELECT Z.com_cd_nm FROM TB_ZZCOMCD Z WHERE Z.com_type_cd='NE02' AND Z.com_cd=(SELECT Y.request_status FROM TB_STREQTRANS Y WHERE Y.record_id=D.record_id AND Y.job_id=(SELECT MAX(X.job_id) FROM TB_STREQTRANS X WHERE X.record_id=D.record_id AND X.neo_gubun='0')))
					ELSE (SELECT Z.com_cd_nm FROM TB_ZZCOMCD Z WHERE Z.com_type_cd='ST02' AND Z.com_cd=D.pdf_a1_trans_state)
				END) AS record_state_nm
			, decode(d.erecord_flag,'1',(SELECT COUNT(1) FROM TB_STORIGNFILE F WHERE F.record_center_id=D.record_center_id AND F.orign_id=D.orign_id AND F.doc_type_cd NOT IN ('10','S1')), 0) file_tot_cnt
			, decode(d.erecord_flag,'1',(SELECT COUNT(1) FROM TB_STORIGNFILE F WHERE F.record_center_id=D.record_center_id AND F.orign_id=D.orign_id AND F.doc_type_cd NOT IN ('10','S1') AND F.pdf_a1_trans_state IN ('0')), 0) file_def_cnt
			, decode(d.erecord_flag,'1',(SELECT COUNT(1) FROM TB_STORIGNFILE F WHERE F.record_center_id=D.record_center_id AND F.orign_id=D.orign_id AND F.doc_type_cd NOT IN ('10','S1') AND F.pdf_a1_trans_state IN ('1','2','3')), 0) file_ing_cnt
			, decode(d.erecord_flag,'1',(SELECT COUNT(1) FROM TB_STORIGNFILE F WHERE F.record_center_id=D.record_center_id AND F.orign_id=D.orign_id AND F.doc_type_cd NOT IN ('10','S1') AND F.pdf_a1_trans_state IN ('5')), 0) file_fail_cnt
			, decode(d.erecord_flag,'1',(SELECT COUNT(1) FROM TB_STORIGNFILE F WHERE F.record_center_id=D.record_center_id AND F.orign_id=D.orign_id AND F.doc_type_cd NOT IN ('10','S1') AND F.pdf_a1_trans_state IN ('4')), 0) file_end_cnt
			, decode(d.erecord_flag,'1',(SELECT COUNT(1) FROM TB_STORIGNFILE F WHERE F.record_center_id=D.record_center_id AND F.orign_id=D.orign_id AND F.doc_type_cd NOT IN ('10','S1') AND F.pdf_a1_trans_state IN ('6')), 0) file_not_cnt
		FROM TB_RDRECORD D
			, ( SELECT C.record_center_id, C.record_id
				FROM (
					SELECT ROWNUM AS rnum, B.*
					FROM (
						SELECT A.record_center_id, A.record_id
						FROM TB_RDRECORD A
						WHERE A.record_center_id = #recordCenterId:VARCHAR#
						AND   A.folder_id = #folderId:VARCHAR#
		                ORDER BY A.record_center_id, A.creat_reg_dtime, A.creat_reg_no
		            ) B
		            WHERE ROWNUM <![CDATA[<=]]> #pagedEnd:NUMBER#
		        ) C
		        WHERE C.rnum <![CDATA[>=]]> #pagedStart:NUMBER#
		    ) E
		WHERE D.record_center_id = E.record_center_id
		AND   D.record_id = E.record_id
	    ORDER BY D.record_center_id, D.creat_reg_dtime, D.creat_reg_no
	</select>

	<!--
		문서보존포맷변환_포맷변환현황
		 : 생산년도별 보존기간별 현황 조회 
	 -->
	<resultMap id="findPresvFormatPdfCurStateList-resultMap" class="rms.presv.format.domain.PresvFormatPdfResult">
		<result property="creatYyyy" column="creat_yyyy"></result>
		<result property="presvTermCd" column="presv_term_cd"></result>
		<result property="presvTermNm" column="presv_term_nm"></result>
		<result property="folderTotCnt" column="folder_tot_cnt"></result>
		<result property="folderDefCnt" column="folder_def_cnt"></result>
		<result property="folderIngCnt" column="folder_ing_cnt"></result>
		<result property="folderFailCnt" column="folder_fail_cnt"></result>
		<result property="folderEndCnt" column="folder_end_cnt"></result>
		<result property="recordTotCnt" column="record_tot_cnt"></result>
		<result property="recordDefCnt" column="record_def_cnt"></result>
		<result property="recordIngCnt" column="record_ing_cnt"></result>
		<result property="recordFailCnt" column="record_fail_cnt"></result>
		<result property="recordEndCnt" column="record_end_cnt"></result>
	</resultMap>
	<select id="findPresvFormatPdfCurStateList" parameterClass="rms.presv.format.domain.PresvFormatPdf" resultMap="findPresvFormatPdfCurStateList-resultMap">
		SELECT D.creat_yyyy
			, D.presv_term_cd
		    , (SELECT Z.com_cd_nm FROM TB_ZZCOMCD Z WHERE Z.com_type_cd='RD07' AND Z.com_cd=D.presv_term_cd) presv_term_nm 
		    , NVL(C.folder_tot_cnt,0) AS folder_tot_cnt
		    , NVL(C.folder_def_cnt,0) AS folder_def_cnt
		    , NVL(C.folder_ing_cnt,0) AS folder_ing_cnt
		    , NVL(C.folder_fail_cnt,0) AS folder_fail_cnt
		    , NVL(C.folder_end_cnt,0) AS folder_end_cnt
		    , NVL(C.record_tot_cnt,0) AS record_tot_cnt
		    , NVL(C.record_def_cnt,0) AS record_def_cnt
		    , NVL(C.record_ing_cnt,0) AS record_ing_cnt
		    , NVL(C.record_fail_cnt,0) AS record_fail_cnt
		    , NVL(C.record_end_cnt,0) AS record_end_cnt
		FROM 
		(   SELECT B.record_center_id, B.creat_yyyy, B.presv_term_cd
		        , SUM(folder_tot_cnt) folder_tot_cnt
		        , SUM(folder_def_cnt) folder_def_cnt
		        , SUM(folder_ing_cnt) folder_ing_cnt
		        , SUM(folder_fail_cnt) folder_fail_cnt
		        , SUM(folder_end_cnt) folder_end_cnt
		        , SUM(record_tot_cnt) record_tot_cnt
		        , SUM(record_def_cnt) record_def_cnt
		        , SUM(record_ing_cnt) record_ing_cnt
		        , SUM(record_fail_cnt) record_fail_cnt
		        , SUM(record_end_cnt) record_end_cnt
		    FROM 
		    (   SELECT A.record_center_id, A.folder_id, A.creat_yyyy, DECODE(A.presv_term_cd, '20', '25', A.presv_term_cd) presv_term_cd, A.pdf_a1_trans_state
		            , 1 folder_tot_cnt
		            , (CASE WHEN A.pdf_a1_trans_state IN ('0') THEN 1 ELSE 0 END) folder_def_cnt
		            , (CASE WHEN A.pdf_a1_trans_state IN ('1','2','3') THEN 1 ELSE 0 END) folder_ing_cnt
		            , (CASE WHEN A.pdf_a1_trans_state IN ('5') THEN 1 ELSE 0 END) folder_fail_cnt
		            , (CASE WHEN A.pdf_a1_trans_state IN ('4','6') THEN 1 ELSE 0 END) folder_end_cnt
		            , (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=A.record_center_id AND R.folder_id=A.folder_id) record_tot_cnt
		            , (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=A.record_center_id AND R.folder_id=A.folder_id AND R.pdf_a1_trans_state IN ('0')) record_def_cnt
		            , (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=A.record_center_id AND R.folder_id=A.folder_id AND R.pdf_a1_trans_state IN ('1','2','3')) record_ing_cnt
		            , (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=A.record_center_id AND R.folder_id=A.folder_id AND R.pdf_a1_trans_state IN ('5')) record_fail_cnt
		            , (SELECT COUNT(1) FROM TB_RDRECORD R WHERE R.record_center_id=A.record_center_id AND R.folder_id=A.folder_id AND R.pdf_a1_trans_state IN ('4','6')) record_end_cnt
		        FROM  TB_RDFOLDER A
		        WHERE A.record_center_id = #recordCenterId:VARCHAR#
				<isNotEmpty prepend="AND" property="creatYyyyFrom">
					<isNotEmpty property="creatYyyyTo">
						(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
					</isNotEmpty>
					<isEmpty property="creatYyyyTo">
						A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
					</isEmpty>
				</isNotEmpty>
				<isEmpty prepend="AND" property="creatYyyyFrom">
					<isNotEmpty property="creatYyyyTo">
						A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
					</isNotEmpty>
				</isEmpty>
				<isNotEmpty prepend="AND" property="creatDtimeFrom">
					<isNotEmpty property="creatDtimeTo">
						TO_DATE(SUBSTR(A.creat_dtime,1,8),'YYYYMMDD') BETWEEN  TO_DATE(#creatDtimeFrom:VARCHAR#,'YYYYMMDD')  AND  TO_DATE(#creatDtimeTo:VARCHAR#,'YYYYMMDD') 
					</isNotEmpty>
					<isEmpty property="creatDtimeTo">
						TO_DATE(SUBSTR(A.creat_dtime,1,8),'YYYYMMDD')  <![CDATA[>=]]> TO_DATE(#creatDtimeFrom:VARCHAR#,'YYYYMMDD')
					</isEmpty>
				</isNotEmpty>
				<isEmpty prepend="AND" property="creatDtimeFrom">
					<isNotEmpty property="creatDtimeTo">
						TO_DATE(SUBSTR(A.creat_dtime,1,8),'YYYYMMDD')  <![CDATA[<=]]> TO_DATE(#creatDtimeTo:VARCHAR#,'YYYYMMDD') 
					</isNotEmpty>
				</isEmpty>
				<isNotEmpty property="presvTermCd">
					<isEqual property="presvTermCheck" compareValue="1">
						<isEqual prepend="AND" property="presvTermCd" compareValue="25">
							A.presv_term_cd <![CDATA[>=]]> '20'
						</isEqual>
						<isNotEqual prepend="AND" property="presvTermCd" compareValue="25">
						A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR# 
						</isNotEqual> 					 
					</isEqual>
					<isNotEqual property="presvTermCheck" compareValue="1">
						<isEqual prepend="AND" property="presvTermCd" compareValue="25">
							A.presv_term_cd IN ('20','25') 
						</isEqual>
						<isNotEqual prepend="AND" property="presvTermCd" compareValue="25">
						A.presv_term_cd = #presvTermCd:VARCHAR# 
					</isNotEqual>
					</isNotEqual>
				</isNotEmpty>
				AND   A.folder_keep_state_cd IN ('01','04')
		    ) B
		    GROUP BY B.record_center_id, B.creat_yyyy, B.presv_term_cd
		    ORDER BY B.record_center_id, B.creat_yyyy, B.presv_term_cd
		) C, (
		    SELECT Y.yyyy AS creat_yyyy, Z.com_cd AS presv_term_cd
		    FROM (SELECT com_cd FROM TB_ZZCOMCD WHERE com_type_cd='RD07') Z,
			<isNotEmpty property="creatYyyyFrom">
		     (SELECT yyyy FROM (SELECT LEVEL AS yyyy FROM DUAL CONNECT BY LEVEL <![CDATA[<=]]> #creatYyyyTo:VARCHAR#) WHERE yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#) Y
            </isNotEmpty>
			<isEmpty property="creatYyyyFrom">
		     (SELECT yyyy FROM (SELECT LEVEL AS yyyy FROM DUAL CONNECT BY LEVEL <![CDATA[<=]]> SUBSTR(#creatDtimeTo:VARCHAR#,1,4)) WHERE yyyy <![CDATA[>=]]> SUBSTR(#creatDtimeFrom:VARCHAR#,1,4)) Y
            </isEmpty>
		) D
		WHERE D.creat_yyyy = C.creat_yyyy(+)
		AND   D.presv_term_cd = C.presv_term_cd(+)
		ORDER BY D.creat_yyyy DESC, D.presv_term_cd DESC
	</select>

	<!-- 
		문서보존포맷변환 : 변환실패 목록 조회
	 -->
	<resultMap id="findPresvFormatPdfFailedMsgPagedList-resultMap" class="rms.presv.format.domain.PresvFormatPdfFailedMsg">
		<result property="rnum"				column="rnum" />
		<result property="recordCenterId"	column="record_center_id" />
		<result property="workHistId"		column="work_hist_id" />
		<result property="folderId"			column="folder_id" />
		<result property="folderTitle"		column="folder_title" />
		<result property="recordId"			column="record_id" />
		<result property="recordTitle"		column="record_title" />
		<result property="orignFileId"		column="orign_file_id" />
		<result property="orignFileNm"		column="orign_file_nm" />
		<result property="workStartDtime"	column="work_start_dtime" />
		<result property="workCloseDtime"	column="work_close_dtime" />
		<result property="errorCd"			column="error_cd" />
		<result property="errorCont"		column="error_cont" />
		<result property="followupDivCd"	column="followup_div_cd" />
		<result property="followupDivNm"	column="followup_div_nm" />
		<result property="followupCause"	column="followup_cause" />
	</resultMap>
	<select id="countPresvFormatPdfFailedMsgPagedList" parameterClass="rms.presv.format.domain.PresvFormatPdf" resultClass="java.lang.Long">
		SELECT COUNT(1)
		FROM  TB_STWORKHIST B
		<!--cubrid WHERE (B.record_center_id, B.folder_id)-->
		WHERE
           EXISTS (
               <!--cubrid SELECT A.record_center_id, A.folder_id-->
               SELECT 1
               FROM TB_RDFOLDER A
               WHERE A.record_center_id = #recordCenterId:VARCHAR#
			<isNotEmpty prepend="AND" property="folderId">
				A.folder_id = #folderId:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="orgCd">
				A.org_cd = #orgCd:VARCHAR#
			</isNotEmpty>
			<isNotEmpty property="creatYyyyFrom">
				<isNotEmpty prepend="AND" property="creatYyyyTo">
					A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#
				</isNotEmpty>
				<isEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
				</isEmpty>
			</isNotEmpty>
			<isEmpty property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
				</isNotEmpty>
			</isEmpty>
			<isNotEmpty property="presvTermCd">
				<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR# 
				</isEqual>
				<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd = #presvTermCd:VARCHAR# 
				</isNotEqual>
			</isNotEmpty>
			AND   A.folder_keep_state_cd IN ('01','04')
			AND   A.record_center_id = B.record_center_id
			AND   A.folder_id = B.folder_id
           )
		<isNotEmpty prepend="AND" property="recordId">
			B.record_id = #recordId:VARCHAR#
		</isNotEmpty>
		AND (B.format_div_cd = '0' OR B.format_div_cd IS NULL) 
		AND (B.followup_fin_flag IS NULL OR B.followup_fin_flag='0')
	</select>
	<select id="findPresvFormatPdfFailedMsgPagedList" parameterClass="rms.presv.format.domain.PresvFormatPdf" resultMap="findPresvFormatPdfFailedMsgPagedList-resultMap">
		SELECT E.rnum
			, E.record_center_id
			, E.work_hist_id
			, E.folder_id
			, (SELECT Z.title FROM TB_RDFOLDER Z WHERE Z.record_center_id=E.record_center_id AND Z.folder_id=E.folder_id) AS folder_title
			, E.record_id
			, (SELECT Z.title FROM TB_RDRECORD Z WHERE Z.record_center_id=E.record_center_id AND Z.record_id=E.record_id) AS record_title
			, E.orign_file_id
			, (SELECT Z.file_nm FROM TB_STORIGNFILE Z WHERE Z.orign_file_id=E.orign_file_id) AS orign_file_nm
			, E.work_start_dtime
			, E.work_close_dtime
			, E.error_cd
			, E.error_cont
			, E.followup_div_cd
			, (CASE WHEN E.followup_div_cd='1' THEN '재변환' WHEN E.followup_div_cd='2' THEN '변환불가' ELSE '미조치' END) AS followup_div_nm
			, E.followup_cause
		FROM (
			SELECT D.*
			FROM (
				SELECT ROWNUM AS rnum, C.*
				FROM (
					SELECT B.record_center_id, B.work_hist_id, B.folder_id, B.record_id, B.orign_file_id
						, B.work_start_dtime, B.work_close_dtime, B.error_cd, B.error_cont
						, B.followup_div_cd, B.followup_cause
					FROM  TB_STWORKHIST B
					<!--cubrid WHERE (B.record_center_id, B.folder_id)
					IN (
		                SELECT A.record_center_id, A.folder_id-->
					WHERE
					EXISTS (
		                SELECT 1
		                FROM TB_RDFOLDER A
		                WHERE A.record_center_id = #recordCenterId:VARCHAR#
		                <!--cubrid-->
					          AND A.record_center_id = B.record_center_id
					          AND A.folder_id = B.folder_id
						<isNotEmpty prepend="AND" property="folderId">
							A.folder_id = #folderId:VARCHAR#
						</isNotEmpty>
						<isNotEmpty prepend="AND" property="orgCd">
							A.org_cd = #orgCd:VARCHAR#
						</isNotEmpty>
						<isNotEmpty property="creatYyyyFrom">
							<isNotEmpty prepend="AND" property="creatYyyyTo">
								A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#
							</isNotEmpty>
							<isEmpty property="creatYyyyTo">
								A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
							</isEmpty>
						</isNotEmpty>
						<isEmpty property="creatYyyyFrom">
							<isNotEmpty property="creatYyyyTo">
								A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
							</isNotEmpty>
						</isEmpty>
						<isNotEmpty property="presvTermCd">
							<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
								A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR# 
							</isEqual>
							<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
								A.presv_term_cd = #presvTermCd:VARCHAR# 
							</isNotEqual>
						</isNotEmpty>
						AND   A.folder_keep_state_cd IN ('01','04')
					)
					<isNotEmpty prepend="AND" property="recordId">
						B.record_id = #recordId:VARCHAR#
					</isNotEmpty>
					AND (B.format_div_cd = '0' OR B.format_div_cd IS NULL) 
					AND (B.followup_fin_flag IS NULL OR B.followup_fin_flag='0')
					
					ORDER BY record_center_id, work_hist_id DESC
				) C
				WHERE ROWNUM <![CDATA[<=]]> #pagedEnd:NUMBER#
			) D
			WHERE D.rnum <![CDATA[>=]]> #pagedStart:NUMBER#
		) E
	</select>
	<!-- 
		문서보존포맷변환 : 변환실패 기록물철 수량
	 -->
	<select id="countPresvFormatPdfFailedMsgFolder" parameterClass="rms.presv.format.domain.PresvFormatPdf" resultClass="java.lang.Long">
		SELECT COUNT(1)
		FROM (
			SELECT B.record_center_id, B.folder_id
			FROM  TB_STWORKHIST B
			<!--cubrid WHERE (B.record_center_id, B.folder_id)-->
			WHERE 
	           EXISTS (
	               <!--cubrid SELECT A.record_center_id, A.folder_id-->
	               SELECT 1
	               FROM TB_RDFOLDER A
	               WHERE A.record_center_id = #recordCenterId:VARCHAR#
				<isNotEmpty prepend="AND" property="folderId">
					A.folder_id = #folderId:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="orgCd">
					A.org_cd = #orgCd:VARCHAR#
				</isNotEmpty>
				<isNotEmpty property="creatYyyyFrom">
					<isNotEmpty prepend="AND" property="creatYyyyTo">
						A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#
					</isNotEmpty>
					<isEmpty property="creatYyyyTo">
						A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
					</isEmpty>
				</isNotEmpty>
				<isEmpty property="creatYyyyFrom">
					<isNotEmpty property="creatYyyyTo">
						A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
					</isNotEmpty>
				</isEmpty>
				<isNotEmpty property="presvTermCd">
					<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
						A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR# 
					</isEqual>
					<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
						A.presv_term_cd = #presvTermCd:VARCHAR# 
					</isNotEqual>
				</isNotEmpty>
				AND   A.folder_keep_state_cd IN ('01','04')
				AND   A.record_center_id = B.record_center_id
				AND   A.folder_id = B.folder_id
	           )
			<isNotEmpty prepend="AND" property="recordId">
				B.record_id = #recordId:VARCHAR#
			</isNotEmpty>
			AND (B.format_div_cd = '0' OR B.format_div_cd IS NULL) 
			AND (B.followup_fin_flag IS NULL OR B.followup_fin_flag='0')
			GROUP BY B.record_center_id, B.folder_id
		) C
	</select>
	<!-- 
		문서보존포맷변환 : 변환실패 기록물건 수량
	 -->
	<select id="countPresvFormatPdfFailedMsgRecord" parameterClass="rms.presv.format.domain.PresvFormatPdf" resultClass="java.lang.Long">
		SELECT COUNT(1)
		FROM (
			SELECT B.record_center_id, B.record_id
			FROM  TB_STWORKHIST B
			<!--cubrid WHERE (B.record_center_id, B.folder_id)-->
			WHERE
	           EXISTS (
	               <!--cubrid SELECT A.record_center_id, A.folder_id-->
	               SELECT 1
	               FROM TB_RDFOLDER A
	               WHERE A.record_center_id = #recordCenterId:VARCHAR#
				<isNotEmpty prepend="AND" property="folderId">
					A.folder_id = #folderId:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="orgCd">
					A.org_cd = #orgCd:VARCHAR#
				</isNotEmpty>
				<isNotEmpty property="creatYyyyFrom">
					<isNotEmpty prepend="AND" property="creatYyyyTo">
						A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#
					</isNotEmpty>
					<isEmpty property="creatYyyyTo">
						A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
					</isEmpty>
				</isNotEmpty>
				<isEmpty property="creatYyyyFrom">
					<isNotEmpty property="creatYyyyTo">
						A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
					</isNotEmpty>
				</isEmpty>
				<isNotEmpty property="presvTermCd">
					<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
						A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR# 
					</isEqual>
					<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
						A.presv_term_cd = #presvTermCd:VARCHAR# 
					</isNotEqual>
				</isNotEmpty>
				AND   A.folder_keep_state_cd IN ('01','04')
				AND   A.record_center_id = B.record_center_id
				AND   A.folder_id = B.folder_id
	           )
			<isNotEmpty prepend="AND" property="recordId">
				B.record_id = #recordId:VARCHAR#
			</isNotEmpty>
			AND (B.format_div_cd = '0' OR B.format_div_cd IS NULL) 
			AND (B.followup_fin_flag IS NULL OR B.followup_fin_flag='0')
			GROUP BY B.record_center_id, B.record_id
		) C
	</select>

	<!-- 
		문서보존포맷변환의 생산부서별변환
		: 생산부서에 대한 포맷변환 요청 - A.포맷변환요청정보생성(-:신청) 
	 -->
	<insert id="createPresvFormatPdfOrgReqTrans" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		INSERT INTO TB_STREQTRANS (
			record_center_id, job_id, neo_gubun, folder_id, record_id, dest_storage_type, dest_storage_vendor, request_status, erecord_flag
			, request_corp_cd, request_corp_nm, request_org_cd, request_org_nm, request_user_id, request_user_nm, request_user_pos_rank_nm
		)
		(
			SELECT B.record_center_id
				, TO_CHAR(SYSDATE,'YYYY')||LPAD(TB_STFORMAT_SQ01.NEXTVAL,13,'0') AS job_id
				, '0' AS neo_gubun
				, B.folder_id
				, B.record_id
				, D.medium_cd AS dest_storage_type
				, NVL(D.medium_detail_cd, '01') AS dest_storage_vendor
				, '-' AS request_status
				, B.erecord_flag
				, (SELECT Z.hupper_org_cd FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) AS request_corp_cd
				, (SELECT Y.org_nm FROM TB_STORG Y, (SELECT Z.record_center_id, Z.hupper_org_cd FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) X WHERE Y.record_center_id=X.record_center_id AND Y.org_cd=X.hupper_org_cd) AS request_corp_nm
				, #requestOrgCd:VARCHAR#
				, (SELECT Z.full_org_nm FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) AS request_org_nm
				, #requestUserId:VARCHAR#
				, #requestUserNm:VARCHAR#
				, (SELECT (CASE WHEN pos IS NULL AND rank IS NULL THEN ''
								WHEN pos IS NULL AND rank IS NOT NULL THEN rank
								WHEN pos IS NOT NULL AND rank IS NULL THEN pos
								ELSE pos||'/'||rank
							END)
					FROM  TB_STUSER
					WHERE user_id = #requestUserId:VARCHAR#) AS user_pos_rank
	          FROM  TB_RDRECORD B
				, ( SELECT medium_cd, medium_detail_cd
					FROM (
					    SELECT medium_cd, medium_detail_cd
					    FROM  TB_STMEDIUM
					    WHERE record_center_id = #recordCenterId:VARCHAR#
					    AND   volm_id IN (SELECT volm_id FROM TB_STVOLM WHERE del_flag='0' AND volm_div_cd='2')
					    AND   del_flag = '0'
					    AND   (tot_size - use_size) > 0
					    ORDER BY record_center_id, medium_id
					) C
					WHERE ROWNUM = 1) D
	          <!--cubrid WHERE (B.record_center_id, B.folder_id)-->
	          WHERE
	          EXISTS ( 
			<!--cubrid SELECT record_center_id, folder_id -->
			SELECT 1
	                FROM  TB_RDFOLDER A
	                WHERE A.record_center_id = #recordCenterId:VARCHAR#
	                AND   A.org_cd = #orgCd:VARCHAR#
	                AND   A.folder_keep_state_cd IN ('01','04')
			AND   A.record_center_id = B.record_center_id
			AND   A.folder_id = B.folder_id
					<isNotEmpty prepend="AND" property="creatYyyyFrom">
						<isNotEmpty property="creatYyyyTo">
							(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
						</isNotEmpty>
						<isEmpty property="creatYyyyTo">
							A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
						</isEmpty>
					</isNotEmpty>
					<isEmpty prepend="AND" property="creatYyyyFrom">
						<isNotEmpty property="creatYyyyTo">
							A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
						</isNotEmpty>
					</isEmpty>
					<isNotEmpty property="presvTermCd">
						<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
							A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR#
						</isEqual>
						<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
							A.presv_term_cd = #presvTermCd:VARCHAR#
						</isNotEqual>
					</isNotEmpty>
	              )
	          AND   B.erecord_flag = '1'
	          AND   (B.pdf_a1_trans_state IS NULL OR B.pdf_a1_trans_state='0')
         )
	</insert>
	<!-- 
		문서보존포맷변환 생산부서별변환
		: 생산부서에 대한 포맷변환 요청 - B.1.비전자 건원문 상태 변경 (6:변환불가)
	 -->
	<update id="updatePresvFormatPdfOrgNonErecordRecordOrign" parameterClass="rms.presv.format.domain.PresvFormatPdf">
        UPDATE TB_STRECORDORIGN
	SET   pdf_a1_trans_state = '6'
        WHERE
        EXISTS ( SELECT 1
			FROM  TB_RDFOLDER A
				, TB_RDRECORD B
				, TB_STRECORDORIGN C
            WHERE A.record_center_id = B.record_center_id
			AND   A.folder_id = B.folder_id
			AND   B.record_center_id = C.record_center_id
			AND   B.record_id = C.record_id
			AND   A.record_center_id = #recordCenterId:VARCHAR#
			AND   A.org_cd = #orgCd:VARCHAR#
			<isNotEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
				</isNotEmpty>
				<isEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
				</isEmpty>
			</isNotEmpty>
			<isEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
				</isNotEmpty>
			</isEmpty>
			<isNotEmpty property="presvTermCd">
				<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR#
				</isEqual>
				<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd = #presvTermCd:VARCHAR#
				</isNotEqual>
			</isNotEmpty>
            AND   A.folder_keep_state_cd IN ('01','04')
	        AND   B.erecord_flag = '2'
            )
	</update>
	<!--
		문서보존포맷변환 생산부서별변환
		: 생산부서에 대한 포맷변환 요청 - B.2.비전자 기록물건 상태 변경 (6:변환불가)
	 -->
	<update id="updatePresvFormatPdfOrgNonErecordRecord" parameterClass="rms.presv.format.domain.PresvFormatPdf">
        UPDATE TB_RDRECORD B
        SET   B.pdf_a1_trans_state = '6'
        <!--cubrid WHERE (B.record_center_id, B.folder_id)-->
        WHERE
        EXISTS(
            <!--cubrid SELECT A.record_center_id, A.folder_id-->
            SELECT 1
            FROM  TB_RDFOLDER A
            WHERE A.record_center_id = #recordCenterId:VARCHAR#
			AND   A.org_cd = #orgCd:VARCHAR#
			AND   A.record_center_id = B.record_center_id
			AND   A.folder_id = B.folder_id
			<isNotEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
				</isNotEmpty>
				<isEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
				</isEmpty>
			</isNotEmpty>
			<isEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
				</isNotEmpty>
			</isEmpty>
			<isNotEmpty property="presvTermCd">
				<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR#
				</isEqual>
				<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd = #presvTermCd:VARCHAR#
				</isNotEqual>
			</isNotEmpty>
            AND   A.folder_keep_state_cd IN ('01','04')
        )
        AND   B.erecord_flag = '2'
	</update>
	
	<!--
		문서보존포맷변환 생산부서별변환
		: C.1.원문파일 변환상태 변경 
	 -->
	<insert id="updatePresvFormatPdfOrgWaitOrignFile" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_STORIGNFILE Z
		SET   Z.pdf_a1_trans_state = '1'
		<!--cubrid WHERE (A.record_center_id, A.orign_id)
		 IN(
			SELECT A.record_center_id, A.orign_id-->
                WHERE 
		 EXISTS(
			SELECT 1
			FROM  TB_STORIGNFILE A
				, TB_RDRECORD B
				, TB_STREQTRANS T
				, TB_RDFOLDER F
			WHERE F.record_center_id = #recordCenterId:VARCHAR#
			AND   F.org_cd = #orgCd:VARCHAR#
			AND   F.folder_keep_state_cd IN ('01','04')    
			AND   B.record_center_id = F.record_center_id
			AND   B.folder_id  = F.folder_id
			AND   B.erecord_flag = '1'
			AND   (B.pdf_a1_trans_state IS NULL OR B.pdf_a1_trans_state='0')
			AND   T.record_center_id = B.record_center_id 
			AND   T.RECORD_ID = B.RECORD_ID
			AND   T.REQUEST_STATUS = '-'
			AND   A.record_center_id = B.record_center_id
			AND   A.orign_id = B.orign_id
                        <!--cubrid-->
                        AND   A.record_center_id = Z.record_center_id
                        AND   A.orign_id = Z.orign_id
        )
	</insert>
	<!--
		문서보존포맷변환 생산부서별변환
		: C.2.건원문 변환상태 변경 
	 -->
	<insert id="updatePresvFormatPdfOrgWaitRecordOrign" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_STRECORDORIGN Z
		SET   Z.pdf_a1_trans_state = '1'
		<!--cubrid WHERE (A.record_center_id, A.orign_id)
		IN (
			SELECT A.record_center_id, A.orign_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM  TB_STORIGNFILE A
				, TB_RDRECORD B
				, TB_STREQTRANS T
				, TB_RDFOLDER F
			WHERE F.record_center_id = #recordCenterId:VARCHAR#
			AND   F.org_cd = #orgCd:VARCHAR#
			AND   F.folder_keep_state_cd IN ('01','04')    
			AND   B.record_center_id = F.record_center_id
			AND   B.folder_id  = F.folder_id
			AND   B.erecord_flag = '1'
			AND   (B.pdf_a1_trans_state IS NULL OR B.pdf_a1_trans_state='0')
			AND   T.record_center_id = B.record_center_id 
			AND   T.RECORD_ID = B.RECORD_ID
			AND   T.REQUEST_STATUS = '-'
			AND   A.record_center_id = B.record_center_id
			AND   A.orign_id = B.orign_id
			<!--cubrid-->
			AND   A.record_center_id = Z.record_center_id
			AND   A.orign_id=Z.orign_id  
        )
	</insert>
	<!--
		문서보존포맷변환 생산부서별변환
		: C.3.기록물건 변환상태 변경 
	 -->
 	<insert id="updatePresvFormatPdfOrgWaitRecord" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_RDRECORD Z
		SET   pdf_a1_trans_state = '1'
		<!--cubrid WHERE  (record_center_id, folder_id)    
		IN (
			SELECT F.record_center_id, F.folder_id   -->
		WHERE  
		EXISTS (
			SELECT 1
			FROM  TB_RDFOLDER F
				, TB_STREQTRANS T
			WHERE F.record_center_id = #recordCenterId:VARCHAR#
			AND   F.org_cd = #orgCd:VARCHAR#
			AND   F.folder_keep_state_cd IN ('01','04')
			AND   T.record_center_id = F.record_center_id
			AND   T.folder_id  = F.folder_id
			AND   T.request_status = '-'
			<!--cubrid-->
			AND   F.record_center_id = Z.record_center_id
			AND   F.folder_id = Z.folder_id
		)
		AND   erecord_flag = '1'
		AND   (pdf_a1_trans_state IS NULL OR pdf_a1_trans_state='0')
	</insert>
	<!--
		문서보존포맷변환 생산부서별변환
		: C.4.기록물철 변환상태 변경 
	 -->
 	<insert id="updatePresvFormatPdfOrgWaitFolder" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_RDFOLDER A
		SET   A.pdf_a1_trans_state = ( CASE WHEN A.erecord_flag='2' THEN '6'
                                            WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.erecord_flag='1' AND (B.pdf_a1_trans_state IS NULL OR B.pdf_a1_trans_state IN ('0','1','2','3','5'))) THEN '4'
                                            WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.erecord_flag='1' AND (B.pdf_a1_trans_state IS NULL OR B.pdf_a1_trans_state IN ('0','1','2','3'))) THEN '5'
                                            WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.erecord_flag='1' AND B.pdf_a1_trans_state IN ('1','2','3')) THEN '0'
                                            WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.erecord_flag='1' AND B.pdf_a1_trans_state IN ('1','2')) THEN '3'
                                            ELSE '1'
                                        END )
		<!--cubrid WHERE  ( record_center_id, folder_id)    
		IN (
			SELECT F.record_center_id, F.folder_id   -->
		WHERE  
		EXISTS (
			SELECT 1
			FROM  TB_RDFOLDER F
				, TB_STREQTRANS T
			WHERE F.record_center_id = #recordCenterId:VARCHAR#
			AND   F.org_cd = #orgCd:VARCHAR#
			AND   F.folder_keep_state_cd IN ('01','04')
			AND   T.record_center_id = F.record_center_id
			AND   T.folder_id  = F.folder_id
			AND   T.request_status = '-'
			<!--cubrid-->
			AND   F.record_center_id=A.record_center_id
			AND   F.folder_id=A.folder_id
		)       
    </insert>
	
	<!-- 
		문서보존포맷변환의 생산부서별변환
		: 생산부서에 대한 변환취소 처리 - D.포맷변환요청정보변경(E:취소) 
	 -->
	<update id="updatePresvFormatPdfOrgClearReqTrans" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_STREQTRANS
		SET   request_status = 'E'
			, request_start_time = SYSDATE
		<!--cubrid WHERE (record_center_id, folder_id, record_id)
		IN (
			SELECT B.record_center_id, B.folder_id, B.record_id-->
		WHERE 
		EXISTS (
			SELECT 1
			FROM  TB_RDRECORD B
			<!--cubrid WHERE (B.record_center_id, B.folder_id)
			IN (
                SELECT record_center_id, FOLDER_ID -->
			WHERE
			EXISTS (
                SELECT 1
                FROM  TB_RDFOLDER A
                WHERE A.record_center_id = #recordCenterId:VARCHAR#
                AND   A.org_cd = #orgCd:VARCHAR#
                AND   A.folder_keep_state_cd IN ('01','04')
		<!--cubrid-->
		AND   record_center_id = B.record_center_id
		AND   FOLDER_ID = B.folder_id
				<isNotEmpty prepend="AND" property="creatYyyyFrom">
					<isNotEmpty property="creatYyyyTo">
						(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
					</isNotEmpty>
					<isEmpty property="creatYyyyTo">
						A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
					</isEmpty>
				</isNotEmpty>
				<isEmpty prepend="AND" property="creatYyyyFrom">
					<isNotEmpty property="creatYyyyTo">
						A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
					</isNotEmpty>
				</isEmpty>
				<isNotEmpty property="presvTermCd">
					<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
						A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR# 
					</isEqual>
					<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
						A.presv_term_cd = #presvTermCd:VARCHAR# 
					</isNotEqual>
				</isNotEmpty>
				AND   A.folder_keep_state_cd IN ('01','04')
			  )
			<isEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.pdf_a1_trans_state IN ('0','1', '2', '3','5')
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.pdf_a1_trans_state IN ('1', '2', '3')
				</isNotEqual>
			</isEqual>
			<isNotEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.pdf_a1_trans_state = '5'
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					0 = 1
				</isNotEqual>
			</isNotEqual>
		)
		AND neo_gubun = '0'
	</update>
	
	<!-- 
		문서보존포맷변환 생산부서별변환
		: 생산부서에 대한 변환취소 처리 - E.1.원문파일 변환실패 내역 삭제 
	 -->
	<delete id="updatePresvFormatPdfOrgClearWorkHist" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		DELETE FROM TB_STWORKHIST Z
		<!--cubrid WHERE (record_center_id, folder_id, record_id)
		IN (
			SELECT B.record_center_id, B.folder_id, B.record_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM  TB_RDRECORD B
			<!--cubrid WHERE (B.record_center_id, B.folder_id)
			IN (
				SELECT A.record_center_id, A.folder_id-->
			WHERE
			EXISTS (
				SELECT 1
				FROM  TB_RDFOLDER A
				WHERE A.record_center_id = #recordCenterId:VARCHAR#
				AND   A.org_cd = #orgCd:VARCHAR#
				<!--cubrid -->
				AND   A.record_center_id = B.record_center_id
				AND   A.folder_id = B.folder_id
				<isNotEmpty prepend="AND" property="creatYyyyFrom">
					<isNotEmpty property="creatYyyyTo">
						(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
					</isNotEmpty>
					<isEmpty property="creatYyyyTo">
						A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
					</isEmpty>
				</isNotEmpty>
				<isEmpty prepend="AND" property="creatYyyyFrom">
					<isNotEmpty property="creatYyyyTo">
						A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
					</isNotEmpty>
				</isEmpty>
				<isNotEmpty property="presvTermCd">
					<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
						A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR# 
					</isEqual>
					<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
						A.presv_term_cd = #presvTermCd:VARCHAR# 
					</isNotEqual>
				</isNotEmpty>
				AND   A.folder_keep_state_cd IN ('01','04')
			)
			<isEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.pdf_a1_trans_state IN ('1', '2', '3','5')
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.pdf_a1_trans_state IN ('1', '2', '3')
				</isNotEqual>
			</isEqual>
			<isNotEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.pdf_a1_trans_state = '5'
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					0 = 1
				</isNotEqual>
			</isNotEqual>
                <!--cubrid-->
		AND   B.record_center_id = Z.record_center_id
		AND   B.folder_id = Z.folder_id
		AND   B.record_id = Z.record_id
		)
		AND   format_div_cd = '0'
		AND   (followup_div_cd IS NULL OR followup_div_cd IN ('0','1'))
	</delete>
	<!-- 
		문서보존포맷변환 생산부서별변환
		: 생산부서에 대한 변환취소 처리 - E.2.원문파일 상태 변경 (0:미변환)
	 -->
	<update id="updatePresvFormatPdfOrgClearOrignFile" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_STORIGNFILE Z
		SET   pdf_a1_trans_state = '0'
		<!--cubrid WHERE (record_center_id, orign_id)
		IN (
			SELECT B.record_center_id, B.orign_id-->
		WHERE 
		EXISTS (
			SELECT B.record_center_id, B.orign_id
			FROM  TB_RDRECORD B
			<!--cubrid WHERE (B.record_center_id, B.folder_id)
				IN (
				SELECT A.record_center_id, A.folder_id-->
			WHERE
			EXISTS (
				SELECT 1
				FROM  TB_RDFOLDER A
				WHERE A.record_center_id = #recordCenterId:VARCHAR#
				AND   A.org_cd = #orgCd:VARCHAR#
				<!--cubrid-->
				AND   A.record_center_id = B.record_center_id
				AND   A.folder_id = B.folder_id
				<isNotEmpty prepend="AND" property="creatYyyyFrom">
					<isNotEmpty property="creatYyyyTo">
						(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
					</isNotEmpty>
					<isEmpty property="creatYyyyTo">
						A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
					</isEmpty>
				</isNotEmpty>
				<isEmpty prepend="AND" property="creatYyyyFrom">
					<isNotEmpty property="creatYyyyTo">
						A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
					</isNotEmpty>
				</isEmpty>
				<isNotEmpty property="presvTermCd">
					<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
						A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR# 
					</isEqual>
					<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
						A.presv_term_cd = #presvTermCd:VARCHAR# 
					</isNotEqual>
				</isNotEmpty>
				AND   A.folder_keep_state_cd IN ('01','04')
			)
			<isEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.pdf_a1_trans_state IN ('1', '2', '3','5')
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.pdf_a1_trans_state IN ('1', '2', '3')
				</isNotEqual>
			</isEqual>
			<isNotEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.pdf_a1_trans_state = '5'
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					0 = 1
				</isNotEqual>
			</isNotEqual>
		<!--cubrid-->
		AND B.record_center_id = Z.record_center_id
		AND B.orign_id = Z.orign_id
		)
		<isEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				pdf_a1_trans_state IN ('1', '2', '3','5')
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				pdf_a1_trans_state IN ('1', '2', '3')
			</isNotEqual>
		</isEqual>
		<isNotEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				pdf_a1_trans_state = '5'
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				0 = 1
			</isNotEqual>
		</isNotEqual>
	</update>
	<!-- 
		문서보존포맷변환 생산부서별변환
		: 생산부서에 대한 변환취소 처리 - E.3.건원문 상태 변경 (0:미변환)
	 -->
	<update id="updatePresvFormatPdfOrgClearRecordOrign" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_STRECORDORIGN Z
		SET   pdf_a1_trans_state = '0'
		<!--cubrid WHERE (record_center_id, record_id)
		IN (
			SELECT B.record_center_id, B.record_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM  TB_RDRECORD B
			<!--cubrid WHERE (B.record_center_id, B.folder_id)
			IN (
				SELECT A.record_center_id, A.folder_id-->
			WHERE 
			EXISTS (
				SELECT 1
				FROM  TB_RDFOLDER A
				WHERE A.record_center_id = #recordCenterId:VARCHAR#
				AND   A.org_cd = #orgCd:VARCHAR#
				<!--cubrid-->
				AND   A.record_center_id=B.record_center_id
				AND   A.folder_id=B.folder_id
				<isNotEmpty prepend="AND" property="creatYyyyFrom">
					<isNotEmpty property="creatYyyyTo">
						(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
					</isNotEmpty>
					<isEmpty property="creatYyyyTo">
						A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
					</isEmpty>
				</isNotEmpty>
				<isEmpty prepend="AND" property="creatYyyyFrom">
					<isNotEmpty property="creatYyyyTo">
						A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
					</isNotEmpty>
				</isEmpty>
				<isNotEmpty property="presvTermCd">
					<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
						A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR# 
					</isEqual>
					<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
						A.presv_term_cd = #presvTermCd:VARCHAR# 
					</isNotEqual>
				</isNotEmpty>
				AND   A.folder_keep_state_cd IN ('01','04')
			)
			<isEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.pdf_a1_trans_state IN ('1', '2', '3','5')
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.pdf_a1_trans_state IN ('1', '2', '3')
				</isNotEqual>
			</isEqual>
			<isNotEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.pdf_a1_trans_state = '5'
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					0 = 1
				</isNotEqual>
			</isNotEqual>
		<!--cubrid-->
		AND B.record_center_id = Z.record_center_id
		AND B.record_id = Z.record_id
		)
		<isEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				pdf_a1_trans_state IN ('1', '2', '3','5')
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				pdf_a1_trans_state IN ('1', '2', '3')
			</isNotEqual>
		</isEqual>
		<isNotEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				pdf_a1_trans_state = '5'
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				0 = 1
			</isNotEqual>
		</isNotEqual>
	</update>
	<!-- 
		문서보존포맷변환 생산부서별변환
		: 생산부서에 대한 변환취소 처리 - E.4.기록물건 상태 변경 (0:미변환)
	 -->
	<update id="updatePresvFormatPdfOrgClearRecord" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_RDRECORD Z
		SET   pdf_a1_trans_state = '0'
		<!--cubrid WHERE (record_center_id, folder_id)
		IN (
			SELECT A.record_center_id, A.folder_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM  TB_RDFOLDER A
			WHERE A.record_center_id = #recordCenterId:VARCHAR#
			AND   A.org_cd = #orgCd:VARCHAR#
			<!--cubrid-->
			AND   A.record_center_id = Z.record_center_id
			AND   A.folder_id = Z.folder_id
			<isNotEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
				</isNotEmpty>
				<isEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
				</isEmpty>
			</isNotEmpty>
			<isEmpty prepend="AND" property="creatYyyyFrom">
				<isNotEmpty property="creatYyyyTo">
					A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
				</isNotEmpty>
			</isEmpty>
			<isNotEmpty property="presvTermCd">
				<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR# 
				</isEqual>
				<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
					A.presv_term_cd = #presvTermCd:VARCHAR# 
				</isNotEqual>
			</isNotEmpty>
			AND   A.folder_keep_state_cd IN ('01','04')
		)
		<isEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				pdf_a1_trans_state IN ('1', '2', '3', '5')
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				pdf_a1_trans_state IN ('1', '2', '3')
			</isNotEqual>
		</isEqual>
		<isNotEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				pdf_a1_trans_state = '5'
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				0 = 1
			</isNotEqual>
		</isNotEqual>
	</update>
	<!-- 
		문서보존포맷변환 생산부서별변환
		: 생산부서에 대한 변환취소 처리 - E.5.기록물철 상태 변경 (0:미변환 or OTHER)
	 -->
	<update id="updatePresvFormatPdfOrgClearFolder" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_RDFOLDER A
		SET   A.pdf_a1_trans_state = ( CASE WHEN A.erecord_flag='2' THEN '6'
											WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.erecord_flag='1' AND (B.pdf_a1_trans_state IS NULL OR B.pdf_a1_trans_state IN ('0','1','2','3','5'))) THEN '4'
											WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.erecord_flag='1' AND (B.pdf_a1_trans_state IS NULL OR B.pdf_a1_trans_state IN ('0','1','2','3'))) THEN '5'
											WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.erecord_flag='1' AND B.pdf_a1_trans_state IN ('1','2','3')) THEN '0'
											ELSE '1' END )
		WHERE A.record_center_id = #recordCenterId:VARCHAR#
		AND   A.org_cd = #orgCd:VARCHAR#
		<isNotEmpty prepend="AND" property="creatYyyyFrom">
			<isNotEmpty property="creatYyyyTo">
				(A.creat_yyyy BETWEEN #creatYyyyFrom:VARCHAR# AND #creatYyyyTo:VARCHAR#)
			</isNotEmpty>
			<isEmpty property="creatYyyyTo">
				A.creat_yyyy <![CDATA[>=]]> #creatYyyyFrom:VARCHAR#
			</isEmpty>
		</isNotEmpty>
		<isEmpty prepend="AND" property="creatYyyyFrom">
			<isNotEmpty property="creatYyyyTo">
				A.creat_yyyy <![CDATA[<=]]> #creatYyyyTo:VARCHAR#
			</isNotEmpty>
		</isEmpty>
		<isNotEmpty property="presvTermCd">
			<isEqual prepend="AND" property="presvTermCheck" compareValue="1">
				A.presv_term_cd <![CDATA[>=]]> #presvTermCd:VARCHAR# 
			</isEqual>
			<isNotEqual prepend="AND" property="presvTermCheck" compareValue="1">
				A.presv_term_cd = #presvTermCd:VARCHAR# 
			</isNotEqual>
		</isNotEmpty>
		AND   A.folder_keep_state_cd IN ('01','04')
	</update>



	<!-- 
		기록물철에 대한 포맷변환 요청 - A.포맷변환요청정보생성(-:신청) 
	 -->
	<insert id="createPresvFormatPdfFolderReqTrans" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		INSERT INTO TB_STREQTRANS (
			record_center_id, job_id, neo_gubun, folder_id, record_id, dest_storage_type, dest_storage_vendor, request_status, erecord_flag
			, request_corp_cd, request_corp_nm, request_org_cd, request_org_nm, request_user_id, request_user_nm, request_user_pos_rank_nm
		)
		(
			SELECT B.record_center_id
				, TO_CHAR(SYSDATE,'YYYY')||LPAD(TB_STFORMAT_SQ01.NEXTVAL,13,'0')
				, '0'
				, B.folder_id
				, B.record_id
				, D.medium_cd AS dest_storage_type
				, NVL(D.medium_detail_cd, '01') AS dest_storage_vendor
				, '-'
				, '1'
				, (SELECT Z.hupper_org_cd FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) AS request_corp_cd
				, (SELECT Y.org_nm FROM TB_STORG Y, (SELECT Z.record_center_id, Z.hupper_org_cd FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) X WHERE Y.record_center_id=X.record_center_id AND Y.org_cd=X.hupper_org_cd) AS request_corp_nm
				, #requestOrgCd:VARCHAR#
				, (SELECT Z.full_org_nm FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) AS request_org_nm
				, #requestUserId:VARCHAR#
				, #requestUserNm:VARCHAR#
				, (SELECT (CASE WHEN pos IS NULL AND rank IS NULL THEN ''
								WHEN pos IS NULL AND rank IS NOT NULL THEN rank
								WHEN pos IS NOT NULL AND rank IS NULL THEN pos
								ELSE pos||'/'||rank
							END)
					FROM  TB_STUSER
					WHERE user_id = #requestUserId:VARCHAR#) AS user_pos_rank
			FROM  TB_RDRECORD B
				, ( SELECT medium_cd, medium_detail_cd
					FROM (
					    SELECT medium_cd, medium_detail_cd
					    FROM  TB_STMEDIUM
					    WHERE record_center_id = #recordCenterId:VARCHAR#
					    AND   volm_id IN (SELECT volm_id FROM TB_STVOLM WHERE del_flag='0' AND volm_div_cd='2')
					    AND   del_flag = '0'
					    AND   (tot_size - use_size) > 0
					    ORDER BY record_center_id, medium_id
					) C
					WHERE ROWNUM = 1) D
			WHERE B.record_center_id = #recordCenterId:VARCHAR#
			AND   B.folder_id = #folderId:VARCHAR#
			AND   B.erecord_flag = '1'
			AND   (B.pdf_a1_trans_state IS NULL OR B.pdf_a1_trans_state='0')
         )
	</insert>
	<!--
		기록물철에 대한 포맷변환 요청 - B.1.비전자 건원문 상태 변경 (6:변환불가)
	 -->
	<update id="updatePresvFormatPdfFolderNonErecordRecordOrign" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_STRECORDORIGN Z
		SET   pdf_a1_trans_state = '6'
		<!--cubrid WHERE (record_center_id, record_id)
		IN (
			SELECT B.record_center_id, B.record_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM  TB_RDRECORD B
			WHERE B.record_center_id = #recordCenterId:VARCHAR#
			AND   B.folder_id = #folderId:VARCHAR#
			AND   B.erecord_flag = '2'
			<!--cubrid-->
			AND   B.record_center_id = Z.record_center_id
			AND   B.record_id = Z.record_id
		)
	</update>
	<!--
		기록물철에 대한 포맷변환 요청 - B.2.비전자 기록물건 상태 변경 (6:변환불가)
	 -->
	<update id="updatePresvFormatPdfFolderNonErecordRecord" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_RDRECORD B
		SET   B.pdf_a1_trans_state = '6'
		WHERE B.record_center_id = #recordCenterId:VARCHAR#
		AND   B.folder_id = #folderId:VARCHAR#
		AND   B.erecord_flag = '2'
	</update>
	
	<!-- 
		기록물철에 대한 포맷변환 요청 - C.1.원문파일 변환상태 변경 
	 -->
	<update id="updatePresvFormatPdfFolderWaitOrignFile" parameterClass="rms.presv.format.domain.PresvFormatPdf">
        UPDATE TB_STORIGNFILE A
        SET   A.pdf_a1_trans_state = '1'
        <!--cubrid WHERE (A.record_center_id, A.orign_id)
        IN (
            SELECT record_center_id, orign_id-->
        WHERE
        EXISTS (
            SELECT 1
            FROM  TB_RDRECORD B
			WHERE B.record_center_id = #recordCenterId:VARCHAR#
			AND   B.folder_id = #folderId:VARCHAR#
			AND   B.erecord_flag = '1'
			AND   (B.pdf_a1_trans_state IS NULL OR B.pdf_a1_trans_state='0')
			<!--cubrid-->
			AND   record_center_id = A.record_center_id
			AND   orign_id = A.orign_id
        )
        AND (A.pdf_a1_trans_state IS NULL OR A.pdf_a1_trans_state='0')
	</update>
	
	<!-- 
		기록물철에 대한 포맷변환 요청 - C.2.건원문 변환상태 변경 
	 -->
	<update id="updatePresvFormatPdfFolderWaitRecordOrign" parameterClass="rms.presv.format.domain.PresvFormatPdf">
        UPDATE TB_STRECORDORIGN A
        SET   A.pdf_a1_trans_state = '1'
        <!--cubrid WHERE (A.record_center_id, A.orign_id)
        IN (
            SELECT record_center_id, orign_id-->
        WHERE 
        EXISTS (
            SELECT 1
            FROM  TB_RDRECORD B
			WHERE B.record_center_id = #recordCenterId:VARCHAR#
			AND   B.folder_id = #folderId:VARCHAR#
			AND   B.erecord_flag = '1'
			AND   (B.pdf_a1_trans_state IS NULL OR B.pdf_a1_trans_state='0')
			<!--cubrid-->
			AND   record_center_id = A.record_center_id
			AND   orign_id = A.orign_id
        )
        AND (A.pdf_a1_trans_state IS NULL OR A.pdf_a1_trans_state='0')
	</update>
	
	<!-- 
		기록물철에 대한 포맷변환 요청 - C.3.기록물건 변환상태 변경 
	 -->
	<update id="updatePresvFormatPdfFolderWaitRecord" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_RDRECORD
		SET   pdf_a1_trans_state = '1'
		WHERE record_center_id = #recordCenterId:VARCHAR#
		AND   folder_id = #folderId:VARCHAR#
		AND   erecord_flag = '1'
		AND ( pdf_a1_trans_state IS NULL OR pdf_a1_trans_state='0')
	</update>
	
	<!-- 
		기록물철에 대한 포맷변환 요청 - C.4.기록물철 변환상태 변경 
	 -->
	<update id="updatePresvFormatPdfFolderWaitFolder" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_RDFOLDER A
		SET   A.pdf_a1_trans_state = ( CASE WHEN A.erecord_flag='2' THEN '6'
                                            WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.erecord_flag='1' AND (B.pdf_a1_trans_state IS NULL OR B.pdf_a1_trans_state IN ('0','1','2','3','5'))) THEN '4'
                                            WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.erecord_flag='1' AND (B.pdf_a1_trans_state IS NULL OR B.pdf_a1_trans_state IN ('0','1','2','3'))) THEN '5'
                                            WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.erecord_flag='1' AND B.pdf_a1_trans_state IN ('1','2','3')) THEN '0'
                                            WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.erecord_flag='1' AND B.pdf_a1_trans_state IN ('1','2')) THEN '3'
                                            ELSE '1'
                                        END )
		WHERE A.record_center_id = #recordCenterId:VARCHAR#
		AND   A.folder_id = #folderId:VARCHAR#
	</update>
	
	<!-- 
		: 기록물철에 대한 변환취소 처리 - D.포맷변환요청정보변경(E:취소) 
	 -->
	<update id="updatePresvFormatPdfFolderClearReqTrans" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_STREQTRANS Z
		SET   request_status = 'E'
			, request_start_time = SYSDATE
		<!--cubrid WHERE (record_center_id, folder_id, record_id)
		IN (
			SELECT B.record_center_id, B.folder_id, B.record_id-->
		WHERE 
		EXISTS (
			SELECT 1
			FROM  TB_RDRECORD B
	        WHERE B.record_center_id = #recordCenterId:VARCHAR#
	        AND   B.folder_id = #folderId:VARCHAR#
		<!--cubrid-->
		AND   B.record_center_id = Z.record_center_id
		AND   B.folder_id = Z.folder_id
		AND   B.record_id = Z.record_id
			<isEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.pdf_a1_trans_state IN ('0','1', '2', '3','5')
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.pdf_a1_trans_state IN ('1', '2', '3')
				</isNotEqual>
			</isEqual>
			<isNotEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.pdf_a1_trans_state = '5'
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					0 = 1
				</isNotEqual>
			</isNotEqual>
		)
		AND neo_gubun = '0'		
	</update>
	
	<!-- 
		기록물철에 대한 변환취소 처리 - E.1.원문파일 변환실패 내역 삭제
	 -->
	<delete id="updatePresvFormatPdfFolderClearWorkHist" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		DELETE FROM TB_STWORKHIST Z
		<!--cucbrid WHERE (record_center_id, folder_id, record_id)
		IN (
			SELECT B.record_center_id, B.folder_id, B.record_id-->
		WHERE 
		EXISTS (
			SELECT 1
			FROM  TB_RDRECORD B
	        WHERE B.record_center_id = #recordCenterId:VARCHAR#
	        AND   B.folder_id = #folderId:VARCHAR#
		<!--cubrid-->
		AND   B.record_center_id = Z.record_center_id
		AND   B.folder_id = Z.folder_id
		AND   B.record_id = Z.record_id
			<isEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.pdf_a1_trans_state IN ('1', '2', '3','5')
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.pdf_a1_trans_state IN ('1', '2', '3')
				</isNotEqual>
			</isEqual>
			<isNotEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.pdf_a1_trans_state = '5'
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					0 = 1
				</isNotEqual>
			</isNotEqual>
		)
		AND   format_div_cd = '0'
		AND   (followup_div_cd IS NULL OR followup_div_cd IN ('0','1'))
	</delete>
	<!-- 
		기록물철에 대한 변환취소 처리 - E.2.원문파일 상태 변경 (0:미변환)
	 -->
	<update id="updatePresvFormatPdfFolderClearOrignFile" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_STORIGNFILE Z
		SET   pdf_a1_trans_state = '0'
		<!--cubrid WHERE (record_center_id, orign_id)
		IN (
			SELECT B.record_center_id, B.orign_id-->
		WHERE 
		EXISTS (
			SELECT 1
			FROM  TB_RDRECORD B
	        WHERE B.record_center_id = #recordCenterId:VARCHAR#
	        AND   B.folder_id = #folderId:VARCHAR#
		<!--cubrid-->
		AND   B.record_center_id = Z.record_center_id
		AND   B.orign_id = Z.orign_id
		)
		<isEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				pdf_a1_trans_state IN ('1', '2', '3','5')
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				pdf_a1_trans_state IN ('1', '2', '3')
			</isNotEqual>
		</isEqual>
		<isNotEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				pdf_a1_trans_state = '5'
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				0 = 1
			</isNotEqual>
		</isNotEqual>
	</update>
	<!-- 
		기록물철에 대한 변환취소 처리 - E.3.건원문 상태 변경 (0:미변환)
	 -->
	<update id="updatePresvFormatPdfFolderClearRecordOrign" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_STRECORDORIGN Z
		SET   pdf_a1_trans_state = '0'
		<!--cubridWHERE (record_center_id, record_id)
		IN (
			SELECT B.record_center_id, B.record_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM  TB_RDRECORD B
	        WHERE B.record_center_id = #recordCenterId:VARCHAR#
	        AND   B.folder_id = #folderId:VARCHAR#
		<!--cubrid-->
		AND   B.record_center_id=Z.record_center_id
		AND   B.record_id=Z.record_id
		)
		<isEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				pdf_a1_trans_state IN ('1', '2', '3','5')
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				pdf_a1_trans_state IN ('1', '2', '3')
			</isNotEqual>
		</isEqual>
		<isNotEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				pdf_a1_trans_state = '5'
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				0 = 1
			</isNotEqual>
		</isNotEqual>
	</update>
	<!-- 
		기록물철에 대한 변환취소 처리 - E.4.기록물건 상태 변경 (0:미변환)
	 -->
	<update id="updatePresvFormatPdfFolderClearRecord" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_RDRECORD
		SET   pdf_a1_trans_state = '0'
        WHERE record_center_id = #recordCenterId:VARCHAR#
        AND   folder_id = #folderId:VARCHAR#
		<isEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				pdf_a1_trans_state IN ('1', '2', '3', '5')
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				pdf_a1_trans_state IN ('1', '2', '3')
			</isNotEqual>
		</isEqual>
		<isNotEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				pdf_a1_trans_state = '5'
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				0 = 1
			</isNotEqual>
		</isNotEqual>
	</update>
	<!-- 
		기록물철에 대한 변환취소 처리 - E.5.기록물철 상태 변경 (0:미변환 or OTHER)
	 -->
	<update id="updatePresvFormatPdfFolderClearFolder" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_RDFOLDER A
		SET   A.pdf_a1_trans_state = ( CASE WHEN A.erecord_flag='2' THEN '6'
											WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.erecord_flag='1' AND (B.pdf_a1_trans_state IS NULL OR B.pdf_a1_trans_state IN ('0','1','2','3','5'))) THEN '4'
											WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.erecord_flag='1' AND (B.pdf_a1_trans_state IS NULL OR B.pdf_a1_trans_state IN ('0','1','2','3'))) THEN '5'
											WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.erecord_flag='1' AND B.pdf_a1_trans_state IN ('1','2','3')) THEN '0'
											ELSE '1' END )
		WHERE A.record_center_id = #recordCenterId:VARCHAR#
        AND   A.folder_id = #folderId:VARCHAR#
	</update>



	<!-- 
		기록물건에 대한 포맷변환 요청 - A.포맷변환요청정보생성(-:신청) 
	 -->
	<insert id="createPresvFormatPdfRecordReqTrans" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		INSERT INTO TB_STREQTRANS (
			record_center_id, job_id, neo_gubun, folder_id, record_id, dest_storage_type, dest_storage_vendor, request_status, erecord_flag
			, request_corp_cd, request_corp_nm, request_org_cd, request_org_nm, request_user_id, request_user_nm, request_user_pos_rank_nm
		)
		(
			SELECT B.record_center_id
				, TO_CHAR(SYSDATE,'YYYY')||LPAD(TB_STFORMAT_SQ01.NEXTVAL,13,'0')
				, '0'
				, B.folder_id
				, B.record_id
				, D.medium_cd AS dest_storage_type
				, NVL(D.medium_detail_cd,  '01') AS dest_storage_vendor
				, '-'
				, '1'
				, (SELECT Z.hupper_org_cd FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) AS request_corp_cd
				, (SELECT Y.org_nm FROM TB_STORG Y, (SELECT Z.record_center_id, Z.hupper_org_cd FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) X WHERE Y.record_center_id=X.record_center_id AND Y.org_cd=X.hupper_org_cd) AS request_corp_nm
				, #requestOrgCd:VARCHAR#
				, (SELECT Z.full_org_nm FROM TB_STORG Z WHERE Z.record_center_id = #recordCenterId:VARCHAR# AND Z.org_cd = #requestOrgCd:VARCHAR#) AS request_org_nm
				, #requestUserId:VARCHAR#
				, #requestUserNm:VARCHAR#
				, (SELECT (CASE WHEN pos IS NULL AND rank IS NULL THEN ''
								WHEN pos IS NULL AND rank IS NOT NULL THEN rank
								WHEN pos IS NOT NULL AND rank IS NULL THEN pos
								ELSE pos||'/'||rank
							END)
					FROM  TB_STUSER
					WHERE user_id = #requestUserId:VARCHAR#) AS user_pos_rank
			FROM  TB_RDRECORD B
				, ( SELECT medium_cd, medium_detail_cd
					FROM (
					    SELECT medium_cd, medium_detail_cd
					    FROM  TB_STMEDIUM
					    WHERE record_center_id = #recordCenterId:VARCHAR#
					    AND   volm_id IN (SELECT volm_id FROM TB_STVOLM WHERE del_flag='0' AND volm_div_cd='2')
					    AND   del_flag = '0'
					    AND   (tot_size - use_size) > 0
					    ORDER BY record_center_id, medium_id
					) C
					WHERE ROWNUM = 1) D
			WHERE B.record_center_id = #recordCenterId:VARCHAR#
			AND   B.record_id = #recordId:VARCHAR#
			AND   B.erecord_flag = '1'
			AND   (B.pdf_a1_trans_state IS NULL OR B.pdf_a1_trans_state='0')
         )
	</insert>
	
	<!--
		기록물건에 대한 포맷변환 요청 - B.1.비전자 건원문 상태 변경 (6:변환불가)
	 -->
	<update id="updatePresvFormatPdfRecordNonErecordRecordOrign" parameterClass="rms.presv.format.domain.PresvFormatPdf">
        UPDATE TB_STRECORDORIGN Z
		SET   pdf_a1_trans_state = '6'
		<!--cubrid WHERE (record_center_id, record_id)
		IN (
			SELECT B.record_center_id, B.record_id-->
		WHERE 
		EXISTS (
			SELECT 1
			FROM  TB_RDRECORD B
			WHERE B.record_center_id = #recordCenterId:VARCHAR#
			AND   B.record_id = #recordId:VARCHAR#
	        AND   B.erecord_flag = '2'
			<!--cubrid-->
			AND   B.record_center_id = Z.record_center_id
			AND   B.record_id = Z.record_id
	    )
	</update>

	<!--
		기록물건에 대한 포맷변환 요청 - B.2.비전자 기록물건 상태 변경 (6:변환불가)
	 -->
	<update id="updatePresvFormatPdfRecordNonErecordRecord" parameterClass="rms.presv.format.domain.PresvFormatPdf">
        UPDATE TB_RDRECORD B
        SET   B.pdf_a1_trans_state = '6'
		WHERE B.record_center_id = #recordCenterId:VARCHAR#
		AND   B.record_id = #recordId:VARCHAR#
        AND   B.erecord_flag = '2'
	</update>
	
	<!-- 
		기록물건에 대한 포맷변환 요청 - C.1.원문파일 상태 변경 (1:변환대기)
	 -->
	<update id="updatePresvFormatPdfRecordWaitOrignFile" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_STORIGNFILE A
		SET   A.pdf_a1_trans_state = '1'
		<!--cubrid WHERE (A.record_center_id, A.orign_id)
		IN (
		    SELECT record_center_id, orign_id-->
		WHERE
		EXISTS (
		    SELECT 1
		    FROM  TB_RDRECORD
			WHERE record_center_id = #recordCenterId:VARCHAR#
			AND   record_id = #recordId:VARCHAR#
			<!--cubrid-->
			AND   record_center_id = A.record_center_id
			AND   orign_id = A.orign_id
		)
		AND (A.pdf_a1_trans_state IS NULL OR A.pdf_a1_trans_state='0')
	</update>
	<!-- 
		기록물건에 대한 포맷변환 요청 - C.2.건원문 변환상태 변경 (1:변환대기)
	 -->
	<update id="updatePresvFormatPdfRecordWaitRecordOrign" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_STRECORDORIGN A
		SET   A.pdf_a1_trans_state = '1'
		WHERE A.record_center_id = #recordCenterId:VARCHAR#
		AND   A.record_id = #recordId:VARCHAR#
        AND   A.erecord_flag = '1'
		AND  (A.pdf_a1_trans_state IS NULL OR A.pdf_a1_trans_state='0')
	</update>
	<!-- 
		기록물건에 대한 포맷변환 요청 - C.3.기록물건 상태 변경 (1:변환대기)
	 -->
	<update id="updatePresvFormatPdfRecordWaitRecord" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_RDRECORD A
		SET   A.pdf_a1_trans_state = '1'
		WHERE A.record_center_id = #recordCenterId:VARCHAR#
		AND   A.record_id = #recordId:VARCHAR#
        AND   A.erecord_flag = '1'
		AND  (A.pdf_a1_trans_state IS NULL OR A.pdf_a1_trans_state='0')
	</update>
	<!-- 
		기록물건에 대한 포맷변환 요청 - C.4.기록물철 상태 변경 (1:변환대기 or OTHER)
	 -->
	<update id="updatePresvFormatPdfRecordWaitFolder" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_RDFOLDER A
		SET   A.pdf_a1_trans_state = ( CASE WHEN A.erecord_flag='2' THEN '6'
											WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.erecord_flag='1' AND (B.pdf_a1_trans_state IS NULL OR B.pdf_a1_trans_state IN ('0','1','2','3','5'))) THEN '4'
											WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.erecord_flag='1' AND (B.pdf_a1_trans_state IS NULL OR B.pdf_a1_trans_state IN ('0','1','2','3'))) THEN '5'
											WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.erecord_flag='1' AND B.pdf_a1_trans_state IN ('1','2','3')) THEN '0'
											ELSE '1'
										END )
		<!--cubrid WHERE (A.record_center_id, A.folder_id)
		IN (
            SELECT record_center_id, folder_id-->
		WHERE 
		EXISTS (
            SELECT 1
            FROM  TB_RDRECORD
			WHERE record_center_id = #recordCenterId:VARCHAR#
			AND   record_id = #recordId:VARCHAR#
			<!--cubrid-->
			AND   record_center_id=A.record_center_id
			AND   folder_id = A.folder_id
		)
	</update>
	
	<!-- 
		: 기록물건에 대한 변환취소 처리 - D.포맷변환요청정보변경(E:취소) 
	 -->
	<update id="updatePresvFormatPdfRecordClearReqTrans" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_STREQTRANS Z
		SET   request_status = 'E'
			, request_start_time = SYSDATE
		<!--cubrid WHERE (record_center_id, folder_id, record_id)
		IN (
			SELECT B.record_center_id, B.folder_id, B.record_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM  TB_RDRECORD B
	        WHERE B.record_center_id = #recordCenterId:VARCHAR#
	        AND   B.record_id = #recordId:VARCHAR#
		<!--cubrid-->
		AND   B.record_center_id = Z.record_center_id
		AND   B.folder_id = Z.folder_id
		AND   B.record_id = Z.record_id
			<isEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.pdf_a1_trans_state IN ('0','1', '2', '3','5')
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.pdf_a1_trans_state IN ('1', '2', '3')
				</isNotEqual>
			</isEqual>
			<isNotEqual property="clearIngFlag" compareValue="1">
				<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
					B.pdf_a1_trans_state = '5'
				</isEqual>
				<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
					0 = 1
				</isNotEqual>
			</isNotEqual>
		)
		AND neo_gubun = '0'		
	</update>
	
	<!-- 
		기록물건에 대한 변환취소 처리 - E.1.원문파일 변환실패 내역 삭제
	 -->
	<delete id="updatePresvFormatPdfRecordClearWorkHist" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		DELETE FROM TB_STWORKHIST Z
		<!--cubrid WHERE (record_center_id, folder_id, record_id)
		IN (
			SELECT B.record_center_id, B.folder_id, B.record_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM  TB_RDRECORD B
	        WHERE B.record_center_id = #recordCenterId:VARCHAR#
	        AND   B.record_id = #recordId:VARCHAR#
		<!--cubrid-->
		AND   B.record_center_id = Z.record_center_id
		AND   B.folder_id = Z.folder_id
		AND   B.record_id = Z.record_id
		)
		AND   format_div_cd = '0'
		AND   (followup_div_cd IS NULL OR followup_div_cd IN ('0','1'))
	</delete>
	<!-- 
		기록물건에 대한 변환취소 처리 - E.2.원문파일 상태 변경 (0:미변환)
	 -->
	<update id="updatePresvFormatPdfRecordClearOrignFile" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_STORIGNFILE Z
		SET   pdf_a1_trans_state = '0'
		<!--cubrid WHERE (record_center_id, orign_id)
		IN (
			SELECT B.record_center_id, B.orign_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM  TB_RDRECORD B
	        WHERE B.record_center_id = #recordCenterId:VARCHAR#
	        AND   B.record_id = #recordId:VARCHAR#
		<!--cubrid-->
		AND   B.record_center_id = Z.record_center_id
		AND   B.orign_id = Z.orign_id
		)
		<isEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				pdf_a1_trans_state IN ('1', '2', '3','5')
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				pdf_a1_trans_state IN ('1', '2', '3')
			</isNotEqual>
		</isEqual>
		<isNotEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				pdf_a1_trans_state = '5'
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				0 = 1
			</isNotEqual>
		</isNotEqual>
	</update>
	<!-- 
		기록물건에 대한 변환취소 처리 - E.3.건원문 상태 변경 (0:미변환)
	 -->
	<update id="updatePresvFormatPdfRecordClearRecordOrign" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_STRECORDORIGN Z
		SET   pdf_a1_trans_state = '0'
		<!--cubrid WHERE (record_center_id, record_id)
		IN (
			SELECT B.record_center_id, B.record_id-->
		WHERE
		EXISTS (
			SELECT 1
			FROM  TB_RDRECORD B
	        WHERE B.record_center_id = #recordCenterId:VARCHAR#
	        AND   B.record_id = #recordId:VARCHAR#
		<!--cubrid-->
		AND   B.record_center_id = Z.record_center_id
    		AND   B.record_id = Z.record_id
		)
		<isEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				pdf_a1_trans_state IN ('1', '2', '3','5')
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				pdf_a1_trans_state IN ('1', '2', '3')
			</isNotEqual>
		</isEqual>
		<isNotEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				pdf_a1_trans_state = '5'
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				0 = 1
			</isNotEqual>
		</isNotEqual>
	</update>
	<!-- 
		기록물건에 대한 변환취소 처리 - E.4.기록물건 상태 변경 (0:미변환)
	 -->
	<update id="updatePresvFormatPdfRecordClearRecord" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_RDRECORD
		SET   pdf_a1_trans_state = '0'
        WHERE record_center_id = #recordCenterId:VARCHAR#
        AND   record_id = #recordId:VARCHAR#
		<isEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				pdf_a1_trans_state IN ('1', '2', '3', '5')
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				pdf_a1_trans_state IN ('1', '2', '3')
			</isNotEqual>
		</isEqual>
		<isNotEqual property="clearIngFlag" compareValue="1">
			<isEqual prepend="AND" property="clearFailFlag" compareValue="1">
				pdf_a1_trans_state = '5'
			</isEqual>
			<isNotEqual prepend="AND" property="clearFailFlag" compareValue="1">
				0 = 1
			</isNotEqual>
		</isNotEqual>
	</update>
	<!-- 
		기록물건에 대한 변환취소 처리 - E.5.기록물철 상태 변경 (0:미변환 or OTHER)
	 -->
	<update id="updatePresvFormatPdfRecordClearFolder" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_RDFOLDER A
		SET   A.pdf_a1_trans_state = ( CASE WHEN A.erecord_flag='2' THEN '6'
											WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.erecord_flag='1' AND (B.pdf_a1_trans_state IS NULL OR B.pdf_a1_trans_state IN ('0','1','2','3','5'))) THEN '4'
											WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.erecord_flag='1' AND (B.pdf_a1_trans_state IS NULL OR B.pdf_a1_trans_state IN ('0','1','2','3'))) THEN '5'
											WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.erecord_flag='1' AND B.pdf_a1_trans_state IN ('1','2','3')) THEN '0'
											ELSE '1' END )
		<!--cubrid WHERE (A.record_center_id, A.folder_id)
		IN (
			SELECT record_center_id, folder_id-->
		WHERE 
		EXISTS (
			SELECT 1
			FROM  TB_RDRECORD
	        WHERE record_center_id = #recordCenterId:VARCHAR#
	        AND   record_id = #recordId:VARCHAR#
		AND   record_center_id = A.record_center_id
		AND   folder_id = A.folder_id
		)
	</update>
	
	
	
	
	
	<!-- 
		문서보존포맷변환 : 변환실패 파일 후속조치 (후속조치이력 입력)
	 -->
	<update id="updatePresvFormatPdfFollowup" parameterClass="rms.presv.format.domain.PresvFormatPdfFailedMsg">
		UPDATE TB_STWORKHIST
		SET   followup_div_cd = #followupDivCd:VARCHAR#
			, followup_cause = #followupCause:VARCHAR#
			, followup_fin_flag = '1'
		WHERE record_center_id = #recordCenterId:VARCHAR#
		AND   work_hist_id = #workHistId:VARCHAR#
	</update>
	
	<!-- 
		문서보존포맷변환 : 변환실패 파일 후속조치 (후속조치 미반영 수량 조회)
	 -->
	<select id="countPresvFormatPdfFollowup" parameterClass="rms.presv.format.domain.PresvFormatPdfFailedMsg" resultClass="int">
		SELECT COUNT(1)
		FROM  TB_STWORKHIST Z
		<!--cubrid WHERE (record_center_id, folder_id, record_id)
		IN (
		    SELECT record_center_id, folder_id, record_id-->
		WHERE
		EXISTS (
		    SELECT 1
		    FROM  TB_STWORKHIST
		    WHERE record_center_id = #recordCenterId:VARCHAR#
		    AND   work_hist_id = #workHistId:VARCHAR#
		<!--cubrid-->
		    AND    record_center_id = Z.record_center_id
	 	    AND    folder_id = Z.folder_id
		    AND    record_id = Z.record_id
		)
		AND   format_div_cd = '0'
		AND   (followup_div_cd IS NULL OR followup_div_cd = '0')
	</select>
	
	<!-- 
		문서보존포맷변환 : 변환실패 파일 후속조치 (후속조치에 따른 재변환대상 기록물건 상태 변경) - 0.후속조치 완료여부 변경 
	 -->
	<update id="updatePresvFormatPdfFollowupWorkHist" parameterClass="rms.presv.format.domain.PresvFormatPdfFailedMsg">
		UPDATE TB_STWORKHIST
		SET   followup_fin_flag = '1'
	    WHERE record_center_id = #recordCenterId:VARCHAR#
	    AND   work_hist_id = #workHistId:VARCHAR#
	</update>
	<!-- 
		문서보존포맷변환 : 변환실패 파일 후속조치 (후속조치에 따른 재변환대상 기록물건 상태 변경) - 1.원문파일 변환상태 변경
	 -->
	<update id="updatePresvFormatPdfFollowupOrignFile" parameterClass="rms.presv.format.domain.PresvFormatPdfFailedMsg">
		UPDATE TB_STORIGNFILE Z
		SET  pdf_a1_trans_state
			 = (SELECT (CASE WHEN followup_div_cd='1' THEN '0' WHEN followup_div_cd='2' THEN '6' ELSE '5' END)
			    FROM TB_STWORKHIST
			    WHERE record_center_id = #recordCenterId:VARCHAR#
			    AND   work_hist_id = #workHistId:VARCHAR#)
		<!--cubrid WHERE (record_center_id, orign_file_id)
		IN (
		    SELECT record_center_id, orign_file_id-->
		WHERE
		EXISTS (
		    SELECT 1
		    FROM  TB_STWORKHIST
		    WHERE record_center_id = #recordCenterId:VARCHAR#
		    AND   work_hist_id = #workHistId:VARCHAR#
		<!--cubrid-->
		AND  record_center_id = Z.record_center_id
		AND  orign_file_id = Z.orign_file_id
		)
	</update>
	<!-- 
		문서보존포맷변환 : 변환실패 파일 후속조치 (후속조치에 따른 재변환대상 기록물건 상태 변경) - 2.건원문 변환상태 변경
	 -->
	<update id="updatePresvFormatPdfFollowupRecordOrign" parameterClass="rms.presv.format.domain.PresvFormatPdfFailedMsg">
		UPDATE TB_STRECORDORIGN A
		SET   A.pdf_a1_trans_state
				= (CASE WHEN (SELECT COUNT(1) FROM TB_STORIGNFILE B WHERE B.record_center_id=A.record_center_id AND B.orign_id=A.orign_id AND B.pdf_a1_trans_state='1')>0 THEN '1'
		                WHEN (SELECT COUNT(1) FROM TB_STORIGNFILE B WHERE B.record_center_id=A.record_center_id AND B.orign_id=A.orign_id AND B.pdf_a1_trans_state='2')>0 THEN '2'
		                WHEN (SELECT COUNT(1) FROM TB_STORIGNFILE B WHERE B.record_center_id=A.record_center_id AND B.orign_id=A.orign_id AND B.pdf_a1_trans_state='3')>0 THEN '3'
		                WHEN (SELECT COUNT(1) FROM TB_STORIGNFILE B WHERE B.record_center_id=A.record_center_id AND B.orign_id=A.orign_id AND B.pdf_a1_trans_state='0')>0 THEN '0'
		                WHEN (SELECT COUNT(1) FROM TB_STORIGNFILE B WHERE B.record_center_id=A.record_center_id AND B.orign_id=A.orign_id AND B.pdf_a1_trans_state='4')>0 THEN '4'
		                WHEN (SELECT COUNT(1) FROM TB_STORIGNFILE B WHERE B.record_center_id=A.record_center_id AND B.orign_id=A.orign_id AND B.pdf_a1_trans_state='6')>0 THEN '6'
		                ELSE '5'
		        	END)
		<!--cubrid WHERE (A.record_center_id, A.record_id)
		IN (
		    SELECT record_center_id, record_id-->
		WHERE 
		EXISTS (
		    SELECT 1
		    FROM  TB_STWORKHIST
		    WHERE record_center_id = #recordCenterId:VARCHAR#
		    AND   work_hist_id = #workHistId:VARCHAR#
		<!--cubrid-->
		AND record_center_id = A.record_center_id
		AND record_id = A.record_id
		)
	</update>
	<!-- 
		문서보존포맷변환 : 변환실패 파일 후속조치 (후속조치에 따른 재변환대상 기록물건 상태 변경) - 3.기록물건 변환상태 변경
	 -->
	<update id="updatePresvFormatPdfFollowupRecord" parameterClass="rms.presv.format.domain.PresvFormatPdfFailedMsg">
		UPDATE TB_RDRECORD A
		SET   A.pdf_a1_trans_state = (SELECT B.pdf_a1_trans_state FROM TB_STRECORDORIGN B WHERE B.record_center_id=A.record_center_id AND B.orign_id=A.orign_id)
		<!--cubrid WHERE (A.record_center_id, A.record_id)
		IN (
		    SELECT record_center_id, record_id-->
		WHERE
		EXISTS (
		    SELECT 1
		    FROM  TB_STWORKHIST
		    WHERE record_center_id = #recordCenterId:VARCHAR#
		    AND   work_hist_id = #workHistId:VARCHAR#
		<!--cubgrid-->
		AND record_center_id = A.record_center_id
		AND record_id = A.record_id
		)
	</update>
	<!-- 
		문서보존포맷변환 : 변환실패 파일 후속조치 (후속조치에 따른 재변환대상 기록물건 상태 변경) - 4.기록물철 변환상태 변경
	 -->
	<update id="updatePresvFormatPdfFollowupFolder" parameterClass="rms.presv.format.domain.PresvFormatPdfFailedMsg">
		UPDATE TB_RDFOLDER A
		SET   A.pdf_a1_trans_state = ( CASE WHEN A.erecord_flag='2' THEN '6'
											WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.erecord_flag='1' AND (B.pdf_a1_trans_state IS NULL OR B.pdf_a1_trans_state IN ('0','1','2','3','5'))) THEN '4'
											WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.erecord_flag='1' AND (B.pdf_a1_trans_state IS NULL OR B.pdf_a1_trans_state IN ('0','1','2','3'))) THEN '5'
											WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.erecord_flag='1' AND B.pdf_a1_trans_state IN ('1','2','3')) THEN '0'
											ELSE '1' END )
		<!--cubrid WHERE (A.record_center_id, A.folder_id)
		IN (
			SELECT record_center_id, folder_id-->
		WHERE
		EXISTS (
			SELECT 1
		    FROM  TB_STWORKHIST
		    WHERE record_center_id = #recordCenterId:VARCHAR#
		    AND   work_hist_id = #workHistId:VARCHAR#
		<!--cubrid-->
		AND record_center_id = A.record_center_id
		AND folder_id = A.folder_id
		)
	</update>
	
	<!-- 
		문서보존포맷변환 : 변환실패 파일 후속조치 (재변환 대상의 수량 확인)
	 -->
	<select id="countPresvFormatPdfFollowupRetry" parameterClass="rms.presv.format.domain.PresvFormatPdfFailedMsg" resultClass="int">
		SELECT COUNT(1)
		FROM TB_STWORKHIST a
		<!--cubrid WHERE (record_center_id, folder_id, record_id)
		IN (
		    SELECT record_center_id, folder_id, record_id-->
		WHERE
		EXISTS (
		    SELECT 1
		    FROM TB_STWORKHIST
		    WHERE record_center_id = #recordCenterId:VARCHAR#
		    AND   work_hist_id = #workHistId:VARCHAR#
		<!--cubrid-->
		AND record_center_id = A.record_center_id
		AND folder_id = A.folder_id
		AND record_id = A.record_id	
		)
		AND   format_div_cd = '0'
		AND   followup_div_cd = '1'
	</select>
	
	<!-- 
		문서보존포맷변환 : 변환실패 파일 후속조치 (재변환 대상 JOBID)
	 -->
	<select id="findPresvFormatPdfFollowupFialJobid" parameterClass="rms.presv.format.domain.PresvFormatPdf" resultClass="string">
		SELECT MAX(job_id) AS job_id
		FROM  TB_STREQTRANS
		WHERE record_center_id = #recordCenterId:VARCHAR#
		AND   record_id = #recordId:VARCHAR#
		AND   request_status = 'D'	     
	</select>
	
	<!-- 
		문서보존포맷변환 : 변환실패 파일 후속조치 (기록물건에 대한 포맷변환 요청)
	 -->
	<update id="updatePresvFormatPdfRecordQueue" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_STREQTRANS
		SET   request_status = '-'
			, wflb_server_ip = ''
			, reflection_flag = ''
		WHERE job_id = #jobGroupId:VARCHAR#
	</update>
	
	<!-- 
		문서보존포맷변환 : 포맷변환 요청 - 1.원문파일 상태 변경 (1:변환대기)
	 -->
	<update id="updatePresvFormatPdfWaitOrignFile" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_STORIGNFILE A
		SET   A.pdf_a1_trans_state = '1'
		<!--cubrid WHERE (A.record_center_id, A.orign_id)
	 	IN (
		    SELECT record_center_id, orign_id-->
		WHERE
	 	EXISTS (
		    SELECT 1
		    FROM  TB_RDRECORD Z
		    <!--cubrid WHERE (record_center_id, record_id)
		    IN (
	            	SELECT record_center_id, record_id-->
		    WHERE
		    EXISTS (
	            	SELECT 1
	           	 FROM  TB_STREQTRANS 
	            	WHERE job_id = #jobGroupId:VARCHAR#
			<!--cubrid-->
			AND record_center_id = Z.record_center_id
			AND record_id = Z.record_id
		    	)
		)
		AND (A.pdf_a1_trans_state IS NULL OR A.pdf_a1_trans_state='0')
		<!--cubrid-->
		AND record_center_id = A.record_center_id
		AND orign_id = A.orign_id
	</update>
	<!-- 
		문서보존포맷변환 : 포맷변환 요청 - 2.건원문 상태 변경 (1:변환대기 or 6:변환불가)
	 -->
	<update id="updatePresvFormatPdfWaitRecordOrign" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_STRECORDORIGN A
		SET   A.pdf_a1_trans_state = (CASE WHEN A.erecord_flag='2' THEN '6' ELSE '1' END)
		WHERE (A.record_center_id, A.record_id)
		= (
            SELECT record_center_id, record_id
            FROM  TB_STREQTRANS
            WHERE job_id = #jobGroupId:VARCHAR#
		)
		AND (A.pdf_a1_trans_state IS NULL OR A.pdf_a1_trans_state='0')
	</update>
	
	<!-- 
		문서보존포맷변환 : 포맷변환 요청 - 3.기록물건 상태 변경 (1:변환대기 or 6:변환불가)
	 -->
	<update id="updatePresvFormatPdfWaitRecord" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_RDRECORD A
		SET   A.pdf_a1_trans_state = (CASE WHEN A.erecord_flag='2' THEN '6' ELSE '1' END)
			, A.pdf_job_id = #jobGroupId:VARCHAR#
		WHERE (A.record_center_id, A.record_id)
		= (
            SELECT record_center_id, record_id
            FROM  TB_STREQTRANS
            WHERE job_id = #jobGroupId:VARCHAR#
		)
		AND (A.pdf_a1_trans_state IS NULL OR A.pdf_a1_trans_state='0')
	</update>
	
	<!-- 
		문서보존포맷변환 : 포맷변환 요청 - 4.기록물철 상태 변경 (1:변환대기 or OTHER)
	 -->
	<update id="updatePresvFormatPdfWaitFolder" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		UPDATE TB_RDFOLDER A
		SET   A.pdf_a1_trans_state = ( CASE WHEN A.erecord_flag='2' THEN '6'
											WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.erecord_flag='1' AND (B.pdf_a1_trans_state IS NULL OR B.pdf_a1_trans_state IN ('0','1','2','3','5'))) THEN '4'
											WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.erecord_flag='1' AND (B.pdf_a1_trans_state IS NULL OR B.pdf_a1_trans_state IN ('0','1','2','3'))) THEN '5'
											WHEN NOT EXISTS (SELECT 1 FROM TB_RDRECORD B WHERE B.record_center_id=A.record_center_id AND B.folder_id=A.folder_id AND B.erecord_flag='1' AND B.pdf_a1_trans_state IN ('1','2','3')) THEN '0'
											ELSE '1'
										END )
		<!--cubrid WHERE (A.record_center_id, A.folder_id)
		IN (
            SELECT record_center_id, FOLDER_id-->
		WHERE 
		EXISTS (
            SELECT 1
            FROM  TB_STREQTRANS
            WHERE job_id = #jobGroupId:VARCHAR#
	<!--cubrid-->
	    AND record_center_id = A.record_center_id
	    AND FOLDER_id = A.folder_id
		)
	</update>
	<!-- 
		변환재요청시 TB_STREQFILE 테이블 초기화
	 -->
	<delete id="deletePresvFormatPdfOtherFile" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		DELETE FROM TB_STREQFILE
		WHERE record_center_id = #recordCenterId:VARCHAR#
		AND   job_id = #jobGroupId:VARCHAR#
	</delete>
	<!-- 
		변환재요청시 TB_STREQRESULT 테이블 초기화
	 -->
	<delete id="deletePresvFormatPdfOtherResult" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		DELETE FROM TB_STREQRESULT
		WHERE record_center_id = #recordCenterId:VARCHAR#
		AND   job_id = #jobGroupId:VARCHAR#
	</delete>
	
	<!-- 
		변환재요청시 TB_STWORKHIST 테이블 초기화
	 -->
	 <delete id="deletePresvFormatPdfOtherWorkHist" parameterClass="rms.presv.format.domain.PresvFormatPdf">
		DELETE FROM TB_STWORKHIST
		WHERE record_center_id = #recordCenterId:VARCHAR#
		AND   record_id = #recordId:VARCHAR#
		AND FORMAT_DIV_CD    = '0'
		AND (FOLLOWUP_DIV_CD IS NULL OR FOLLOWUP_DIV_CD  IN ('0','1'))
	</delete>
</sqlMap>
