<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="presv.optidiskmst">
	
	<!-- 
		광디스크수록_대상현황
		: 광디스크수록대상현황을 조회한다.
	 -->
	<resultMap id="findOptidiskMstTrgtStatPagedList-result" class="rms.presv.optidiskmst.domain.OptidiskMstTrgt">
		<result property="creatYyyy" 		column="creat_yyyy" 		nullValue=""  />
		<result property="eleTrgtCnt" 		column="ele_trgt_cnt" 		nullValue="0" />
		<result property="eleChoiceCnt" 	column="ele_choice_cnt" 	nullValue="0" />
		<result property="eleYesCnt" 		column="ele_yes_cnt" 		nullValue="0" />
		<result property="eleNoCnt" 		column="ele_no_cnt" 		nullValue="0" />
		<result property="neoTrgtCnt" 		column="neo_trgt_cnt" 		nullValue="0" />
		<result property="neoChoiceCnt" 	column="neo_choice_cnt" 	nullValue="0" />
		<result property="neoYesCnt" 		column="neo_yes_cnt" 		nullValue="0" />
		<result property="neoNoCnt" 		column="neo_no_cnt" 		nullValue="0" />
		<result property="scanTrgtCnt" 		column="scan_trgt_cnt" 		nullValue="0" />
		<result property="scanChoiceCnt"	column="scan_choice_cnt" 	nullValue="0" />
		<result property="scanYesCnt" 		column="scan_yes_cnt" 		nullValue="0" />
		<result property="scanNoCnt" 		column="scan_no_cnt" 		nullValue="0" />
	</resultMap>
	<select id="countOptidiskMstTrgtStatPagedList" parameterClass="rms.presv.optidiskmst.domain.OptidiskMstTrgt" resultClass="java.lang.Long">
		SELECT COUNT(1)
        FROM (
            select  t.creat_yyyy, 
                    (select count(*) from tb_rdfolder where record_center_id = t.record_center_id and creat_yyyy = t.creat_yyyy and erecord_flag in ('1', '3')) as ele_trgt_cnt,
                    (select count(*) from tb_rdfolder where record_center_id = t.record_center_id and creat_yyyy = t.creat_yyyy and erecord_flag in ('1', '3') and opti_disk_store_state_cd in ('1', '2', '3', '4', '5')) as ele_choice_cnt,
                    (select count(*) from tb_rdfolder where record_center_id = t.record_center_id and creat_yyyy = t.creat_yyyy and erecord_flag in ('1', '3') and opti_disk_store_state_cd in ('4', '5')) as ele_yes_cnt,
                    (select count(*) from tb_rdfolder where record_center_id = t.record_center_id and creat_yyyy = t.creat_yyyy and erecord_flag in ('1', '3') and opti_disk_store_state_cd in ('1', '2', '3')) as ele_no_cnt,
                    (select count(*) from tb_rdfolder where record_center_id = t.record_center_id and creat_yyyy = t.creat_yyyy and neo_trans_state = '4' and record_neo_trans_state = '4') as neo_trgt_cnt,
                    (select count(*) from tb_rdfolder where record_center_id = t.record_center_id and creat_yyyy = t.creat_yyyy and neo_trans_state = '4' and record_neo_trans_state = '4' and opti_disk_neo_store_state_cd in ('1', '2', '3', '4', '5')) as neo_choice_cnt,
                    (select count(*) from tb_rdfolder where record_center_id = t.record_center_id and creat_yyyy = t.creat_yyyy and neo_trans_state = '4' and record_neo_trans_state = '4' and opti_disk_neo_store_state_cd in ('4', '5')) as neo_yes_cnt,
                    (select count(*) from tb_rdfolder where record_center_id = t.record_center_id and creat_yyyy = t.creat_yyyy and neo_trans_state = '4' and record_neo_trans_state = '4' and opti_disk_neo_store_state_cd in ('1', '2', '3')) as neo_no_cnt,
                    (select count(*) from tb_rdfolder where record_center_id = t.record_center_id and creat_yyyy = t.creat_yyyy and erecord_flag in ('2', '3') and scan_prog_state_cd = '5') as scan_trgt_cnt,
                    (select count(*) from tb_rdfolder where record_center_id = t.record_center_id and creat_yyyy = t.creat_yyyy and erecord_flag in ('2', '3') and scan_prog_state_cd = '5' and opti_disk_scn_store_state_cd in ('1', '2', '3', '4', '5')) as scan_choice_cnt,
                    (select count(*) from tb_rdfolder where record_center_id = t.record_center_id and creat_yyyy = t.creat_yyyy and erecord_flag in ('2', '3') and scan_prog_state_cd = '5' and opti_disk_scn_store_state_cd in ('4', '5')) as scan_yes_cnt,
                    (select count(*) from tb_rdfolder where record_center_id = t.record_center_id and creat_yyyy = t.creat_yyyy and erecord_flag in ('2', '3') and scan_prog_state_cd = '5' and opti_disk_scn_store_state_cd in ('1', '2', '3')) as scan_no_cnt
            from    (
                      select  distinct creat_yyyy, #recordCenterId:VARCHAR# as record_center_id
                      from    tb_rdfolder
                      where   record_center_id = #recordCenterId:VARCHAR#
                      and     creat_yyyy between #creatYyyyS:VARCHAR# and #creatYyyyE:VARCHAR#
                      and 	  folder_keep_state_cd in ('01', '04')
                      order by creat_yyyy desc
            ) t
        ) C
	</select>
	<select id="findOptidiskMstTrgtStatPagedList" parameterClass="rms.presv.optidiskmst.domain.OptidiskMstTrgt" resultMap="findOptidiskMstTrgtStatPagedList-result">
		SELECT E.*
		FROM (
		    SELECT D.*
		    FROM (
		        SELECT ROWNUM AS rnum
		                   ,C.*
		        FROM (
		            select  t.creat_yyyy, 
		                    (select count(*) from tb_rdfolder where record_center_id = t.record_center_id and creat_yyyy = t.creat_yyyy and erecord_flag in ('1', '3')) as ele_trgt_cnt,
		                    (select count(*) from tb_rdfolder where record_center_id = t.record_center_id and creat_yyyy = t.creat_yyyy and erecord_flag in ('1', '3') and opti_disk_store_state_cd in ('1', '2', '3', '4', '5')) as ele_choice_cnt,
		                    (select count(*) from tb_rdfolder where record_center_id = t.record_center_id and creat_yyyy = t.creat_yyyy and erecord_flag in ('1', '3') and opti_disk_store_state_cd in ('4', '5')) as ele_yes_cnt,
		                    (select count(*) from tb_rdfolder where record_center_id = t.record_center_id and creat_yyyy = t.creat_yyyy and erecord_flag in ('1', '3') and opti_disk_store_state_cd in ('1', '2', '3')) as ele_no_cnt,
		                    (select count(*) from tb_rdfolder where record_center_id = t.record_center_id and creat_yyyy = t.creat_yyyy and neo_trans_state = '4' and record_neo_trans_state = '4') as neo_trgt_cnt,
		                    (select count(*) from tb_rdfolder where record_center_id = t.record_center_id and creat_yyyy = t.creat_yyyy and neo_trans_state = '4' and record_neo_trans_state = '4' and opti_disk_neo_store_state_cd in ('1', '2', '3', '4', '5')) as neo_choice_cnt,
		                    (select count(*) from tb_rdfolder where record_center_id = t.record_center_id and creat_yyyy = t.creat_yyyy and neo_trans_state = '4' and record_neo_trans_state = '4' and opti_disk_neo_store_state_cd in ('4', '5')) as neo_yes_cnt,
		                    (select count(*) from tb_rdfolder where record_center_id = t.record_center_id and creat_yyyy = t.creat_yyyy and neo_trans_state = '4' and record_neo_trans_state = '4' and opti_disk_neo_store_state_cd in ('1', '2', '3')) as neo_no_cnt,
		                    (select count(*) from tb_rdfolder where record_center_id = t.record_center_id and creat_yyyy = t.creat_yyyy and erecord_flag in ('2', '3') and scan_prog_state_cd = '5') as scan_trgt_cnt,
		                    (select count(*) from tb_rdfolder where record_center_id = t.record_center_id and creat_yyyy = t.creat_yyyy and erecord_flag in ('2', '3') and scan_prog_state_cd = '5' and opti_disk_scn_store_state_cd in ('1', '2', '3', '4', '5')) as scan_choice_cnt,
		                    (select count(*) from tb_rdfolder where record_center_id = t.record_center_id and creat_yyyy = t.creat_yyyy and erecord_flag in ('2', '3') and scan_prog_state_cd = '5' and opti_disk_scn_store_state_cd in ('4', '5')) as scan_yes_cnt,
		                    (select count(*) from tb_rdfolder where record_center_id = t.record_center_id and creat_yyyy = t.creat_yyyy and erecord_flag in ('2', '3') and scan_prog_state_cd = '5' and opti_disk_scn_store_state_cd in ('1', '2', '3')) as scan_no_cnt
		            from    (
		                      select  distinct creat_yyyy, #recordCenterId:VARCHAR# as record_center_id
		                      from    tb_rdfolder
		                      where   record_center_id = #recordCenterId:VARCHAR#
		                      and     creat_yyyy between #creatYyyyS:VARCHAR# and #creatYyyyE:VARCHAR#
		                      and 	  folder_keep_state_cd in ('01', '04')
		                      order by creat_yyyy desc
		            ) t
		        ) C
		        WHERE ROWNUM <![CDATA[<=]]> #pagedEnd:NUMBER#
		    ) D
		    WHERE D.rnum <![CDATA[>=]]> #pagedStart:NUMBER#
		) E
		ORDER BY E.rnum
	</select>
	
	<!-- 
		광디스크수록_계획수립
		: 계획수립 목록을 조회한다.
	 -->
	<resultMap id="findOptidiskMstPagedList-result" class="rms.presv.optidiskmst.domain.OptidiskMst">
		<result property="optidiskId"	 	column="optidisk_id" 			nullValue="" 	/>
		<result property="orgCd" 			column="org_cd" 				nullValue="" 	/>
		<result property="storeSize" 		column="store_size" 			nullValue="" 	/>
		<result property="optidiskSize" 	column="optidisk_size" 			nullValue="" 	/>
		<result property="seq" 				column="seq" 					nullValue="0" 	/>
		<result property="seqNm" 			column="seq_nm"					nullValue="" 	/>
		<result property="splitTot" 		column="split_tot" 				nullValue="0" 	/>
		<result property="splitCnt" 		column="split_cnt" 				nullValue="0" 	/>
		<result property="optidiskStateCd" 	column="optidisk_state_cd" 		nullValue="" 	/>
		<result property="optidiskTypeCd" 	column="optidisk_type_cd" 		nullValue="" 	/>
		<result property="optidiskYyyy" 	column="optidisk_yyyy"	 		nullValue="" 	/>
		<result property="creatYyyy" 		column="creat_yyyy"	 			nullValue="" 	/>
		<result property="presvTermCd" 		column="presv_term_cd" 			nullValue="" 	/>
		<result property="storePlanYmd" 	column="store_plan_ymd"			nullValue="" 	/>
		<result property="scheduleSeq" 		column="schedule_seq"			nullValue="0" 	/>
	</resultMap>
	<select id="countOptidiskMstPagedList" parameterClass="rms.presv.optidiskmst.domain.OptidiskMst" resultClass="java.lang.Long">
		SELECT COUNT(1)  
        FROM    tb_sroptidisk_mst A
        WHERE   A.record_center_id = #recordCenterId:VARCHAR#
        <isNotEmpty property="optidiskYyyy" prepend="AND">
            A.optidisk_yyyy = #optidiskYyyy:VARCHAR#
        </isNotEmpty>
        <isNotEmpty property="optidiskStateCd" prepend="AND">
            A.optidisk_state_cd = #optidiskStateCd:VARCHAR#
        </isNotEmpty>
        <isNotEmpty property="optidiskTypeCd" prepend="AND">
            A.optidisk_type_cd = #optidiskTypeCd:VARCHAR#
        </isNotEmpty>
        <isNotEmpty property="creatYyyy" prepend="AND">
            A.creat_yyyy = #creatYyyy:VARCHAR#
        </isNotEmpty>
	</select>
	<select id="findOptidiskMstPagedList" parameterClass="rms.presv.optidiskmst.domain.OptidiskMst" resultMap="findOptidiskMstPagedList-result">
		SELECT D.org_cd
		      ,D.seq
		      ,D.store_size
		      ,D.optidisk_size
		      ,D.split_tot
		      ,D.optidisk_state_cd
		      ,D.optidisk_type_cd
		      ,D.optidisk_yyyy
		      ,D.creat_yyyy
		      ,D.presv_term_cd
		      ,D.store_plan_ymd
		      ,D.optidisk_id
		      ,D.schedule_seq, LPAD(D.seq, 6, '0') seq_nm
		      ,(CASE WHEN ((select count(*) from tb_sroptidisk_fld where record_center_id = D.record_center_id and org_cd = D.org_cd and seq = D.seq)=0) 
		             THEN (select count(*) from tb_sroptihist_fld where record_center_id = D.record_center_id and optidisk_id = D.optidisk_id)
		             ELSE (select count(*) from tb_sroptidisk_fld where record_center_id = D.record_center_id and org_cd = D.org_cd and seq = D.seq)
		        END) as split_cnt
		FROM (
		    SELECT C.*
		    FROM (
		        SELECT ROWNUM AS rnum
		                ,B.*
		        FROM (
		            SELECT A.*  
		            FROM    tb_sroptidisk_mst A
		            WHERE   A.record_center_id = #recordCenterId:VARCHAR#
		            <isNotEmpty property="optidiskYyyy" prepend="AND">
		                A.optidisk_yyyy = #optidiskYyyy:VARCHAR#
		            </isNotEmpty>
		            <isNotEmpty property="optidiskStateCd" prepend="AND">
		                A.optidisk_state_cd = #optidiskStateCd:VARCHAR#
		            </isNotEmpty>
		            <isNotEmpty property="optidiskTypeCd" prepend="AND">
		                A.optidisk_type_cd = #optidiskTypeCd:VARCHAR#
		            </isNotEmpty>
		            <isNotEmpty property="creatYyyy" prepend="AND">
		                A.creat_yyyy = #creatYyyy:VARCHAR#
		            </isNotEmpty>
		            ORDER BY A.store_plan_ymd DESC
		        ) B
		        WHERE ROWNUM <![CDATA[<=]]> #pagedEnd:NUMBER#
		    ) C
		    WHERE C.rnum <![CDATA[>=]]> #pagedStart:NUMBER#
		) D
		ORDER BY D.rnum
	</select>
	
	<!-- 
		광디스크수록_계획생성
		: 광디스크수록대상 기록물철 목록을 조회한다.	
	 -->
	<resultMap id="findOptidiskFldList-result" class="rms.presv.optidiskmst.domain.OptidiskFld">
		<result property="recordCenterId" 	column="record_center_id"	nullValue=""  />
		<result property="folderId" 		column="folder_id"			nullValue=""  />
		<result property="orgCd" 			column="org_cd"				nullValue=""  />
		<result property="presvTermCd" 		column="presv_term_cd"		nullValue=""  />
		<result property="creatYyyy" 		column="creat_yyyy"			nullValue=""  />
		<result property="optidiskTypeCd"	column="optidisk_type_cd"	nullValue=""  />
		<result property="seq" 				column="seq"				nullValue="0" />
		<result property="storeSize" 		column="store_size"			nullValue=""  />
		<result property="recordCnt" 		column="record_cnt"			nullValue="0" />
	</resultMap>
	<select id="findOptidiskFldList" parameterClass="rms.presv.optidiskmst.domain.OptidiskMst" resultMap="findOptidiskFldList-result">
		<isEqual property="mediaDiv" compareValue="1">
			SELECT record_center_id
				  ,optidisk_type_cd
				  ,folder_id
				  ,store_size
				  ,org_cd
				  ,seq
				  ,creat_yyyy
				  ,presv_term_cd
				  ,record_cnt
			FROM tb_sroptidisk_fld
			WHERE record_center_id = #recordCenterId:VARCHAR#
			AND org_cd = #orgCd:VARCHAR#
			AND seq = #seq#
			<isNotEmpty property="presvTermCd" prepend="AND">
				presv_term_cd = #presvTermCd:VARCHAR#
			</isNotEmpty>
			<isNotEmpty property="creatYyyy" prepend="AND">
				creat_yyyy = #creatYyyy#
			</isNotEmpty>
			ORDER BY to_number(store_size) ASC
		</isEqual>
		<isEqual property="mediaDiv" compareValue="2">
			SELECT record_center_id
				  ,pic_sno as seq
				  ,folder_id
				  ,'' as optidisk_type_cd
				  ,'' as store_size
				  ,'' as org_cd
				  ,'' as creat_yyyy
				  ,'' as presv_term_cd
				  ,'' as record_cnt
			FROM tb_srmfpicdetl
			WHERE record_center_id = #recordCenterId:VARCHAR#
			AND pic_sno = #seq#
			GROUP BY record_center_id, pic_sno, folder_id
			ORDER BY folder_id
		</isEqual>
	</select> 
	
	<!-- 
		광디스크수록_계획생성
		: 광디스크수록대상 기록물철별 건 목록을 조회한다.
	 -->
	<resultMap id="findOptidiskRcdList-result" class="rms.presv.optidiskmst.domain.OptidiskRcd">
		<result property="recordCenterId" 	column="record_center_id"	nullValue=""  />
		<result property="optidiskTypeCd"	column="optidisk_type_cd"	nullValue=""  />
		<result property="folderId" 		column="folder_id"			nullValue=""  />
		<result property="recordId" 		column="record_id"			nullValue=""  />
		<result property="recordDiscern" 	column="record_discern"		nullValue=""  />
		<result property="storeSize" 		column="store_size"			nullValue=""  />
		<result property="orgCd" 			column="org_cd"				nullValue=""  />
		<result property="splitSeq"			column="split_seq"			nullValue="0" />
		<result property="seq" 				column="seq"				nullValue="0" />
		<result property="fileCnt"	 		column="file_cnt"				nullValue="0" />
		<result property="mediaDiv"	 		column="media_div"			nullValue="0" />
	</resultMap>
	<select id="findOptidiskRcdList" parameterClass="rms.presv.optidiskmst.domain.OptidiskFld" resultMap="findOptidiskRcdList-result">
		<isEqual property="mediaDiv" compareValue="1">
			SELECT	record_center_id
				   ,optidisk_type_cd
				   ,folder_id
				   ,record_id
				   ,record_discern
				   ,store_size
				   ,org_cd
				   ,split_seq
				   ,seq
				   ,file_cnt
				   ,'1' as media_div
			FROM tb_sroptidisk_rcd
			WHERE record_center_id = #recordCenterId:VARCHAR#
			AND folder_id = #folderId:VARCHAR#
			AND optidisk_type_cd = #optidiskTypeCd:VARCHAR#
		</isEqual>
		<isEqual property="mediaDiv" compareValue="2">
			SELECT	 record_center_id
					,'' as optidisk_type_cd
					,folder_id
					,record_id
					,'' as record_discern
					,'' as store_size
					,'' as org_cd
					,'' as split_seq
					,pic_sno as seq
					,'' as file_cnt
					,'2' as media_div
			FROM tb_srmfpicdetl
			WHERE record_center_id = #recordCenterId:VARCHAR#
			AND folder_id = #folderId:VARCHAR#
		</isEqual>
	</select>
	
	<!-- 
		광디스크수록_계획생성
		: 생산부서별 연번 최대값을 조회한다.
	 -->
	<select id="getOptidiskMstMaxSeq" parameterClass="rms.presv.optidiskmst.domain.OptidiskMst" resultClass="int">
		SELECT	nvl(MAX(seq), 0)+1 as seq
		FROM	tb_sroptidisk_mst
		WHERE	record_center_id = #recordCenterId:VARCHAR#
		AND		org_cd = #orgCd:VARCHAR#
	</select>
	
	<insert id="createOptidiskMstInfo" parameterClass="rms.presv.optidiskmst.domain.OptidiskMst">
		INSERT	INTO	tb_sroptidisk_mst (record_center_id, org_cd, seq, split_tot, optidisk_yyyy, optidisk_type_cd, creat_yyyy, presv_term_cd, booksf_arng_flag, optidisk_state_cd, optidisk_size, store_plan_ymd, split_cnt)
		VALUES	(#recordCenterId:VARCHAR#, #orgCd:VARCHAR#, #seq#, #splitTot:VARCHAR#, #optidiskYyyy:VARCHAR#, #optidiskTypeCd:VARCHAR#, #creatYyyy:VARCHAR#, #presvTermCd:VARCHAR#, '0', #optidiskStateCd:VARCHAR#, #optidiskSize:VARCHAR#, to_char(sysdate, 'yyyyMMdd')
		     		,(SELECT COUNT(FOLDER_ID)
        			FROM TB_SROPTIDISK_FLD
        			WHERE RECORD_CENTER_ID = #recordCenterId:VARCHAR#
        			AND ORG_CD                   = #orgCd:VARCHAR#
        			AND CREAT_YYYY              = #creatYyyy:VARCHAR#
          			AND PRESV_TERM_CD         = #presvTermCd:VARCHAR#
          			AND OPTIDISK_TYPE_CD      = #optidiskTypeCd:VARCHAR#
          			AND SEQ                        = 0))
	</insert>
	
	<update id="updateOptidiskFldInfo" parameterClass="rms.presv.optidiskmst.domain.OptidiskFld">
		UPDATE	tb_sroptidisk_fld
		SET		seq = #seq#
		WHERE	record_center_id = #recordCenterId:VARCHAR#
		AND		folder_id = #folderId:VARCHAR#
		AND		org_cd = #orgCd:VARCHAR#
		AND		optidisk_type_cd = #optidiskTypeCd:VARCHAR#
		AND		creat_yyyy = #creatYyyy:VARCHAR#
		AND		presv_term_cd = #presvTermCd:VARCHAR#
	</update>
	
	
	<!-- 
		광디스크수록_계획수립
		: 광디스크 수록 / 수록대상정리시 철 정보 업데이트 
	-->
	<update id="updateRdFolderInfo" parameterClass="rms.presv.optidiskmst.domain.OptidiskFld">
		UPDATE	tb_rdfolder
			<isEqual prepend="SET" property="mediaDiv" compareValue="1">
				<isNotEmpty property="optidiskTypeCd">
					<isEqual property="optidiskTypeCd" compareValue="1">
						opti_disk_store_state_cd = #optidiskStoreStateCd:VARCHAR#	
					</isEqual>
					<isEqual property="optidiskTypeCd" compareValue="2">
						opti_disk_neo_store_state_cd = #optidiskStoreStateCd:VARCHAR#
					</isEqual>
					<isEqual property="optidiskTypeCd" compareValue="3">
						opti_disk_scn_store_state_cd = #optidiskStoreStateCd:VARCHAR#
					</isEqual>
				</isNotEmpty>
			    <isEmpty property="optidiskTypeCd">
					 opti_disk_store_state_cd = #optidiskStoreStateCd:VARCHAR#
					,opti_disk_neo_store_state_cd = #optidiskStoreStateCd:VARCHAR#
					,opti_disk_scn_store_state_cd = #optidiskStoreStateCd:VARCHAR#
				</isEmpty>
			</isEqual>
			<isEqual property="mediaDiv" compareValue="2">
				SET MEDIUM = '', MF_PIC_STATE_CD = ''
			</isEqual>
		WHERE	record_center_id = #recordCenterId:VARCHAR#
		AND		folder_id = #folderId:VARCHAR#
	</update>
	
	<!-- 
		광디스크수록_계획수립
		: 
	 -->
	<update id="updateOptidiskRcdInfo" parameterClass="rms.presv.optidiskmst.domain.OptidiskRcd">
		UPDATE	tb_sroptidisk_rcd
		SET		seq = #seq#,
				split_seq = #splitSeq#
		WHERE	record_center_id = #recordCenterId:VARCHAR#
		AND		folder_id = #folderId:VARCHAR#
		AND		record_id = #recordId:VARCHAR#
		AND		org_cd = #orgCd:VARCHAR#
		AND		optidisk_type_cd = #optidiskTypeCd:VARCHAR#
	</update>
	
	<!-- 
		광디스크수록_계획수립
		: 
	 -->
	<update id="updateOptidiskMstStoreSize" parameterClass="rms.presv.optidiskmst.domain.OptidiskMst">
		UPDATE	tb_sroptidisk_mst
		SET		store_size = (SELECT SUM(store_size) FROM tb_sroptidisk_rcd WHERE record_center_id = #recordCenterId:VARCHAR# AND org_cd = #orgCd:VARCHAR# AND seq = #seq#)
		WHERE	record_center_id = #recordCenterId:VARCHAR#
		AND		org_cd = #orgCd:VARCHAR#
		AND		seq = #seq#
	</update>
	
	<!-- 
		광디스크수록_수록파일생성
		: 수록파일생성 목록을 조회한다.
	 -->
	<resultMap id="findOptidiskMstTrgtPagedList-result" class="rms.presv.optidiskmst.domain.OptidiskFld">
		<result property="recordCenterId" 	column="record_center_id"	nullValue=""  />
		<result property="orgCd" 			column="org_cd"				nullValue=""  />
		<result property="orgNm" 			column="org_nm"				nullValue=""  />
		<result property="orgAbbrNm"		column="org_abbr_nm"		nullValue=""  />
		<result property="presvTermCd" 		column="presv_term_cd"		nullValue=""  />
		<result property="presvTermNm" 		column="presv_term_nm"		nullValue=""  />
		<result property="creatYyyy" 		column="creat_yyyy"			nullValue=""  />
		<result property="optidiskTypeCd"	column="optidisk_type_cd"	nullValue=""  />
		<result property="total" 			column="total"				nullValue="0" />
		<result property="storeSize" 		column="store_size"			nullValue=""  />
		<result property="choiceCnt" 		column="choice_cnt"			nullValue="0" />
	</resultMap>
	<select id="countOptidiskMstTrgtPagedList" parameterClass="rms.presv.optidiskmst.domain.OptidiskFld" resultClass="java.lang.Long">
		SELECT COUNT(1)
        FROM    (
             SELECT o.record_center_id, o.org_cd, o.presv_term_cd, o.creat_yyyy, count(*) as total, sum(o.store_size) as store_size, o.optidisk_type_cd
             FROM tb_sroptidisk_fld o
             WHERE o.record_center_id = #recordCenterId:VARCHAR#
             <isNotEmpty property="presvTermCd" prepend="AND">
             	 o.presv_term_cd = #presvTermCd:VARCHAR#
             </isNotEmpty>
             <isNotEmpty property="orgCd" prepend="AND">
                 o.org_cd = #orgCd:VARCHAR#
             </isNotEmpty>
             <isNotEmpty property="creatYyyyS">
                 <isNotEmpty property="creatYyyyE">
                 	AND    creat_yyyy BETWEEN #creatYyyyS:VARCHAR# AND #creatYyyyE:VARCHAR#
                 </isNotEmpty>
             </isNotEmpty>
             <isNotEmpty property="optidiskTypeCd" prepend="AND">
                 o.optidisk_type_cd = #optidiskTypeCd:VARCHAR#
             </isNotEmpty>
             GROUP BY o.record_center_id, o.org_cd, o.presv_term_cd, o.creat_yyyy, o.optidisk_type_cd
        )
	</select>
	<select id="findOptidiskMstTrgtPagedList" parameterClass="rms.presv.optidiskmst.domain.OptidiskFld" resultMap="findOptidiskMstTrgtPagedList-result">
		SELECT E.record_center_id
		      ,E.org_cd
		      ,E.presv_term_cd
		      ,E.creat_yyyy
		      ,E.total
		      ,E.store_size
		      ,E.optidisk_type_cd
		      ,(select count(*) from tb_sroptidisk_fld where record_center_id = E.record_center_id and org_cd = E.org_cd and presv_term_cd = E.presv_term_cd and creat_yyyy = E.creat_yyyy and optidisk_type_cd = E.optidisk_type_cd and seq > 0) as choice_cnt
		      ,(SELECT dept_nm FROM tb_stdept WHERE org_cd = E.org_cd) as org_nm
		      ,(SELECT dept_abbr_nm FROM tb_stdept WHERE org_cd = E.org_cd) as org_abbr_nm
		      ,(SELECT Z.com_cd_nm FROM TB_ZZCOMCD Z WHERE Z.com_type_cd='RD07' AND Z.com_cd = DECODE(E.presv_term_cd, '20', '25', E.presv_term_cd)) presv_term_nm
		FROM (
		    SELECT D.*
		    FROM (
		        SELECT ROWNUM AS rnum
		              ,C.*
		        FROM    (
		             SELECT o.record_center_id, o.org_cd, o.presv_term_cd, o.creat_yyyy, count(*) as total, sum(o.store_size) as store_size, o.optidisk_type_cd
		             FROM tb_sroptidisk_fld o
		             WHERE o.record_center_id = #recordCenterId:VARCHAR#
		             <isNotEmpty property="presvTermCd" prepend="AND">
		             	 o.presv_term_cd = #presvTermCd:VARCHAR#
		             </isNotEmpty>
		             <isNotEmpty property="orgCd" prepend="AND">
		                 o.org_cd = #orgCd:VARCHAR#
		             </isNotEmpty>
		             <isNotEmpty property="creatYyyyS">
		                 <isNotEmpty property="creatYyyyE">
		                 	AND    creat_yyyy BETWEEN #creatYyyyS:VARCHAR# AND #creatYyyyE:VARCHAR#
		                 </isNotEmpty>
		             </isNotEmpty>
		             <isNotEmpty property="optidiskTypeCd" prepend="AND">
		                 o.optidisk_type_cd = #optidiskTypeCd:VARCHAR#
		             </isNotEmpty>
		             GROUP BY o.record_center_id, o.org_cd, o.presv_term_cd, o.creat_yyyy, o.optidisk_type_cd
		        ) C
		        WHERE ROWNUM <![CDATA[<=]]> #pagedEnd:NUMBER#
		    ) D
		    WHERE D.rnum <![CDATA[>=]]> #pagedStart:NUMBER#
		) E
		ORDER BY E.rnum
	</select>
	
	<!-- 
		광디스크수록_수록파일생성
		: 광디스크 마스터 정보별 분할매체 목록을 조회한다.
	 -->
	<resultMap id="findOptidiskMstSplitList-result" class="rms.presv.optidiskmst.domain.OptidiskRcd">
		<result property="orgCd" column="org_cd" nullValue="" />
		<result property="seq" column="seq" nullValue="0" />
		<result property="splitSeq" column="split_seq" nullValue="0" />
		<result property="storeSize" column="store_size" nullValue="" />
	</resultMap>
	<select id="findOptidiskMstSplitList" parameterClass="rms.presv.optidiskmst.domain.OptidiskMst" resultMap="findOptidiskMstSplitList-result">
		SELECT	t.org_cd, t.seq, t.split_seq, t.store_size
		FROM	(
					SELECT 	org_cd, seq, split_seq, sum(to_number(store_size)) as store_size
					FROM  	tb_sroptidisk_rcd
					WHERE   record_center_id = #recordCenterId:VARCHAR#
					AND		org_cd = #orgCd:VARCHAR#
					AND     seq = #seq#
					GROUP BY org_cd, seq, split_seq
				) t
		ORDER by t.split_seq ASC
	</select>
	
	<!-- 
		광디스크수록_수록파일생성
		: 실제사용될 광디스크ID를 업데이트한다.
	 -->
	<update id="updateRealOptidiskId" parameterClass="rms.presv.optidiskmst.domain.OptidiskMst">
		UPDATE	tb_sroptidisk_mst
		SET		optidisk_id = #optidiskId:VARCHAR#
		WHERE	record_center_id = #recordCenterId:VARCHAR#
		AND		org_cd = #orgCd#
		AND		seq = #seq#
	</update>
	
	<!-- 
		광디스크수록_수록파일생성
		: 광디스크수록정보 작업시퀀스 갱신
	 -->
	<update id="updateOptidiskMstScheduleSeq" parameterClass="rms.presv.optidiskmst.domain.OptidiskMst">
		UPDATE	tb_sroptidisk_mst
		SET		schedule_seq = #scheduleSeq#,
				optidisk_state_cd = #optidiskStateCd:VARCHAR#
				<isNotEmpty property="workUserId" open=" , ">
					work_user_id = #workUserId:VARCHAR#
				</isNotEmpty>
				<isNotEmpty property="workReqDtime" open=" , ">
					work_req_dtime = #workReqDtime:VARCHAR#
				</isNotEmpty>
		WHERE	record_center_id = #recordCenterId:VARCHAR#
		AND		org_cd = #orgCd:VARCHAR#
		AND		seq = #seq#
	</update>
	
	<!-- 
		광디스크수록_수록파일생성
		: 광디스크 수록철 이력정보를 생성한다
	 -->
	<insert id="createOptidiskFldHist" parameterClass="rms.presv.optidiskmst.domain.OptidiskFld">
		INSERT 	INTO tb_sroptihist_fld (
			record_center_id, folder_id, optidisk_id, store_size, record_cnt
		) VALUES (
			#recordCenterId:VARCHAR#, #folderId:VARCHAR#, #optidiskId:VARCHAR#, #storeSize:VARCHAR#, #recordCnt#
		)
	</insert>
	
	<!-- 
		광디스크수록_수록파일생성
		: 광디스크 수록철 정보를 삭제한다.
	 -->
	<delete id="deleteOptidiskFld" parameterClass="rms.presv.optidiskmst.domain.OptidiskFld">
		DELETE
		FROM	tb_sroptidisk_fld
		WHERE	record_center_id = #recordCenterId:VARCHAR#
		AND		folder_id = #folderId:VARCHAR#
		AND		org_cd = #orgCd:VARCHAR#
		AND		seq = #seq#
	</delete>
	
	<!-- 
		광디스크수록_수록파일생성
		: 광디스크 수록건 이력정보를 생성한다
	 -->
	<insert id="createOptidiskRcdHist" parameterClass="rms.presv.optidiskmst.domain.OptidiskRcd"> 
		INSERT	INTO tb_sroptihist_rcd (
			record_center_id, folder_id, record_id, optidisk_id, record_discern, store_size, split_seq, file_cnt
		) VALUES (
			#recordCenterId:VARCHAR#, #folderId:VARCHAR#, #recordId:VARCHAR#, #optidiskId:VARCHAR#, #recordDiscern:VARCHAR#, #storeSize:VARCHAR#, #splitSeq#, #fileCnt#
		)
	</insert>
	
	<!-- 
		광디스크수록_수록파일생성
		: 광디스크 수록건 정보를 삭제한다.
	 -->
	<delete id="deleteOptidiskRcd" parameterClass="rms.presv.optidiskmst.domain.OptidiskRcd">
		DELETE 
		FROM 	tb_sroptidisk_rcd
		WHERE 	record_center_id = #recordCenterId:VARCHAR#
		AND		record_id = #recordId:VARCHAR#
		AND		org_cd = #orgCd:VARCHAR#
		AND		seq = #seq#
		AND		split_seq = #splitSeq#
	</delete>
	
	<!-- 
		광디스수록_수록파일생성
		: 광디스크ID별 수록정보를 생성한다.	
	 -->
	<resultMap id="findOptidiskMstInfo-result" class="rms.presv.optidiskmst.domain.OptidiskMst">
		<result property="optidiskId"	 	column="optidisk_id" 			nullValue="" 	/>
		<result property="orgCd" 			column="org_cd" 				nullValue="" 	/>
		<result property="orgNm" 			column="org_nm" 				nullValue="" 	/>
		<result property="orgAbbrNm" 		column="org_abbr_nm"			nullValue="" 	/>
		<result property="storeSize" 		column="store_size" 			nullValue="" 	/>
		<result property="optidiskSize" 	column="optidisk_size" 			nullValue="" 	/>
		<result property="seq" 				column="seq" 					nullValue="0" 	/>
		<result property="scheduleSeq" 		column="schedule_seq" 			nullValue="0" 	/>
		<result property="seqNm" 			column="seq_nm"					nullValue="" 	/>
		<result property="splitTot" 		column="split_tot" 				nullValue="0" 	/>
		<result property="splitCnt" 		column="split_cnt" 				nullValue="0" 	/>
		<result property="optidiskStateCd" 	column="optidisk_state_cd" 		nullValue="" 	/>
		<result property="optidiskTypeCd" 	column="optidisk_type_cd" 		nullValue="" 	/>
		<result property="optidiskYyyy" 	column="optidisk_yyyy"	 		nullValue="" 	/>
		<result property="creatYyyy" 		column="creat_yyyy"	 			nullValue="" 	/>
		<result property="presvTermCd" 		column="presv_term_cd" 			nullValue="" 	/>
		<result property="presvTermNm" 		column="presv_term_nm" 			nullValue="" 	/>
		<result property="storePlanYmd" 	column="store_plan_ymd"			nullValue="" 	/>
		<result property="workReqDtime" 	column="work_req_dtime"			nullValue="" 	/>
		<result property="workEndDtime" 	column="work_end_dtime"			nullValue="" 	/>
		<result property="workUserId" 		column="work_user_id"			nullValue="" 	/>
		<result property="disuseFlag"		column="disuse_flag"			nullValue=""	/>
		<result property="disuseYyyy"		column="disuse_yyyy"			nullValue=""	/>
		<result property="disuseUserId"		column="disuse_user_id"			nullValue=""	/>
		<result property="disuseYmd"		column="disuse_ymd"				nullValue=""	/>
		<result property="disuseRsn"		column="disuse_rsn"				nullValue=""	/>
	</resultMap>
	<select id="findOptidiskMstInfo" parameterClass="rms.presv.optidiskmst.domain.OptidiskMst" resultMap="findOptidiskMstInfo-result">
		SELECT  o.org_cd, o.seq, o.store_size, o.optidisk_size, o.split_tot, o.optidisk_state_cd, o.optidisk_type_cd, o.optidisk_yyyy, o.creat_yyyy, o.presv_term_cd, o.store_plan_ymd,
				o.work_req_dtime, o.work_user_id, o.work_end_dtime, o.schedule_seq, o.optidisk_id,
				o.disuse_flag, o.disuse_user_id, o.disuse_ymd, o.disuse_yyyy, o.disuse_rsn, 
		        (
		          CASE
		                WHEN (length(o.seq)=1) THEN concat('00000',o.seq)
		                WHEN (length(o.seq)=2) THEN concat('0000',o.seq)
		                WHEN (length(o.seq)=3) THEN concat('000',o.seq)
		                WHEN (length(o.seq)=4) THEN concat('00',o.seq)
		                WHEN (length(o.seq)=5) THEN concat('0',o.seq)
		                ELSE concat('', o.seq)
		          END
		        ) as seq_nm,
		        (
				  CASE
				        WHEN ((select count(*) from tb_sroptidisk_fld where record_center_id = o.record_center_id and org_cd = o.org_cd and seq = o.seq)=0) 
				          THEN (select count(*) from tb_sroptihist_fld where record_center_id = o.record_center_id and optidisk_id = o.optidisk_id)
				        ELSE (select count(*) from tb_sroptidisk_fld where record_center_id = o.record_center_id and org_cd = o.org_cd and seq = o.seq)
				  END
				) as split_cnt, 
		        (SELECT dept_nm FROM tb_stdept WHERE org_cd = o.org_cd) as org_nm,
		        (SELECT dept_abbr_nm FROM tb_stdept WHERE org_cd = o.org_cd) as org_abbr_nm,
		        (SELECT Z.com_cd_nm FROM TB_ZZCOMCD Z WHERE Z.com_type_cd='RD07' AND Z.com_cd = o.presv_term_cd) presv_term_nm
		FROM    tb_sroptidisk_mst o
		WHERE   o.record_center_id = #recordCenterId:VARCHAR#
		<isEmpty property="optidiskId">
			AND		o.org_cd = #orgCd:VARCHAR#
			AND		o.seq = #seq#
		</isEmpty>
		<isNotEmpty property="optidiskId">
			AND		o.optidisk_id = #optidiskId:VARCHAR#
		</isNotEmpty>
	</select>
	
	<!-- 
		광디스크수록_수록파일생성
		: 광디스크수록정보 삭제 / 수록대상정리시 관리순번이 부여된 마스터 테이블 삭제 -->
	<delete id="deleteOptidiskMstInfo" parameterClass="rms.presv.optidiskmst.domain.OptidiskMst">
		<isEqual property="mediaDiv" compareValue="1">
			DELETE	FROM  tb_sroptidisk_mst
			WHERE	record_center_id = #recordCenterId:VARCHAR#
			AND		org_cd = #orgCd:VARCHAR#
			AND		seq = #seq#
		</isEqual>
		<isEqual property="mediaDiv" compareValue="2">
			DELETE	FROM tb_srmfpic
			WHERE	record_center_id = #recordCenterId:VARCHAR#
			AND 		pic_sno = #seq#
		</isEqual>
	</delete>
	
	<!-- 
		광디스크수록_수록파일생성
		: 광디스크 수록정보를 초기화한다. (기록물철)
	 -->
	<update id="resetOptidiskFldInfo" parameterClass="rms.presv.optidiskmst.domain.OptidiskFld">
		UPDATE	tb_sroptidisk_fld
		SET		seq = 0
		WHERE	record_center_id = #recordCenterId:VARCHAR#
		AND		org_cd = #orgCd:VARCHAR#
		AND		seq = #seq#
	</update>
	
	<!-- 
		광디스크수록_수록파일생성
		: 광디스크 수록대상 건목록을 조회한다.
	 -->
	<resultMap id="findOptidiskRcdResetList-result" class="rms.presv.optidiskmst.domain.OptidiskRcd">
		<result property="recordCenterId" 	column="record_center_id"	nullValue=""  />
		<result property="optidiskTypeCd"	column="optidisk_type_cd"	nullValue=""  />
		<result property="folderId" 		column="folder_id"			nullValue=""  />
		<result property="recordId" 		column="record_id"			nullValue=""  />
		<result property="recordDiscern" 	column="record_discern"		nullValue=""  />
		<result property="storeSize" 		column="store_size"			nullValue=""  />
		<result property="orgCd" 			column="org_cd"				nullValue=""  />
		<result property="splitSeq"			column="split_seq"			nullValue="0" />
		<result property="seq" 				column="seq"				nullValue="0" />
		<result property="fileCnt"	 		column="file_cnt"			nullValue="0" />
	</resultMap>
	<select id="findOptidiskRcdResetList" parameterClass="rms.presv.optidiskmst.domain.OptidiskMst" resultMap="findOptidiskRcdResetList-result">
		SELECT	record_center_id, optidisk_type_cd, folder_id, record_id, record_discern, store_size, org_cd, split_seq, seq, file_cnt
		FROM	tb_sroptidisk_rcd
		WHERE	record_center_id = #recordCenterId:VARCHAR#
		AND		seq = #seq#
		AND		org_cd = #orgCd:VARCHAR#
	</select>
	
	<!-- 
		광디스크수록_수록파일생성
		: 기록물건 수록정보를 초기화한다.
	 -->
	<update id="resetOptidiskRcdInfo" parameterClass="rms.presv.optidiskmst.domain.OptidiskRcd">
		UPDATE	tb_sroptidisk_rcd
		SET		seq = 0, split_seq = 0
		WHERE	record_center_id = #recordCenterId:VARCHAR#
		AND		org_cd = #orgCd:VARCHAR#
		AND		seq = #seq#
	</update>

	<!-- 
		광디스크수록_수록검사
		: 수록검사 목록을 조회한다.
	 -->
	<resultMap id="findOptidiskMstChkPagedList-result" class="rms.presv.optidiskmst.domain.OptidiskMst">
		<result property="optidiskId"	 	column="optidisk_id" 			nullValue="" 	/>
		<result property="orgCd" 			column="org_cd" 				nullValue="" 	/>
		<result property="storeSize" 		column="store_size" 			nullValue="" 	/>
		<result property="optidiskSize" 	column="optidisk_size" 			nullValue="" 	/>
		<result property="seq" 				column="seq" 					nullValue="0" 	/>
		<result property="seqNm" 			column="seq_nm"					nullValue="" 	/>
		<result property="splitTot" 		column="split_tot" 				nullValue="0" 	/>
		<result property="splitCnt" 		column="split_cnt" 				nullValue="0" 	/>
		<result property="optidiskStateCd" 	column="optidisk_state_cd" 		nullValue="" 	/>
		<result property="optidiskTypeCd" 	column="optidisk_type_cd" 		nullValue="" 	/>
		<result property="optidiskYyyy" 	column="optidisk_yyyy"	 		nullValue="" 	/>
		<result property="creatYyyy" 		column="creat_yyyy"	 			nullValue="" 	/>
		<result property="presvTermCd" 		column="presv_term_cd" 			nullValue="" 	/>
		<result property="storePlanYmd" 	column="store_plan_ymd"			nullValue="" 	/>
		<result property="scheduleSeq" 		column="schedule_seq"			nullValue="0" 	/>
	</resultMap>
	<select id="countOptidiskMstChkPagedList" parameterClass="rms.presv.optidiskmst.domain.OptidiskMst" resultClass="java.lang.Long">
		SELECT COUNT(1)
        FROM    tb_sroptidisk_mst A
        WHERE   A.record_center_id = #recordCenterId:VARCHAR#
        <isNotEmpty property="optidiskYyyy" prepend="AND">
            A.optidisk_yyyy = #optidiskYyyy:VARCHAR#
        </isNotEmpty>
        <isNotEmpty property="optidiskStateCd" prepend="AND">
            A.optidisk_state_cd = #optidiskStateCd:VARCHAR#
        </isNotEmpty>
        <isNotEmpty property="optidiskTypeCd" prepend="AND">
            A.optidisk_type_cd = #optidiskTypeCd:VARCHAR#
        </isNotEmpty>
        <isNotEmpty property="creatYyyy" prepend="AND">
            A.creat_yyyy = #creatYyyy:VARCHAR#
        </isNotEmpty>
	</select>
	<select id="findOptidiskMstChkPagedList" parameterClass="rms.presv.optidiskmst.domain.OptidiskMst" resultMap="findOptidiskMstChkPagedList-result">
		SELECT D.org_cd
		      ,D.seq
		      ,D.store_size
		      ,D.optidisk_size
		      ,D.split_tot
		      ,D.optidisk_state_cd
		      ,D.optidisk_type_cd
		      ,D.optidisk_yyyy
		      ,D.creat_yyyy
		      ,D.presv_term_cd
		      ,D.store_plan_ymd
		      ,D.optidisk_id
		      ,D.schedule_seq
		      ,LPAD(D.seq, 6, '0') seq_nm
		      ,(CASE WHEN ((select count(*) from tb_sroptidisk_fld where record_center_id = D.record_center_id and org_cd = D.org_cd and seq = D.seq)=0) 
		             THEN (select count(*) from tb_sroptihist_fld where record_center_id = D.record_center_id and optidisk_id = D.optidisk_id)
		             ELSE (select count(*) from tb_sroptidisk_fld where record_center_id = D.record_center_id and org_cd = D.org_cd and seq = D.seq)
		        END) as split_cnt
		FROM (
		    SELECT C.*
		    FROM (
		        SELECT ROWNUM AS rnum
		              ,B.*
		        FROM (
		            SELECT * 
		            FROM    tb_sroptidisk_mst A
		            WHERE   A.record_center_id = #recordCenterId:VARCHAR#
		            <isNotEmpty property="optidiskYyyy" prepend="AND">
		                A.optidisk_yyyy = #optidiskYyyy:VARCHAR#
		            </isNotEmpty>
		            <isNotEmpty property="optidiskStateCd" prepend="AND">
		                A.optidisk_state_cd = #optidiskStateCd:VARCHAR#
		            </isNotEmpty>
		            <isNotEmpty property="optidiskTypeCd" prepend="AND">
		                A.optidisk_type_cd = #optidiskTypeCd:VARCHAR#
		            </isNotEmpty>
		            <isNotEmpty property="creatYyyy" prepend="AND">
		                A.creat_yyyy = #creatYyyy:VARCHAR#
		            </isNotEmpty>
		            ORDER BY A.store_plan_ymd DESC
		        ) B
		        WHERE ROWNUM <![CDATA[<=]]> #pagedEnd:NUMBER#
		    ) C
		    WHERE C.rnum <![CDATA[>=]]> #pagedStart:NUMBER#
		) D
		ORDER BY D.rnum
	</select>
	
	<!-- 
		광디스크수록_수록검사
		: 광디스크 수록철 목록을 조회한다.
	 -->
	<resultMap id="findOptidiskChkFldPagedList-result" class="rms.presv.optidiskmst.domain.OptidiskFld">
		<result property="folderId"			column="folder_id" 				nullValue="" />
		<result property="recordCenterId" 	column="record_center_id"		nullValue="" />
		<result property="title"			column="title" 					nullValue="" />
		<result property="creatSysCd" 		column="creat_sys_cd" 			nullValue="" />
		<result property="orgCd" 			column="org_cd" 				nullValue="" />
		<result property="clssId" 			column="clss_id" 				nullValue="" />
		<result property="creatYyyy" 		column="creat_yyyy" 			nullValue="" />
		<result property="folderRegSeq" 	column="folder_reg_seq" 		nullValue="" />
		<result property="hoNo" 			column="ho_no" 					nullValue="" />
		<result property="storeSize" 		column="store_size" 			nullValue="" />
		<result property="hoNoCnt"		column="ho_no_cnt"			nullValue="" />
	</resultMap>
	<select id="countOptidiskChkFldPagedList" parameterClass="rms.presv.optidiskmst.domain.OptidiskMst" resultClass="java.lang.Long">
		 SELECT  COUNT(1)
         FROM   tb_sroptihist_fld o, tb_rdfolder f
         WHERE  o.record_center_id = #recordCenterId:VARCHAR#
         AND     o.optidisk_id = #optidiskId:VARCHAR#
         AND     o.record_center_id = f.record_center_id
         AND     o.folder_id = f.folder_id
	
	</select>
	<select id="findOptidiskChkFldPagedList" parameterClass="rms.presv.optidiskmst.domain.OptidiskMst" resultMap="findOptidiskChkFldPagedList-result">
		SELECT C.*
		FROM (
		    SELECT B.*
		    FROM (
		        SELECT ROWNUM AS rnum
		                ,A.*
		        FROM (
		            SELECT  o.folder_id, f.title, f.record_center_id, f.creat_sys_cd, f.org_cd, f.clss_id, f.creat_yyyy, f.folder_reg_seq, f.ho_no, o.store_size
		                    , (select count(*) 
		                      from tb_rdfolder
		                      where creat_sys_cd = f.creat_sys_cd
		                      and org_cd = f.org_cd
		                      and clss_id = f.clss_id
		                      and creat_yyyy = f.creat_yyyy
		                      and folder_reg_seq = f.folder_reg_seq) as ho_no_cnt                
		            FROM   tb_sroptihist_fld o, tb_rdfolder f
		            WHERE  o.record_center_id = #recordCenterId:VARCHAR#
		            AND     o.optidisk_id = #optidiskId:VARCHAR#
		            AND     o.record_center_id = f.record_center_id
		            AND     o.folder_id = f.folder_id
		        ) A
		        WHERE ROWNUM <![CDATA[<=]]> #pagedEnd:NUMBER#
		    ) B
		    WHERE B.rnum <![CDATA[>=]]> #pagedStart:NUMBER#
		) C
	</select>
	
	<!-- 
		광디스크수록_수록검사
		: 광디스크 수록철 목록을 조회한다.
	 -->
	<resultMap id="findOptidiskchkFldList-result" class="rms.presv.optidiskmst.domain.OptidiskFld">
		<result property="folderId"			column="folder_id" 				nullValue="" />
		<result property="recordCenterId" 	column="record_center_id"		nullValue="" />
		<result property="title"			column="title" 					nullValue="" />
		<result property="creatSysCd" 		column="creat_sys_cd" 			nullValue="" />
		<result property="orgCd" 			column="org_cd" 				nullValue="" />
		<result property="clssId" 			column="clss_id" 				nullValue="" />
		<result property="creatYyyy" 		column="creat_yyyy" 			nullValue="" />
		<result property="folderRegSeq" 	column="folder_reg_seq" 		nullValue="" />
		<result property="hoNo" 			column="ho_no" 					nullValue="" />
		<result property="storeSize" 		column="store_size" 			nullValue="" />
		<result property="hoNoCnt"		column="ho_no_cnt"			nullValue="" />
	</resultMap>
	<select id="findOptidiskchkFldList" parameterClass="rms.presv.optidiskmst.domain.OptidiskMst" resultMap="findOptidiskchkFldList-result">
        SELECT  o.folder_id, f.title, f.record_center_id, f.creat_sys_cd, f.org_cd, f.clss_id, f.creat_yyyy, f.folder_reg_seq, f.ho_no, o.store_size
                , (select count(*) 
                  from tb_rdfolder
                  where creat_sys_cd = f.creat_sys_cd
                  and org_cd = f.org_cd
                  and clss_id = f.clss_id
                  and creat_yyyy = f.creat_yyyy
                  and folder_reg_seq = f.folder_reg_seq) as ho_no_cnt                
        FROM   tb_sroptihist_fld o, tb_rdfolder f
        WHERE  o.record_center_id = #recordCenterId:VARCHAR#
        AND     o.optidisk_id = #optidiskId:VARCHAR#
        AND     o.record_center_id = f.record_center_id
        AND     o.folder_id = f.folder_id
	</select>
	
	<!-- 
		광디스크수록_수록검사
		: 광디스크 수록검사완료처리를 한다.
	 -->
	<update id="updateOptidiskMstChkInfo" parameterClass="rms.presv.optidiskmst.domain.OptidiskMst">
		UPDATE TB_SROPTIDISK_MST
		SET	CHK_USER_ID = #chkUserId:VARCHAR#,
				CHK_YMD = #chkYmd:VARCHAR#,
				OPTIDISK_STATE_CD = #optidiskStateCd:VARCHAR#
		WHERE 1 = 1
		AND    RECORD_CENTER_ID = #recordCenterId:VARCHAR#
		AND    ORG_CD = #orgCd:VARCHAR#
		AND    SEQ = #seq:NUMBER#
		AND    OPTIDISK_STATE_CD = '3'  
	</update>
	
	<!-- 
		광디스크수록_광디스크서가배치
		: 광디스크서가배치 목록을 조회한다.
	 -->
	<resultMap id="findOptidiskBooksfArangePagedList-result" class="rms.presv.optidiskmst.domain.OptidiskBooksf">
		<result property="optidiskId" 		column="OPTIDISK_ID"/>
		<result property="splitTot" 		column="SPLIT_TOT"/>
		<result property="creatYyyy" 		column="CREAT_YYYY"/>
		<result property="optidiskYyyy" 	column="OPTIDISK_YYYY"/>
		<result property="optidiskTypeCd" 	column="OPTIDISK_TYPE_CD"/>
		<result property="optidiskTypeNm" 	column="OPTIDISK_TYPE_NM"/>
		<result property="orgCd" 			column="ORG_CD"/>
		<result property="orgNm" 			column="ORG_NM"/>
		<result property="orgAbbrNm" 		column="ORG_ABBR_NM"/>
		<result property="presvTermCd" 		column="PRESV_TERM_CD"/>
		<result property="presvTermNm" 		column="PRESV_TERM_NM"/>
		<result property="splitCnt" 		column="SPLIT_CNT"/>
		<result property="booksfLocation" 	column="BOOKSF_LOCATION"/>
		<result property="booksfArngFlag" 	column="BOOKSF_ARNG_FLAG"/>
		<result property="booksfArngFlagNm" column="BOOKSF_ARNG_FLAG_NM"/>
		<result property="disuDivCd"           column="DISU_DIV_CD_NM"/>
	</resultMap>
	<select id="countOptidiskBooksfArangePagedList" parameterClass="rms.presv.optidiskmst.domain.OptidiskBooksf" resultClass="java.lang.Long">
		SELECT COUNT(1)
        FROM TB_SROPTIDISK_MST A, (SELECT B.record_center_id, B.optidisk_id
                                   FROM TB_SROPTIHIST_FLD B, TB_RDFOLDER C
                                   WHERE B.record_center_id = C.record_center_id
                                   AND B.folder_id = C.folder_id
                                   <isNotEmpty prepend="AND" property="disuDivCd">
                                   		C.DISU_DIV_CD = #disuDivCd:VARCAHR#
					   </isNotEmpty>
                                   <isNotEmpty prepend="AND" property="lastEvalYyyy">
                                   		C.LAST_EVAL_YYYY = #lastEvalYyyy:VARCAHR#
                                   </isNotEmpty>
                                   GROUP BY B.record_center_id, B.optidisk_id
                                   ) B
        WHERE 1 = 1
        AND A.record_center_id = B.record_center_id
        AND A.optidisk_id = B.optidisk_id
        AND A.optidisk_state_cd = '4'
        AND A.RECORD_CENTER_ID = #recordCenterId:VARCHAR#
        AND A.OPTIDISK_YYYY = #optidiskYyyy:VARCHAR#
        <dynamic prepend="AND">
            <isNotEmpty prepend="AND" property="optidiskTypeCd">
                A.OPTIDISK_TYPE_CD = #optidiskTypeCd:VARCHAR#
            </isNotEmpty>
            <isNotEmpty prepend="AND" property="orgCd">
                A.ORG_CD = #orgCd:VARCHAR#
            </isNotEmpty>
            <isNotEmpty property="creatYyyyS">
                <isNotEmpty property="creatYyyyE">
                    AND A.CREAT_YYYY BETWEEN #creatYyyyS:VARCHAR# AND #creatYyyyE:VARCHAR#
                </isNotEmpty>
            </isNotEmpty>
            <isNotEmpty prepend="AND" property="booksfArngFlag">
                A.BOOKSF_ARNG_FLAG = #booksfArngFlag:VARCHAR#
            </isNotEmpty>
            <isNotEmpty prepend="AND" property="presvTermCd">
                A.PRESV_TERM_CD = #presvTermCd:VARCHAR#
            </isNotEmpty>
        </dynamic>
        ORDER BY A.org_cd, A.seq
	</select>
	<select id="findOptidiskBooksfArangePagedList" parameterClass="rms.presv.optidiskmst.domain.OptidiskBooksf" resultMap="findOptidiskBooksfArangePagedList-result">
		SELECT E.optidisk_id
		      ,E.split_tot
		      ,E.creat_yyyy
		      ,E.optidisk_yyyy
		      ,E.optidisk_type_cd
		      ,(SELECT com_cd_nm FROM TB_ZZCOMCD WHERE com_type_cd = 'RD86' AND com_cd = E.optidisk_type_cd) AS optidisk_type_nm
		      ,E.org_cd
		      ,(SELECT org_nm FROM TB_STORG WHERE record_center_id = E.record_center_id AND org_cd = E.org_cd) AS org_nm
		      ,(SELECT org_abbr_nm FROM TB_STORG WHERE record_center_id = E.record_center_id AND org_cd = E.org_cd) AS org_abbr_nm
		      ,E.presv_term_cd
		      ,(SELECT com_cd_nm FROM TB_ZZCOMCD WHERE com_type_cd = 'RD07' AND com_cd = DECODE(E.presv_term_cd, '20', '25', E.presv_term_cd)) AS presv_term_nm
		      ,(SELECT count(folder_id) FROM TB_SROPTIHIST_FLD WHERE record_center_id = E.record_center_id AND optidisk_id = E.optidisk_id) AS split_cnt
		      ,E.optidisk_stakrm_id || '-' || E.optidisk_booksf_id || '-' || LPAD(E.floor_no, 3, '0') || '-' || LPAD(E.col_no, 3, '0') AS booksf_location
		      ,E.booksf_arng_flag
		      ,(SELECT com_cd_nm FROM TB_ZZCOMCD WHERE com_type_cd = 'RD45' AND com_cd = E.booksf_arng_flag) AS booksf_arng_flag_nm
		      ,(CASE WHEN (SELECT count(f.disu_div_cd) 
		                   FROM TB_SROPTIHIST_FLD E, TB_RDFOLDER f 
		                   WHERE E.record_center_id = f.record_center_id 
		                   AND E.folder_id = f.folder_id 
		                   AND E.record_center_id = E.record_center_id 
		                   AND E.optidisk_id = E.optidisk_id) > 0 
		             THEN '재책정' 
		             ELSE ''
		        END) AS disu_div_cd_nm
		FROM (
		    SELECT D.*
		    FROM (
		        SELECT ROWNUM AS rnum
		              ,C.*
		        FROM (
		            SELECT A.*
		            FROM TB_SROPTIDISK_MST A, (SELECT B.record_center_id, B.optidisk_id
		                                       FROM TB_SROPTIHIST_FLD B, TB_RDFOLDER C
		                                       WHERE B.record_center_id = C.record_center_id
		                                       AND B.folder_id = C.folder_id
		                                       <isNotEmpty prepend="AND" property="disuDivCd">
		                                       		C.DISU_DIV_CD = #disuDivCd:VARCAHR#
											   </isNotEmpty>
		                                       <isNotEmpty prepend="AND" property="lastEvalYyyy">
		                                       		C.LAST_EVAL_YYYY = #lastEvalYyyy:VARCAHR#
		                                       </isNotEmpty>
		                                       GROUP BY B.record_center_id, B.optidisk_id
		                                       ) B
		            WHERE 1 = 1
		            AND A.record_center_id = B.record_center_id
		            AND A.optidisk_id = B.optidisk_id
		            AND A.optidisk_state_cd = '4'
		            AND A.RECORD_CENTER_ID = #recordCenterId:VARCHAR#
		            AND A.OPTIDISK_YYYY = #optidiskYyyy:VARCHAR#
		            <dynamic prepend="AND">
		                <isNotEmpty prepend="AND" property="optidiskTypeCd">
		                    A.OPTIDISK_TYPE_CD = #optidiskTypeCd:VARCHAR#
		                </isNotEmpty>
		                <isNotEmpty prepend="AND" property="orgCd">
		                    A.ORG_CD = #orgCd:VARCHAR#
		                </isNotEmpty>
		                <isNotEmpty property="creatYyyyS">
		                    <isNotEmpty property="creatYyyyE">
		                        AND A.CREAT_YYYY BETWEEN #creatYyyyS:VARCHAR# AND #creatYyyyE:VARCHAR#
		                    </isNotEmpty>
		                </isNotEmpty>
		                <isNotEmpty prepend="AND" property="booksfArngFlag">
		                    A.BOOKSF_ARNG_FLAG = #booksfArngFlag:VARCHAR#
		                </isNotEmpty>
		                <isNotEmpty prepend="AND" property="presvTermCd">
		                    A.PRESV_TERM_CD = #presvTermCd:VARCHAR#
		                </isNotEmpty>
		            </dynamic>
		            ORDER BY A.org_cd, A.seq
		        ) C
		        WHERE ROWNUM <![CDATA[<=]]> #pagedEnd:NUMBER#
		    ) D
		    WHERE D.rnum <![CDATA[>=]]> #pagedStart:NUMBER#
		) E
		ORDER BY E.rnum
	</select>
	
	<!-- 
		광디스크수록_광디스크서가배치
		: 광디스크 서가목록을 조회한다.
	 -->
	<resultMap id="findOptidiskBooksfIdList-result" class="rms.presv.optidiskmst.domain.OptidiskMstStakrm">
		<result property="optidiskStakrmId"			column="OPTIDISK_STAKRM_ID"/>
		<result property="optidiskBooksfId"			column="OPTIDISK_BOOKSF_ID"/>
		<result property="optidiskBooksfNm" 		column="OPTIDISK_BOOKSF_NM"/>
		<result property="shelfCcnt" 				column="SHELF_C_CNT"/>
		<result property="shelfRcnt" 				column="SHELF_R_CNT"/>
	</resultMap>
	<select id="findOptidiskBooksfIdList" parameterClass="rms.presv.optidiskmst.domain.OptidiskMst" resultMap="findOptidiskBooksfIdList-result">
		SELECT OPTIDISK_STAKRM_ID, OPTIDISK_BOOKSF_ID, OPTIDISK_BOOKSF_NM, SHELF_C_CNT, SHELF_R_CNT 
		FROM TB_SROPTIDISK_BOOKSF
		WHERE RECORD_CENTER_ID = #recordCenterId:VARCHAR#
		AND OPTIDISK_STAKRM_ID = #optidiskStakrmId:VARCHAR#
		<isNotEmpty prepend="AND" property="optidiskBooksfId">
			OPTIDISK_BOOKSF_ID = #optidiskBooksfId:VARCHAR#
		</isNotEmpty>
		ORDER BY OPTIDISK_STAKRM_ID, OPTIDISK_BOOKSF_ID
	</select>
	
	<!-- 
		광디스크수록_광디스크서가배치
		: 광디스크 서가배치를 한다.
	 -->
	<update id="updateOptidiskBooksfArng" parameterClass="rms.presv.optidiskmst.domain.OptidiskMst">
		UPDATE TB_SROPTIDISK_MST A
	    SET  A.OPTIDISK_STAKRM_ID = #optidiskStakrmId:VARCHAR#
	     	,A.OPTIDISK_BOOKSF_ID = #optidiskBooksfId:VARCHAR#
	     	,A.FLOOR_NO = #floorNo:VARCHAR#
	     	,A.COL_NO = #colNo:VARCHAR#
	     	,A.BOOKSF_ARNG_FLAG = #booksfArngFlag:VARCHAR#
	 	WHERE A.RECORD_CENTER_ID = #recordCenterId:VARCHAR#
	   	AND A.OPTIDISK_ID = #optidiskId:VARCHAR#
	   	AND A.OPTIDISK_STATE_CD = '4'
	</update>
	
	<!-- 
		광디스크수록_광디스크서고등록
		: 광디스크서가목록을 조회한다.
	 -->
	<resultMap id="findOptidiskMstBooksf-result" class="rms.presv.optidiskmst.domain.OptidiskMstStakrm">
		<result property="optidiskStakrmId" 	column="OPTIDISK_STAKRM_ID"/>
		<result property="optidiskStakrmNm" 	column="OPTIDISK_STAKRM_NM"/>
		<result property="optidiskBooksfId" 	column="OPTIDISK_BOOKSF_ID"/>
		<result property="optidiskBooksfNm" 	column="OPTIDISK_BOOKSF_NM"/>
		<result property="shelfCcnt" 			column="SHELF_C_CNT" 		nullValue="0"/>
		<result property="shelfRcnt" 			column="SHELF_R_CNT" 		nullValue="0"/>
		<result property="maxArngDiskCnt" 		column="MAX_ARNG_DISK_CNT" 	nullValue="0"/>
		<result property="curArngDiskCnt" 		column="CUR_ARNG_DISK_CNT" 	nullValue="0"/>
		<result property="optidiskBooksfRemk" 	column="OPTIDISK_BOOKSF_REMK" 	/>
	</resultMap>
	<select id="countOptidiskMstBooksf" parameterClass="rms.presv.optidiskmst.domain.OptidiskMstStakrm" resultClass="java.lang.Long">
	    SELECT COUNT(1)
	    FROM     TB_SROPTIDISK_STAKRM A, TB_SROPTIDISK_BOOKSF B
	    WHERE A.RECORD_CENTER_ID = #recordCenterId:VARCHAR#
	    AND A.RECORD_CENTER_ID = B.RECORD_CENTER_ID 
	    AND A.OPTIDISK_STAKRM_ID = B.OPTIDISK_STAKRM_ID 
	    <dynamic>        
	        <isNotEmpty prepend="AND" property="optidiskStakrmNm">
	            A.OPTIDISK_STAKRM_NM LIKE #optidiskStakrmNm:VARCHAR#
	        </isNotEmpty>            
	        <isNotEmpty prepend="AND" property="optidiskBooksfNm">
	            B.OPTIDISK_BOOKSF_NM LIKE #optidiskBooksfNm:VARCHAR#
	        </isNotEmpty>            
	    </dynamic>
	</select>
	<select id="findOptidiskMstBooksf" parameterClass="rms.presv.optidiskmst.domain.OptidiskMstStakrm" resultMap="findOptidiskMstBooksf-result">
		SELECT E.optidisk_stakrm_id
		      ,E.optidisk_stakrm_nm
		      ,E.optidisk_booksf_id
		      ,E.optidisk_booksf_nm
		      ,E.shelf_c_cnt
		      ,E.shelf_r_cnt
		      ,E.max_arng_disk_cnt
		      ,( SELECT SUM(split_tot) FROM TB_SROPTIDISK_MST WHERE record_center_id = E.record_center_id AND optidisk_stakrm_id = E.optidisk_stakrm_id AND optidisk_booksf_id = E.optidisk_booksf_id) AS cur_arng_disk_cnt
		      ,E.remk AS optidisk_booksf_remk
		FROM (
		    SELECT D.*
		    FROM (
		        SELECT ROWNUM AS rnum
		              ,C.*
		        FROM (
		            SELECT A.record_center_id, A.optidisk_stakrm_id,A.optidisk_stakrm_nm,B.optidisk_booksf_id,B.optidisk_booksf_nm
		                  ,B.shelf_c_cnt,B.shelf_r_cnt,B.max_arng_disk_cnt, B.remk
		            FROM     TB_SROPTIDISK_STAKRM A, TB_SROPTIDISK_BOOKSF B
		            WHERE A.RECORD_CENTER_ID = #recordCenterId:VARCHAR#
		            AND A.RECORD_CENTER_ID = B.RECORD_CENTER_ID(+) 
		            AND A.OPTIDISK_STAKRM_ID = B.OPTIDISK_STAKRM_ID(+) 
		            <dynamic>        
		                <isNotEmpty prepend="AND" property="optidiskStakrmNm">
		                    A.OPTIDISK_STAKRM_NM LIKE #optidiskStakrmNm:VARCHAR#
		                </isNotEmpty>            
		                <isNotEmpty prepend="AND" property="optidiskBooksfNm">
		                    B.OPTIDISK_BOOKSF_NM LIKE #optidiskBooksfNm:VARCHAR#
		                </isNotEmpty>            
		            </dynamic>
		            ORDER BY A.record_center_id, A.optidisk_stakrm_id, B.optidisk_booksf_id
		        ) C
		        WHERE ROWNUM <![CDATA[<=]]> #pagedEnd:NUMBER#
		    ) D
		    WHERE D.rnum <![CDATA[>=]]> #pagedStart:NUMBER#
		) E
		ORDER BY E.rnum
	</select>

	<!-- 
		광디스크수록_광디스크서고등록
		: 서고관리팝업의 서고목록을 조회한다.
	 -->
	<resultMap id="findOptidiskMstStakrm-result" class="rms.presv.optidiskmst.domain.OptidiskMstStakrm">
		<result property="optidiskStakrmId" 	column="OPTIDISK_STAKRM_ID"/>
		<result property="optidiskStakrmNm" 	column="OPTIDISK_STAKRM_NM"/>
		<result property="optidiskBooksfCnt" 	column="BOOKSF_CNT" 		nullValue="0"/>
		<result property="optidiskStakrmRemk" 	column="STAKRM_REMK"/>
	</resultMap>
	<select id="countOptidiskMstStakrm" parameterClass="rms.presv.optidiskmst.domain.OptidiskMstStakrm" resultClass="java.lang.Long">
		SELECT COUNT(1)
        FROM TB_SROPTIDISK_STAKRM  
        WHERE RECORD_CENTER_ID = #recordCenterId:VARCHAR# 
        <dynamic>        
            <isNotEmpty prepend="AND" property="optidiskStakrmNm">
                OPTIDISK_STAKRM_NM LIKE #optidiskStakrmNm:VARCHAR# 
            </isNotEmpty>                
        </dynamic>
	</select>
	<select id="findOptidiskMstStakrm" parameterClass="rms.presv.optidiskmst.domain.OptidiskMstStakrm" resultMap="findOptidiskMstStakrm-result">
		SELECT D.optidisk_stakrm_id
		      ,D.optidisk_stakrm_nm
		      ,D.booksf_cnt
		      ,D.remk AS stakrm_remk
		FROM (
		    SELECT C.*
		    FROM (
		        SELECT ROWNUM AS rnum
		              ,B.*
		        FROM (
		            SELECT *
		            FROM TB_SROPTIDISK_STAKRM  
		            WHERE RECORD_CENTER_ID = #recordCenterId:VARCHAR# 
		            <dynamic>        
		                <isNotEmpty prepend="AND" property="optidiskStakrmNm">
		                    OPTIDISK_STAKRM_NM LIKE #optidiskStakrmNm:VARCHAR# 
		                </isNotEmpty>                
		            </dynamic>
		            ORDER BY OPTIDISK_STAKRM_ID DESC
		        ) B
		        WHERE ROWNUM <![CDATA[<=]]> #pagedEnd:NUMBER#
		    ) C
		    WHERE C.rnum <![CDATA[>=]]> #pagedStart:NUMBER#
		) D
		ORDER BY D.rnum
	</select>
	
	<!-- 
		광디스크수록_광디스크서고등록
		: 광디스크 서고등록시 최종 서고ID를 조회한다.
	 -->
	<select id="findMaxOptidiskStakrmId" parameterClass="java.lang.String" resultClass="java.lang.String">
		SELECT MAX(OPTIDISK_STAKRM_ID) AS OPTIDISK_STAKRM_ID
		FROM TB_SROPTIDISK_STAKRM
		WHERE RECORD_CENTER_ID = #recordCenterId:VARCHAR#
	</select>
	
	<!-- 
		광디스크수록_광디스크서고등록
		: 광디스크 서고를 등록한다.
	 -->
	<insert id="createOptidiskStakrm" parameterClass="rms.presv.optidiskmst.domain.OptidiskMstStakrm">
		INSERT INTO TB_SROPTIDISK_STAKRM (
		    RECORD_CENTER_ID, OPTIDISK_STAKRM_ID, OPTIDISK_STAKRM_NM, BOOKSF_CNT, REMK
		) VALUES (
		    #recordCenterId:VARCHAR#, #createOptidiskStakrmId:VARCHAR#, #createOptidiskStakrmNm:VARCHAR#, #createOptidiskBooksfCnt:INT#, #createOptidiskStakrmRemk:VARCHAR#
		)
	</insert>

	<!-- 
		광디스크수록_광디스크서고등록
		: 광디스크 서고를 수정한다.
	 -->	
	<update id="updateOptidiskStakrm" parameterClass="rms.presv.optidiskmst.domain.OptidiskMstStakrm">
		UPDATE TB_SROPTIDISK_STAKRM
		SET  OPTIDISK_STAKRM_NM = #createOptidiskStakrmNm:VARCHAR#
			,REMK = #createOptidiskStakrmRemk:VARCHAR#
		WHERE RECORD_CENTER_ID = #recordCenterId:VARCHAR#
		AND OPTIDISK_STAKRM_ID = #createOptidiskStakrmId:VARCHAR#
	</update>
	
	<!-- 
		광디스크수록_광디스크서고등록
		: 광디스크 서고를 삭제한다.
	 -->
	<delete id="deleteOptidiskStakrm" parameterClass="rms.presv.optidiskmst.domain.OptidiskMstStakrm">
		DELETE FROM TB_SROPTIDISK_STAKRM
		WHERE RECORD_CENTER_ID = #recordCenterId:VARCHAR#
		AND OPTIDISK_STAKRM_ID = #optidiskStakrmId:VARCHAR#
	</delete>
	
	<!-- 
		광디스크수록_광디스크서고등록
		: 서고 리스트를 조회한다. 
	-->
	<resultMap id="findOptidiskStakrmIdList-result" class="rms.presv.optidiskmst.domain.OptidiskMstStakrm" >
		<result property="optidiskStakrmId" 		column="OPTIDISK_STAKRM_ID"/>
		<result property="optidiskStakrmNm" 		column="OPTIDISK_STAKRM_NM"/>
		<result property="optidiskBooksfCnt" 		column="OPTIDISK_BOOKSF_CNT"/>
		<result property="optidiskStakrmRemk" 		column="OPTIDISK_STAKRM_REMK"/>
	</resultMap>	
	<select id="findOptidiskStakrmIdList" parameterClass="rms.presv.optidiskmst.domain.OptidiskMstStakrm" resultMap="findOptidiskStakrmIdList-result">
		SELECT 	OPTIDISK_STAKRM_ID AS OPTIDISK_STAKRM_ID, 
	   		   	OPTIDISK_STAKRM_NM AS OPTIDISK_STAKRM_NM, 
	   			NVL(BOOKSF_CNT,'0') AS OPTIDISK_BOOKSF_CNT,
	   			REMK AS OPTIDISK_STAKRM_REMK 
	   	  FROM  TB_SROPTIDISK_STAKRM  
	   	 WHERE  RECORD_CENTER_ID = #recordCenterId:VARCHAR# 
		<dynamic>		
			<isNotEmpty prepend="AND" property="optidiskStakrmNm">
				OPTIDISK_STAKRM_NM LIKE #optidiskStakrmNm:VARCHAR# 
			</isNotEmpty>				
		</dynamic>
		ORDER BY OPTIDISK_STAKRM_ID ASC 
	</select>
	
	<!-- 
		광디스크수록_광디스크서고등록
		: 서가번호 최고값을 얻는다.
	 -->
	<select id="findMaxOptidiskStakrmBooksfId" parameterClass="rms.presv.optidiskmst.domain.OptidiskMstStakrm" resultClass="java.lang.String">
		SELECT MAX(OPTIDISK_BOOKSF_ID)
		FROM TB_SROPTIDISK_BOOKSF
		WHERE RECORD_CENTER_ID = #recordCenterId:VARCHAR#
		AND OPTIDISK_STAKRM_ID = #optidiskStakrmId:VARCHAR#	
	</select>
	
	<!-- 
		광디스크수록_광디스크서고등록
		: 광디스크 서가를 등록한다.
	 -->
	<insert id="createOptidiskBooksf" parameterClass="rms.presv.optidiskmst.domain.OptidiskMstStakrm">
		INSERT INTO TB_SROPTIDISK_BOOKSF (
			RECORD_CENTER_ID, OPTIDISK_BOOKSF_ID, OPTIDISK_BOOKSF_NM, OPTIDISK_STAKRM_ID, OPTIDISK_STAKRM_SNO, 
	  		   	SHELF_C_CNT, SHELF_R_CNT, MAX_ARNG_DISK_CNT, CUR_ARNG_DISK_CNT, REMK
		) VALUES (
			#recordCenterId:VARCHAR#, #createOptidiskBooksfId:VARCHAR#, #createOptidiskBooksfNm:VARCHAR#, #createOptidiskStakrmId:VARCHAR#
		   ,(SELECT (COUNT(OPTIDISK_BOOKSF_ID)+1) AS STAKRMSEQ FROM TB_SROPTIDISK_BOOKSF WHERE OPTIDISK_STAKRM_ID=#createOptidiskStakrmId:VARCHAR#)
	  	   ,#createShelfCcnt:NUMBER#, #createShelfRcnt:NUMBER#, #createMaxArngDiskCnt:NUMBER#, #createCurArngDiskCnt:NUMBER#, #createOptidiskBooksfRemk:VARCHAR#)
	</insert>
	
	<!-- 
		광디스크수록_광디스크서고등록
		: 광디스크 보유 서가수량을 증가한다.
	 -->
	<update id="addOptidiskMstBooksfCnt" parameterClass="rms.presv.optidiskmst.domain.OptidiskMstStakrm">
	  	UPDATE TB_SROPTIDISK_STAKRM 
	  	SET BOOKSF_CNT=(SELECT COUNT(OPTIDISK_STAKRM_ID) FROM TB_SROPTIDISK_BOOKSF WHERE OPTIDISK_STAKRM_ID=#createOptidiskStakrmId:VARCHAR#)	  	     
		WHERE RECORD_CENTER_ID = #recordCenterId:VARCHAR#
		AND   OPTIDISK_STAKRM_ID = #createOptidiskStakrmId:VARCHAR#
	</update>
	
	<!-- 
		광디스크수록_광디스크서고등록
		: 광디스크 서가를 수정한다.
	 -->
	<update id="updateOptidiskBooksf" parameterClass="rms.presv.optidiskmst.domain.OptidiskMstStakrm">
		UPDATE TB_SROPTIDISK_BOOKSF 
		SET OPTIDISK_BOOKSF_NM = #optidiskBooksfNm:VARCHAR# 
	  	   	 , REMK	= #optidiskBooksfRemk:VARCHAR# 
	  	   	 , SHELF_C_CNT = #shelfCcnt:NUMBER# 
	  	   	 , SHELF_R_CNT = #shelfRcnt:NUMBER# 
	  	   	 , MAX_ARNG_DISK_CNT = #maxArngDiskCnt:NUMBER#  
	 	WHERE RECORD_CENTER_ID = #recordCenterId:VARCHAR#
 	   	AND OPTIDISK_STAKRM_ID = #optidiskStakrmId:VARCHAR#	
 	   	AND OPTIDISK_BOOKSF_ID = #optidiskBooksfId:VARCHAR#
	</update>
	
	<!-- 
		광디스크수록_광디스크서고등록
		: 광디스크 서가를 삭제한다.
	 --> 	
	<delete id="deleteOptidiskMstStakrmBooksf" parameterClass="rms.presv.optidiskmst.domain.OptidiskMstStakrm">
		DELETE FROM TB_SROPTIDISK_BOOKSF
		WHERE RECORD_CENTER_ID = #recordCenterId:VARCHAR#
		AND OPTIDISK_STAKRM_ID = #optidiskStakrmId:VARCHAR#
		AND OPTIDISK_BOOKSF_ID = #optidiskBooksfId:VARCHAR#	
	</delete>
	
	<!-- 
		광디스크수록_광디스크서고등록
		: 광디스크 보유 서가수량을 감소한다.
	 -->
	<update id="minOptidiskMstBooksfCnt" parameterClass="rms.presv.optidiskmst.domain.OptidiskMstStakrm">
	  	UPDATE TB_SROPTIDISK_STAKRM 
	  	SET BOOKSF_CNT=(SELECT NVL(COUNT(OPTIDISK_STAKRM_ID), 0) FROM TB_SROPTIDISK_BOOKSF WHERE OPTIDISK_STAKRM_ID=#optidiskStakrmId:VARCHAR#)	  	     
		WHERE RECORD_CENTER_ID = #recordCenterId:VARCHAR#
		AND   OPTIDISK_STAKRM_ID = #optidiskStakrmId:VARCHAR#
	</update>
	
	<!-- 
		광디스크수록_광디스크서고등록
		: 광디스크 서고수량을 조회한다.
	 -->
	<select id="findOptidiskMstStakrmCount" parameterClass="rms.presv.optidiskmst.domain.OptidiskMstStakrm" resultClass="java.lang.String">
		SELECT 	COUNT(OPTIDISK_STAKRM_ID) 
		FROM TB_SROPTIDISK_STAKRM  	
		WHERE RECORD_CENTER_ID = #recordCenterId:VARCHAR# 
		<dynamic>		
			<isNotEmpty prepend="AND" property="optidiskStakrmNm">
				OPTIDISK_STAKRM_NM LIKE #optidiskStakrmNm:VARCHAR# 
			</isNotEmpty>				
		</dynamic>
	</select>

	<!-- 
		광디스크수록_광디스크현황
		: 광디스크현황의 광디스크제작목록을 조회한다.
	 -->
	<resultMap id="findOptiDiskStoreList-result" class="rms.presv.optidiskmst.domain.Optidisk">
		<result property="optidiskYyyy" 		column="OPTIDISK_YYYY"/>
		<result property="aCnt" 			    column="A_CNT"/>			
		<result property="aScnt" 		        column="A_SCNT"/>
		<result property="aFcnt" 				column="A_FCNT"/>
		<result property="aStsize" 				column="A_STSIZE"/>
		<result property="bCnt" 			    column="B_CNT"/>			
		<result property="bScnt" 		        column="B_SCNT"/>
		<result property="bFcnt" 				column="B_FCNT"/>
		<result property="bStsize" 				column="B_STSIZE"/>
		<result property="cCnt" 			    column="C_CNT"/>			
		<result property="cScnt" 		        column="C_SCNT"/>
		<result property="cFcnt" 				column="C_FCNT"/>
		<result property="cStsize" 				column="C_STSIZE"/>
	</resultMap>
	<select id="findOptiDiskStoreList" parameterClass="rms.presv.optidiskmst.domain.Optidisk" resultMap="findOptiDiskStoreList-result">
		SELECT OPTIDISK_YYYY
			  ,NVL(SUM(A_CNT), 0) A_CNT
			  ,NVL(SUM(A_SCNT), 0) A_SCNT
			  ,NVL(SUM(A_FCNT), 0) A_FCNT
			  ,NVL(SUM(A_STSIZE), 0) A_STSIZE
			  ,NVL(SUM(B_CNT), 0) B_CNT
			  ,NVL(SUM(B_SCNT), 0) B_SCNT
			  ,NVL(SUM(B_FCNT), 0) B_FCNT
			  ,NVL(SUM(B_STSIZE), 0) B_STSIZE
			  ,NVL(SUM(C_CNT), 0) C_CNT
			  ,NVL(SUM(C_SCNT), 0) C_SCNT
			  ,NVL(SUM(C_FCNT), 0) C_FCNT
			  ,NVL(SUM(C_STSIZE), 0) C_STSIZE
        FROM (
                SELECT T.OPTIDISK_YYYY
                	  ,(SELECT COUNT(1) FROM TB_SROPTIDISK_MST WHERE RECORD_CENTER_ID = T.RECORD_CENTER_ID AND ORG_CD = T.ORG_CD AND SEQ = T.SEQ AND OPTIDISK_TYPE_CD = '1') A_CNT
                	  ,(SELECT SUM(SPLIT_TOT) FROM TB_SROPTIDISK_MST WHERE RECORD_CENTER_ID = T.RECORD_CENTER_ID AND ORG_CD = T.ORG_CD AND SEQ = T.SEQ AND OPTIDISK_TYPE_CD = '1') A_SCNT
                	  ,(SELECT COUNT(FOLDER_ID) FROM TB_SROPTIHIST_FLD WHERE RECORD_CENTER_ID = T.RECORD_CENTER_ID AND OPTIDISK_ID = T.OPTIDISK_ID AND T.OPTIDISK_TYPE_CD = '1') AS A_FCNT	    <!-- 원문 수록철수 -->
                	  ,(SELECT SUM(STORE_SIZE) FROM TB_SROPTIDISK_MST WHERE RECORD_CENTER_ID = T.RECORD_CENTER_ID AND ORG_CD = T.ORG_CD AND SEQ = T.SEQ AND OPTIDISK_TYPE_CD = '1') A_STSIZE
                	  ,(SELECT COUNT(1) FROM TB_SROPTIDISK_MST WHERE RECORD_CENTER_ID = T.RECORD_CENTER_ID AND ORG_CD = T.ORG_CD AND SEQ = T.SEQ AND OPTIDISK_TYPE_CD = '2') B_CNT
                	  ,(SELECT SUM(SPLIT_TOT) FROM TB_SROPTIDISK_MST WHERE RECORD_CENTER_ID = T.RECORD_CENTER_ID AND ORG_CD = T.ORG_CD AND SEQ = T.SEQ AND OPTIDISK_TYPE_CD = '2') B_SCNT
                	  ,(SELECT COUNT(FOLDER_ID) FROM TB_SROPTIHIST_FLD WHERE RECORD_CENTER_ID = T.RECORD_CENTER_ID AND OPTIDISK_ID = T.OPTIDISK_ID AND T.OPTIDISK_TYPE_CD = '2') AS B_FCNT	    <!-- 장기보존 수록철수 -->
                	  ,(SELECT SUM(STORE_SIZE) FROM TB_SROPTIDISK_MST WHERE RECORD_CENTER_ID = T.RECORD_CENTER_ID AND ORG_CD = T.ORG_CD AND SEQ = T.SEQ AND OPTIDISK_TYPE_CD = '2') B_STSIZE
                	  ,(SELECT COUNT(1) FROM TB_SROPTIDISK_MST WHERE RECORD_CENTER_ID = T.RECORD_CENTER_ID AND ORG_CD = T.ORG_CD AND SEQ = T.SEQ AND OPTIDISK_TYPE_CD = '3') C_CNT
                	  ,(SELECT SUM(SPLIT_TOT) FROM TB_SROPTIDISK_MST WHERE RECORD_CENTER_ID = T.RECORD_CENTER_ID AND ORG_CD = T.ORG_CD AND SEQ = T.SEQ AND OPTIDISK_TYPE_CD = '3') C_SCNT
                	  ,(SELECT COUNT(FOLDER_ID) FROM TB_SROPTIHIST_FLD WHERE RECORD_CENTER_ID = T.RECORD_CENTER_ID AND OPTIDISK_ID = T.OPTIDISK_ID AND T.OPTIDISK_TYPE_CD = '3') AS C_FCNT	    <!-- 스캔 수록철수 -->
                	  ,(SELECT SUM(STORE_SIZE) FROM TB_SROPTIDISK_MST WHERE RECORD_CENTER_ID = T.RECORD_CENTER_ID AND ORG_CD = T.ORG_CD AND SEQ = T.SEQ AND OPTIDISK_TYPE_CD = '3') C_STSIZE      
                FROM (
                    SELECT RECORD_CENTER_ID, ORG_CD, SEQ,  SPLIT_TOT, OPTIDISK_YYYY, OPTIDISK_TYPE_CD, STORE_SIZE, OPTIDISK_ID         
                    FROM TB_SROPTIDISK_MST                             
                    WHERE OPTIDISK_STATE_CD = '4'
                    AND RECORD_CENTER_ID = #recordCenterId:VARCHAR#                    
                    AND OPTIDISK_YYYY BETWEEN #creatYyyyS:VARCHAR# AND #creatYyyyE:VARCHAR#                    
                    ) T    
            )
        GROUP BY OPTIDISK_YYYY	 	
	</select>
	
	<!-- 
		광디스크수록_광디스크현황
		: 광디스크현황의 광디스크제작목록을 조회한다.
	 -->
	<resultMap id="findOptiDiskStoreCheckList-result" class="rms.presv.optidiskmst.domain.Optidisk">
		<result property="checkYmd" 			column="CHECK_YMD"/>
		<result property="aChkCnt" 			    column="A_CHK_CNT"/>			
		<result property="aNrmltCnt" 		    column="A_NRMLT_CNT"/>
		<result property="aLosCnt" 				column="A_LOS_CNT"/>
		<result property="aDamageCnt" 			column="A_DAMAGE_CNT"/>
		<result property="aEtcCnt" 			    column="A_ETC_CNT"/>			
		<result property="bChkCnt" 		        column="B_CHK_CNT"/>
		<result property="bNrmltCnt" 			column="B_NRMLT_CNT"/>
		<result property="bLosCnt" 				column="B_LOS_CNT"/>
		<result property="bDamageCnt" 			column="B_DAMAGE_CNT"/>			
		<result property="bEtcCnt" 		        column="B_ETC_CNT"/>
		<result property="cChkCnt" 				column="C_CHK_CNT"/>
		<result property="cNrmltCnt" 			column="C_NRMLT_CNT"/>
		<result property="cLosCnt" 				column="C_LOS_CNT"/>
		<result property="cDamageCnt" 			column="C_DAMAGE_CNT"/>
		<result property="cEtcCnt" 				column="C_ETC_CNT"/>
	</resultMap>
	<select id="findOptiDiskStoreCheckList" parameterClass="rms.presv.optidiskmst.domain.Optidisk" resultMap="findOptiDiskStoreCheckList-result">
		SELECT CHECK_YMD
			  ,NVL(SUM(A_CHK_CNT), 0) A_CHK_CNT
			  ,NVL(SUM(A_NRMLT_CNT), 0) A_NRMLT_CNT
			  ,NVL(SUM(A_LOS_CNT), 0) A_LOS_CNT
			  ,NVL(SUM(A_DAMAGE_CNT), 0) A_DAMAGE_CNT
			  ,NVL(SUM(A_ETC_CNT), 0) A_ETC_CNT
			  ,NVL(SUM(B_CHK_CNT), 0) B_CHK_CNT
			  ,NVL(SUM(B_NRMLT_CNT), 0) B_NRMLT_CNT
			  ,NVL(SUM(B_LOS_CNT), 0) B_LOS_CNT
			  ,NVL(SUM(B_DAMAGE_CNT), 0) B_DAMAGE_CNT
			  ,NVL(SUM(B_ETC_CNT), 0) B_ETC_CNT
			  ,NVL(SUM(C_CHK_CNT), 0) C_CHK_CNT
			  ,NVL(SUM(C_NRMLT_CNT), 0) C_NRMLT_CNT
			  ,NVL(SUM(C_LOS_CNT), 0) C_LOS_CNT
			  ,NVL(SUM(C_DAMAGE_CNT), 0) C_DAMAGE_CNT
			  ,NVL(SUM(C_ETC_CNT), 0) C_ETC_CNT
		FROM (        
		        SELECT CHECK_YMD
		        	  ,(SELECT COUNT(1) FROM TB_SROPTIDISK_MST WHERE RECORD_CENTER_ID = T.RECORD_CENTER_ID AND ORG_CD = T.ORG_CD AND SEQ = T.SEQ AND OPTIDISK_TYPE_CD = '1') A_CHK_CNT
		        	  ,(SELECT SUM(CASE WHEN CNTCHK_RSLT_CD = '1' THEN 1 ELSE 0 END) FROM TB_SROPTIDISK_MST WHERE RECORD_CENTER_ID = T.RECORD_CENTER_ID AND ORG_CD = T.ORG_CD AND SEQ = T.SEQ AND OPTIDISK_TYPE_CD = '1') A_NRMLT_CNT
		        	  ,(SELECT SUM(CASE WHEN CNTCHK_RSLT_CD = '2' THEN 1 ELSE 0 END) FROM TB_SROPTIDISK_MST WHERE RECORD_CENTER_ID = T.RECORD_CENTER_ID AND ORG_CD = T.ORG_CD AND SEQ = T.SEQ AND OPTIDISK_TYPE_CD = '1') A_LOS_CNT
		        	  ,(SELECT SUM(CASE WHEN CNTCHK_RSLT_CD = '3' THEN 1 ELSE 0 END) FROM TB_SROPTIDISK_MST WHERE RECORD_CENTER_ID = T.RECORD_CENTER_ID AND ORG_CD = T.ORG_CD AND SEQ = T.SEQ AND OPTIDISK_TYPE_CD = '1') A_DAMAGE_CNT
		        	  ,(SELECT SUM(CASE WHEN CNTCHK_RSLT_CD = '4' THEN 1 ELSE 0 END) FROM TB_SROPTIDISK_MST WHERE RECORD_CENTER_ID = T.RECORD_CENTER_ID AND ORG_CD = T.ORG_CD AND SEQ = T.SEQ AND OPTIDISK_TYPE_CD = '1') A_ETC_CNT
		        	  ,(SELECT COUNT(1) FROM TB_SROPTIDISK_MST WHERE RECORD_CENTER_ID = T.RECORD_CENTER_ID AND ORG_CD = T.ORG_CD AND SEQ = T.SEQ AND OPTIDISK_TYPE_CD = '2') B_CHK_CNT
		        	  ,(SELECT SUM(CASE WHEN CNTCHK_RSLT_CD = '1' THEN 1 ELSE 0 END) FROM TB_SROPTIDISK_MST WHERE RECORD_CENTER_ID = T.RECORD_CENTER_ID AND ORG_CD = T.ORG_CD AND SEQ = T.SEQ AND OPTIDISK_TYPE_CD = '2') B_NRMLT_CNT
		        	  ,(SELECT SUM(CASE WHEN CNTCHK_RSLT_CD = '2' THEN 1 ELSE 0 END) FROM TB_SROPTIDISK_MST WHERE RECORD_CENTER_ID = T.RECORD_CENTER_ID AND ORG_CD = T.ORG_CD AND SEQ = T.SEQ AND OPTIDISK_TYPE_CD = '2') B_LOS_CNT
		        	  ,(SELECT SUM(CASE WHEN CNTCHK_RSLT_CD = '3' THEN 1 ELSE 0 END) FROM TB_SROPTIDISK_MST WHERE RECORD_CENTER_ID = T.RECORD_CENTER_ID AND ORG_CD = T.ORG_CD AND SEQ = T.SEQ AND OPTIDISK_TYPE_CD = '2') B_DAMAGE_CNT
		        	  ,(SELECT SUM(CASE WHEN CNTCHK_RSLT_CD = '4' THEN 1 ELSE 0 END) FROM TB_SROPTIDISK_MST WHERE RECORD_CENTER_ID = T.RECORD_CENTER_ID AND ORG_CD = T.ORG_CD AND SEQ = T.SEQ AND OPTIDISK_TYPE_CD = '2') B_ETC_CNT
		        	  ,(SELECT COUNT(1) FROM TB_SROPTIDISK_MST WHERE RECORD_CENTER_ID = T.RECORD_CENTER_ID AND ORG_CD = T.ORG_CD AND SEQ = T.SEQ AND OPTIDISK_TYPE_CD = '3') C_CHK_CNT
		        	  ,(SELECT SUM(CASE WHEN CNTCHK_RSLT_CD = '1' THEN 1 ELSE 0 END) FROM TB_SROPTIDISK_MST WHERE RECORD_CENTER_ID = T.RECORD_CENTER_ID AND ORG_CD = T.ORG_CD AND SEQ = T.SEQ AND OPTIDISK_TYPE_CD = '3') C_NRMLT_CNT
		        	  ,(SELECT SUM(CASE WHEN CNTCHK_RSLT_CD = '2' THEN 1 ELSE 0 END) FROM TB_SROPTIDISK_MST WHERE RECORD_CENTER_ID = T.RECORD_CENTER_ID AND ORG_CD = T.ORG_CD AND SEQ = T.SEQ AND OPTIDISK_TYPE_CD = '3') C_LOS_CNT
		        	  ,(SELECT SUM(CASE WHEN CNTCHK_RSLT_CD = '3' THEN 1 ELSE 0 END) FROM TB_SROPTIDISK_MST WHERE RECORD_CENTER_ID = T.RECORD_CENTER_ID AND ORG_CD = T.ORG_CD AND SEQ = T.SEQ AND OPTIDISK_TYPE_CD = '3') C_DAMAGE_CNT
		        	  ,(SELECT SUM(CASE WHEN CNTCHK_RSLT_CD = '4' THEN 1 ELSE 0 END) FROM TB_SROPTIDISK_MST WHERE RECORD_CENTER_ID = T.RECORD_CENTER_ID AND ORG_CD = T.ORG_CD AND SEQ = T.SEQ AND OPTIDISK_TYPE_CD = '3') C_ETC_CNT
		        FROM (
		                SELECT A.RECORD_CENTER_ID, A.ORG_CD, A.SEQ, SUBSTR(B.CHECK_YMD, 0, 4) CHECK_YMD, B.CNTCHK_RSLT_CD         
		                FROM TB_SROPTIDISK_MST A,
		                        TB_SROPTIDISK_CNTCHKDETL B
		                WHERE A.RECORD_CENTER_ID = B.RECORD_CENTER_ID
		                AND A.ORG_CD = B.ORG_CD
		                AND A.SEQ = B.SEQ
		                AND A.RECORD_CENTER_ID = #recordCenterId:VARCHAR#
		                AND A.OPTIDISK_STATE_CD = '4'
		                AND SUBSTR(B.CHECK_YMD, 0, 4) BETWEEN #creatYyyyS:VARCHAR# AND #creatYyyyE:VARCHAR#
		                ) T    
		    )
	    GROUP BY CHECK_YMD  		 	
	</select>

</sqlMap>
