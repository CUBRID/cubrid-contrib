-- File Open : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\srch\read\ReadAppr.xml


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\srch\read\ReadAppr.xml
-- Query    : select
-- Query Id : countReadApprFolderPagedList

		SELECT COUNT(1)                     FROM  TB_RDREADREQ A, TB_RDFOLDERREADDETL B, TB_RDFOLDER C        WHERE C.FOLDER_ID = B.FOLDER_ID        AND B.READ_REQNO = A.READ_REQNO        AND A.RECORD_CENTER_ID = B.RECORD_CENTER_ID                AND B.KEEP_RECORD_CENTER_ID = C.RECORD_CENTER_ID        AND A.READ_REQ_DIV_CD = '1'                AND B.KEEP_RECORD_CENTER_ID = '1'        AND B.HANDL_ORG_CD = '1'        AND READ_REQ_YMD BETWEEN '1' AND '1'        ;


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\srch\read\ReadAppr.xml
-- Query    : select
-- Query Id : findReadApprFolderPagedList

		SELECT E.keep_record_center_id		      ,E.req_record_center_id		      ,(SELECT Z.record_center_nm FROM tb_strecordcenter Z WHERE Z.record_center_id = E.req_record_center_id) AS req_record_center_nm		      ,E.read_reqno		      ,SUBSTR(E.READ_REQNO, 1, 4)||'-'||SUBSTR(E.READ_REQNO, 5, 6) AS readReqNo		      ,E.folder_id		      ,E.org_cd		      ,(SELECT Z.org_nm FROM tb_storg Z WHERE Z.record_center_id = E.keep_record_center_id AND Z.org_cd = E.org_cd) AS org_nm		      ,(SELECT Z.org_abbr_nm FROM tb_storg Z WHERE Z.record_center_id = E.keep_record_center_id AND Z.org_cd = E.org_cd) AS org_abbr_nm		      ,E.title		      ,E.creat_yyyy		      ,E.clss_id		      ,E.clss_nm		      ,E.read_req_ymd		      ,E.read_start_ymd		      ,E.read_close_ymd		      ,E.read_user_dept_nm		      ,E.read_ymd		      ,E.read_user_id		      ,E.read_user_nm		      ,E.read_rsn		      ,E.read_aprov_cd		      ,E.read_aprov_user_id		      ,(SELECT Z.user_nm FROM TB_STUSER Z WHERE Z.user_id = E.read_aprov_user_id AND Z.record_center_id = E.req_record_center_id) AS read_aprov_user_nm		      ,E.handl_org_cd		      ,(SELECT Z.org_nm FROM TB_STORG Z WHERE Z.org_cd = E.handl_org_cd AND Z.record_center_id = E.keep_record_center_id) AS handl_org_nm		      ,E.read_aprov_ymd		      ,'' AS read_ymd_start		      ,'' AS read_ymd_close		      ,E.read_aprov_rsn		      ,CASE WHEN E.read_aprov_cd ='1' AND E.read_return_cd IS NULL THEN '미처리' 		            WHEN E.read_aprov_cd ='2' THEN '승인'||'('||(SELECT USER_NM FROM TB_STUSER WHERE USER_ID = E.READ_APROV_USER_ID)||')'		            WHEN E.read_aprov_cd ='3' THEN '열람불가'		            WHEN E.read_return_cd ='1' AND E.read_aprov_cd = '1' THEN '반려'		       END  AS read_aprov_nm		      ,E.read_return_cd		      ,E.read_req_prog_state_cd		FROM (		    SELECT D.*		    FROM (		        SELECT ROWNUM AS rnum		               ,C.*		        FROM (		            SELECT B.keep_record_center_id AS keep_record_center_id, A.record_center_id AS req_record_center_id, A.read_reqno, B.folder_id, C.org_cd                          ,C.title, C.creat_yyyy, C.clss_id, C.clss_nm, A.read_req_ymd                          ,A.read_start_ymd, A.read_close_ymd, A.read_user_dept_nm, B.read_ymd, A.read_user_id                          ,A.read_user_nm, A.read_rsn, B.read_aprov_cd, B.read_aprov_user_id, B.handl_org_cd                             ,B.read_aprov_ymd, B.read_aprov_rsn, B.read_return_cd, B.read_req_prog_state_cd                    FROM  TB_RDREADREQ A, TB_RDFOLDERREADDETL B, TB_RDFOLDER C		            WHERE C.FOLDER_ID = B.FOLDER_ID		            AND B.READ_REQNO = A.READ_REQNO		            AND A.RECORD_CENTER_ID = B.RECORD_CENTER_ID        		            AND B.KEEP_RECORD_CENTER_ID = C.RECORD_CENTER_ID		            AND A.READ_REQ_DIV_CD = '1'        		            AND B.KEEP_RECORD_CENTER_ID = '1'		            AND B.HANDL_ORG_CD = '1'		            AND READ_REQ_YMD BETWEEN '1' AND '1'        		            		        ) C		        WHERE ROWNUM <= '1'		    ) D		    WHERE D.rnum >= '1'		) E		ORDER BY E.rnum	;


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\srch\read\ReadAppr.xml
-- Query    : update
-- Query Id : updateReadApprFolderConfirm

		UPDATE TB_RDFOLDERREADDETL	  	SET    READ_APROV_CD = '1' , 	  		   	READ_REQ_PROG_STATE_CD = '1'	  		     ,  	  		   		READ_APROV_USER_ID = '1'	  		   	   , 				READ_APROV_RSN = '1'  		   	  		     , 	  		  	READ_APROV_YMD = TO_CHAR(SYSDATE, 'YYYYMMDD') 	  		     , 	  	       	READ_RETURN_CD = '1'	  	         , 	  	       	READ_RETURN_RSN = '1'	  	        	  	WHERE  RECORD_CENTER_ID = '1'	  	AND	   FOLDER_ID = '1'	  	AND    READ_REQNO = '1'	;


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\srch\read\ReadAppr.xml
-- Query    : select
-- Query Id : countReadApprRecordPagedList

		SELECT COUNT(1)        FROM   TB_RDREADREQ A, TB_RDRECORDREADDETL B, TB_RDRECORD C        WHERE C.RECORD_ID = B.RECORD_ID        AND B.READ_REQNO = A.READ_REQNO        AND A.RECORD_CENTER_ID = B.RECORD_CENTER_ID                AND B.KEEP_RECORD_CENTER_ID = C.RECORD_CENTER_ID        AND A.READ_REQ_DIV_CD = '2'                AND B.KEEP_RECORD_CENTER_ID = '1'        AND B.HANDL_ORG_CD = '1'        AND READ_REQ_YMD BETWEEN '1' AND '1'                        ;


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\srch\read\ReadAppr.xml
-- Query    : select
-- Query Id : findReadApprRecordPagedList

		SELECT E.keep_record_center_id	          ,E.req_record_center_id	          ,(SELECT Z.record_center_nm FROM tb_strecordcenter Z WHERE Z.record_center_id = E.req_record_center_id) req_record_center_nm	          ,E.read_reqno	          ,SUBSTR(E.read_reqno, 1, 4)||'-'||SUBSTR(E.read_reqno, 5, 6) AS readReqNo	          ,E.record_id	          ,E.org_cd	          ,(SELECT Z.org_nm FROM TB_STORG Z WHERE Z.record_center_id = E.keep_record_center_id AND Z.org_cd = E.org_cd) AS org_nm	          ,(SELECT Z.org_abbr_nm FROM TB_STORG Z WHERE Z.record_center_id = E.keep_record_center_id AND Z.org_cd = E.org_cd) AS org_abbr_nm	          ,E.title	          ,SUBSTR(E.creat_reg_dtime, 0, 8) AS creat_reg_dtime	          ,E.read_req_ymd	          ,E.read_start_ymd	          ,E.read_close_ymd	          ,E.read_ymd	          ,E.read_user_id	          ,E.read_user_nm	          ,E.read_user_dept_nm	          ,E.read_rsn	          ,E.read_aprov_cd	          ,E.read_aprov_user_id	          ,(SELECT Z.user_nm FROM TB_STUSER Z WHERE Z.user_id = E.read_aprov_user_id AND Z.record_center_id = E.req_record_center_id) AS read_aprov_user_nm	          ,E.handl_org_cd	          ,(SELECT Z.org_nm FROM TB_STORG Z WHERE Z.org_cd = E.handl_org_cd AND Z.record_center_id = E.keep_record_center_id) AS handl_org_nm	          ,E.read_aprov_ymd	          ,'' AS read_ymd_start	          ,'' AS read_ymd_close	          ,E.read_aprov_rsn	          ,E.open_div_cd	          ,(SELECT Z.com_cd_nm FROM TB_ZZCOMCD Z WHERE Z.com_type_cd = 'RD05' AND Z.com_cd = E.open_div_cd) AS open_div_nm	          ,E.oper_read_range_cd	          ,(SELECT Z.com_cd_nm FROM TB_ZZCOMCD Z WHERE Z.com_type_cd='RD53' AND Z.com_cd=E.oper_read_range_cd) AS oper_read_range_nm	          ,CASE WHEN E.read_aprov_cd ='1' AND E.read_return_cd IS NULL THEN '미처리' 	                WHEN E.read_aprov_cd ='2' THEN '승인'||'('||(SELECT USER_NM FROM TB_STUSER WHERE USER_ID = E.READ_APROV_USER_ID)||')'	                WHEN E.read_aprov_cd ='3' THEN '열람불가'	                WHEN E.read_return_cd ='1' AND E.read_aprov_cd = '1' THEN '반려'	           END AS read_aprov_nm	          ,E.read_return_cd	          ,E.read_req_prog_state_cd		FROM (		    SELECT D.*		    FROM (		        SELECT ROWNUM AS rnum		              ,C.*		        FROM (		            SELECT C.record_center_id as keep_record_center_id, A.record_center_id as req_record_center_id, A.read_reqno, B.record_id, C.org_cd		                  ,C.title, A.read_req_ymd, A.read_start_ymd, A.read_close_ymd, B.read_ymd		                  ,A.read_user_id, A.read_user_nm, A.read_user_dept_nm, A.read_rsn, B.read_aprov_cd		                  ,B.read_aprov_user_id, B.handl_org_cd, B.read_aprov_ymd, B.read_aprov_rsn, C.open_div_cd		                  ,C.oper_read_range_cd, B.read_return_cd, B.read_req_prog_state_cd, C.creat_reg_dtime		            FROM   TB_RDREADREQ A, TB_RDRECORDREADDETL B, TB_RDRECORD C		            WHERE C.RECORD_ID = B.RECORD_ID		            AND B.READ_REQNO = A.READ_REQNO		            AND A.RECORD_CENTER_ID = B.RECORD_CENTER_ID        		            AND B.KEEP_RECORD_CENTER_ID = C.RECORD_CENTER_ID		            AND A.READ_REQ_DIV_CD = '2'        		            AND B.KEEP_RECORD_CENTER_ID = '1'		            AND B.HANDL_ORG_CD = '1'		            AND READ_REQ_YMD BETWEEN '1' AND '1'                        		        ) C		        WHERE ROWNUM <= '1'		    ) D		    WHERE D.rnum >= '1'		) E		ORDER BY E.rnum	;


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\srch\read\ReadAppr.xml
-- Query    : update
-- Query Id : updateReadApprRecordConfirm

		UPDATE TB_RDRECORDREADDETL	  	SET    READ_APROV_CD = '1' , 	  		   	READ_REQ_PROG_STATE_CD = '1'	  		     ,  	  		   		READ_APROV_USER_ID = '1'	  		   	   , 				READ_APROV_RSN = '1'  		   	  		     , 	  		  	READ_APROV_YMD = TO_CHAR(SYSDATE, 'YYYYMMDD') 	  		     , 	  	       	READ_RETURN_CD = '1'	  	         , 	  	       	READ_RETURN_RSN = '1'	  	        	  	WHERE  RECORD_CENTER_ID = '1'	  	AND	   RECORD_ID = '1'	  	AND    READ_REQNO = '1'	;


-- File Close : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\srch\read\ReadAppr.xml
