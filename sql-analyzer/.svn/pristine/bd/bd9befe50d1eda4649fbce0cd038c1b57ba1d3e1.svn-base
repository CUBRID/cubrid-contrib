-- File Open : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\eval\openresortopin\OpenResortOpinRslt.xml


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\eval\openresortopin\OpenResortOpinRslt.xml
-- Query    : select
-- Query Id : findOpenResortRsltList

		SELECT o.resort_yyyy			, o.resort_case			, 0 as resort_case_no			, '' as resort_reason			, (SELECT COUNT(*) FROM tb_rdopenresortopin WHERE record_center_id = o.record_center_id AND resort_case = o.resort_case AND resort_yyyy = o.resort_yyyy) as total			, (SELECT COUNT(*) FROM tb_rdopenresortopin WHERE record_center_id = o.record_center_id AND resort_case = o.resort_case AND resort_yyyy = o.resort_yyyy AND resort_prog_state_cd IN ('2','3','4','5','6','7')) as choice_cnt			, (SELECT COUNT(*) FROM tb_rdopenresortopin WHERE record_center_id = o.record_center_id AND resort_case = o.resort_case AND resort_yyyy = o.resort_yyyy AND resort_prog_state_cd = '5' AND discu_trgt_flag = '0') as expert_opin_cnt			, (SELECT COUNT(*) FROM tb_rdopenresortopin WHERE record_center_id = o.record_center_id AND resort_case = o.resort_case AND resort_yyyy = o.resort_yyyy AND resort_prog_state_cd = '6' AND discu_trgt_flag = '1') as review_opin_cnt			, (SELECT COUNT(*) FROM tb_rdopenresortopin WHERE record_center_id = o.record_center_id AND resort_case = o.resort_case AND resort_yyyy = o.resort_yyyy AND resort_prog_state_cd = '7' AND discu_trgt_flag = '0') as expert_rslt_cnt			, (SELECT COUNT(*) FROM tb_rdopenresortopin WHERE record_center_id = o.record_center_id AND resort_case = o.resort_case AND resort_yyyy = o.resort_yyyy AND resort_prog_state_cd = '7' AND discu_trgt_flag = '1') as review_rslt_cnt		FROM (			SELECT DISTINCT(resort_case)				, resort_yyyy				, '1' as record_center_id			FROM tb_rdopenresortopin			WHERE record_center_id = '1'			AND resort_case in ('1','2')			AND resort_yyyy = '1'			ORDER BY resort_yyyy DESC		) o		        		UNION		SELECT o.resort_yyyy			, '3' as resort_case			, o.resort_case_no			, (SELECT resort_reason FROM tb_rdopenresortreason WHERE record_center_id = o.record_center_id AND resort_case_no = o.resort_case_no AND resort_yyyy = o.resort_yyyy AND resort_case = '3') as resort_reason			, (SELECT COUNT(*) FROM tb_rdopenresortopin WHERE record_center_id = o.record_center_id AND resort_case = '3' AND resort_yyyy = o.resort_yyyy AND resort_case_no = o.resort_case_no) as total			, (SELECT COUNT(*) FROM tb_rdopenresortopin WHERE record_center_id = o.record_center_id AND resort_case = '3' AND resort_yyyy = o.resort_yyyy AND resort_case_no = o.resort_case_no AND resort_prog_state_cd IN ('2','3','4','5','6','7')) as choice_cnt			, (SELECT COUNT(*) FROM tb_rdopenresortopin WHERE record_center_id = o.record_center_id AND resort_case = '3' AND resort_yyyy = o.resort_yyyy AND resort_case_no = o.resort_case_no AND resort_prog_state_cd = '5' AND discu_trgt_flag = '0') as expert_opin_cnt			, (SELECT COUNT(*) FROM tb_rdopenresortopin WHERE record_center_id = o.record_center_id AND resort_case = '3' AND resort_yyyy = o.resort_yyyy AND resort_case_no = o.resort_case_no AND resort_prog_state_cd = '6' AND discu_trgt_flag = '1') as review_opin_cnt			, (SELECT COUNT(*) FROM tb_rdopenresortopin WHERE record_center_id = o.record_center_id AND resort_case = '3' AND resort_yyyy = o.resort_yyyy AND resort_case_no = o.resort_case_no AND resort_prog_state_cd = '7' AND discu_trgt_flag = '0') as expert_rslt_cnt			, (SELECT COUNT(*) FROM tb_rdopenresortopin WHERE record_center_id = o.record_center_id AND resort_case = '3' AND resort_yyyy = o.resort_yyyy AND resort_case_no = o.resort_case_no AND resort_prog_state_cd = '7' AND discu_trgt_flag = '1') as review_rslt_cnt		FROM (			SELECT DISTINCT(resort_case_no)				, resort_yyyy				, '1' as record_center_id			FROM tb_rdopenresortopin			WHERE resort_case in ('3')			AND resort_yyyy = '1'						ORDER BY resort_yyyy DESC		) o        		UNION		SELECT o.resort_yyyy			, '4' as resort_case			, o.resort_case_no			, (SELECT resort_reason FROM tb_rdopenresortreason WHERE record_center_id = o.record_center_id AND resort_case_no = o.resort_case_no AND resort_yyyy = o.resort_yyyy AND resort_case = '4') as resort_reason			, (SELECT COUNT(*) FROM tb_rdopenresortopin WHERE record_center_id = o.record_center_id AND resort_case = '4' AND resort_yyyy = o.resort_yyyy AND resort_case_no = o.resort_case_no) as total			, (SELECT COUNT(*) FROM tb_rdopenresortopin WHERE record_center_id = o.record_center_id AND resort_case = '4' AND resort_yyyy = o.resort_yyyy AND resort_case_no = o.resort_case_no AND resort_prog_state_cd IN ('2','3','4','5','6','7')) as choice_cnt			, (SELECT COUNT(*) FROM tb_rdopenresortopin WHERE record_center_id = o.record_center_id AND resort_case = '4' AND resort_yyyy = o.resort_yyyy AND resort_case_no = o.resort_case_no AND resort_prog_state_cd = '5' AND discu_trgt_flag = '0') as expert_opin_cnt			, (SELECT COUNT(*) FROM tb_rdopenresortopin WHERE record_center_id = o.record_center_id AND resort_case = '4' AND resort_yyyy = o.resort_yyyy AND resort_case_no = o.resort_case_no AND resort_prog_state_cd = '6' AND discu_trgt_flag = '1') as review_opin_cnt			, (SELECT COUNT(*) FROM tb_rdopenresortopin WHERE record_center_id = o.record_center_id AND resort_case = '4' AND resort_yyyy = o.resort_yyyy AND resort_case_no = o.resort_case_no AND resort_prog_state_cd = '7' AND discu_trgt_flag = '0') as expert_rslt_cnt			, (SELECT COUNT(*) FROM tb_rdopenresortopin WHERE record_center_id = o.record_center_id AND resort_case = '4' AND resort_yyyy = o.resort_yyyy AND resort_case_no = o.resort_case_no AND resort_prog_state_cd = '7' AND discu_trgt_flag = '1') as review_rslt_cnt		FROM (			SELECT DISTINCT(resort_case_no)				, resort_yyyy				, '1' as record_center_id			FROM tb_rdopenresortopin			WHERE resort_case in ('4')			AND resort_yyyy = '1'						ORDER BY resort_yyyy DESC		) o        		UNION		SELECT o.resort_yyyy			, o.resort_case			, 0 as resort_case_no			, '' as resort_reason			, (SELECT COUNT(*) FROM tb_rdopenresortopin WHERE record_center_id = o.record_center_id AND resort_case = o.resort_case AND resort_yyyy = o.resort_yyyy) as total			, (SELECT COUNT(*) FROM tb_rdopenresortopin WHERE record_center_id = o.record_center_id AND resort_case = o.resort_case AND resort_yyyy = o.resort_yyyy AND resort_prog_state_cd IN ('2','3','4','5','6','7')) as choice_cnt			, (SELECT COUNT(*) FROM tb_rdopenresortopin WHERE record_center_id = o.record_center_id AND resort_case = o.resort_case AND resort_yyyy = o.resort_yyyy AND resort_prog_state_cd = '5' AND discu_trgt_flag = '0') as expert_opin_cnt			, (SELECT COUNT(*) FROM tb_rdopenresortopin WHERE record_center_id = o.record_center_id AND resort_case = o.resort_case AND resort_yyyy = o.resort_yyyy AND resort_prog_state_cd = '6' AND discu_trgt_flag = '1') as review_opin_cnt			, (SELECT COUNT(*) FROM tb_rdopenresortopin WHERE record_center_id = o.record_center_id AND resort_case = o.resort_case AND resort_yyyy = o.resort_yyyy AND resort_prog_state_cd = '7' AND discu_trgt_flag = '0') as expert_rslt_cnt			, (SELECT COUNT(*) FROM tb_rdopenresortopin WHERE record_center_id = o.record_center_id AND resort_case = o.resort_case AND resort_yyyy = o.resort_yyyy AND resort_prog_state_cd = '7' AND discu_trgt_flag = '1') as review_rslt_cnt		FROM (			SELECT DISTINCT(resort_case)				, resort_yyyy				, '1' as record_center_id			FROM tb_rdopenresortopin			WHERE record_center_id = '1'			AND resort_case in ('5')			AND resort_yyyy = '1'						ORDER BY resort_yyyy DESC		) o		;


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\eval\openresortopin\OpenResortOpinRslt.xml
-- Query    : select
-- Query Id : findOpenResortOpinRecordPagedList

		SELECT B.*		FROM (			SELECT ROWNUM AS rnum				, A.*			FROM (				SELECT o.record_id					, o.record_center_id					, o.resort_seq					, o.resort_prog_state_cd					, r.title					, o.discu_trgt_flag					, (CASE WHEN ((r.creat_sys_cd='02' OR r.creat_sys_cd='05' OR r.creat_sys_cd='06') AND (SELECT 1 FROM TB_STORG Z WHERE Z.record_center_id=r.record_center_id AND Z.org_cd=SUBSTR(r.creat_reg_no,1,7))=1)							THEN NVL((SELECT Z.org_abbr_nm FROM TB_STORG Z WHERE Z.record_center_id=r.record_center_id AND Z.org_cd=SUBSTR(r.creat_reg_no,1,7)),SUBSTR(r.creat_reg_no,1,7)) ||'-'|| TO_NUMBER(SUBSTR(r.creat_reg_no,8))							WHEN (r.creat_sys_cd='05' OR ((r.creat_sys_cd='01' OR r.creat_sys_cd='04') AND r.record_detl_type_cd='01'))							THEN NVL((SELECT Z.org_abbr_nm FROM TB_STORG Z WHERE Z.record_center_id=r.record_center_id AND Z.org_cd=r.org_cd),r.org_cd) ||'-'|| TO_NUMBER(r.doc_no)							ELSE doc_no						END) as doc_no_nm					, (SELECT dept_nm FROM tb_stdept WHERE org_cd = o.handl_org_cd) as handl_org_nm					, (SELECT dept_abbr_nm FROM tb_stdept WHERE org_cd = o.org_cd) as handl_org_abbr_nm				FROM tb_rdrecord r, tb_rdopenresortopin o				WHERE o.record_center_id = '1'				AND o.record_center_id = r.record_center_id				AND o.record_id = r.record_id				AND o.resort_yyyy = '1'				AND o.resort_case = '1'				 AND 					o.resort_prog_state_cd = '1'				  AND 					title like '1'				 				ORDER BY o.resort_prog_state_cd DESC, o.record_id ASC			) A			WHERE ROWNUM <= '1'		) B		WHERE B.rnum >= '1'	;


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\eval\openresortopin\OpenResortOpinRslt.xml
-- Query    : select
-- Query Id : countOpenResortOpinRecordPagedList

		SELECT COUNT(1)		FROM (			SELECT o.record_id				, o.record_center_id				, o.resort_seq				, o.resort_prog_state_cd				, r.title				, o.discu_trgt_flag				, (CASE WHEN ((r.creat_sys_cd='02' OR r.creat_sys_cd='05' OR r.creat_sys_cd='06') AND (SELECT 1 FROM TB_STORG Z WHERE Z.record_center_id=r.record_center_id AND Z.org_cd=SUBSTR(r.creat_reg_no,1,7))=1)						THEN NVL((SELECT Z.org_abbr_nm FROM TB_STORG Z WHERE Z.record_center_id=r.record_center_id AND Z.org_cd=SUBSTR(r.creat_reg_no,1,7)),SUBSTR(r.creat_reg_no,1,7)) ||'-'|| TO_NUMBER(SUBSTR(r.creat_reg_no,8))						WHEN (r.creat_sys_cd='05' OR ((r.creat_sys_cd='01' OR r.creat_sys_cd='04') AND r.record_detl_type_cd='01'))						THEN NVL((SELECT Z.org_abbr_nm FROM TB_STORG Z WHERE Z.record_center_id=r.record_center_id AND Z.org_cd=r.org_cd),r.org_cd) ||'-'|| TO_NUMBER(r.doc_no)						ELSE doc_no					END) as doc_no_nm				, (SELECT dept_nm FROM tb_stdept WHERE org_cd = o.handl_org_cd) as handl_org_nm				, (SELECT dept_abbr_nm FROM tb_stdept WHERE org_cd = o.org_cd) as handl_org_abbr_nm			FROM tb_rdrecord r, tb_rdopenresortopin o			WHERE o.record_center_id = '1'			AND o.record_center_id = r.record_center_id			AND o.record_id = r.record_id			AND o.resort_yyyy = '1'			AND o.resort_case = '1' AND 				o.resort_prog_state_cd = '1'			  AND 				title like '1'			 		)	;


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\eval\openresortopin\OpenResortOpinRslt.xml
-- Query    : update
-- Query Id : updateOpenResortRslt

		UPDATE tb_rdopenresortopin		SET resort_prog_state_cd = '7'			, resort_doc_no = '1'			, rslt_decision_cd = '1'			, rslt_reg_ymd = '1'		WHERE resort_yyyy = '1'		AND resort_case = '1'		AND record_center_id = '1'		AND record_id = '1'		AND resort_seq = '1'		AND resort_prog_state_cd != '7'		AND resort_doc_no is null;


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\eval\openresortopin\OpenResortOpinRslt.xml
-- Query    : insert
-- Query Id : createOpenResortHist

		INSERT INTO tb_rdopenhist (record_center_id			, record_id			, chng_hist_no			, open_div_cd_bef			, open_div_cd_aft			, chng_ymd			, chng_rsn			, chng_user_id			, take_mng_no			, open_grade_bef			, open_grade_aft			, open_limit_part_bef			, open_limit_part_aft			, part_open_rsn_bef			, part_open_rsn_aft			, chng_org_cd			, resort_yyyy			, resort_case			, resort_case_no			, resort_doc_no		) VALUES ('1'			, '1'			, (SELECT NVL(MAX(chng_hist_no), 0)+1 FROM tb_rdopenhist WHERE record_center_id = '1' AND record_id = '1')			, '1'			, '1'			, '1'			, '1'			, '1'			, '1'			, '1'			, '1'			, '1'			, '1'			, '1'			, '1'			, '1'			, '1'			, '1'			, '1'			, '1'		)	;


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\eval\openresortopin\OpenResortOpinRslt.xml
-- Query    : insert
-- Query Id : createOpenResortAuto

		INSERT INTO tb_rdopenresortauto (record_center_id			, record_id			, resort_seq			, resort_yyyy			, resort_case			, resort_case_no			, handl_org_cd			, resort_prog_state_cd						, auto_org_open_div_cd							, auto_open_grade				, auto_limit_part			, record_chrgr_id				, folder_id													, org_cd							, auto_org_open_ymd					) VALUES ('1'			, '1'			, '1'						, '1'			, '1'						, '1'			, '1'			, '7'			, '1'						, '1'							, '1'				, '1'				, '1'							, '1'							, '1'						)			;


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\eval\openresortopin\OpenResortOpinRslt.xml
-- Query    : update
-- Query Id : updateOpenAutoRecordRslt

		UPDATE tb_rdrecord		SET open_resort_prog_state = '7'			, open_revw_prog_state = '5'			, open_limit_part = '1'			, open_div_cd = '1'			, last_open_resort_yyyy = '1'			, open_grade = '1'		WHERE record_center_id = '1'		AND record_id = '1'	;


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\eval\openresortopin\OpenResortOpinRslt.xml
-- Query    : update
-- Query Id : updateRecordRslt

		UPDATE tb_rdrecord		SET open_resort_prog_state = '7'			, open_revw_prog_state = '5'			, open_limit_part = '1'			, open_div_cd = '1'			, last_open_resort_yyyy = '1' ,				open_grade = '1'			 		WHERE record_center_id = '1'		AND record_id = '1';


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\eval\openresortopin\OpenResortOpinRslt.xml
-- Query    : select
-- Query Id : findOpenResortRsltRecordTraceList

		SELECT A.ORG_CD		      ,A.FOLDER_ID		      ,A.RECORD_ID		      ,A.OPEN_DIV_CD||A.OPEN_GRADE AS OPEN_GUBUN		      ,A.PART_OPEN_RSN		      ,(SELECT Z.CREAT_SYS_CD||'-'||Z.ORG_CD||'-'||Z.CREAT_YYYY||'-'||Z.FOLDER_REG_SEQ||'-'||Z.HO_NO FROM TB_RDFOLDER Z WHERE Z.RECORD_CENTER_ID = A.RECORD_CENTER_ID AND Z.FOLDER_ID = A.FOLDER_ID) AS FOLDER_KEY		      ,A.CREAT_SYS_CD||'-'||A.ORG_CD||'-'||A.CREAT_YYYY||'-'||A.CREAT_REG_NO||'-'||A.DTCH_REG_NO AS RECORD_KEY		FROM TB_RDRECORD A 		WHERE RECORD_CENTER_ID = '1'		AND RECORD_ID = '1';


-- File Close : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\eval\openresortopin\OpenResortOpinRslt.xml
