-- File Open : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\srch\read\ReadHandl.xml


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\srch\read\ReadHandl.xml
-- Query    : select
-- Query Id : countReadHandlFolderPagedList

 		SELECT COUNT(1)        FROM TB_RDREADREQ A ,TB_RDFOLDERREADDETL B ,TB_RDFOLDER C        WHERE B.keep_record_center_id = C.record_center_id        AND B.folder_id = C.folder_id        AND A.record_center_id = B.record_center_id        AND A.read_reqno = B.read_reqno         AND A.READ_REQ_DIV_CD = '1'                AND B.KEEP_RECORD_CENTER_ID = '1'        AND READ_REQ_YMD BETWEEN '1' AND '1';


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\srch\read\ReadHandl.xml
-- Query    : select
-- Query Id : findReadHandlFolderPagedList

		SELECT E.keep_record_center_id		      ,E.req_record_center_id		      ,(SELECT Z.record_center_nm FROM TB_STRECORDCENTER Z WHERE Z.record_center_id = E.req_record_center_id) AS req_record_center_nm		      ,SUBSTR(E.read_reqno,1,4)||'-'||SUBSTR(E.read_reqno,5,6) AS readReqNo		      ,E.read_reqno		      ,E.folder_id		      ,E.org_cd		      ,E.cur_keep_org_cd		      ,(SELECT Z.org_nm FROM TB_STORG Z WHERE Z.record_center_id = E.keep_record_center_id AND Z.org_cd = E.org_cd) AS org_nm		      ,(SELECT Z.org_abbr_nm FROM TB_STORG Z WHERE Z.record_center_id = E.keep_record_center_id AND Z.org_cd = E.org_cd) AS org_abbr_nm		      ,E.title		      ,E.creat_yyyy		      ,E.clss_id		      ,E.clss_nm		      ,E.read_req_ymd		      ,E.read_start_ymd		      ,E.read_close_ymd		      ,E.read_ymd		      ,E.read_user_id		      ,E.read_user_nm		      ,E.read_user_dept_nm		      ,E.read_rsn		      ,E.read_aprov_cd		      ,(SELECT Z.com_cd_nm FROM TB_ZZCOMCD Z WHERE Z.com_type_cd = 'RD25' AND Z.com_cd = E.read_aprov_cd) AS read_aprov_nm		      ,E.read_aprov_user_id		      ,(SELECT Z.user_nm FROM TB_STUSER Z WHERE Z.user_id = e.read_aprov_user_id AND Z.record_center_id = E.req_record_center_id) AS read_aprov_user_nm		      ,E.handl_org_cd		      ,(SELECT Z.org_nm FROM TB_STORG Z WHERE Z.org_cd = E.handl_org_cd AND Z.record_center_id = E.keep_record_center_id) AS handl_org_nm		      ,(SELECT Z.org_abbr_nm FROM TB_STORG Z WHERE Z.org_cd = E.handl_org_cd AND Z.record_center_id = E.keep_record_center_id) AS handl_org_Abbr_nm		      ,E.read_aprov_ymd		      ,'' AS read_ymd_start		      ,'' AS read_ymd_close		      ,E.read_aprov_rsn		      ,E.read_req_prog_state_cd		      ,(CASE WHEN E.read_req_prog_state_cd = '1' AND E.read_return_cd IS NULL THEN '신청'		             WHEN E.read_req_prog_state_cd = '2' THEN '처리과지정' 		             WHEN E.read_req_prog_state_cd = '3' AND E.read_aprov_cd = '2' THEN '승인'||'('||(SELECT USER_NM FROM TB_STUSER WHERE USER_ID = E.READ_APROV_USER_ID)||')'		             WHEN E.read_req_prog_state_cd = '3' AND E.read_aprov_cd = '3' THEN '열람불가' 		             WHEN E.read_req_prog_state_cd = '4' THEN '열람'		             WHEN E.read_req_prog_state_cd = '1' AND E.read_return_cd = '1' THEN '반려'		       END) AS read_req_prog_state_nm		      ,E.read_return_cd		      ,(SELECT Z.CLOSE_FLAG FROM TB_STORG Z WHERE Z.record_center_id = E.keep_record_center_id AND Z.org_cd = E.org_cd) AS close_flag		FROM (		    SELECT D.*		    FROM (		        SELECT ROWNUM AS rnum		              ,C.*		        FROM (		            SELECT  C.record_center_id AS keep_record_center_id, A.record_center_id AS req_record_center_id, A.read_reqno, B.folder_id, C.org_cd		                  ,C.cur_keep_org_cd, C.title, C.creat_yyyy, C.clss_id, C.clss_nm		                  ,A.read_req_ymd, A.read_start_ymd, A.read_close_ymd, B.read_ymd, A.read_user_id		                  ,A.read_user_nm, A.read_user_dept_nm, A.read_rsn, B.read_aprov_cd, B.read_aprov_user_id		                  ,B.handl_org_cd, B.read_aprov_ymd, B.read_aprov_rsn, B.read_req_prog_state_cd, B.read_return_cd		                FROM TB_RDREADREQ A ,TB_RDFOLDERREADDETL B ,TB_RDFOLDER C		                WHERE B.keep_record_center_id = C.record_center_id		                AND B.folder_id = C.folder_id		                AND A.record_center_id = B.record_center_id		                AND A.read_reqno = B.read_reqno 		                AND A.READ_REQ_DIV_CD = '1'        		               AND B.KEEP_RECORD_CENTER_ID = '1'		               AND READ_REQ_YMD BETWEEN '1' AND '1'		               		               		        ) C		       WHERE ROWNUM <= '1'		    ) D		   WHERE D.rnum >= '1'		) E		ORDER BY E.rnum	;


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\srch\read\ReadHandl.xml
-- Query    : update
-- Query Id : updateReadHandlFolderConfirm

		UPDATE TB_RDFOLDERREADDETL		SET  READ_APROV_CD = '1'			,READ_REQ_PROG_STATE_CD = '3'			,READ_APROV_USER_ID = '1'			,READ_APROV_YMD = TO_CHAR(SYSDATE, 'YYYYMMDD')			 , 				READ_APROV_RSN = '1'			 			,HANDL_ORG_CD = ''			,READ_RETURN_CD = ''			,READ_RETURN_RSN = ''		WHERE RECORD_CENTER_ID = '1'		AND FOLDER_ID = '1'		AND READ_REQNO = '1';


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\srch\read\ReadHandl.xml
-- Query    : update
-- Query Id : updateReadFolderHandlOrgCd

		UPDATE TB_RDFOLDERREADDETL 		SET    READ_REQ_PROG_STATE_CD = '2',		       HANDL_ORG_CD = '1',		  	   READ_RETURN_CD = '',		  	   READ_RETURN_RSN = ''		  	     		WHERE  RECORD_CENTER_ID = '1'		AND	   FOLDER_ID = '1'		AND    READ_REQNO = '1'		AND    READ_REQ_PROG_STATE_CD = '1'	;


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\srch\read\ReadHandl.xml
-- Query    : select
-- Query Id : findReadHandlFolderList

		SELECT C.record_center_id AS keep_record_center_id			  ,A.record_center_id AS req_record_center_id,			   (SELECT Z.record_center_nm FROM tb_strecordcenter Z WHERE Z.record_center_id = A.record_center_id) req_record_center_nm,			   A.READ_REQNO,			   B.FOLDER_ID,	 			   C.ORG_CD,			   C.CUR_KEEP_ORG_CD,			   (SELECT Z.org_nm FROM tb_storg Z WHERE Z.record_center_id = C.record_center_id AND Z.org_cd = C.org_cd) AS org_nm,   			   (SELECT Z.org_abbr_nm FROM tb_storg Z WHERE Z.record_center_id = C.record_center_id AND Z.org_cd = C.org_cd) AS org_abbr_nm,	 		   C.TITLE,			   			   			   C.CREAT_YYYY,			   			   C.CLSS_ID,			   C.CLSS_NM,			   READ_REQ_YMD,			   TO_CHAR(TO_DATE(A.READ_START_YMD, 'YYYYMMDD'), 'YYYY-MM-DD') READ_START_YMD,			   TO_CHAR(TO_DATE(A.READ_CLOSE_YMD, 'YYYYMMDD'), 'YYYY-MM-DD') READ_CLOSE_YMD,			   READ_YMD,			   			   A.READ_USER_ID,			   A.READ_USER_NM,			   A.READ_USER_DEPT_NM,			   A.READ_RSN,			   B.READ_APROV_CD,			   (SELECT Z.com_cd_nm FROM tb_zzcomcd Z WHERE Z.com_type_cd = 'RD25' AND Z.com_cd = B.read_aprov_cd) AS READ_APROV_NM,			   READ_APROV_USER_ID,			   (SELECT USER_NM FROM TB_STUSER WHERE USER_ID = B.READ_APROV_USER_ID AND RECORD_CENTER_ID = A.RECORD_CENTER_ID) READ_APROV_USER_NM,					   HANDL_ORG_CD,				   (SELECT ORG_NM FROM TB_STORG WHERE ORG_CD = HANDL_ORG_CD AND RECORD_CENTER_ID = A.RECORD_CENTER_ID) HANDL_ORG_NM,   			   READ_APROV_YMD,			   '' READ_YMD_START,			   '' READ_YMD_CLOSE,			   B.READ_APROV_RSN,               B.READ_REQ_PROG_STATE_CD,               CASE WHEN B.READ_REQ_PROG_STATE_CD ='1' THEN '신청'                     WHEN B.READ_REQ_PROG_STATE_CD ='2' THEN '처리과지정'                    WHEN B.READ_REQ_PROG_STATE_CD ='3' AND B.READ_APROV_CD = '2' THEN '열람승인'                    WHEN B.READ_REQ_PROG_STATE_CD ='3' AND B.READ_APROV_CD = '3' THEN '열람불가'               END  AS READ_REQ_PROG_STATE_NM,               B.READ_RETURN_CD,               NVL((SELECT CLOSE_FLAG FROM TB_STDEPT WHERE ORG_CD = C.CUR_KEEP_ORG_CD), '1') AS CLOSE_FLAG			   		FROM   TB_RDREADREQ A, TB_RDFOLDERREADDETL B, TB_RDFOLDER C		WHERE B.keep_record_center_id = C.record_center_id        AND B.folder_id = C.folder_id        AND A.record_center_id = B.record_center_id        AND A.read_reqno = B.read_reqno        AND A.READ_REQ_DIV_CD = '1'		AND B.KEEP_RECORD_CENTER_ID = '1'        AND A.READ_REQ_YMD BETWEEN '1' AND '1' AND          		 B.READ_REQ_PROG_STATE_CD = '1'        	  		ORDER BY A.READ_REQNO DESC, READ_REQ_YMD DESC	;


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\srch\read\ReadHandl.xml
-- Query    : select
-- Query Id : countReadHandlRecordPagedList

 		SELECT COUNT(1)        FROM   TB_RDRECORD A, TB_RDRECORDREADDETL B, TB_RDREADREQ C, TB_RDFOLDER F        WHERE C.record_center_id = B.record_center_id        AND C.read_reqno = B.read_reqno        AND B.keep_record_center_id = A.record_center_id        AND B.record_id = A.record_id        AND F.record_center_id = B.keep_record_center_id        AND F.record_center_id = A.record_center_id        AND F.folder_id = A.folder_id        AND C.read_req_div_cd = '2'        AND B.keep_record_center_id = '1'        AND read_req_ymd BETWEEN '1' AND '1'        ;


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\srch\read\ReadHandl.xml
-- Query    : select
-- Query Id : findReadHandlRecordPagedList

		SELECT E.keep_record_center_id		      ,E.req_record_center_id		      ,E.org_cd		      ,(SELECT Z.record_center_nm FROM tb_strecordcenter Z WHERE Z.record_center_id = E.req_record_center_id) AS req_record_center_nm		      ,E.folder_id		      ,E.record_id		      ,SUBSTR(E.read_reqno, 1, 4)||'-'||SUBSTR(E.read_reqno, 5, 6) AS readReqNo		      ,E.read_reqno		      ,(SELECT Z.org_nm FROM TB_STORG Z WHERE Z.record_center_id = E.keep_record_center_id AND Z.org_cd = E.org_cd) AS org_nm		      ,(SELECT Z.org_abbr_nm FROM TB_STORG Z WHERE Z.record_center_id = E.keep_record_center_id AND Z.org_cd = E.org_cd) AS org_abbr_nm		      ,E.title		      ,SUBSTR(E.creat_reg_dtime, 0, 8) AS creat_reg_dtime		      ,(SELECT Z.com_cd_nm FROM TB_ZZCOMCD Z WHERE Z.com_type_cd = 'RD03' AND Z.com_cd = E.record_detl_type_cd) AS record_detl_type_nm		      ,(SELECT Z.org_nm FROM TB_STORG Z WHERE Z.record_center_id = E.keep_record_center_id AND Z.org_cd = E.read_range) AS read_range_nm		      ,(SELECT Z.org_abbr_nm FROM TB_STORG Z WHERE Z.record_center_id = E.keep_record_center_id AND Z.org_cd = E.read_range) AS read_range_abbr_nm		      ,(SELECT Z.com_cd_nm FROM TB_ZZCOMCD Z WHERE Z.com_type_cd = 'RD05' AND Z.com_cd = E.open_div_cd) AS open_div_nm		      ,E.read_req_ymd		      ,E.read_start_ymd		      ,E.read_close_ymd		      ,E.read_user_id		      ,E.read_user_nm		      ,E.read_user_dept_nm		      ,E.read_rsn		      ,E.handl_org_cd		      ,(SELECT Z.org_nm FROM TB_STORG Z WHERE Z.record_center_id = E.keep_record_center_id AND   Z.org_cd = E.handl_org_cd) AS handl_org_nm		      ,(SELECT Z.org_abbr_nm FROM TB_STORG Z WHERE Z.record_center_id = E.keep_record_center_id AND   Z.org_cd = E.handl_org_cd) AS handl_org_abbr_nm		      ,'' AS creat_dtime		      ,E.record_center_id		      ,E.oper_read_range_cd		      ,(SELECT Z.com_cd_nm FROM TB_ZZCOMCD Z WHERE Z.com_type_cd='RD53' AND Z.com_cd=E.oper_read_range_cd) AS oper_read_range_nm		      ,E.read_req_prog_state_cd		      ,CASE WHEN E.read_req_prog_state_cd ='1' AND E.read_return_cd IS NULL THEN '신청' 		            WHEN E.read_req_prog_state_cd ='2' THEN '처리과지정'		            WHEN E.read_req_prog_state_cd = '3' AND E.read_aprov_cd = '2' THEN '승인'||'('||(SELECT USER_NM FROM TB_STUSER WHERE USER_ID = E.READ_APROV_USER_ID)||')'		            WHEN E.read_req_prog_state_cd ='3' AND E.read_aprov_cd = '3' THEN '열람불가'		            WHEN E.read_req_prog_state_cd ='4' THEN '열람'		            WHEN E.read_req_prog_state_cd ='1' AND E.read_return_cd ='1' THEN '반려'		       END  AS read_req_prog_state_nm		      ,E.read_return_cd		      ,E.read_aprov_cd		      ,E.cur_keep_org_cd		      ,(SELECT Z.close_flag FROM TB_STDEPT Z WHERE Z.org_cd = E.org_cd) AS close_flag      		FROM (		    SELECT D.*		    FROM (		        SELECT ROWNUM AS rnum		              ,C.*		        FROM (		            SELECT A.record_center_id AS keep_record_center_id, B.record_center_id AS req_record_center_id, A.folder_id, A.record_id, C.read_reqno		                  ,A.org_cd, A.title, A.creat_reg_dtime, A.record_detl_type_cd, A.read_range		                  ,A.open_div_cd, C.read_req_ymd, C.read_start_ymd, C.read_close_ymd, C.read_user_id		                  ,C.read_user_nm, C.read_user_dept_nm, C.read_rsn, B.handl_org_cd, B.record_center_id		                  ,A.oper_read_range_cd, B.read_req_prog_state_cd, B.read_return_cd, B.read_aprov_cd		                  ,F.cur_keep_org_cd, B.read_aprov_user_id		            FROM   TB_RDRECORD A, TB_RDRECORDREADDETL B, TB_RDREADREQ C, TB_RDFOLDER F		            WHERE C.record_center_id = B.record_center_id		            AND C.read_reqno = B.read_reqno		            AND B.keep_record_center_id = A.record_center_id		            AND B.record_id = A.record_id		            AND F.record_center_id = B.keep_record_center_id		            AND F.record_center_id = A.record_center_id		            AND F.folder_id = A.folder_id		            AND C.read_req_div_cd = '2'		            AND B.keep_record_center_id = '1'		            AND read_req_ymd BETWEEN '1' AND '1'		       ) C		       WHERE ROWNUM <= '1'		    ) D		   WHERE D.rnum >= '1'		) E		ORDER BY E.rnum	;


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\srch\read\ReadHandl.xml
-- Query    : update
-- Query Id : updateReadHandlRecordConfirm

		UPDATE TB_RDRECORDREADDETL		SET  READ_APROV_CD = '1'			,READ_REQ_PROG_STATE_CD = '3'			,READ_APROV_USER_ID = '1'			,READ_APROV_YMD = TO_CHAR(SYSDATE, 'YYYYMMDD')			 , 				READ_APROV_RSN = '1'			 			,HANDL_ORG_CD = ''			,READ_RETURN_CD = ''			,READ_RETURN_RSN = ''		WHERE RECORD_CENTER_ID = '1'		AND RECORD_ID = '1'		AND READ_REQNO = '1';


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\srch\read\ReadHandl.xml
-- Query    : update
-- Query Id : updateReadRecordHandlOrgCd

		UPDATE TB_RDRECORDREADDETL 		SET    READ_REQ_PROG_STATE_CD = '2',		       HANDL_ORG_CD = '1',		  	   READ_RETURN_CD = '',		  	   READ_RETURN_RSN = ''		  	     		WHERE  RECORD_CENTER_ID = '1'		AND	   RECORD_ID = '1'		AND    READ_REQNO = '1'		AND    READ_REQ_PROG_STATE_CD = '1'	;


-- Filename : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\srch\read\ReadHandl.xml
-- Query    : select
-- Query Id : findReadHandlRecordList

		SELECT A.record_center_id AS keep_record_center_id,			   B.record_center_id As req_record_center_id,			   (SELECT Z.record_center_nm FROM tb_strecordcenter Z WHERE Z.record_center_id = B.record_center_id) AS req_record_center_nm,			   A.FOLDER_ID,			   A.RECORD_ID,			   C.READ_REQNO, 			   (SELECT Z.org_nm FROM TB_STORG Z WHERE Z.record_center_id = A.record_center_id AND Z.org_cd = A.org_cd) AS org_nm,			   (SELECT Z.org_abbr_nm FROM TB_STORG Z WHERE Z.record_center_id = A.record_center_id AND Z.org_cd = A.org_cd) AS org_abbr_nm,			   			   A.TITLE,			   SUBSTR(a.CREAT_REG_DTIME, 0, 8) AS CREAT_REG_DTIME,			   (SELECT COM_CD_NM FROM TB_ZZCOMCD WHERE COM_TYPE_CD = 'RD03' AND	TB_ZZCOMCD.COM_CD = A.RECORD_DETL_TYPE_CD) RECORD_DETL_TYPE_NM,			   (SELECT ORG_NM FROM TB_STORG WHERE ORG_CD = A.READ_RANGE AND RECORD_CENTER_ID = A.RECORD_CENTER_ID) READ_RANGE_NM,			   (SELECT ORG_ABBR_NM FROM TB_STORG WHERE ORG_CD = A.READ_RANGE AND RECORD_CENTER_ID = A.RECORD_CENTER_ID) READ_RANGE_ABBR_NM,			   			   (SELECT COM_CD_NM FROM TB_ZZCOMCD WHERE COM_TYPE_CD = 'RD05' AND	TB_ZZCOMCD.COM_CD = A.OPEN_DIV_CD) OPEN_DIV_NM,			   READ_REQ_YMD,			   C.READ_START_YMD,			   C.READ_CLOSE_YMD,               C.READ_USER_ID,               C.READ_USER_NM,               C.READ_USER_DEPT_NM,               C.READ_RSN,			   B.handl_org_cd,               (SELECT Z.ORG_NM FROM TB_STORG Z WHERE Z.RECORD_CENTER_ID = B.KEEP_RECORD_CENTER_ID AND   Z.org_cd = B.handl_org_cd) HANDL_ORG_NM,               (SELECT Z.ORG_NM FROM TB_STORG Z WHERE Z.RECORD_CENTER_ID = B.KEEP_RECORD_CENTER_ID AND   Z.org_cd = B.handl_org_cd) HANDL_ORG_ABBR_NM,			   '' CREAT_DTIME,			   B.RECORD_CENTER_ID,			   A.OPER_READ_RANGE_CD,			   (SELECT Z.COM_CD_NM FROM TB_ZZCOMCD Z WHERE Z.COM_TYPE_CD='RD53' AND Z.COM_CD=A.OPER_READ_RANGE_CD) OPER_READ_RANGE_NM,               B.READ_REQ_PROG_STATE_CD,               CASE WHEN B.READ_REQ_PROG_STATE_CD ='1' THEN '신청'                     WHEN B.READ_REQ_PROG_STATE_CD ='2' THEN '처리과지정'                    WHEN B.READ_REQ_PROG_STATE_CD ='3' AND B.READ_APROV_CD = '2' THEN '열람승인'                    WHEN B.READ_REQ_PROG_STATE_CD ='3' AND B.READ_APROV_CD = '3' THEN '열람불가'               END  AS READ_REQ_PROG_STATE_NM,               B.READ_RETURN_CD,               A.ORG_CD,               F.CUR_KEEP_ORG_CD,               B.READ_APROV_CD,               NVL((SELECT CLOSE_FLAG FROM TB_STDEPT WHERE ORG_CD = F.CUR_KEEP_ORG_CD), '1') AS CLOSE_FLAG			   		FROM   TB_RDRECORD A,			   TB_RDRECORDREADDETL B,			   TB_RDREADREQ C,			   TB_RDFOLDER F   		WHERE C.record_center_id = B.record_center_id        AND C.read_reqno = B.read_reqno        AND B.keep_record_center_id = A.record_center_id        AND B.record_id = A.record_id        AND F.record_center_id = B.keep_record_center_id        AND F.record_center_id = A.record_center_id        AND F.folder_id = A.folder_id		AND C.READ_REQ_DIV_CD = '2'		AND B.READ_REQ_PROG_STATE_CD = '1'			AND B.KEEP_RECORD_CENTER_ID = '1'		AND READ_REQ_YMD BETWEEN '1' AND '1'		 AND          		 B.READ_REQ_PROG_STATE_CD = '1'        	  		ORDER BY C.READ_REQNO DESC, READ_REQ_YMD	;


-- File Close : C:\eclipse\workspace\SqlMapXMLParser\rmsCubrid\rms\default\rms\srch\read\ReadHandl.xml
