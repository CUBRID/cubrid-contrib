<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="stnd.stndinfo">
	<resultMap id="stnd-task-result" class="rms.stnd.stndinfo.domain.Task" >
		<result property="bisClssId"				  column="BIS_CLSS_ID"/>
		<result property="bisClssNm"				  column="BIS_CLSS_NM"/>
		<result property="bisClssPathNm" 			  column="BIS_CLSS_PATH_NM"/>
		<result property="startDtime" 				  column="START_DTIME"/>	
		<result property="presvTermNm" 				  column="PRESV_TERM_NM"/>
		<result property="presvTermHandlStateNm"	  column="PRESV_TERM_HANDL_STATE_NM"/>
		<result property="recordCenterPresvTermCdNm"  column="RECORD_CENTER_PRESV_TERM_NM"/>
		<result property="recordCenterCheckYmd"       column="RECORD_CENTER_CHECK_YMD"/>
		<result property="recordCenterOpin" 		  column="RECORD_CENTER_OPIN"/>
		<result property="delFlagNm"		          column="DEL_FLAG_NM"/>
		<result property="bisTypeNm"                  column="BIS_TYPE_NM"/>
		<result property="writeFlagNm" 				  column="WRITE_FLAG_NM"/>
		</resultMap>
	<resultMap id="stnd-task-remedi-result" class="rms.stnd.stndinfo.domain.Task" >
		<result property="bisClssId"				  column="BIS_CLSS_ID"/>
		<result property="bisClssNm"				  column="BIS_CLSS_NM"/>
		<result property="bisClssPathNm" 			  column="BIS_CLSS_PATH_NM"/>
		<result property="startDtime" 				  column="START_DTIME"/>	
		<result property="presvTermNm" 				  column="PRESV_TERM_NM"/>
		<result property="presvTermHandlStateNm"	  column="PRESV_TERM_HANDL_STATE_NM"/>
		<result property="narsPresvTermCdNm"          column="NARS_PRESV_TERM_NM"/>
		<result property="narsCheckYmd"               column="NARS_CHECK_YMD"/>
		<result property="narsOpin" 		          column="NARS_OPIN"/>
		<result property="delFlagNm"		          column="DEL_FLAG_NM"/>
		<result property="bisTypeNm"                  column="BIS_TYPE_NM"/>
		<result property="presvTermState"             column="PRESV_TERM_STATE"/>
		<result property="resubmitFlag"		          column="RESUBMIT_FLAG"/>
		<result property="presvTermFileCreatState"    column="PRESV_TERM_FILE_CREAT_STATE"/>
		<result property="taskDescr"                  column="TASK_DESCR"/>
	</resultMap>
	
	
	<resultMap id="stnd-task-excel-result" class="rms.stnd.stndinfo.domain.Task" >
		<result property="bisClssId"				  column="BIS_CLSS_ID"/>
		<result property="bisClssNm"				  column="BIS_CLSS_NM"/>
		<result property="bisClssPathNm" 			  column="BIS_CLSS_PATH_NM"/>
		<result property="startDtime" 				  column="START_DTIME"/>	
		<result property="presvTermNm" 				  column="PRESV_TERM_NM"/>
		<result property="presvTermHandlStateNm"	  column="PRESV_TERM_HANDL_STATE_NM"/>
		<result property="recordCenterPresvTermCdNm"  column="RECORD_CENTER_PRESV_TERM_NM"/>
		<result property="recordCenterCheckYmd"       column="RECORD_CENTER_CHECK_YMD"/>
		<result property="recordCenterOpin" 		  column="RECORD_CENTER_OPIN"/>
		<result property="delFlagNm"		          column="DEL_FLAG_NM"/>
		<result property="bisTypeNm"                  column="BIS_TYPE_NM"/>
		<result property="taskDescr"                  column="TASK_DESCR"/>
	</resultMap>
	<resultMap id="stnd-taskinfo-result" class="rms.stnd.stndinfo.domain.Task" >
		<result property="bisClssId"				column="BIS_CLSS_ID"/>
		<result property="bisClssNm"				column="BIS_CLSS_NM"/>
		<result property="presvTermCd" 				column="PRESV_TERM_CD"/>
		<result property="presvTermNm" 				column="PRESV_TERM_NM"/>		
		<result property="bisType" 					column="BIS_TYPE"/>	
		<result property="startDtime" 				column="START_DTIME"/>	
		<result property="closeDtime" 				column="CLOSE_DTIME"/>	
		<result property="lawBasis" 				column="LAW_BASIS"/>	
		<result property="presvTermFixYmd"			column="PRESV_TERM_FIX_YMD"/>
		<result property="presvTermFixRsn"			column="PRESV_TERM_FIX_RSN"/>
		<result property="openDetlStnd" 			column="OPEN_DETL_STND"/>	
		<result property="readRangeDetlStnd" 		column="READ_RANGE_DETL_STND"/>	
		<result property="funshRecord" 				column="FUNSH_RECORD"/>
		<result property="bisClssPathNm" 			column="BIS_CLSS_PATH_NM"/>	
		<result property="pjtClssPathNm" 			column="PJT_CLSS_PATH_NM"/>	
		<result property="taskDescr" 				column="TASK_DESCR"/>	
		<result property="writeFlag" 				column="WRITE_FLAG"/>	
		<result property="presvTermFixYmd"	 		column="PRESV_TERM_FIX_YMD"/>	
		<result property="taskRemk" 				column="TASK_REMK"/>	
		<result property="presvTermHandlState"		column="PRESV_TERM_HANDL_STATE"/>
		<result property="presvTermHandlStateNm"	column="PRESV_TERM_HANDL_STATE_NM"/>
		<result property="presvTermFixRsn"			column="PRESV_TERM_FIX_RSN"/>
	    <result property="funshFlag" 				column="FUNSH_FLAG"/>
		<result property="funshRsn" 				column="FUNSH_RSN"/>
		<result property="funshTerm" 				column="FUNSH_TERM"/>
	</resultMap>
	
	<resultMap id="stnd-midref-result" class="rms.stnd.stndinfo.domain.Task" >
		<result property="bisClssNm"				column="BIS_CLSS_NM"/>
		<result property="presvTermCd" 				column="PRESV_TERM_CD"/>
		<result property="presvTermNm" 				column="PRESV_TERM_NM"/>
		<result property="bisClssPathNm" 			column="BIS_CLSS_PATH_NM"/>
    </resultMap>
	
	<resultMap id="stnd-chrgorg-result" class="rms.stnd.stndinfo.domain.Task" >
		<result property="orgCd" 					column="ORG_CD"/>
		<result property="orgNm" 					column="ORG_NM"/>
		<result property="orgAbbrNm" 				column="ORG_ABBR_NM"/>
		<result property="fullOrgNm" 				column="FULL_ORG_NM"/>
	</resultMap>
	
	<resultMap id="stnd-unitcreat-result" class="rms.stnd.stndinfo.domain.Task" >
		<result property="bisClssId" 				column="BIS_CLSS_ID"/>
		<result property="bisClssNm"				column="BIS_CLSS_NM"/>
		<result property="startDtime" 				column="START_DTIME"/>
		<result property="chrgOrgNm" 				column="CHRG_ORG_NM"/>
		<result property="chrgOrgAbbrNm" 			column="CHRG_ORG_ABBR_NM"/>	
		<result property="unitCd" 					column="UNIT_CD"/>
		<result property="unitCdTransFlag" 			column="UNIT_CD_TRANS_FLAG"/>
	</resultMap>
	
	<resultMap id="stnd-taskforunit-result" class="rms.stnd.unitcreat.domain.SendUnit" >
		<result property="narsHandlDtime" 			column="NARS_HANDL_DTIME"/>
		<result property="creatStndYmd"				column="CREAT_STND_YMD"/>
		<result property="lrgCd" 					column="LRG_CD"/>
		<result property="lrgNm" 					column="LRG_NM"/>
		<result property="midCd" 					column="MID_CD"/>
		<result property="midNm" 					column="MID_NM"/>
		<result property="smlCd" 					column="SML_CD"/>
		<result property="smlNm" 					column="SML_NM"/>
		<result property="unitCd" 					column="UNIT_CD"/>
		<result property="unitNm" 					column="UNIT_NM"/>
		<result property="unitDescr" 				column="UNIT_DESCR"/>
		<result property="presvTermCd" 				column="PRESV_TERM_CD"/>
		<result property="presvTermFixRsn" 			column="PRESV_TERM_FIX_RSN"/>
		<result property="stateCd" 					column="STATE_CD"/>
		<result property="linkDtime" 				column="LINK_DTIME"/>
	</resultMap>
	
	<resultMap id="stnd-delflag-result" class="rms.stnd.stndinfo.domain.Task" >
		<result property="delFlag" 					column="DEL_FLAG"/>
		<result property="linkDtime" 				column="LINK_DTIME"/>
		<result property="bisClssId" 				column="BIS_CLSS_ID"/>
	</resultMap>
	
	<resultMap id="stnd-chrgorgdelflag-result" class="rms.stnd.stndinfo.domain.Task" >
		<result property="delFlag" 					column="DEL_FLAG"/>
	</resultMap>
	
	<resultMap id="stnd-task-narsreq-result" class="rms.stnd.stndinfo.domain.Task" >
		<result property="bisClssId"				  column="BIS_CLSS_ID"/>
		<result property="bisClssNm"				  column="BIS_CLSS_NM"/>
		<result property="bisClssPathNm" 			  column="BIS_CLSS_PATH_NM"/>
		<result property="startDtime" 				  column="START_DTIME"/>	
		<result property="presvTermNm" 				  column="PRESV_TERM_NM"/>
		<result property="recordCenterPresvTermCdNm"  column="RECORD_CENTER_PRESV_TERM_NM"/>
		<result property="recordCenterCheckYmd"       column="RECORD_CENTER_CHECK_YMD"/>
		<result property="recordCenterOpin" 		  column="RECORD_CENTER_OPIN"/>
		<result property="delFlagNm"		          column="DEL_FLAG_NM"/>
		<result property="resubmitFlag"		          column="RESUBMIT_FLAG"/>
		<result property="bisTypeNm"                  column="BIS_TYPE_NM"/>
		<result property="taskDescr" 				  column="TASK_DESCR"/>	
	</resultMap>
		<!--
		기록관 설정 조회 COUNT
	-->
	<select id="countTask" parameterClass="rms.stnd.stndinfo.domain.Task" resultClass="long">
	SELECT count(1)
	  FROM (SELECT C.BIS_CLSS_ID
	       ,C.BIS_CLSS_NM
	       ,C.BIS_CLSS_PATH_NM
	       ,(SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'ZZ03'
                AND use_flag = '1'
                AND com_cd = REPLACE(C.BIS_TYPE,'B','')) bis_type_nm
	       ,C.START_DTIME
	       ,(SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'RD07'
                AND use_flag = '1'
                AND com_cd = DECODE(C.presv_term_cd, '20', '25', C.presv_term_cd))  PRESV_TERM_NM
	       ,(SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'ZZ11'
                AND use_flag = '1'
                AND com_cd =C.presv_term_state) PRESV_TERM_HANDL_STATE_NM
	       ,(SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'RD07'
                AND use_flag = '1'
                AND com_cd = DECODE(B.RECORD_CENTER_PRESV_TERM_CD, '20', '25', B.RECORD_CENTER_PRESV_TERM_CD)) RECORD_CENTER_PRESV_TERM_NM
	       ,B.RECORD_CENTER_CHECK_YMD
	       ,B.RECORD_CENTER_OPIN
	       ,(SELECT COM_CD_NM
	           FROM TB_ZZCOMCD
		      WHERE COM_TYPE_CD='ZZ19'
		        AND USE_FLAG='0'
			    AND COM_CD=C.DEL_FLAG)DEL_FLAG_NM
	       ,(SELECT COM_CD_NM
              FROM TB_ZZCOMCD
             WHERE COM_TYPE_CD = 'ZZ01'
               AND USE_FLAG = '1'
               AND COM_CD=C.WRITE_FLAG) WRITE_FLAG_NM
           ,C.DEL_FLAG
           ,C.WRITE_FLAG
           ,REPLACE(C.BIS_TYPE,'B','') bis_type
           ,C.PRESV_TERM_STATE
           ,C.PRESV_TERM_CD
	  FROM (SELECT A.BIS_CLSS_ID, A.bis_clss_nm
           ,SYS_CONNECT_BY_PATH(A.bis_clss_nm,'>') bis_clss_path_nm 
	       ,A.BIS_TYPE
           ,A.START_DTIME
           ,A.PRESV_TERM_CD
	       ,A.PRESV_TERM_STATE
	       ,A.DEL_FLAG
		   ,A.WRITE_FLAG
		   FROM tb_zzbisclss A 
      WHERE A.levl='6' and A.presv_term_state in (1,2)
           START WITH A.bis_clss_id ='00000000000000000000000000000000000'
      CONNECT BY PRIOR A.bis_clss_id = A.upper_bis_clss_id) C,TB_ZZPRESVTERMHIST B
      WHERE C.BIS_CLSS_ID = B.BIS_CLSS_ID ) D
      
      <dynamic prepend="WHERE">
          <isNotEmpty prepend="AND" property="bisClssPathNm">
	  	    D.BIS_CLSS_PATH_NM LIKE #bisClssPathNm:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="AND" property="bisClssId">
		    D.BIS_CLSS_ID = #bisClssId:VARCHAR# 
		  </isNotEmpty>
		  <isNotEmpty prepend="AND" property="chrgOrgCd">	
			D.BIS_CLSS_ID IN (SELECT BIS_CLSS_ID 
								FROM TB_ZZBISORG
							   WHERE ORG_CD= #chrgOrgCd:VARCHAR#)
		  </isNotEmpty>
          <isNotEmpty property="presvTermCd">
	          <isEqual prepend="AND" property="presvTermCd" compareValue="25">
	              D.PRESV_TERM_CD IN ('20','25')
              </isEqual>
	          <isNotEqual prepend="AND" property="presvTermCd" compareValue="25">
			D.PRESV_TERM_CD = #presvTermCd:VARCHAR#
              </isNotEqual>		            
		  </isNotEmpty>						
		  <isNotEmpty prepend="AND" property="writeFlag">
			D.WRITE_FLAG = #writeFlag:VARCHAR#
		  </isNotEmpty>			
		  <isNotEmpty prepend="AND" property="bisType">
			D.BIS_TYPE = #bisType:VARCHAR#
		  </isNotEmpty>
	      <isNotEmpty prepend="AND" property="presvTermState">
			D.PRESV_TERM_STATE = #presvTermState:VARCHAR#
		  </isNotEmpty>
		  <isNotEmpty prepend="AND" property="delFlag">
			D.DEL_FLAG = #delFlag:VARCHAR#
		  </isNotEmpty>
     </dynamic>
     <dynamic>
		  <isEqual property="order" compareValue="1">
			    ORDER BY START_DTIME
			   </isEqual>
			   <isEqual property="order" compareValue="2">
				ORDER BY START_DTIME DESC
			   </isEqual>
			   <isEqual  property="order" compareValue="0">
				ORDER BY BIS_TYPE,BIS_CLSS_NM
			   </isEqual>	
		  
	</dynamic>	
		     
	 </select>	
	
	<!-- 
		기록관 설정  조회 SELECT
	 -->
	 <select id="findTask" parameterClass="rms.stnd.stndinfo.domain.Task" resultMap="stnd-task-result">
<!--cubrid
	 SELECT BB.*
		FROM (
			SELECT 

			ROWNUM AS rnum
				,CC.*
			FROM (
-->
	 SELECT ROWNUM AS rnum
	       ,D.BIS_CLSS_ID
	       ,D.BIS_CLSS_NM
	       ,D.BIS_CLSS_PATH_NM
	       ,D.BIS_TYPE_NM
	       ,D.START_DTIME
	       ,D.PRESV_TERM_NM
	       ,D.PRESV_TERM_HANDL_STATE_NM
	       ,D.RECORD_CENTER_PRESV_TERM_NM
	       ,D.RECORD_CENTER_CHECK_YMD
	       ,D.RECORD_CENTER_OPIN
	       ,D.DEL_FLAG_NM
	       ,D.WRITE_FLAG_NM
	       ,D.DEL_FLAG
	       ,D.BIS_TYPE
	 FROM 
	 (SELECT C.BIS_CLSS_ID
	       ,C.BIS_CLSS_NM
	       ,C.BIS_CLSS_PATH_NM
	       ,NVL((SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'ZZ03'
                AND use_flag = '1'
                AND com_cd = REPLACE(C.BIS_TYPE,'B','')),REPLACE(C.BIS_TYPE,'B','')) bis_type_nm
	       ,C.START_DTIME
	       ,(SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'RD07'
                AND use_flag = '1'
                AND com_cd = DECODE(C.presv_term_cd, '20', '25', C.presv_term_cd)) PRESV_TERM_NM
	       ,(SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'ZZ11'
                AND use_flag = '1'
                AND com_cd =C.presv_term_state) PRESV_TERM_HANDL_STATE_NM
	       ,(SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'RD07'
                AND use_flag = '1'
                AND com_cd = DECODE(B.RECORD_CENTER_PRESV_TERM_CD, '20', '25', B.RECORD_CENTER_PRESV_TERM_CD)) RECORD_CENTER_PRESV_TERM_NM
	       ,B.RECORD_CENTER_CHECK_YMD
	       ,B.RECORD_CENTER_OPIN
	       ,(SELECT COM_CD_NM
	           FROM TB_ZZCOMCD
		      WHERE COM_TYPE_CD='ZZ19'
		        AND USE_FLAG='0'
			    AND COM_CD=C.DEL_FLAG)DEL_FLAG_NM
	       ,(SELECT COM_CD_NM
              FROM TB_ZZCOMCD
             WHERE COM_TYPE_CD = 'ZZ01'
               AND USE_FLAG = '1'
               AND COM_CD=C.WRITE_FLAG) WRITE_FLAG_NM
           ,C.DEL_FLAG
           ,C.WRITE_FLAG
           ,REPLACE(C.BIS_TYPE,'B','') bis_type
           ,C.PRESV_TERM_STATE
           ,C.PRESV_TERM_CD
	  FROM (SELECT A.BIS_CLSS_ID, A.bis_clss_nm
           ,SYS_CONNECT_BY_PATH(A.bis_clss_nm,'>') bis_clss_path_nm 
	       ,A.BIS_TYPE
           ,A.START_DTIME
           ,A.PRESV_TERM_CD
	       ,A.PRESV_TERM_STATE
	       ,A.DEL_FLAG
		   ,A.WRITE_FLAG
		   FROM tb_zzbisclss A 
      WHERE A.levl='6' and A.presv_term_state in (1,2)
           START WITH A.bis_clss_id ='00000000000000000000000000000000000'
      CONNECT BY PRIOR A.bis_clss_id = A.upper_bis_clss_id) C,TB_ZZPRESVTERMHIST B
      WHERE C.BIS_CLSS_ID = B.BIS_CLSS_ID 
      <!--cubrid
      ) D
      -->
      <dynamic>
          <isNotEmpty prepend="AND" property="bisClssPathNm">
	  	    C.BIS_CLSS_PATH_NM LIKE #bisClssPathNm:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="AND" property="bisClssId">
		    C.BIS_CLSS_ID = #bisClssId:VARCHAR# 
		  </isNotEmpty>
		  <isNotEmpty prepend="AND" property="chrgOrgCd">	
			C.BIS_CLSS_ID IN (SELECT BIS_CLSS_ID 
								FROM TB_ZZBISORG
							   WHERE ORG_CD= #chrgOrgCd:VARCHAR#)
		  </isNotEmpty>
          <isNotEmpty property="presvTermCd">
	          <isEqual prepend="AND" property="presvTermCd" compareValue="25">
	              C.PRESV_TERM_CD IN ('20','25')
              </isEqual>
	          <isNotEqual prepend="AND" property="presvTermCd" compareValue="25">
			C.PRESV_TERM_CD = #presvTermCd:VARCHAR#
              </isNotEqual>		            
		  </isNotEmpty>						
		  <isNotEmpty prepend="AND" property="writeFlag">
			C.WRITE_FLAG = #writeFlag:VARCHAR#
		  </isNotEmpty>			
		  <isNotEmpty prepend="AND" property="bisType">
			C.BIS_TYPE = #bisType:VARCHAR#
		  </isNotEmpty>
	      <isNotEmpty prepend="AND" property="presvTermState">
			C.PRESV_TERM_STATE = #presvTermState:VARCHAR#
		  </isNotEmpty>
		  <isNotEmpty prepend="AND" property="delFlag">
			C.DEL_FLAG = #delFlag:VARCHAR#
		  </isNotEmpty>	 
<!--cubrid-->
		  <isEmpty prepend="AND" property="order">
			ROWNUM BETWEEN #pagedStart:NUMBER# AND #pagedEnd:NUMBER#
		  </isEmpty>
	</dynamic>
	<dynamic>	  
		  <isEqual property="order" compareValue="1">
		      ORDER BY START_DTIME for orderby_num() between #pagedEnd:NUMBER# AND #pagedStart:NUMBER#
		  </isEqual>
		  <isEqual property="order" compareValue="2">
		      ORDER BY START_DTIME DESC for orderby_num() between #pagedEnd:NUMBER# AND #pagedStart:NUMBER#
		  </isEqual>
		  <isEqual  property="order" compareValue="0">
		      ORDER BY BIS_TYPE,BIS_CLSS_NM for orderby_num() between #pagedEnd:NUMBER# AND #pagedStart:NUMBER#
		  </isEqual>	
	</dynamic>	
	) D
<!--cubrid
		     			) CC
						WHERE ROWNUM <![CDATA[<=]]> #pagedEnd:NUMBER#
					) BB
					WHERE BB.rnum <![CDATA[>=]]> #pagedStart:NUMBER#
-->		     
	 </select>	
	 
	<!-- 
		기록관 설정 Excel 조회 SELECT
	 -->
	  <select id="findTaskExcel" parameterClass="rms.stnd.stndinfo.domain.Task" resultMap="stnd-task-excel-result">
	SELECT D.BIS_CLSS_ID
	       ,D.BIS_CLSS_NM
	       ,D.BIS_CLSS_PATH_NM
	       ,D.BIS_TYPE_NM
	       ,D.START_DTIME
	       ,D.PRESV_TERM_NM
	       ,D.PRESV_TERM_HANDL_STATE_NM
	       ,D.RECORD_CENTER_PRESV_TERM_NM
	       ,D.RECORD_CENTER_CHECK_YMD
	       ,D.RECORD_CENTER_OPIN
	       ,D.DEL_FLAG_NM
	       ,D.DEL_FLAG
	       ,D.TASK_DESCR
	 FROM 
	 (SELECT C.BIS_CLSS_ID
	       ,C.BIS_CLSS_NM
	       ,C.BIS_CLSS_PATH_NM
	       ,NVL((SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'ZZ03'
                AND use_flag = '1'
                AND com_cd = REPLACE(C.BIS_TYPE,'B','')),REPLACE(C.BIS_TYPE,'B','')) bis_type_nm
	       ,C.START_DTIME
	       ,(SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'RD07'
                AND use_flag = '1'
                AND com_cd = C.presv_term_cd)  PRESV_TERM_NM
	       ,(SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'ZZ11'
                AND use_flag = '1'
                AND com_cd =C.presv_term_state) PRESV_TERM_HANDL_STATE_NM
	       ,(SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'RD07'
                AND use_flag = '1'
                AND com_cd = B.RECORD_CENTER_PRESV_TERM_CD) RECORD_CENTER_PRESV_TERM_NM
	       ,B.RECORD_CENTER_CHECK_YMD
	       ,B.RECORD_CENTER_OPIN
	       ,(SELECT COM_CD_NM
	           FROM TB_ZZCOMCD
		      WHERE COM_TYPE_CD='ZZ19'
		        AND USE_FLAG='0'
			    AND COM_CD=C.DEL_FLAG)DEL_FLAG_NM
	       ,(SELECT COM_CD_NM
              FROM TB_ZZCOMCD
             WHERE COM_TYPE_CD = 'ZZ01'
               AND USE_FLAG = '1'
               AND COM_CD=C.WRITE_FLAG) WRITE_FLAG_NM
           ,C.DEL_FLAG
           ,C.WRITE_FLAG
           ,REPLACE(C.BIS_TYPE,'B','') bis_type
           ,C.TASK_DESCR
           ,C.PRESV_TERM_STATE
	  FROM (SELECT A.BIS_CLSS_ID, A.bis_clss_nm
           ,SYS_CONNECT_BY_PATH(A.bis_clss_nm,'>') bis_clss_path_nm 
	       ,A.BIS_TYPE
           ,A.START_DTIME
           ,A.PRESV_TERM_CD
	       ,A.PRESV_TERM_STATE
	       ,A.DEL_FLAG
		   ,A.WRITE_FLAG
		   ,A.TASK_DESCR
		   FROM tb_zzbisclss A 
      WHERE A.levl='6' and A.presv_term_state in (1,2)
           START WITH A.bis_clss_id ='00000000000000000000000000000000000'
      CONNECT BY PRIOR A.bis_clss_id = A.upper_bis_clss_id) C,TB_ZZPRESVTERMHIST B
      WHERE C.BIS_CLSS_ID = B.BIS_CLSS_ID ) D
      
      <dynamic prepend="WHERE">
          <isNotEmpty prepend="AND" property="bisClssPathNm">
	  	    D.BIS_CLSS_PATH_NM LIKE #bisClssPathNm:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="AND" property="bisClssId">
		    D.BIS_CLSS_ID = #bisClssId:VARCHAR# 
		  </isNotEmpty>
		  <isNotEmpty prepend="AND" property="chrgOrgCd">	
			D.BIS_CLSS_ID IN (SELECT BIS_CLSS_ID 
								FROM TB_ZZBISORG
							   WHERE ORG_CD= #chrgOrgCd:VARCHAR#)
		  </isNotEmpty>
		  <isNotEmpty prepend="AND" property="presvTermCd">
			D.PRESV_TERM_CD = #presvTermCd:VARCHAR#
		  </isNotEmpty>						
		  <isNotEmpty prepend="AND" property="writeFlag">
			D.WRITE_FLAG = #writeFlag:VARCHAR#
		  </isNotEmpty>			
		  <isNotEmpty prepend="AND" property="bisType">
			D.BIS_TYPE = #bisType:VARCHAR#
		  </isNotEmpty>
	      <isNotEmpty prepend="AND" property="presvTermState">
			D.PRESV_TERM_STATE = #presvTermState:VARCHAR#
		  </isNotEmpty>
		  <isNotEmpty prepend="AND" property="delFlag">
			D.DEL_FLAG = #delFlag:VARCHAR#
		  </isNotEmpty>
     </dynamic>
     <dynamic>  
		  <isEqual property="order" compareValue="1">
		      ORDER BY START_DTIME
		  </isEqual>
		  <isEqual property="order" compareValue="2">
		      ORDER BY START_DTIME DESC
		  </isEqual>
		  <isEqual  property="order" compareValue="0">
		      ORDER BY BIS_TYPE,BIS_CLSS_NM
		  </isEqual>
	</dynamic>
    </select>
	
	<!-- 엑셀 저장 시 주관부서 조회 -->
	<select id="findExcelOrgNm" parameterClass="rms.stnd.stndinfo.domain.Task" resultMap="stnd-chrgorg-result">
		SELECT A.org_cd
			, (SELECT B.org_nm FROM TB_STORG B WHERE B.org_cd=A.org_cd and b.record_center_id=#recordCenterId:VARCHAR#) org_nm
			, (SELECT B.org_abbr_nm FROM TB_STORG B WHERE B.org_cd=A.org_cd and b.record_center_id=#recordCenterId:VARCHAR#) org_abbr_nm
			, (SELECT B.full_org_nm FROM TB_STORG B WHERE B.org_cd=A.org_cd and b.record_center_id=#recordCenterId:VARCHAR#) full_org_nm
		FROM TB_ZZBISORG A
		WHERE A.bis_clss_id = #bisClssId:VARCHAR#
		AND   A.del_flag = '0'
    </select>
	 
	 <!-- 기록원 확정 조회 COUNT -->
	  <select id="countTaskReMedi" parameterClass="rms.stnd.stndinfo.domain.Task" resultClass="int">
	SELECT COUNT(1)
	 FROM 
	 (SELECT C.BIS_CLSS_ID
	       ,C.BIS_CLSS_NM
	       ,C.BIS_CLSS_PATH_NM
	       ,(SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'ZZ03'
                AND use_flag = '1'
                AND com_cd = REPLACE(C.BIS_TYPE,'B','')) bis_type_nm
	       ,C.START_DTIME
	       ,(SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'RD07'
                AND use_flag = '1'
                AND com_cd = C.presv_term_cd)  PRESV_TERM_NM
	       ,(SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'ZZ11'
                AND use_flag = '1'
                AND com_cd =decode(c.presv_term_state,2,3,c.presv_term_state)) presv_term_handl_state_nm
	       ,(SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'RD07'
                AND use_flag = '1'
                AND com_cd = B.NARS_PRESV_TERM_CD) NARS_PRESV_TERM_NM
	       ,B.NARS_CHECK_YMD
	       ,B.NARS_OPIN
	       ,(SELECT COM_CD_NM
	           FROM TB_ZZCOMCD
		      WHERE COM_TYPE_CD='ZZ19'
		        AND USE_FLAG='0'
			    AND COM_CD=C.DEL_FLAG)DEL_FLAG_NM
	       ,(SELECT COM_CD_NM
              FROM TB_ZZCOMCD
             WHERE COM_TYPE_CD = 'ZZ01'
               AND USE_FLAG = '1'
               AND COM_CD=C.WRITE_FLAG) WRITE_FLAG_NM
           ,C.DEL_FLAG
           ,C.WRITE_FLAG
           ,REPLACE(C.BIS_TYPE,'B','') bis_type
           ,C.TASK_DESCR
           ,C.PRESV_TERM_STATE
           ,C.PRESV_TERM_FILE_CREAT_STATE
	  FROM (SELECT A.BIS_CLSS_ID, A.bis_clss_nm
           ,SYS_CONNECT_BY_PATH(A.bis_clss_nm,'>') bis_clss_path_nm 
	       ,A.BIS_TYPE
           ,A.START_DTIME
           ,A.PRESV_TERM_CD
	       ,A.PRESV_TERM_STATE
	       ,A.DEL_FLAG
		   ,A.WRITE_FLAG
		   ,A.TASK_DESCR
		   ,A.PRESV_TERM_FILE_CREAT_STATE
		   FROM tb_zzbisclss A 
      WHERE A.levl='6' 
           START WITH A.bis_clss_id ='00000000000000000000000000000000000'
      CONNECT BY PRIOR A.bis_clss_id = A.upper_bis_clss_id) C,TB_ZZPRESVTERMHIST B
      WHERE C.BIS_CLSS_ID = B.BIS_CLSS_ID ) D
      
	  <dynamic prepend="WHERE">
	      <isNotEmpty prepend="AND" property="bisClssPathNm">
	  	    D.BIS_CLSS_PATH_NM LIKE #bisClssPathNm:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="AND" property="bisClssId">
		    D.BIS_CLSS_ID = #bisClssId:VARCHAR# 
		  </isNotEmpty>
		  <isNotEmpty prepend="AND" property="chrgOrgCd">	
			D.BIS_CLSS_ID IN (SELECT BIS_CLSS_ID 
								FROM TB_ZZBISORG
							   WHERE ORG_CD= #chrgOrgCd:VARCHAR#)
		  </isNotEmpty>
		  <isNotEmpty prepend="AND" property="presvTermCd">
			D.PRESV_TERM_CD = #presvTermCd:VARCHAR#
		  </isNotEmpty>						
		  <isNotEmpty prepend="AND" property="writeFlag">
			D.WRITE_FLAG = #writeFlag:VARCHAR#
		  </isNotEmpty>			
		  <isNotEmpty prepend="AND" property="bisType">
			D.BIS_TYPE = #bisType:VARCHAR#
		  </isNotEmpty>
		  <isNotEmpty prepend="AND" property="presvTermState">
		   D.PRESV_TERM_STATE = #presvTermState:VARCHAR#
		  <!-- 
		      <isEqual property="presvTermState" compareValue="3">
		        D.PRESV_TERM_STATE  IN ('2','3')
		      </isEqual>
		      <isEqual property="presvTermState" compareValue="4">
		        D.PRESV_TERM_STATE ='4'
		      </isEqual>
		       -->
	      </isNotEmpty>
	      <isNotEmpty prepend="AND" property="startDTimeF">
	      		<isNotEmpty property="startDTimeT">
		      		(D.START_DTIME BETWEEN #startDTimeF:VARCHAR#||'000000' AND #startDTimeT:VARCHAR#||'240000')
	      		</isNotEmpty>
				<isEmpty property="startDTimeT">
					D.START_DTIME <![CDATA[>=]]> #startDTimeF:VARCHAR#||'000000'
				</isEmpty>
		  	</isNotEmpty>
		  	<isEmpty prepend="AND" property="startDTimeF">
		  		<isNotEmpty property="startDTimeT">
		  			D.START_DTIME <![CDATA[<=]]> #startDTimeT:VARCHAR#||'240000'
		  		</isNotEmpty>
		  	</isEmpty>
		<isNotEmpty prepend="AND" property="delFlag">
			D.DEL_FLAG = #delFlag:VARCHAR#
		</isNotEmpty>
	    </dynamic>
         <dynamic>  
		      <isEqual property="order" compareValue="1">
		          ORDER BY START_DTIME
		      </isEqual>
		      <isEqual property="order" compareValue="2">
		          ORDER BY START_DTIME DESC
		      </isEqual>
		      <isEqual  property="order" compareValue="0">
		          ORDER BY BIS_TYPE,BIS_CLSS_NM
		      </isEqual>
	     </dynamic>	
		     
	 </select>
	 
	
	<!-- 기록원 확정 조회  -->
	<select id="findTaskReMedi" parameterClass="rms.stnd.stndinfo.domain.Task" resultMap="stnd-task-remedi-result">
	SELECT D.BIS_CLSS_ID
	       ,D.BIS_CLSS_NM
	       ,D.BIS_CLSS_PATH_NM
	       ,D.BIS_TYPE_NM
	       ,D.START_DTIME
	       ,D.PRESV_TERM_NM
	       ,D.PRESV_TERM_HANDL_STATE_NM
	       ,D.NARS_PRESV_TERM_NM
	       ,D.NARS_CHECK_YMD
	       ,D.NARS_OPIN
	       ,D.DEL_FLAG_NM
	       ,D.DEL_FLAG
	       ,D.TASK_DESCR
	       ,D.PRESV_TERM_STATE
		   ,D.PRESV_TERM_FILE_CREAT_STATE,D.RESUBMIT_FLAG
	 FROM 
	 (SELECT C.BIS_CLSS_ID
	       ,C.BIS_CLSS_NM
	       ,C.BIS_CLSS_PATH_NM
	       ,NVL((SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'ZZ03'
                AND use_flag = '1'
                AND com_cd = REPLACE(C.BIS_TYPE,'B','')),REPLACE(C.BIS_TYPE,'B','')) bis_type_nm
	       ,C.START_DTIME
	       ,(SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'RD07'
                AND use_flag = '1'
                AND com_cd = C.presv_term_cd)  PRESV_TERM_NM            
	       ,(SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'ZZ11'
                AND use_flag = '1'
                AND com_cd = c.presv_term_state) AS presv_term_handl_state_nm,
	        (SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'RD07'
                AND use_flag = '1'
                AND com_cd = B.NARS_PRESV_TERM_CD) NARS_PRESV_TERM_NM
	       ,B.NARS_CHECK_YMD
	       ,B.NARS_OPIN
	       ,(SELECT COM_CD_NM
	           FROM TB_ZZCOMCD
		      WHERE COM_TYPE_CD='ZZ19'
		        AND USE_FLAG='0'
			    AND COM_CD=C.DEL_FLAG)DEL_FLAG_NM
	       ,(SELECT COM_CD_NM
              FROM TB_ZZCOMCD
             WHERE COM_TYPE_CD = 'ZZ01'
               AND USE_FLAG = '1'
               AND COM_CD=C.WRITE_FLAG) WRITE_FLAG_NM
           ,C.DEL_FLAG
           ,C.WRITE_FLAG
           ,REPLACE(C.BIS_TYPE,'B','') bis_type
           ,C.TASK_DESCR
           ,C.PRESV_TERM_STATE
           ,C.PRESV_TERM_FILE_CREAT_STATE,C.RESUBMIT_FLAG
	  FROM (SELECT A.BIS_CLSS_ID, A.bis_clss_nm
           ,SYS_CONNECT_BY_PATH(A.bis_clss_nm,'>') bis_clss_path_nm 
	       ,A.BIS_TYPE
           ,A.START_DTIME
           ,A.PRESV_TERM_CD
	       ,A.PRESV_TERM_STATE
	       ,A.DEL_FLAG
		   ,A.WRITE_FLAG
		   ,A.TASK_DESCR
		   ,A.PRESV_TERM_FILE_CREAT_STATE,DECODE(A.RESUBMIT_FLAG,1,'Y','N') RESUBMIT_FLAG
		   FROM tb_zzbisclss A 
      WHERE A.levl='6' 
           START WITH A.bis_clss_id ='00000000000000000000000000000000000'
      CONNECT BY PRIOR A.bis_clss_id = A.upper_bis_clss_id) C,TB_ZZPRESVTERMHIST B
      WHERE C.BIS_CLSS_ID = B.BIS_CLSS_ID ) D
      
	  <dynamic prepend="WHERE">
	      <isNotEmpty prepend="AND" property="bisClssPathNm">
	  	    D.BIS_CLSS_PATH_NM LIKE #bisClssPathNm:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="AND" property="bisClssId">
		    D.BIS_CLSS_ID = #bisClssId:VARCHAR# 
		  </isNotEmpty>
		  <isNotEmpty prepend="AND" property="chrgOrgCd">	
			D.BIS_CLSS_ID IN (SELECT BIS_CLSS_ID 
								FROM TB_ZZBISORG
							   WHERE ORG_CD= #chrgOrgCd:VARCHAR#)
		  </isNotEmpty>
		  <isNotEmpty prepend="AND" property="presvTermCd">
			D.PRESV_TERM_CD = #presvTermCd:VARCHAR#
		  </isNotEmpty>						
		  <isNotEmpty prepend="AND" property="writeFlag">
			D.WRITE_FLAG = #writeFlag:VARCHAR#
		  </isNotEmpty>			
		  <isNotEmpty prepend="AND" property="bisType">
			D.BIS_TYPE = #bisType:VARCHAR#
		  </isNotEmpty>
		  <isNotEmpty prepend="AND" property="presvTermState">
		    D.PRESV_TERM_STATE = #presvTermState:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="AND" property="startDTimeF">
	      		<isNotEmpty property="startDTimeT">
		      		(D.START_DTIME BETWEEN #startDTimeF:VARCHAR#||'000000' AND #startDTimeT:VARCHAR#||'240000')
	      		</isNotEmpty>
				<isEmpty property="startDTimeT">
					D.START_DTIME <![CDATA[>=]]> #startDTimeF:VARCHAR#||'000000'
				</isEmpty>
		  	</isNotEmpty>
		  	<isEmpty prepend="AND" property="startDTimeF">
		  		<isNotEmpty property="startDTimeT">
		  			D.START_DTIME <![CDATA[<=]]> #startDTimeT:VARCHAR#||'240000'
		  		</isNotEmpty>
		  	</isEmpty>
		  <isNotEmpty prepend="AND" property="delFlag">
			D.DEL_FLAG = #delFlag:VARCHAR#
		  </isNotEmpty>
	     </dynamic>	
      	 <isEqual property="order" compareValue="1">
	          ORDER BY START_DTIME
	      </isEqual>
	      <isEqual property="order" compareValue="2">
	          ORDER BY START_DTIME DESC
	      </isEqual>
	      <isEqual  property="order" compareValue="0">
	          ORDER BY BIS_TYPE,BIS_CLSS_NM
	      </isEqual>
	 </select>
	 
	<!-- 
		SELECT
	 -->
	<select id="findTaskInfo" parameterClass="rms.stnd.stndinfo.domain.Task" resultMap="stnd-taskinfo-result">
		SELECT A.BIS_CLSS_ID
		, A.BIS_CLSS_NM
		, A.PRESV_TERM_CD
		, (SELECT COM_CD_NM	FROM TB_ZZCOMCD	WHERE COM_TYPE_CD = 'RD07' AND USE_FLAG='1' AND COM_CD = A.PRESV_TERM_CD ) presv_term_nm
<!-- 		, (SELECT COM_CD_NM	FROM TB_ZZCOMCD	WHERE COM_TYPE_CD = 'ZZ03' AND USE_FLAG='1' AND COM_CD = SUBSTR (A.BIS_TYPE,2,5) ) BIS_TYPE -->
		, NVL((SELECT COM_CD_NM FROM TB_ZZCOMCD WHERE COM_TYPE_CD = 'ZZ03' AND USE_FLAG = '1' AND COM_CD = REPLACE(A.BIS_TYPE,'B','')),REPLACE(A.BIS_TYPE,'B','')) BIS_TYPE
		, A.START_DTIME
		, A.CLOSE_DTIME
		, A.LAW_BASIS
		, A.PRESV_TERM_FIX_YMD
		, A.PRESV_TERM_FIX_RSN
		, A.OPEN_DETL_STND
	    , A.READ_RANGE_DETL_STND
		, A.FUNSH_RECORD
		, A.FUNSH_FLAG
		, A.FUNSH_RSN
		, A.FUNSH_TERM
		,(SELECT MAX(DECODE(LEVL,1, BIS_CLSS_NM))||'>'||
			   MAX(DECODE(LEVL,2, BIS_CLSS_NM))||'>'||
			   MAX(DECODE(LEVL,3, BIS_CLSS_NM))||'>'||
			   MAX(DECODE(LEVL,4, BIS_CLSS_NM))||'>'||
			   MAX(DECODE(LEVL,5, BIS_CLSS_NM)) BIS_CLSS_FULL_NM
			FROM   TB_ZZBISCLSS
			START WITH BIS_CLSS_ID = #bisClssId:VARCHAR#
			CONNECT BY BIS_CLSS_ID = PRIOR UPPER_BIS_CLSS_ID 
		) BIS_CLSS_PATH_NM
		,(SELECT MAX(DECODE(LEVL,1, PJT_CLSS_NM))||'>'||
			   MAX(DECODE(LEVL,2, PJT_CLSS_NM))||'>'||
			   MAX(DECODE(LEVL,3, PJT_CLSS_NM))||'>'||
			   MAX(DECODE(LEVL,4, PJT_CLSS_NM)) PJT_CLSS_FULL_NM
			FROM   TB_ZZPJTCLSS
			START WITH PJT_CLSS_ID = (SELECT PJT_CLSS_ID FROM TB_ZZPJTMAPPNG WHERE BIS_CLSS_ID = #bisClssId:VARCHAR#)
			CONNECT BY PJT_CLSS_ID = PRIOR UPPER_PJT_CLSS_ID 
		) PJT_CLSS_PATH_NM
		, A.TASK_DESCR
		, (SELECT COM_CD_NM	FROM TB_ZZCOMCD	WHERE COM_TYPE_CD = 'ZZ01' AND USE_FLAG='1' AND COM_CD = A.	WRITE_FLAG ) as WRITE_FLAG
		, A.PRESV_TERM_FIX_YMD
		, A.TASK_REMK
		, A.PRESV_TERM_HANDL_STATE
		, (SELECT COM_CD_NM	FROM TB_ZZCOMCD	WHERE COM_TYPE_CD = 'ZZ11' AND USE_FLAG='1' AND COM_CD = A.PRESV_TERM_STATE) PRESV_TERM_HANDL_STATE_NM
		, A.PRESV_TERM_FIX_RSN
		FROM TB_ZZBISCLSS A
		WHERE A.LEVL = '6'  
		AND A.BIS_CLSS_ID = #bisClssId:VARCHAR#
	</select>
		
	<!-- 
		UPDATE
	 -->	
	<update id="updateTaskMng" parameterClass="rms.stnd.stndinfo.domain.Task">
		  UPDATE TB_ZZBISCLSS
		  SET TASK_REMK = #taskRemk:VARCHAR#
		  , FUNSH_FLAG = #funshFlag:VARCHAR#
		  , FUNSH_RSN = #funshRsn:VARCHAR#
		  , FUNSH_TERM = #funshTerm:VARCHAR#
		  , OPEN_DETL_STND = #openDetlStnd:VARCHAR#
		  , READ_RANGE_DETL_STND = #readRangeDetlStnd:VARCHAR#
		  , FUNSH_RECORD = #funshRecord:VARCHAR#
		  <dynamic>
		  	<isNotEmpty prepend="," property="taskDescr">
		  		TASK_DESCR = #taskDescr:VARCHAR#	
		  	</isNotEmpty>
		  </dynamic>
		  , WRITE_FLAG = '1'
		  WHERE BIS_CLSS_ID = #bisClssId:VARCHAR#
	</update>
	
	<!--  
		SELECT
		ORDER BY 지우면 안됨. Dao에서 순서대로 가져와야 정상적으로 처리되도록 코딩하였음.
	 -->
	<select id="findMidRef" parameterClass="rms.stnd.stndinfo.domain.Task" resultMap="stnd-midref-result">
		SELECT A.BIS_CLSS_NM
		, A.PRESV_TERM_CD
		, (SELECT COM_CD_NM	FROM TB_ZZCOMCD	WHERE COM_TYPE_CD = 'RD07' AND USE_FLAG='1'AND COM_CD = A.PRESV_TERM_CD ) PRESV_TERM_NM 
		, '' BIS_CLSS_PATH_NM
        FROM TB_ZZBISCLSS A
		WHERE PRESV_TERM_CD >'0' AND UPPER_BIS_CLSS_ID IN(
			SELECT BIS_CLSS_ID
			FROM TB_ZZBISCLSS
			WHERE UPPER_BIS_CLSS_ID IN ( 
				SELECT UPPER_BIS_CLSS_ID
				FROM TB_ZZBISCLSS 
				WHERE BIS_CLSS_ID = (
					SELECT UPPER_BIS_CLSS_ID FROM TB_ZZBISCLSS 
					WHERE BIS_CLSS_ID = #bisClssId:VARCHAR# 
					<!-- (TODO: 주관부서가 생기면 이 WHERE 를 사용해야 함) WHERE BIS_CLSS_ID =( SELECT DISTINCT B.BIS_CLSS_ID FROM TB_ZZBISORG B,TB_STORG C	WHERE B.ORG_CD = C.ORG_CD AND B.BIS_CLSS_ID = #bisClssId:VARCHAR# AND C.RECORD_CENTER_ID = #recordCenterId:VARCHAR#) -->				
					) 
				)
			)
		ORDER BY PRESV_TERM_CD, BIS_CLSS_NM
	</select>
	
	<!-- 
		SELECT
	 -->
	<select id="findMidRefNm" parameterClass="rms.stnd.stndinfo.domain.Task" resultMap="stnd-midref-result">
		SELECT DISTINCT '' BIS_CLSS_NM
		, '' PRESV_TERM_CD
		, '' PRESV_TERM_NM 
		,(SELECT MAX(DECODE(LEVL,1, BIS_CLSS_NM))||'>'||
			   MAX(DECODE(LEVL,2, BIS_CLSS_NM))||'>'||
			   MAX(DECODE(LEVL,3, BIS_CLSS_NM))||'>'||
			   MAX(DECODE(LEVL,4, BIS_CLSS_NM)) BIS_CLSS_FULL_NM
			FROM   TB_ZZBISCLSS
			START WITH BIS_CLSS_ID = #bisClssId:VARCHAR#	
			CONNECT BY BIS_CLSS_ID = PRIOR UPPER_BIS_CLSS_ID 
		) BIS_CLSS_PATH_NM
		FROM TB_ZZBISCLSS A
	</select>
	
	<!-- 
		SELECT
	 -->
	<select id="findPresvTerm" parameterClass="rms.stnd.stndinfo.domain.Task" resultMap="stnd-task-result">
		SELECT COM_CD AS PRESV_TERM_CD
		, COM_CD_NM AS PRESV_TERM_NM
		FROM TB_ZZCOMCD
		WHERE COM_TYPE_CD = 'RD07' AND USE_FLAG='1' 
	</select>
	
	<!-- 
		UPDATE
	 -->	
	<update id="updatePresvTermAprov" parameterClass="rms.stnd.stndinfo.domain.Task">
	  UPDATE TB_ZZBISCLSS
	  SET  PRESV_TERM_HANDL_STATE = '2'
	  WHERE PRESV_TERM_HANDL_STATE = '1' AND BIS_CLSS_ID = #bisClssId:VARCHAR# 
	</update>	
	
	<!-- 
		SELECT
		20150402 김경수 : 주관부서 목록 호출 쿼리 수정 (DEL_FLAG 항목 추가)
	 -->
	<select id="findChrgOrg" parameterClass="rms.stnd.stndinfo.domain.Task" resultMap="stnd-chrgorg-result">
		SELECT ORG_CD, ORG_NM, org_abbr_nm, full_org_nm
		FROM TB_STORG 
		WHERE ORG_CD IN (SELECT ORG_CD FROM TB_ZZBISORG WHERE BIS_CLSS_ID = #bisClssId:VARCHAR# AND DEL_FLAG='0' )
	</select>
	
	<!--
		COUNT
	-->
	<select id="countUnitCreat" parameterClass="rms.stnd.stndinfo.domain.Task" resultClass="int">
		SELECT COUNT(1)
		FROM TB_ZZBISCLSS A
		WHERE LEVL = '6'
		AND A.BIS_CLSS_ID IN (SELECT BIS_CLSS_ID FROM TB_ZZBISORG WHERE ORG_CD IN (SELECT ORG_CD FROM TB_STORG WHERE RECORD_CENTER_ID = #recordCenterId:VARCHAR#))
		<dynamic>	
			<isNotEmpty prepend="AND" property="bisClssId">
				A.BIS_CLSS_ID = #bisClssId:VARCHAR#
			</isNotEmpty>			
			<isNotEmpty prepend="AND" property="unitCdTransFlag">
				A.UNIT_CD_TRANS_FLAG = #unitCdTransFlag:VARCHAR#
			</isNotEmpty>					
		</dynamic>			
	</select>
		
	<!-- 
		SELECT
	 -->
	<select id="findUnitCreat" parameterClass="rms.stnd.stndinfo.domain.Task" resultMap="stnd-unitcreat-result">
		SELECT A.BIS_CLSS_ID
		, A.BIS_CLSS_NM
		, A.START_DTIME
		, (SELECT ORG_NM FROM TB_STORG WHERE ORG_CD = (SELECT MIN(ORG_CD) FROM TB_ZZBISORG WHERE BIS_CLSS_ID = A.BIS_CLSS_ID AND ORG_CD IN (SELECT ORG_CD FROM TB_STORG WHERE RECORD_CENTER_ID = #recordCenterId:VARCHAR#))AND RECORD_CENTER_ID = #recordCenterId:VARCHAR#) CHRG_ORG_NM
		, (SELECT ORG_ABBR_NM FROM TB_STORG WHERE ORG_CD = (SELECT MIN(ORG_CD) FROM TB_ZZBISORG WHERE BIS_CLSS_ID = A.BIS_CLSS_ID AND ORG_CD IN (SELECT ORG_CD FROM TB_STORG WHERE RECORD_CENTER_ID = #recordCenterId:VARCHAR#))AND RECORD_CENTER_ID = #recordCenterId:VARCHAR#) CHRG_ORG_ABBR_NM		
		, A.TRANS_UNIT_CD UNIT_CD
		, (SELECT COM_CD_NM	FROM TB_ZZCOMCD	WHERE COM_TYPE_CD = 'ZZ16' AND USE_FLAG='1' AND COM_CD = A.UNIT_CD_TRANS_FLAG) UNIT_CD_TRANS_FLAG
		FROM TB_ZZBISCLSS A
		WHERE LEVL = '6'
		AND A.BIS_CLSS_ID IN (SELECT BIS_CLSS_ID FROM TB_ZZBISORG WHERE ORG_CD IN (SELECT ORG_CD FROM TB_STORG WHERE RECORD_CENTER_ID = #recordCenterId:VARCHAR#))
		<dynamic>	
			<isNotEmpty prepend="AND" property="bisClssId">
				A.BIS_CLSS_ID = #bisClssId:VARCHAR#
			</isNotEmpty>			
			<isNotEmpty prepend="AND" property="unitCdTransFlag">
				A.UNIT_CD_TRANS_FLAG = #unitCdTransFlag:VARCHAR#
			</isNotEmpty>					
		</dynamic>					
	</select>
	
	
	<!-- 
		UPDATE
	 -->	
	<update id="updateTransUnitCd" parameterClass="rms.stnd.stndinfo.domain.Task">
	  UPDATE TB_ZZBISCLSS
	  SET  TRANS_UNIT_CD = #unitCd:VARCHAR# 
	  , UNIT_CD_TRANS_FLAG = #unitCdTransFlag:VARCHAR# 
	  WHERE BIS_CLSS_ID = #bisClssId:VARCHAR# 
	</update>	
	

	
	<!-- 
		SELECT
	 -->
	<select id="findTaskForUnit" parameterClass="rms.stnd.stndinfo.domain.Task" resultMap="stnd-taskforunit-result">
		SELECT A.WORK_DTIME NARS_HANDL_DTIME
			, A.START_DTIME CREAT_STND_YMD
			, (SELECT UPPER_BIS_CLSS_ID FROM TB_ZZBISCLSS WHERE BIS_CLSS_ID = (SELECT UPPER_BIS_CLSS_ID FROM TB_ZZBISCLSS WHERE BIS_CLSS_ID = A.UPPER_BIS_CLSS_ID)) LRG_CD
			, (SELECT BIS_CLSS_NM FROM TB_ZZBISCLSS WHERE BIS_CLSS_ID = (SELECT UPPER_BIS_CLSS_ID FROM TB_ZZBISCLSS WHERE BIS_CLSS_ID = (SELECT UPPER_BIS_CLSS_ID FROM TB_ZZBISCLSS WHERE BIS_CLSS_ID = A.UPPER_BIS_CLSS_ID))) LRG_NM
			, (SELECT UPPER_BIS_CLSS_ID FROM TB_ZZBISCLSS WHERE BIS_CLSS_ID = A.UPPER_BIS_CLSS_ID) MID_CD
			, (SELECT BIS_CLSS_NM FROM TB_ZZBISCLSS WHERE BIS_CLSS_ID = (SELECT UPPER_BIS_CLSS_ID FROM TB_ZZBISCLSS WHERE BIS_CLSS_ID = A.UPPER_BIS_CLSS_ID)) MID_NM
			, A.UPPER_BIS_CLSS_ID SML_CD
			, (SELECT BIS_CLSS_NM FROM TB_ZZBISCLSS WHERE BIS_CLSS_ID = A.UPPER_BIS_CLSS_ID) SML_NM
			, '' UNIT_CD
			, A.BIS_CLSS_NM UNIT_NM
			, A.TASK_DESCR UNIT_DESCR
			, A.PRESV_TERM_CD
			, A.PRESV_TERM_FIX_RSN
			, DECODE(A.DEL_FLAG,0,'1',1,'2') STATE_CD
			, A.LINK_DTIME
		FROM TB_ZZBISCLSS A
		WHERE LEVL = '6'
		AND BIS_CLSS_ID = #bisClssId:VARCHAR# 
	</select>
	
	
	<!-- 
		SELECT
	 -->
	<select id="checkLinkDtimeAndTaskDel" parameterClass="rms.stnd.unitcreat.domain.SendUnit" resultMap="stnd-delflag-result">
		SELECT A.DEL_FLAG
		, A.LINK_DTIME
		, A.BIS_CLSS_ID
		FROM TB_ZZBISCLSS A
		WHERE TRANS_UNIT_CD = #unitCd:VARCHAR# 
	</select>
	
	
	<!-- 
		SELECT
	 -->
	<select id="findChrgOrgDelFlag" parameterClass="rms.stnd.stndinfo.domain.Task" resultMap="stnd-chrgorgdelflag-result">
		SELECT DEL_FLAG 
		FROM TB_ZZBISORG 
		WHERE BIS_CLSS_ID = #bisClssId:VARCHAR# AND ORG_CD = #orgCd:VARCHAR#
	</select>

	<!-- 
		SELECT
	 -->
	<select id="findAddChrgOrg" parameterClass="rms.stnd.unitcreat.domain.SendUnit" resultMap="stnd-chrgorg-result">
		SELECT B.ORG_CD
			, (SELECT ORG_NM FROM TB_STORG WHERE ORG_CD = B.ORG_CD AND RECORD_CENTER_ID = #recordCenterId:VARCHAR#) ORG_NM
			, (SELECT ORG_ABBR_NM FROM TB_STORG WHERE ORG_CD = B.ORG_CD AND RECORD_CENTER_ID = #recordCenterId:VARCHAR#) ORG_ABBR_NM
			, (SELECT FULL_ORG_NM FROM TB_STORG WHERE ORG_CD = B.ORG_CD AND RECORD_CENTER_ID = #recordCenterId:VARCHAR#) FULL_ORG_NM
		FROM TB_ZZBISCLSS A, TB_ZZBISORG B
		WHERE A.BIS_CLSS_ID = B.BIS_CLSS_ID 
		AND B.ORG_CD IN (SELECT ORG_CD FROM TB_STORG WHERE RECORD_CENTER_ID = #recordCenterId:VARCHAR#)
		AND A.TRANS_UNIT_CD = #unitCd:VARCHAR#
		AND B.ORG_CD NOT IN(SELECT ORG_CD FROM TB_ZZSENDUNITORG WHERE TRANS_UNIT_CD= #unitCd:VARCHAR# AND RECORD_CENTER_ID = #recordCenterId:VARCHAR#)
	</select>
	<!-- 
		보존기간 조회
	 -->
	<select id="countPresvTerm" parameterClass="string" resultClass="int">
	    SELECT count(1)
	    FROM TB_ZZCOMCD
	    WHERE COM_TYPE_CD='RD07'
	    AND (COM_CD = #value#
	    OR COM_CD_NM = #value#)
	</select>
	
	<!-- 
	     기록원 신청 조회 Count
	-->
	<select id="countNarsReqBisClss" parameterClass="rms.stnd.stndinfo.domain.Task" resultClass="int">
	SELECT COUNT(1)
	 FROM 
	 (SELECT C.BIS_CLSS_ID
	       ,C.BIS_CLSS_NM
	       ,C.BIS_CLSS_PATH_NM
	       ,(SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'ZZ03'
                AND use_flag = '1'
                AND com_cd = REPLACE(C.BIS_TYPE,'B','')) bis_type_nm
	       ,C.START_DTIME
	       ,(SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'RD07'
                AND use_flag = '1'
                AND com_cd = C.presv_term_cd)  PRESV_TERM_NM
	       ,(SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'ZZ11'
                AND use_flag = '1'
                AND com_cd =C.presv_term_state) PRESV_TERM_HANDL_STATE_NM
	       ,(SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'RD07'
                AND use_flag = '1'
                AND com_cd = B.RECORD_CENTER_PRESV_TERM_CD) RECORD_CENTER_PRESV_TERM_NM
	       ,B.RECORD_CENTER_CHECK_YMD
	       ,B.RECORD_CENTER_OPIN
	       ,(SELECT COM_CD_NM
	           FROM TB_ZZCOMCD
		      WHERE COM_TYPE_CD='ZZ19'
		        AND USE_FLAG='0'
			    AND COM_CD=C.DEL_FLAG)DEL_FLAG_NM
	       ,(SELECT COM_CD_NM
              FROM TB_ZZCOMCD
             WHERE COM_TYPE_CD = 'ZZ01'
               AND USE_FLAG = '1'
               AND COM_CD=C.WRITE_FLAG) WRITE_FLAG_NM
           ,C.DEL_FLAG
           ,C.WRITE_FLAG
           ,REPLACE(C.BIS_TYPE,'B','') bis_type
           ,C.PRESV_TERM_STATE
	  FROM (SELECT A.BIS_CLSS_ID, A.bis_clss_nm
           ,SYS_CONNECT_BY_PATH(A.bis_clss_nm,'>') bis_clss_path_nm 
	       ,A.BIS_TYPE
           ,A.START_DTIME
           ,A.PRESV_TERM_CD
	       ,A.PRESV_TERM_STATE
	       ,A.DEL_FLAG
		   ,A.WRITE_FLAG
		   FROM tb_zzbisclss A 
      WHERE A.levl='6' 
      <dynamic>
		<isNotEmpty property="hwakjongFlag">	
			<isEqual prepend="AND" property="hwakjongFlag" compareValue="1">
				A.PRESV_TERM_STATE=4
			</isEqual>
			<isEqual prepend="AND" property="hwakjongFlag" compareValue="0">			
				A.PRESV_TERM_STATE IN (2,3)
			</isEqual>				
		</isNotEmpty>
        </dynamic>
           START WITH A.bis_clss_id ='00000000000000000000000000000000000'
      CONNECT BY PRIOR A.bis_clss_id = A.upper_bis_clss_id) C,TB_ZZPRESVTERMHIST B
      WHERE C.BIS_CLSS_ID = B.BIS_CLSS_ID ) D
            <dynamic prepend="WHERE">
          <isNotEmpty prepend="AND" property="bisClssPathNm">
	  	    D.BIS_CLSS_PATH_NM LIKE #bisClssPathNm:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="AND" property="bisClssId">
		    D.BIS_CLSS_ID = #bisClssId:VARCHAR# 
		  </isNotEmpty>
		  <isNotEmpty prepend="AND" property="chrgOrgCd">	
			D.BIS_CLSS_ID IN (SELECT BIS_CLSS_ID 
								FROM TB_ZZBISORG
							   WHERE ORG_CD= #chrgOrgCd:VARCHAR#)
		  </isNotEmpty>
		  <isNotEmpty prepend="AND" property="presvTermCd">
			D.PRESV_TERM_CD = #presvTermCd:VARCHAR#
		  </isNotEmpty>						
		  <isNotEmpty prepend="AND" property="bisType">
			D.BIS_TYPE = #bisType:VARCHAR#
		  </isNotEmpty>
	      <isNotEmpty prepend="AND" property="delFlag">
			D.DEL_FLAG = #delFlag:VARCHAR#
		  </isNotEmpty>
		</dynamic>
	 </select>
	 
	<!-- 
		기록원 신청 조회 
	-->
	<select id="findNarsReqBisClss" parameterClass="rms.stnd.stndinfo.domain.Task" resultMap="stnd-task-narsreq-result">
	SELECT D.BIS_CLSS_ID
	       ,D.BIS_CLSS_NM
	       ,D.BIS_CLSS_PATH_NM
	       ,D.BIS_TYPE_NM
	       ,D.START_DTIME
	       ,D.PRESV_TERM_NM
	       ,D.RECORD_CENTER_PRESV_TERM_NM
	       ,D.RECORD_CENTER_CHECK_YMD
	       ,D.RECORD_CENTER_OPIN
	       ,D.DEL_FLAG_NM
	       ,D.DEL_FLAG
	       ,D.BIS_TYPE
	       ,D.TASK_DESCR,D.RESUBMIT_FLAG
	 FROM 
	 (SELECT C.BIS_CLSS_ID
	       ,C.BIS_CLSS_NM
	       ,C.BIS_CLSS_PATH_NM
	       ,NVL((SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'ZZ03'
                AND use_flag = '1'
                AND com_cd = REPLACE(C.BIS_TYPE,'B','')),REPLACE(C.BIS_TYPE,'B','')) bis_type_nm
	       ,C.START_DTIME
	       ,(SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'RD07'
                AND use_flag = '1'
                AND com_cd = C.presv_term_cd)  PRESV_TERM_NM
	       ,(SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'ZZ11'
                AND use_flag = '1'
                AND com_cd =C.presv_term_state) PRESV_TERM_HANDL_STATE_NM
	       ,(SELECT com_cd_nm
               FROM tb_zzcomcd
              WHERE com_type_cd = 'RD07'
                AND use_flag = '1'
                AND com_cd = B.RECORD_CENTER_PRESV_TERM_CD) RECORD_CENTER_PRESV_TERM_NM
	       ,B.RECORD_CENTER_CHECK_YMD
	       ,B.RECORD_CENTER_OPIN
	       ,(SELECT COM_CD_NM
	           FROM TB_ZZCOMCD
		      WHERE COM_TYPE_CD='ZZ19'
		        AND USE_FLAG='0'
			    AND COM_CD=C.DEL_FLAG)DEL_FLAG_NM
	       ,(SELECT COM_CD_NM
              FROM TB_ZZCOMCD
             WHERE COM_TYPE_CD = 'ZZ01'
               AND USE_FLAG = '1'
               AND COM_CD=C.WRITE_FLAG) WRITE_FLAG_NM
           ,C.DEL_FLAG
           ,C.WRITE_FLAG
           ,C.TASK_DESCR
           ,REPLACE(C.BIS_TYPE,'B','') bis_type
           ,C.PRESV_TERM_STATE,C.RESUBMIT_FLAG
	  FROM (SELECT A.BIS_CLSS_ID, A.bis_clss_nm
           ,SYS_CONNECT_BY_PATH(A.bis_clss_nm,'>') bis_clss_path_nm 
	       ,A.BIS_TYPE
           ,A.START_DTIME
           ,A.PRESV_TERM_CD
	       ,A.PRESV_TERM_STATE
	       ,A.DEL_FLAG
		   ,A.WRITE_FLAG
		   ,A.TASK_DESCR,DECODE(A.RESUBMIT_FLAG,1,'Y','N') RESUBMIT_FLAG
		   FROM tb_zzbisclss A 
      WHERE A.levl='6' 
      <dynamic>
		<isNotEmpty property="hwakjongFlag">	
			<isEqual prepend="AND" property="hwakjongFlag" compareValue="1">
				A.PRESV_TERM_STATE=4
			</isEqual>
			<isEqual prepend="AND" property="hwakjongFlag" compareValue="0">			
				A.PRESV_TERM_STATE IN (2,3)
			</isEqual>				
		</isNotEmpty>
        </dynamic>
           START WITH A.bis_clss_id ='00000000000000000000000000000000000'
      CONNECT BY PRIOR A.bis_clss_id = A.upper_bis_clss_id) C,TB_ZZPRESVTERMHIST B
      WHERE C.BIS_CLSS_ID = B.BIS_CLSS_ID ) D
      <dynamic prepend="WHERE">
          <isNotEmpty prepend="AND" property="bisClssPathNm">
	  	    D.BIS_CLSS_PATH_NM LIKE #bisClssPathNm:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="AND" property="bisClssId">
		    D.BIS_CLSS_ID = #bisClssId:VARCHAR# 
		  </isNotEmpty>
		  <isNotEmpty prepend="AND" property="chrgOrgCd">	
			D.BIS_CLSS_ID IN (SELECT BIS_CLSS_ID 
								FROM TB_ZZBISORG
							   WHERE ORG_CD= #chrgOrgCd:VARCHAR#)
		  </isNotEmpty>
		  <isNotEmpty prepend="AND" property="presvTermCd">
			D.PRESV_TERM_CD = #presvTermCd:VARCHAR#
		  </isNotEmpty>						
		  <isNotEmpty prepend="AND" property="bisType">
			D.BIS_TYPE = #bisType:VARCHAR#
		  </isNotEmpty>
	      <isNotEmpty prepend="AND" property="delFlag">
			D.DEL_FLAG = #delFlag:VARCHAR#
		  </isNotEmpty>
	  </dynamic>
	  <dynamic>
		  <isEqual property="order" compareValue="1">
		      ORDER BY START_DTIME
		  </isEqual>
		  <isEqual property="order" compareValue="2">
		      ORDER BY START_DTIME DESC
		  </isEqual>
		  <isEqual  property="order" compareValue="0">
		      ORDER BY BIS_TYPE,BIS_CLSS_NM
		  </isEqual>
		</dynamic>	
	 </select>
</sqlMap>